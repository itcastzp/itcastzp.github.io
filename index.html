<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.0/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"8.0.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="ZP">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Hexo</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Hexo</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">ZP</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">14</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </section>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">
      

      
    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/12/JVMPerformanceOptimization%20At%20Twitter/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ZP">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/12/JVMPerformanceOptimization%20At%20Twitter/" class="post-title-link" itemprop="url">推特的JVM调优</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2020-10-12 18:22:18 / 修改时间：18:26:55" itemprop="dateCreated datePublished" datetime="2020-10-12T18:22:18+08:00">2020-10-12</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="JVMPerformanceOptimization-At-Twitter"><a href="#JVMPerformanceOptimization-At-Twitter" class="headerlink" title="JVMPerformanceOptimization At Twitter"></a>JVMPerformanceOptimization At Twitter</h1><ol>
<li><p>Memory tuning</p>
</li>
<li><p>CPU usage tuning</p>
</li>
<li><p>Lock contention tuning</p>
</li>
<li><p>I/O tuning</p>
</li>
</ol>
<h2 id="潜在的贡献者"><a href="#潜在的贡献者" class="headerlink" title="潜在的贡献者"></a>潜在的贡献者</h2><ul>
<li><p>垃圾回收器</p>
</li>
<li><p>其他为不分先后顺序：</p>
<ul>
<li><p>进程锁和线程调度</p>
</li>
<li><p>I/O</p>
</li>
<li><p>程序算法效率低</p>
</li>
</ul>
</li>
</ul>
<h2 id="性能优化点"><a href="#性能优化点" class="headerlink" title="性能优化点"></a>性能优化点</h2><ul>
<li>内存优化</li>
<li>CPU使用率优化</li>
<li>锁争用优化</li>
<li>I/O优化</li>
</ul>
<h3 id="内存优化点"><a href="#内存优化点" class="headerlink" title="内存优化点"></a>内存优化点</h3><ul>
<li><p>内存占用优化</p>
<ul>
<li><p>so you got an OutOfMemoryError….</p>
<ul>
<li><p>可能你的数据量太大</p>
<ul>
<li><p>通过jvm 参数 -verbose:gc运行程序</p>
</li>
<li><p>观察Full GC消息里的GC数据数量 [Full GC $before-&gt;$after($total), $time secs]  </p>
</li>
<li><p>思考是否可以给JVM分配更多的内存</p>
</li>
<li><p>思考是否在内存中需要所有的数据，考虑使用：</p>
<ul>
<li>​                                                                        一个LRU 缓存。或者其他</li>
<li>​                                                                       考虑使用软引用</li>
</ul>
<p>​                                                                        </p>
</li>
</ul>
</li>
<li><p>可能你的数据定义很臃肿</p>
<ul>
<li><p>当你做些怪异的事情，可能出现问题</p>
<ul>
<li>载入twitter全部的社会关系图在一个JVM中</li>
<li>载入全部的用户元数据在一个JVM中</li>
</ul>
</li>
<li><p>简化数据内部的代表                                                                   </p>
</li>
</ul>
</li>
<li><p>也可能是真正的内存泄露</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>内存分配频率优化</p>
</li>
<li><p>垃圾回收优化</p>
</li>
</ul>
<h2 id="Fat-Data-Object-Header"><a href="#Fat-Data-Object-Header" class="headerlink" title="Fat Data Object Header"></a>Fat Data Object Header</h2><ul>
<li>JVM 对象头 通常消耗两个机器字节码</li>
<li>16字节，或者在64位JVM上占用128 位</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/07/28/Spring%20Boot%E5%8F%82%E8%80%83%E6%8C%87%E5%8D%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ZP">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/28/Spring%20Boot%E5%8F%82%E8%80%83%E6%8C%87%E5%8D%97/" class="post-title-link" itemprop="url">Spring Boot参考指南</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2020-07-28 16:26:46 / 修改时间：16:27:59" itemprop="dateCreated datePublished" datetime="2020-07-28T16:26:46+08:00">2020-07-28</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Spring-Boot参考指南"><a href="#Spring-Boot参考指南" class="headerlink" title="Spring Boot参考指南"></a>Spring Boot参考指南</h1><h2 id="作者"><a href="#作者" class="headerlink" title="作者"></a>作者</h2><p>Phillip Webb, Dave Syer, Josh Long, Stéphane Nicoll, Rob Winch, Andy Wilkinson, Marcel Overdijk, Christian Dupuis, Sébastien Deleuze, Michael Simons, Vedran Pavić, Jay Bryant, Madhura Bhave</p>
<p>2.1.1.RELEASE</p>
<p>版权所有©2012-2018</p>
<p>本文档的副本可供您自己使用并分发给他人，前提是您不对此类副本收取任何费用，并且每份副本均包含本版权声明，无论是以印刷版还是电子版分发。</p>
<hr>
<h1 id="第一部分。Spring-Boot文件"><a href="#第一部分。Spring-Boot文件" class="headerlink" title="第一部分。Spring Boot文件"></a>第一部分。Spring Boot文件</h1><p>本节简要概述了Spring Boot参考文档。它用作文档其余部分的映射。</p>
<h2 id="1-关于文档"><a href="#1-关于文档" class="headerlink" title="1.关于文档"></a>1.关于文档</h2><p>Spring Boot参考指南可用作</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/reference/html">HTML</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/reference/pdf/spring-boot-reference.pdf">PDF</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/reference/epub/spring-boot-reference.epub">EPUB</a></li>
</ul>
<p>最新的副本可在<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference">docs.spring.io/spring-boot/docs/current/reference上找到</a>。</p>
<p>本文档的副本可供您自己使用并分发给他人，前提是您不对此类副本收取任何费用，并且每份副本均包含本版权声明，无论是以印刷版还是电子版分发。</p>
<h2 id="2-获得帮助"><a href="#2-获得帮助" class="headerlink" title="2.获得帮助"></a>2.获得帮助</h2><p>如果您在使用Spring Boot时遇到问题，我们很乐意为您提供帮助。</p>
<ul>
<li>尝试使用<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#howto">方法文档</a>。他们为最常见的问题提供解决方案。</li>
<li>了解Spring基础知识。Spring Boot以许多其他Spring项目为基础。查看 <a target="_blank" rel="noopener" href="https://spring.io/">spring.io</a>网站以获取大量参考文档。如果您从Spring开始，请尝试其中一个<a target="_blank" rel="noopener" href="https://spring.io/guides">指南</a>。</li>
<li>问一个问题。我们监控<a target="_blank" rel="noopener" href="https://stackoverflow.com/">stackoverflow.com</a>以获取标记的问题<a target="_blank" rel="noopener" href="https://stackoverflow.com/tags/spring-boot"><code>spring-boot</code></a>。</li>
<li>在<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/issues">github.com/spring-projects/spring-boot/issues上</a>使用Spring Boot报告错误。</li>
</ul>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>所有Spring Boot都是开源的，包括文档。如果您发现文档存在问题或想要改进它们，请<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE">参与其中</a>。</td>
</tr>
</tbody></table>
<h2 id="3-第一步"><a href="#3-第一步" class="headerlink" title="3.第一步"></a>3.第一步</h2><p>如果您开始使用Spring Boot或“Spring”，请从<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#getting-started">以下主题</a>开始 ：</p>
<ul>
<li><strong>从头开始：</strong> <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#getting-started-introducing-spring-boot">概述</a> | <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#getting-started-system-requirements">要求</a> | <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#getting-started-installing-spring-boot">安装</a></li>
<li><strong>教程：</strong> <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#getting-started-first-application">第1部分</a> | <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#getting-started-first-application-code">第2部分</a></li>
<li><strong>运行你的例子：</strong> <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#getting-started-first-application-run">第1部分</a> | <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#getting-started-first-application-executable-jar">第2部分</a></li>
</ul>
<h2 id="4-使用Spring-Boot"><a href="#4-使用Spring-Boot" class="headerlink" title="4.使用Spring Boot"></a>4.使用Spring Boot</h2><p>准备开始使用Spring Boot？<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot">我们为您提供</a>：</p>
<ul>
<li><strong>构建系统：</strong> <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-maven">Maven</a> | <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-gradle">Gradle</a> | <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-ant">Ant</a> | <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-starter">Starters</a></li>
<li><strong>最佳实践：</strong> <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-structuring-your-code">代码结构</a> | <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-configuration-classes">@Configuration</a> | <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-auto-configuration">@EnableAutoConfiguration</a> | <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-spring-beans-and-dependency-injection">Beans和依赖注入</a></li>
<li><strong>运行代码</strong> <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-running-from-an-ide">IDE</a> | <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-running-as-a-packaged-application">打包</a> | <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-running-with-the-maven-plugin">Maven</a> | <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-running-with-the-gradle-plugin">Gradle</a></li>
<li><strong>打包您的应用程序：</strong> <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-packaging-for-production">生产罐</a></li>
<li><strong>Spring Boot CLI：</strong> <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#cli">使用CLI</a></li>
</ul>
<h2 id="5-了解Spring-Boot功能"><a href="#5-了解Spring-Boot功能" class="headerlink" title="5.了解Spring Boot功能"></a>5.了解Spring Boot功能</h2><p>需要有关Spring Boot核心功能的更多详细信息？ <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features">以下内容适合您</a>：</p>
<ul>
<li><strong>核心功能：</strong> <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-spring-application">SpringApplication</a> | <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-external-config">外部配置</a> | <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-profiles">个人资料</a> | <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-logging">记录</a></li>
<li><strong>Web应用程序：</strong> <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-spring-mvc">MVC</a> | <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-embedded-container">嵌入式容器</a></li>
<li><strong>使用数据：</strong> <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-sql">SQL</a> | <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-nosql">NO-SQL</a></li>
<li><strong>消息：</strong> <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-messaging">概述</a> | <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-jms">JMS</a></li>
<li><strong>测试：</strong> <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-testing">概述</a> | <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-testing-spring-boot-applications">启动应用程序</a> | <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-test-utilities">utils的</a></li>
<li><strong>扩展：</strong> <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-developing-auto-configuration">自动配置</a> | <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-condition-annotations">@条件</a></li>
</ul>
<h2 id="6-转向生产"><a href="#6-转向生产" class="headerlink" title="6.转向生产"></a>6.转向生产</h2><p>当您准备将Spring Boot应用程序推向生产时，我们有 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready">一些</a>您可能喜欢的<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready">技巧</a>：</p>
<ul>
<li><strong>管理端点：</strong> <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready-endpoints">概述</a> | <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#">定制</a></li>
<li><strong>连接选项：</strong> <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready-monitoring">HTTP</a> | <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready-jmx">JMX</a></li>
<li><strong>监控：</strong> <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready-metrics">指标</a> | <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready-auditing">审计</a> | <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#">追踪</a> | <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready-process-monitoring">处理</a></li>
</ul>
<h2 id="7-高级主题"><a href="#7-高级主题" class="headerlink" title="7.高级主题"></a>7.高级主题</h2><p>最后，我们为更高级的用户提供了一些主题：</p>
<ul>
<li><strong>Spring Boot应用程序部署：</strong> <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#cloud-deployment">云部署</a> | <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#deployment-service">OS服务</a></li>
<li><strong>构建工具插件：</strong> <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#build-tool-plugins-maven-plugin">Maven</a> | <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#build-tool-plugins-gradle-plugin">Gradle</a></li>
<li><strong>附录：</strong> <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#common-application-properties">应用程序属性</a> | <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#auto-configuration-classes">自动配置类</a> | <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#executable-jar">可执行的罐子</a></li>
</ul>
<h1 id="第二部分。入门"><a href="#第二部分。入门" class="headerlink" title="第二部分。入门"></a>第二部分。入门</h1><p>如果您开始使用Spring Boot或“Spring”，请首先阅读本节。它回答了基本的“什么？”，“如何？”和“为什么？”的问题。它包括对Spring Boot的介绍以及安装说明。然后，我们将引导您构建您的第一个Spring Boot应用程序，并在我们讨论时讨论一些核心原则。</p>
<h2 id="8-介绍Spring-Boot"><a href="#8-介绍Spring-Boot" class="headerlink" title="8.介绍Spring Boot"></a>8.介绍Spring Boot</h2><p>Spring Boot可以轻松创建可以运行的独立的，基于生产级Spring的应用程序。我们对Spring平台和第三方库进行了自以为是的观点，以便您可以尽量少开始。大多数Spring Boot应用程序需要非常少的Spring配置。</p>
<p>您可以使用Spring Boot创建可以使用<code>java -jar</code>或更多传统战争部署启动的Java应用程序。我们还提供了一个运行“spring脚本”的命令行工具。</p>
<p>我们的主要目标是：</p>
<ul>
<li>为所有Spring开发提供从根本上更快且可广泛访问的入门体验。</li>
<li>开箱即用，但随着需求开始偏离默认值而迅速摆脱困境。</li>
<li>提供大型项目（例如嵌入式服务器，安全性，度量标准，运行状况检查和外部化配置）通用的一系列非功能性功能。</li>
<li>绝对没有代码生成，也不需要XML配置。</li>
</ul>
<h2 id="9-系统要求"><a href="#9-系统要求" class="headerlink" title="9.系统要求"></a>9.系统要求</h2><p>Spring Boot 2.1.1.RELEASE需要<a target="_blank" rel="noopener" href="https://www.java.com/">Java 8</a>并且与Java 11兼容（包括在内）。<a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/">Spring框架5.1.3.RELEASE</a> 或以上也是必需的。</p>
<p>为以下构建工具提供了显式构建支持：</p>
<table>
<thead>
<tr>
<th>构建工具</th>
<th>版</th>
</tr>
</thead>
<tbody><tr>
<td>Maven</td>
<td>3.3+</td>
</tr>
<tr>
<td>Gradle</td>
<td>4.4+</td>
</tr>
</tbody></table>
<h2 id="9-1-Servlet容器"><a href="#9-1-Servlet容器" class="headerlink" title="9.1 Servlet容器"></a>9.1 Servlet容器</h2><p>Spring Boot支持以下嵌入式servlet容器：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>Servlet版本</th>
</tr>
</thead>
<tbody><tr>
<td>Tomcat 9.0</td>
<td>4.0</td>
</tr>
<tr>
<td>Jetty 9.4</td>
<td>3.1</td>
</tr>
<tr>
<td>Undertow 2.0</td>
<td>4.0</td>
</tr>
</tbody></table>
<p>您还可以将Spring Boot应用程序部署到任何Servlet 3.1+兼容容器。</p>
<h2 id="10-安装Spring-Boot"><a href="#10-安装Spring-Boot" class="headerlink" title="10.安装Spring Boot"></a>10.安装Spring Boot</h2><p>Spring Boot可以与“经典”Java开发工具一起使用，也可以作为命令行工具安装。无论哪种方式，您都需要<a target="_blank" rel="noopener" href="https://www.java.com/">Java SDK v1.8</a>或更高版本。在开始之前，您应该使用以下命令检查当前的Java安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ java -version</span><br></pre></td></tr></table></figure>

<p>如果您不熟悉Java开发，或者想要试用Spring Boot，则可能需要先尝试<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#getting-started-installing-the-cli">Spring Boot CLI</a>（命令行界面）。否则，请继续阅读“经典”安装说明。</p>
<h2 id="10-1-Java-Developer的安装说明"><a href="#10-1-Java-Developer的安装说明" class="headerlink" title="10.1 Java Developer的安装说明"></a>10.1 Java Developer的安装说明</h2><p>您可以像使用任何标准Java库一样使用Spring Boot。为此，请在类路径中包含相应的<code>spring-boot-*.jar</code>文件。Spring Boot不需要任何特殊工具集成，因此您可以使用任何IDE或文本编辑器。此外，Spring Boot应用程序没有什么特别之处，因此您可以像运行任何其他Java程序一样运行和调试Spring引导应用程序。</p>
<p>虽然您<em>可以</em>复制Spring Boot罐，但我们通常建议您使用支持依赖关系管理的构建工具（例如Maven或Gradle）。</p>
<h3 id="10-1-1-Maven安装"><a href="#10-1-1-Maven安装" class="headerlink" title="10.1.1 Maven安装"></a>10.1.1 Maven安装</h3><p>Spring Boot与Apache Maven 3.3或更高版本兼容。如果您尚未安装Maven，则可以按照<a target="_blank" rel="noopener" href="https://maven.apache.org/">maven.apache.org上</a>的说明进行操作。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>在许多操作系统上，Maven可以与软件包管理器一起安装。如果您使用OSX Homebrew，请尝试<code>brew install maven</code>。Ubuntu用户可以运行<code>sudo apt-get install maven</code>。使用<a target="_blank" rel="noopener" href="https://chocolatey.org/">Chocolatey的</a> Windows用户可以从提升（管理员）提示符运行<code>choco install maven</code>。</td>
</tr>
</tbody></table>
<p>Spring Boot依赖项使用<code>org.springframework.boot</code> <code>groupId</code>。通常，您的Maven POM文件继承自<code>spring-boot-starter-parent</code>项目，并声明对一个或多个<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-starter">“Starters”的</a>依赖关系。Spring Boot还提供了一个可选的 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#build-tool-plugins-maven-plugin">Maven插件</a>来创建可执行jar。</p>
<p>以下清单显示了典型的<code>pom.xml</code>文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot; xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">	xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">	&lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"></span><br><span class="line">	&lt;groupId&gt;com.example&lt;&#x2F;groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;myproject&lt;&#x2F;artifactId&gt;</span><br><span class="line">	&lt;version&gt;0.0.1-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line"></span><br><span class="line">	&lt;!-- Inherit defaults from Spring Boot --&gt;</span><br><span class="line">	&lt;parent&gt;</span><br><span class="line">		&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">		&lt;artifactId&gt;spring-boot-starter-parent&lt;&#x2F;artifactId&gt;</span><br><span class="line">		&lt;version&gt;2.1.1.RELEASE&lt;&#x2F;version&gt;</span><br><span class="line">	&lt;&#x2F;parent&gt;</span><br><span class="line"></span><br><span class="line">	&lt;!-- Add typical dependencies for a web application --&gt;</span><br><span class="line">	&lt;dependencies&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-boot-starter-web&lt;&#x2F;artifactId&gt;</span><br><span class="line">		&lt;&#x2F;dependency&gt;</span><br><span class="line">	&lt;&#x2F;dependencies&gt;</span><br><span class="line"></span><br><span class="line">	&lt;!-- Package as an executable jar --&gt;</span><br><span class="line">	&lt;build&gt;</span><br><span class="line">		&lt;plugins&gt;</span><br><span class="line">			&lt;plugin&gt;</span><br><span class="line">				&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">				&lt;artifactId&gt;spring-boot-maven-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">			&lt;&#x2F;plugin&gt;</span><br><span class="line">		&lt;&#x2F;plugins&gt;</span><br><span class="line">	&lt;&#x2F;build&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td><code>spring-boot-starter-parent</code>是使用Spring Boot的好方法，但它可能并不适合所有时间。有时您可能需要从其他父POM继承，或者您可能不喜欢我们的默认设置。在这些情况下，请参见 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-maven-without-a-parent">第13.2.2节“使用不带父POM的Spring Boot”</a>作为使用<code>import</code>范围的替代解决方案。</td>
</tr>
</tbody></table>
<h3 id="10-1-2-Gradle安装"><a href="#10-1-2-Gradle安装" class="headerlink" title="10.1.2 Gradle安装"></a>10.1.2 Gradle安装</h3><p>Spring Boot与Gradle 4.4及更高版本兼容。如果您尚未安装Gradle，则可以按照<a target="_blank" rel="noopener" href="https://gradle.org/">gradle.org上</a>的说明进行<a target="_blank" rel="noopener" href="https://gradle.org/">操作</a>。</p>
<p>可以使用<code>org.springframework.boot</code> <code>group</code>声明Spring Boot依赖项。通常，您的项目会声明对一个或多个<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-starter">“Starters”的</a>依赖关系 。Spring Boot提供了一个有用的<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#build-tool-plugins-gradle-plugin">Gradle插件</a>，可用于简化依赖声明和创建可执行jar。</p>
<p><strong>Gradle Wrapper</strong></p>
<p>当您需要构建项目时，Gradle Wrapper提供了一种“获取”Gradle的好方法。它是一个小脚本和库，您可以与代码一起提交以引导构建过程。有关详细信息，请参阅<a target="_blank" rel="noopener" href="https://docs.gradle.org/4.2.1/userguide/gradle_wrapper.html">docs.gradle.org/4.2.1/userguide/gradle_wrapper.html</a>。</p>
<p>有关Spring Boot和Gradle <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/gradle-plugin/reference/html/#getting-started">入门的</a>更多详细信息 ，请参阅Gradle插件参考指南的“ <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/gradle-plugin/reference/html/#getting-started">入门”部分</a>。</p>
<h2 id="10-2安装Spring-Boot-CLI"><a href="#10-2安装Spring-Boot-CLI" class="headerlink" title="10.2安装Spring Boot CLI"></a>10.2安装Spring Boot CLI</h2><p>Spring Boot CLI（命令行界面）是一个命令行工具，可用于使用Spring快速原型。它允许您运行<a target="_blank" rel="noopener" href="http://groovy-lang.org/">Groovy</a>脚本，这意味着您拥有熟悉的类似Java的语法，而没有太多的样板代码。</p>
<p>您不需要使用CLI来使用Spring Boot，但它绝对是实现Spring应用程序的最快方法。</p>
<h3 id="10-2-1手动安装"><a href="#10-2-1手动安装" class="headerlink" title="10.2.1手动安装"></a>10.2.1手动安装</h3><p>您可以从Spring软件存储库下载Spring CLI分发版：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://repo.spring.io/release/org/springframework/boot/spring-boot-cli/2.1.1.RELEASE/spring-boot-cli-2.1.1.RELEASE-bin.zip">spring-boot-cli-2.1.1.RELEASE-bin.zip</a></li>
<li><a target="_blank" rel="noopener" href="https://repo.spring.io/release/org/springframework/boot/spring-boot-cli/2.1.1.RELEASE/spring-boot-cli-2.1.1.RELEASE-bin.tar.gz">spring-boot-cli-2.1.1.RELEASE-bin.tar.gz</a></li>
</ul>
<p>还提供最先进的 <a target="_blank" rel="noopener" href="https://repo.spring.io/snapshot/org/springframework/boot/spring-boot-cli/">快照分发</a>。</p>
<p>下载完成后，请按照 解压缩的存档中的 <a target="_blank" rel="noopener" href="https://raw.github.com/spring-projects/spring-boot/v2.1.1.RELEASE/spring-boot-project/spring-boot-cli/src/main/content/INSTALL.txt">INSTALL.txt</a>说明进行操作。总之，在<code>.zip</code>文件的<code>bin/</code>目录中有一个<code>spring</code>脚本（Windows为<code>spring.bat</code>）。或者，您可以将<code>java -jar</code>与<code>.jar</code>文件一起使用（该脚本可帮助您确保正确设置类路径）。</p>
<h3 id="10-2-2使用SDKMAN安装！"><a href="#10-2-2使用SDKMAN安装！" class="headerlink" title="10.2.2使用SDKMAN安装！"></a>10.2.2使用SDKMAN安装！</h3><p>SDKMAN！（软件开发工具包管理器）可用于管理各种二进制SDK的多个版本，包括Groovy和Spring Boot CLI。获取SDKMAN！从<a target="_blank" rel="noopener" href="http://sdkman.io/">sdkman.io</a>并使用以下命令安装Spring Boot：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sdk install springboot</span><br><span class="line">$ spring --version</span><br><span class="line">Spring Boot v2.1.1.RELEASE</span><br></pre></td></tr></table></figure>

<p>如果您为CLI开发功能并希望轻松访问您构建的版本，请使用以下命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sdk install springboot dev &#x2F;path&#x2F;to&#x2F;spring-boot&#x2F;spring-boot-cli&#x2F;target&#x2F;spring-boot-cli-2.1.1.RELEASE-bin&#x2F;spring-2.1.1.RELEASE&#x2F;</span><br><span class="line">$ sdk default springboot dev</span><br><span class="line">$ spring --version</span><br><span class="line">Spring CLI v2.1.1.RELEASE</span><br></pre></td></tr></table></figure>

<p>前面的说明安装了一个名为<code>dev</code>实例的<code>spring</code>本地实例。它指向您的目标构建位置，因此每次重建Spring Boot时，<code>spring</code>都是最新的。</p>
<p>您可以通过运行以下命令来查看它：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ sdk ls springboot</span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Available Springboot Versions</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&gt; + dev</span><br><span class="line">* 2.1.1.RELEASE</span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">+ - local version</span><br><span class="line">* - installed</span><br><span class="line">&gt; - currently in use</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br></pre></td></tr></table></figure>

<h3 id="10-2-3-OSX-Homebrew安装"><a href="#10-2-3-OSX-Homebrew安装" class="headerlink" title="10.2.3 OSX Homebrew安装"></a>10.2.3 OSX Homebrew安装</h3><p>如果您使用的是Mac并使用<a target="_blank" rel="noopener" href="https://brew.sh/">Homebrew</a>，则可以使用以下命令安装Spring Boot CLI：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ brew tap pivotal&#x2F;tap</span><br><span class="line">$ brew install springboot</span><br></pre></td></tr></table></figure>

<p>Homebrew将<code>spring</code>安装到<code>/usr/local/bin</code>。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果您没有看到公式，那么您的brew安装可能已过时。在这种情况下，运行<code>brew update</code>并再试一次。</td>
</tr>
</tbody></table>
<h3 id="10-2-4-MacPorts安装"><a href="#10-2-4-MacPorts安装" class="headerlink" title="10.2.4 MacPorts安装"></a>10.2.4 MacPorts安装</h3><p>如果您使用的是Mac并使用<a target="_blank" rel="noopener" href="https://www.macports.org/">MacPorts</a>，则可以使用以下命令安装Spring Boot CLI：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo port install spring-boot-cli</span><br></pre></td></tr></table></figure>

<h3 id="10-2-5命令行完成"><a href="#10-2-5命令行完成" class="headerlink" title="10.2.5命令行完成"></a>10.2.5命令行完成</h3><p>Spring Boot CLI包括为<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Bash_(Unix_shell)">BASH</a>和 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Z_shell">zsh</a> shell 提供命令完成的脚本 。您可以在任何shell中<code>source</code>脚本（也称为<code>spring</code>）或将其放入您的个人或系统范围的bash完成初始化中。在Debian系统上，系统范围的脚本位于<code>/shell-completion/bash</code>，并且当新shell启动时，该目录中的所有脚本都将执行。例如，要使用SDKMAN！安装，请手动运行脚本，请使用以下命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ . ~&#x2F;.sdkman&#x2F;candidates&#x2F;springboot&#x2F;current&#x2F;shell-completion&#x2F;bash&#x2F;spring</span><br><span class="line">$ spring &lt;HIT TAB HERE&gt;</span><br><span class="line">  grab  help  jar  run  test  version</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果使用Homebrew或MacPorts安装Spring Boot CLI，则命令行完成脚本将自动注册到shell。</td>
</tr>
</tbody></table>
<h3 id="10-2-6-Windows-Scoop安装"><a href="#10-2-6-Windows-Scoop安装" class="headerlink" title="10.2.6 Windows Scoop安装"></a>10.2.6 Windows Scoop安装</h3><p>如果您使用的是Windows并使用<a target="_blank" rel="noopener" href="http://scoop.sh/">Scoop</a>，则可以使用以下命令安装Spring Boot CLI：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; scoop bucket add extras</span><br><span class="line">&gt; scoop install springboot</span><br></pre></td></tr></table></figure>

<p>Scoop安装<code>spring</code>到<code>~/scoop/apps/springboot/current/bin</code>。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果您没有看到应用清单，则您的scoop安装可能已过时。在这种情况下，请运行<code>scoop update</code>并重试。</td>
</tr>
</tbody></table>
<h3 id="10-2-7快速启动Spring-CLI示例"><a href="#10-2-7快速启动Spring-CLI示例" class="headerlink" title="10.2.7快速启动Spring CLI示例"></a>10.2.7快速启动Spring CLI示例</h3><p>您可以使用以下Web应用程序来测试您的安装。首先，创建一个名为<code>app.groovy</code>的文件，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">class ThisWillActuallyRun &#123;</span><br><span class="line"></span><br><span class="line">	@RequestMapping(&quot;&#x2F;&quot;)</span><br><span class="line">	String home() &#123;</span><br><span class="line">		&quot;Hello World!&quot;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后从shell运行它，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ spring run app.groovy</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>随着依赖项的下载，应用程序的第一次运行速度很慢。后续运行要快得多。</td>
</tr>
</tbody></table>
<p>在您喜欢的网络浏览器中打开<code>localhost:8080</code>。您应该看到以下输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello World!</span><br></pre></td></tr></table></figure>

<h2 id="10-3从早期版本的Spring-Boot升级"><a href="#10-3从早期版本的Spring-Boot升级" class="headerlink" title="10.3从早期版本的Spring Boot升级"></a>10.3从早期版本的Spring Boot升级</h2><p>如果要从早期版本的Spring Boot升级，请查看 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-2.0-Migration-Guide">项目Wiki上的“迁移指南”，</a> 其中提供了详细的升级说明。另请查看 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/wiki">“发行说明”</a>，了解每个版本的“新的和值得注意的”功能列表。</p>
<p>升级到新功能版本时，某些属性可能已重命名或删除。Spring Boot提供了一种在启动时分析应用程序环境和打印诊断的方法，还可以在运行时临时迁移属性。要启用该功能，请将以下依赖项添加到项目中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-boot-properties-migrator&lt;&#x2F;artifactId&gt;</span><br><span class="line">	&lt;scope&gt;runtime&lt;&#x2F;scope&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/warning.png" alt="[警告]"></th>
</tr>
</thead>
<tbody><tr>
<td>添加到环境后期的属性（例如使用<code>@PropertySource</code>时）将不会被考虑在内。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>完成迁移后，请确保从项目的依赖项中删除此模块。</td>
</tr>
</tbody></table>
<p>要升级现有CLI安装，请使用相应的软件包管理器命令（例如，<code>brew upgrade</code>），或者，如果手动安装CLI，请按照 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#getting-started-manual-cli-installation">标准说明操作</a>，记住更新<code>PATH</code>环境变量以删除任何旧版本引用。</p>
<h2 id="11-开发您的第一个Spring-Boot应用程序"><a href="#11-开发您的第一个Spring-Boot应用程序" class="headerlink" title="11.开发您的第一个Spring Boot应用程序"></a>11.开发您的第一个Spring Boot应用程序</h2><p>本节介绍如何开发一个简单的“Hello World！”Web应用程序，该应用程序突出了Spring Boot的一些主要功能。我们使用Maven来构建这个项目，因为大多数IDE都支持它。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>该<a target="_blank" rel="noopener" href="https://spring.io/">spring.io</a>网站包含了许多“入门” <a target="_blank" rel="noopener" href="https://spring.io/guides">指导</a>在使用Spring Boot。如果您需要解决特定问题，请先检查一下。您可以通过转到<a target="_blank" rel="noopener" href="https://start.spring.io/">start.spring.io</a>并从依赖关系搜索器中选择“Web”启动器来快捷执行以下步骤。这样做会生成一个新的项目结构，以便您可以<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#getting-started-first-application-code">立即开始编码</a>。查看<a target="_blank" rel="noopener" href="https://docs.spring.io/initializr/docs/current/reference/htmlsingle/#user-guide">Spring Initializr文档</a>以获取更多详细信息。</td>
</tr>
</tbody></table>
<p>在开始之前，打开终端并运行以下命令以确保您安装了有效版本的Java和Maven：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ java -version</span><br><span class="line">java version &quot;1.8.0_102&quot;</span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_102-b14)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.102-b14, mixed mode)</span><br><span class="line">$ mvn -v</span><br><span class="line">Apache Maven 3.5.4 (1edded0938998edf8bf061f1ceb3cfdeccf443fe; 2018-06-17T14:33:14-04:00)</span><br><span class="line">Maven home: &#x2F;usr&#x2F;local&#x2F;Cellar&#x2F;maven&#x2F;3.3.9&#x2F;libexec</span><br><span class="line">Java version: 1.8.0_102, vendor: Oracle Corporation</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>此示例需要在其自己的文件夹中创建。后续说明假定您已创建合适的文件夹，并且它是您当前的目录。</td>
</tr>
</tbody></table>
<h2 id="11-1创建POM"><a href="#11-1创建POM" class="headerlink" title="11.1创建POM"></a>11.1创建POM</h2><p>我们需要先创建一个Maven <code>pom.xml</code>文件。<code>pom.xml</code>是用于构建项目的配方。打开您喜欢的文本编辑器并添加以下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot; xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">	xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">	&lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"></span><br><span class="line">	&lt;groupId&gt;com.example&lt;&#x2F;groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;myproject&lt;&#x2F;artifactId&gt;</span><br><span class="line">	&lt;version&gt;0.0.1-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line"></span><br><span class="line">	&lt;parent&gt;</span><br><span class="line">		&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">		&lt;artifactId&gt;spring-boot-starter-parent&lt;&#x2F;artifactId&gt;</span><br><span class="line">		&lt;version&gt;2.1.1.RELEASE&lt;&#x2F;version&gt;</span><br><span class="line">	&lt;&#x2F;parent&gt;</span><br><span class="line"></span><br><span class="line">	&lt;!-- Additional lines to be added here... --&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<p>上面的清单应该为您提供有效的构建。您可以通过运行<code>mvn package</code>来测试它（现在，您可以忽略“jar将为空 - 没有内容被标记为包含！”警告）。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>此时，您可以将项目导入IDE（大多数现代Java IDE包含对Maven的内置支持）。为简单起见，我们继续为此示例使用纯文本编辑器。</td>
</tr>
</tbody></table>
<h2 id="11-2添加类路径依赖项"><a href="#11-2添加类路径依赖项" class="headerlink" title="11.2添加类路径依赖项"></a>11.2添加类路径依赖项</h2><p>Spring Boot提供了一些“Starters”，可让您将jar添加到类路径中。我们的示例应用程序已经在POM的<code>parent</code>部分使用了<code>spring-boot-starter-parent</code>。<code>spring-boot-starter-parent</code>是一个特殊的启动器，提供有用的Maven默认值。它还提供了一个 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-dependency-management"><code>dependency-management</code></a> 部分，以便您可以省略<code>version</code>标签中的“祝福”依赖项。</p>
<p>其他“Starters”提供了在开发特定类型的应用程序时可能需要的依赖项。由于我们正在开发Web应用程序，因此我们添加了<code>spring-boot-starter-web</code>依赖项。在此之前，我们可以通过运行以下命令来查看当前的内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ mvn dependency:tree</span><br><span class="line"></span><br><span class="line">[INFO] com.example:myproject:jar:0.0.1-SNAPSHOT</span><br></pre></td></tr></table></figure>

<p><code>mvn dependency:tree</code>命令打印项目依赖项的树表示。您可以看到<code>spring-boot-starter-parent</code>本身不提供依赖关系。要添加必要的依赖项，请编辑<code>pom.xml</code>并在<code>parent</code>部分下方添加<code>spring-boot-starter-web</code>依赖项：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">	&lt;dependency&gt;</span><br><span class="line">		&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">		&lt;artifactId&gt;spring-boot-starter-web&lt;&#x2F;artifactId&gt;</span><br><span class="line">	&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;&#x2F;dependencies&gt;</span><br></pre></td></tr></table></figure>

<p>如果再次运行<code>mvn dependency:tree</code>，您会发现现在有许多其他依赖项，包括Tomcat Web服务器和Spring Boot本身。</p>
<h2 id="11-3编写代码"><a href="#11-3编写代码" class="headerlink" title="11.3编写代码"></a>11.3编写代码</h2><p>要完成我们的应用程序，我们需要创建一个Java文件。默认情况下，Maven编译来自<code>src/main/java</code>的源，因此您需要创建该文件夹结构，然后添加名为<code>src/main/java/Example.java</code>的文件以包含以下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.boot.*;</span><br><span class="line">import org.springframework.boot.autoconfigure.*;</span><br><span class="line">import org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line">@RestController</span><br><span class="line">@EnableAutoConfiguration</span><br><span class="line">public class Example &#123;</span><br><span class="line"></span><br><span class="line">	@RequestMapping(&quot;&#x2F;&quot;)</span><br><span class="line">	String home() &#123;</span><br><span class="line">		return &quot;Hello World!&quot;;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) throws Exception &#123;</span><br><span class="line">		SpringApplication.run(Example.class, args);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>虽然这里的代码不多，但还是有很多代码。我们将在接下来的几节中逐步介绍重要部分。</p>
<h3 id="11-3-1-RestController和-RequestMapping-Annotations"><a href="#11-3-1-RestController和-RequestMapping-Annotations" class="headerlink" title="11.3.1 @RestController和@RequestMapping Annotations"></a>11.3.1 @RestController和@RequestMapping Annotations</h3><p><code>Example</code>类的第一个注释是<code>@RestController</code>。这被称为 <em>构造型</em>注释。它为阅读代码的人提供了提示，并为Spring提供了该类扮演特定角色的提示。在这种情况下，我们的类是一个web <code>@Controller</code>，所以Spring在处理传入的Web请求时会考虑它。</p>
<p><code>@RequestMapping</code>注释提供“路由”信息。它告诉Spring任何带有<code>/</code>路径的HTTP请求都应该映射到<code>home</code>方法。<code>@RestController</code>注释告诉Spring将结果字符串直接呈现给调用者。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td><code>@RestController</code>和<code>@RequestMapping</code>注释是Spring MVC注释。（它们不是Spring Boot特有的。）有关详细信息，请参阅Spring参考文档中的<a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/web.html#mvc">MVC部分</a>。</td>
</tr>
</tbody></table>
<h3 id="11-3-2-EnableAutoConfiguration注释"><a href="#11-3-2-EnableAutoConfiguration注释" class="headerlink" title="11.3.2 @EnableAutoConfiguration注释"></a>11.3.2 @EnableAutoConfiguration注释</h3><p>第二个类级别注释是<code>@EnableAutoConfiguration</code>。这个注释告诉Spring Boot根据你添加的jar依赖关系“猜测”你想要如何配置Spring。由于<code>spring-boot-starter-web</code>添加了Tomcat和Spring MVC，因此自动配置假定您正在开发Web应用程序并相应地设置Spring。</p>
<p><strong>Starters和自动配置</strong></p>
<p>自动配置旨在与“Starters”配合使用，但这两个概念并不直接相关。您可以自由选择并在首发之外选择jar依赖项。Spring Boot仍然尽力自动配置您的应用程序。</p>
<h3 id="11-3-3“主要”方法"><a href="#11-3-3“主要”方法" class="headerlink" title="11.3.3“主要”方法"></a>11.3.3“主要”方法</h3><p>我们的应用程序的最后一部分是<code>main</code>方法。这只是遵循应用程序入口点的Java约定的标准方法。我们的主要方法是通过调用<code>run</code>来委托Spring Boot的<code>SpringApplication</code>类。<code>SpringApplication</code>引导我们的应用程序，从Spring开始，然后启动自动配置的Tomcat Web服务器。我们需要将<code>Example.class</code>作为参数传递给<code>run</code>方法，以告诉<code>SpringApplication</code>哪个是主要的Spring组件。还会传递<code>args</code>数组以公开任何命令行参数。</p>
<h2 id="11-4运行示例"><a href="#11-4运行示例" class="headerlink" title="11.4运行示例"></a>11.4运行示例</h2><p>此时，您的应用程序应该工作。由于您使用了<code>spring-boot-starter-parent</code> POM，因此您可以使用有用的<code>run</code>目标来启动应用程序。从根项目目录中键入<code>mvn spring-boot:run</code>以启动应用程序。您应该看到类似于以下内容的输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ mvn spring-boot:run</span><br><span class="line"></span><br><span class="line">  .   ____          _            __ _ _</span><br><span class="line"> &#x2F;\\ &#x2F; ___&#39;_ __ _ _(_)_ __  __ _ \ \ \ \</span><br><span class="line">( ( )\___ | &#39;_ | &#39;_| | &#39;_ \&#x2F; _&#96; | \ \ \ \</span><br><span class="line"> \\&#x2F;  ___)| |_)| | | | | || (_| |  ) ) ) )</span><br><span class="line">  &#39;  |____| .__|_| |_|_| |_\__, | &#x2F; &#x2F; &#x2F; &#x2F;</span><br><span class="line"> &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;|_|&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;|___&#x2F;&#x3D;&#x2F;_&#x2F;_&#x2F;_&#x2F;</span><br><span class="line"> :: Spring Boot ::  (v2.1.1.RELEASE)</span><br><span class="line">....... . . .</span><br><span class="line">....... . . . (log output here)</span><br><span class="line">....... . . .</span><br><span class="line">........ Started Example in 2.222 seconds (JVM running for 6.514)</span><br></pre></td></tr></table></figure>

<p>如果您打开Web浏览器到<code>localhost:8080</code>，您应该看到以下输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello World!</span><br></pre></td></tr></table></figure>

<p>要正常退出应用程序，请按<code>ctrl-c</code>。</p>
<h2 id="11-5创建一个可执行的Jar"><a href="#11-5创建一个可执行的Jar" class="headerlink" title="11.5创建一个可执行的Jar"></a>11.5创建一个可执行的Jar</h2><p>我们通过创建一个完全自包含的可执行jar文件来完成我们的示例，我们可以在生产中运行它。可执行jar（有时称为“fat jar”）是包含已编译类以及代码需要运行的所有jar依赖项的归档。</p>
<p><strong>可执行的jar和Java</strong></p>
<p>Java没有提供加载嵌套jar文件的标准方法（jar文件本身包含在jar中）。如果您要分发自包含的应用程序，这可能会有问题。</p>
<p>为了解决这个问题，许多开发人员使用“超级”罐子。uber jar将所有应用程序依赖项中的所有类打包到一个存档中。这种方法的问题在于很难看出应用程序中有哪些库。如果在多个罐子中使用相同的文件名（但具有不同的内容），也可能会有问题。</p>
<p>Spring Boot采用<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#executable-jar">不同的方法</a>，让你直接嵌套罐子。</p>
<p>要创建可执行jar，我们需要将<code>spring-boot-maven-plugin</code>添加到<code>pom.xml</code>。为此，请在<code>dependencies</code>部分下方插入以下行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">	&lt;plugins&gt;</span><br><span class="line">		&lt;plugin&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-boot-maven-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">		&lt;&#x2F;plugin&gt;</span><br><span class="line">	&lt;&#x2F;plugins&gt;</span><br><span class="line">&lt;&#x2F;build&gt;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td><code>spring-boot-starter-parent</code> POM包含<code>&lt;executions&gt;</code>配置以绑定<code>repackage</code>目标。如果您不使用父POM，则需要自己声明此配置。有关详细信息，请参阅<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/maven-plugin/usage.html">插件文档</a>。</td>
</tr>
</tbody></table>
<p>保存<code>pom.xml</code>并从命令行运行<code>mvn package</code>，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ mvn package</span><br><span class="line"></span><br><span class="line">[INFO] Scanning for projects...</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] Building myproject 0.0.1-SNAPSHOT</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] .... ..</span><br><span class="line">[INFO] --- maven-jar-plugin:2.4:jar (default-jar) @ myproject ---</span><br><span class="line">[INFO] Building jar: &#x2F;Users&#x2F;developer&#x2F;example&#x2F;spring-boot-example&#x2F;target&#x2F;myproject-0.0.1-SNAPSHOT.jar</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] --- spring-boot-maven-plugin:2.1.1.RELEASE:repackage (default) @ myproject ---</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] BUILD SUCCESS</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>

<p>如果你查看<code>target</code>目录，你应该看到<code>myproject-0.0.1-SNAPSHOT.jar</code>。该文件大小应为10 MB左右。如果要查看内部，可以使用<code>jar tvf</code>，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ jar tvf target&#x2F;myproject-0.0.1-SNAPSHOT.jar</span><br></pre></td></tr></table></figure>

<p>您还应该在<code>target</code>目录中看到一个名为<code>myproject-0.0.1-SNAPSHOT.jar.original</code>的小文件。这是Maven在Spring Boot重新打包之前创建的原始jar文件。</p>
<p>要运行该应用程序，请使用<code>java -jar</code>命令，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar target&#x2F;myproject-0.0.1-SNAPSHOT.jar</span><br><span class="line"></span><br><span class="line">  .   ____          _            __ _ _</span><br><span class="line"> &#x2F;\\ &#x2F; ___&#39;_ __ _ _(_)_ __  __ _ \ \ \ \</span><br><span class="line">( ( )\___ | &#39;_ | &#39;_| | &#39;_ \&#x2F; _&#96; | \ \ \ \</span><br><span class="line"> \\&#x2F;  ___)| |_)| | | | | || (_| |  ) ) ) )</span><br><span class="line">  &#39;  |____| .__|_| |_|_| |_\__, | &#x2F; &#x2F; &#x2F; &#x2F;</span><br><span class="line"> &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;|_|&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;|___&#x2F;&#x3D;&#x2F;_&#x2F;_&#x2F;_&#x2F;</span><br><span class="line"> :: Spring Boot ::  (v2.1.1.RELEASE)</span><br><span class="line">....... . . .</span><br><span class="line">....... . . . (log output here)</span><br><span class="line">....... . . .</span><br><span class="line">........ Started Example in 2.536 seconds (JVM running for 2.864)</span><br></pre></td></tr></table></figure>

<p>和以前一样，要退出应用程序，请按<code>ctrl-c</code>。</p>
<h2 id="12-接下来要阅读的内容"><a href="#12-接下来要阅读的内容" class="headerlink" title="12.接下来要阅读的内容"></a>12.接下来要阅读的内容</h2><p>希望本节提供了一些Spring Boot基础知识，让您开始编写自己的应用程序。如果您是面向任务的开发人员类型，您可能希望跳转到<a target="_blank" rel="noopener" href="https://spring.io/">spring.io</a>并查看一些 <a target="_blank" rel="noopener" href="https://spring.io/guides/">入门</a>指南，这些指南解决了特定的“我如何使用Spring？”问题。我们还有Spring Boot特定的“ <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#howto">操作方法</a> ”参考文档。</p>
<p>该<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot">Spring Boot库</a>也有 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-samples">一堆样品</a>可以运行。样本独立于其余代码（也就是说，您无需构建其余代码来运行或使用示例）。</p>
<p>否则，下一个逻辑步骤是阅读*<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot">第III部分“使用Spring Boot”</a>*。如果你真的很不耐烦，你也可以跳过去阅读 *<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features">Spring Boot功能</a>*。</p>
<h1 id="第三部分。使用Spring-Boot"><a href="#第三部分。使用Spring-Boot" class="headerlink" title="第三部分。使用Spring Boot"></a>第三部分。使用Spring Boot</h1><p>本节详细介绍了如何使用Spring Boot。它涵盖了构建系统，自动配置以及如何运行应用程序等主题。我们还介绍了一些Spring Boot最佳做法。虽然Spring Boot没有什么特别之处（它只是你可以使用的另一个库），但有一些建议，如果遵循这些建议，可以使您的开发过程更容易一些。</p>
<p>如果您从Spring Boot *<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#getting-started">开始，</a>*在进入本节之前，您应该阅读“ *<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#getting-started">入门指南”</a>*。</p>
<h2 id="13-构建系统"><a href="#13-构建系统" class="headerlink" title="13.构建系统"></a>13.构建系统</h2><p>强烈建议您选择支持<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-dependency-management"><em>依赖关系管理</em></a>且可以使用发布到“Maven Central”存储库的工件的构建系统 。我们建议您选择Maven或Gradle。可以使Spring Boot与其他构建系统（例如Ant）一起使用，但它们并没有得到特别好的支持。</p>
<h2 id="13-1依赖管理"><a href="#13-1依赖管理" class="headerlink" title="13.1依赖管理"></a>13.1依赖管理</h2><p>Spring Boot的每个版本都提供了它支持的依赖项的策划列表。实际上，您不需要为构建配置中的任何这些依赖项提供版本，因为Spring Boot会为您管理。升级Spring引导时，这些依赖项也会以一致的方式升级。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果需要，您仍然可以指定版本并覆盖Spring Boot的建议。</td>
</tr>
</tbody></table>
<p>精选列表包含您可以使用Spring Boot的所有spring modules以及精选的第三方库列表。该列表以标准 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-maven-without-a-parent">物料清单（<code>spring-boot-dependencies</code>）的形式提供</a> ，可与<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-maven-parent-pom">Maven</a>和 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-gradle">Gradle一起使用</a>。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/warning.png" alt="[警告]"></th>
</tr>
</thead>
<tbody><tr>
<td>Spring Boot的每个版本都与Spring框架的基本版本相关联。我们<strong>强烈</strong>建议您不要指定其版本。</td>
</tr>
</tbody></table>
<h2 id="13-2-Maven"><a href="#13-2-Maven" class="headerlink" title="13.2 Maven"></a>13.2 Maven</h2><p>Maven用户可以继承<code>spring-boot-starter-parent</code>项目以获得合理的默认值。父项目提供以下功能：</p>
<ul>
<li>Java 1.8作为默认编译器级别。</li>
<li>UTF-8源编码。</li>
<li>一个<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-dependency-management">依赖管理部分</a>，从春天启动依赖性继承POM，管理公共依赖的版本。此依赖关系管理允许您在自己的pom中使用时省略这些依赖项的<version>标记。</li>
<li>使用<code>repackage</code>执行ID 执行<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/maven-plugin/repackage-mojo.html"><code>repackage</code>目标</a>。</li>
<li>明智的 <a target="_blank" rel="noopener" href="https://maven.apache.org/plugins/maven-resources-plugin/examples/filter.html">资源过滤</a>。</li>
<li>明智的插件配置（<a target="_blank" rel="noopener" href="https://www.mojohaus.org/exec-maven-plugin/">exec插件</a>， <a target="_blank" rel="noopener" href="https://github.com/ktoso/maven-git-commit-id-plugin">Git提交ID</a>和 <a target="_blank" rel="noopener" href="https://maven.apache.org/plugins/maven-shade-plugin/">阴影</a>）。</li>
<li><code>application.properties</code>和<code>application.yml</code>的合理资源过滤，包括特定于配置文件的文件（例如，<code>application-dev.properties</code>和<code>application-dev.yml</code>）</li>
</ul>
<p>请注意，由于<code>application.properties</code>和<code>application.yml</code>文件接受Spring样式占位符（<code>$&#123;…&#125;</code>），因此Maven过滤更改为使用<code>@..@</code>占位符。（您可以通过设置名为<code>resource.delimiter</code>的Maven属性来覆盖它。）</p>
<h3 id="13-2-1继承Starter-Parent"><a href="#13-2-1继承Starter-Parent" class="headerlink" title="13.2.1继承Starter Parent"></a>13.2.1继承Starter Parent</h3><p>要将项目配置为从<code>spring-boot-starter-parent</code>继承，请按以下方式设置<code>parent</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Inherit defaults from Spring Boot --&gt;</span><br><span class="line">&lt;parent&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-boot-starter-parent&lt;&#x2F;artifactId&gt;</span><br><span class="line">	&lt;version&gt;2.1.1.RELEASE&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;parent&gt;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>您应该只需要在此依赖项上指定Spring Boot版本号。如果导入其他启动器，则可以安全地省略版本号。</td>
</tr>
</tbody></table>
<p>通过该设置，您还可以通过覆盖自己项目中的属性来覆盖单个依赖项。例如，要升级到另一个Spring数据发布列表，您可以将以下内容添加到<code>pom.xml</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;properties&gt;</span><br><span class="line">	&lt;spring-data-releasetrain.version&gt;Fowler-SR2&lt;&#x2F;spring-data-releasetrain.version&gt;</span><br><span class="line">&lt;&#x2F;properties&gt;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>检查 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-dependencies/pom.xml"><code>spring-boot-dependencies</code> pom</a> 以获取支持的属性列表。</td>
</tr>
</tbody></table>
<h3 id="13-2-2在没有父POM的情况下使用Spring-Boot"><a href="#13-2-2在没有父POM的情况下使用Spring-Boot" class="headerlink" title="13.2.2在没有父POM的情况下使用Spring Boot"></a>13.2.2在没有父POM的情况下使用Spring Boot</h3><p>不是每个人都喜欢继承<code>spring-boot-starter-parent</code> POM。您可能拥有自己需要使用的公司标准父级，或者您可能希望明确声明所有Maven配置。</p>
<p>如果您不想使用<code>spring-boot-starter-parent</code>，您仍然可以通过使用<code>scope=import</code>依赖项来保持依赖项管理（但不是插件管理）的好处，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencyManagement&gt;</span><br><span class="line">		&lt;dependencies&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;!-- Import dependency management from Spring Boot --&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-boot-dependencies&lt;&#x2F;artifactId&gt;</span><br><span class="line">			&lt;version&gt;2.1.1.RELEASE&lt;&#x2F;version&gt;</span><br><span class="line">			&lt;type&gt;pom&lt;&#x2F;type&gt;</span><br><span class="line">			&lt;scope&gt;import&lt;&#x2F;scope&gt;</span><br><span class="line">		&lt;&#x2F;dependency&gt;</span><br><span class="line">	&lt;&#x2F;dependencies&gt;</span><br><span class="line">&lt;&#x2F;dependencyManagement&gt;</span><br></pre></td></tr></table></figure>

<p>如上所述，前面的示例设置不允许您使用属性覆盖单个依赖项。要获得相同的结果，您需要在<code>spring-boot-dependencies</code>条目<strong>之前</strong>在项目的<code>dependencyManagement</code>中添加条目。例如，要升级到另一个Spring数据发布列，您可以将以下元素添加到<code>pom.xml</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencyManagement&gt;</span><br><span class="line">	&lt;dependencies&gt;</span><br><span class="line">		&lt;!-- Override Spring Data release train provided by Spring Boot --&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework.data&lt;&#x2F;groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-data-releasetrain&lt;&#x2F;artifactId&gt;</span><br><span class="line">			&lt;version&gt;Fowler-SR2&lt;&#x2F;version&gt;</span><br><span class="line">			&lt;type&gt;pom&lt;&#x2F;type&gt;</span><br><span class="line">			&lt;scope&gt;import&lt;&#x2F;scope&gt;</span><br><span class="line">		&lt;&#x2F;dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-boot-dependencies&lt;&#x2F;artifactId&gt;</span><br><span class="line">			&lt;version&gt;2.1.1.RELEASE&lt;&#x2F;version&gt;</span><br><span class="line">			&lt;type&gt;pom&lt;&#x2F;type&gt;</span><br><span class="line">			&lt;scope&gt;import&lt;&#x2F;scope&gt;</span><br><span class="line">		&lt;&#x2F;dependency&gt;</span><br><span class="line">	&lt;&#x2F;dependencies&gt;</span><br><span class="line">&lt;&#x2F;dependencyManagement&gt;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>在前面的示例中，我们指定了<em>BOM</em>，但是可以以相同的方式覆盖任何依赖关系类型。</td>
</tr>
</tbody></table>
<h3 id="13-2-3使用Spring-Boot-Maven插件"><a href="#13-2-3使用Spring-Boot-Maven插件" class="headerlink" title="13.2.3使用Spring Boot Maven插件"></a>13.2.3使用Spring Boot Maven插件</h3><p>Spring Boot包含一个<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#build-tool-plugins-maven-plugin">Maven插件</a>，可以将项目打包为可执行jar。如果要使用插件，请将插件添加到<code>&lt;plugins&gt;</code>部分，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">	&lt;plugins&gt;</span><br><span class="line">		&lt;plugin&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-boot-maven-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">		&lt;&#x2F;plugin&gt;</span><br><span class="line">	&lt;&#x2F;plugins&gt;</span><br><span class="line">&lt;&#x2F;build&gt;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果您使用Spring Boot启动程序父pom，则只需添加插件。除非您要更改父级中定义的设置，否则无需对其进行配置。</td>
</tr>
</tbody></table>
<h2 id="13-3-Gradle"><a href="#13-3-Gradle" class="headerlink" title="13.3 Gradle"></a>13.3 Gradle</h2><p>要了解如何将Spring Boot与Gradle一起使用，请参阅Spring Boot的Gradle插件的文档：</p>
<ul>
<li>参考（<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/gradle-plugin/reference/html">HTML</a>和 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/gradle-plugin/reference/pdf/spring-boot-gradle-plugin-reference.pdf">PDF</a>）</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/gradle-plugin/api">API</a></li>
</ul>
<h2 id="13-4-Ant"><a href="#13-4-Ant" class="headerlink" title="13.4 Ant"></a>13.4 Ant</h2><p>可以使用Apache Ant + Ivy构建一个Spring Boot项目。<code>spring-boot-antlib</code>“AntLib”模块也可用于帮助Ant创建可执行jar。</p>
<p>要声明依赖项，典型的<code>ivy.xml</code>文件类似于以下示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;ivy-module version&#x3D;&quot;2.0&quot;&gt;</span><br><span class="line">	&lt;info organisation&#x3D;&quot;org.springframework.boot&quot; module&#x3D;&quot;spring-boot-sample-ant&quot; &#x2F;&gt;</span><br><span class="line">	&lt;configurations&gt;</span><br><span class="line">		&lt;conf name&#x3D;&quot;compile&quot; description&#x3D;&quot;everything needed to compile this module&quot; &#x2F;&gt;</span><br><span class="line">		&lt;conf name&#x3D;&quot;runtime&quot; extends&#x3D;&quot;compile&quot; description&#x3D;&quot;everything needed to run this module&quot; &#x2F;&gt;</span><br><span class="line">	&lt;&#x2F;configurations&gt;</span><br><span class="line">	&lt;dependencies&gt;</span><br><span class="line">		&lt;dependency org&#x3D;&quot;org.springframework.boot&quot; name&#x3D;&quot;spring-boot-starter&quot;</span><br><span class="line">			rev&#x3D;&quot;$&#123;spring-boot.version&#125;&quot; conf&#x3D;&quot;compile&quot; &#x2F;&gt;</span><br><span class="line">	&lt;&#x2F;dependencies&gt;</span><br><span class="line">&lt;&#x2F;ivy-module&gt;</span><br></pre></td></tr></table></figure>

<p>典型的<code>build.xml</code>类似于以下示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;project</span><br><span class="line">	xmlns:ivy&#x3D;&quot;antlib:org.apache.ivy.ant&quot;</span><br><span class="line">	xmlns:spring-boot&#x3D;&quot;antlib:org.springframework.boot.ant&quot;</span><br><span class="line">	name&#x3D;&quot;myapp&quot; default&#x3D;&quot;build&quot;&gt;</span><br><span class="line"></span><br><span class="line">	&lt;property name&#x3D;&quot;spring-boot.version&quot; value&#x3D;&quot;2.1.1.RELEASE&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">	&lt;target name&#x3D;&quot;resolve&quot; description&#x3D;&quot;--&gt; retrieve dependencies with ivy&quot;&gt;</span><br><span class="line">		&lt;ivy:retrieve pattern&#x3D;&quot;lib&#x2F;[conf]&#x2F;[artifact]-[type]-[revision].[ext]&quot; &#x2F;&gt;</span><br><span class="line">	&lt;&#x2F;target&gt;</span><br><span class="line"></span><br><span class="line">	&lt;target name&#x3D;&quot;classpaths&quot; depends&#x3D;&quot;resolve&quot;&gt;</span><br><span class="line">		&lt;path id&#x3D;&quot;compile.classpath&quot;&gt;</span><br><span class="line">			&lt;fileset dir&#x3D;&quot;lib&#x2F;compile&quot; includes&#x3D;&quot;*.jar&quot; &#x2F;&gt;</span><br><span class="line">		&lt;&#x2F;path&gt;</span><br><span class="line">	&lt;&#x2F;target&gt;</span><br><span class="line"></span><br><span class="line">	&lt;target name&#x3D;&quot;init&quot; depends&#x3D;&quot;classpaths&quot;&gt;</span><br><span class="line">		&lt;mkdir dir&#x3D;&quot;build&#x2F;classes&quot; &#x2F;&gt;</span><br><span class="line">	&lt;&#x2F;target&gt;</span><br><span class="line"></span><br><span class="line">	&lt;target name&#x3D;&quot;compile&quot; depends&#x3D;&quot;init&quot; description&#x3D;&quot;compile&quot;&gt;</span><br><span class="line">		&lt;javac srcdir&#x3D;&quot;src&#x2F;main&#x2F;java&quot; destdir&#x3D;&quot;build&#x2F;classes&quot; classpathref&#x3D;&quot;compile.classpath&quot; &#x2F;&gt;</span><br><span class="line">	&lt;&#x2F;target&gt;</span><br><span class="line"></span><br><span class="line">	&lt;target name&#x3D;&quot;build&quot; depends&#x3D;&quot;compile&quot;&gt;</span><br><span class="line">		&lt;spring-boot:exejar destfile&#x3D;&quot;build&#x2F;myapp.jar&quot; classes&#x3D;&quot;build&#x2F;classes&quot;&gt;</span><br><span class="line">			&lt;spring-boot:lib&gt;</span><br><span class="line">				&lt;fileset dir&#x3D;&quot;lib&#x2F;runtime&quot; &#x2F;&gt;</span><br><span class="line">			&lt;&#x2F;spring-boot:lib&gt;</span><br><span class="line">		&lt;&#x2F;spring-boot:exejar&gt;</span><br><span class="line">	&lt;&#x2F;target&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果您不想使用<code>spring-boot-antlib</code>模块，请参见 <em><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#howto-build-an-executable-archive-with-ant">第91.9节“从Ant构建可执行文件，而不使用<code>spring-boot-antlib</code>”</a></em> “操作方法”。</td>
</tr>
</tbody></table>
<h2 id="13-5-Starters"><a href="#13-5-Starters" class="headerlink" title="13.5 Starters"></a>13.5 Starters</h2><p>Starters是一组方便的依赖描述符，您可以在应用程序中包含这些描述符。您可以获得所需的所有Spring和相关技术的一站式服务，而无需搜索示例代码和复制粘贴依赖描述符的负载。例如，如果要开始使用Spring和JPA进行数据库访问，请在项目中包含<code>spring-boot-starter-data-jpa</code>依赖项。</p>
<p>启动器包含许多依赖项，这些依赖项是使项目快速启动和运行所需的依赖项，以及一组受支持的托管传递依赖项。</p>
<p><strong>什么是名字</strong></p>
<p>所有<strong>官方</strong>首发都遵循类似的命名模式; <code>spring-boot-starter-*</code>，其中<code>*</code>是一种特殊类型的应用程序。此命名结构旨在帮助您找到启动器。许多IDE中的Maven集成允许您按名称搜索依赖项。例如，安装了适当的Eclipse或STS插件后，可以在POM编辑器中按<code>ctrl-space</code>并输入“spring-boot-starter”以获取完整列表。</p>
<p>正如“ <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-custom-starter">创建自己的初学者</a> ”部分所述，第三方启动者不应以<code>spring-boot</code>开头，因为它是为官方Spring Boot工件保留的。相反，第三方启动器通常以项目名称开头。例如，名为<code>thirdpartyproject</code>的第三方启动项目通常被命名为<code>thirdpartyproject-spring-boot-starter</code>。</p>
<p>以下应用程序启动程序由<code>org.springframework.boot</code>组下的Spring Boot提供：</p>
<p><strong>表13.1。Spring Boot应用程序启动器</strong></p>
<table>
<thead>
<tr>
<th>名称</th>
<th>描述</th>
<th>双响炮</th>
</tr>
</thead>
<tbody><tr>
<td><code>spring-boot-starter</code></td>
<td>核心启动器，包括自动配置支持，日志记录和YAML</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-activemq</code></td>
<td>使用Apache ActiveMQ进行JMS消息传递的入门者</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-activemq/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-amqp</code></td>
<td>使用Spring AMQP和Rabbit MQ的入门者</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-amqp/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-aop</code></td>
<td>使用Spring AOP和AspectJ进行面向方面编程的入门者</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-aop/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-artemis</code></td>
<td>使用Apache Artemis进行JMS消息传递的入门者</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-artemis/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-batch</code></td>
<td>使用Spring批处理的初学者</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-batch/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-cache</code></td>
<td>使用Spring Framework的缓存支持的初学者</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-cache/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-cloud-connectors</code></td>
<td>使用Spring云连接器的初学者简化了与Cloud Foundry和Heroku等云平台中的服务的连接</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-cloud-connectors/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-data-cassandra</code></td>
<td>使用Cassandra分布式数据库和Spring数据的初学者Cassandra</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-cassandra/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-data-cassandra-reactive</code></td>
<td>使用Cassandra分布式数据库和Spring数据Cassandra Reactive的入门者</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-cassandra-reactive/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-data-couchbase</code></td>
<td>使用Couchbase面向文档的数据库和Spring Data Couchbase的入门者</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-couchbase/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-data-couchbase-reactive</code></td>
<td>使用Couchbase面向文档的数据库和Spring Data Couchbase Reactive的入门者</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-couchbase-reactive/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-data-elasticsearch</code></td>
<td>使用Elasticsearch搜索和分析引擎以及Spring Data Elasticsearch的初学者</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-elasticsearch/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-data-jdbc</code></td>
<td>使用Spring数据JDBC的入门者</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-jdbc/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-data-jpa</code></td>
<td>使用Spring Data JPA和Hibernate的初学者</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-jpa/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-data-ldap</code></td>
<td>使用Spring数据LDAP的入门者</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-ldap/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-data-mongodb</code></td>
<td>使用MongoDB面向文档的数据库和Spring Data MongoDB的初学者</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-mongodb/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-data-mongodb-reactive</code></td>
<td>使用MongoDB面向文档的数据库和Spring Data MongoDB Reactive的入门者</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-mongodb-reactive/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-data-neo4j</code></td>
<td>使用Neo4j图形数据库和Spring数据Neo4j的入门者</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-neo4j/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-data-redis</code></td>
<td>使用Spring数据Redis和Lettuce客户端使用Redis键值数据存储的入门者</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-redis/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-data-redis-reactive</code></td>
<td>使用Redis数据Redis被动和Lettuce客户端的Redis键值数据存储的入门者</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-redis-reactive/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-data-rest</code></td>
<td>使用Spring Data REST通过REST公开Spring数据存储库的入门者</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-rest/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-data-solr</code></td>
<td>使用带有Spring Data Solr的Apache Solr搜索平台的初学者</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-solr/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-freemarker</code></td>
<td>使用FreeMarker视图构建MVC Web应用程序的入门者</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-freemarker/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-groovy-templates</code></td>
<td>使用Groovy模板视图构建MVC Web应用程序的入门者</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-groovy-templates/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-hateoas</code></td>
<td>使用Spring MVC和Spring HATEOAS构建基于超媒体的RESTful Web应用程序的入门者</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-hateoas/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-integration</code></td>
<td>使用Spring Integration的入门者</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-integration/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-jdbc</code></td>
<td>将JDBC与HikariCP连接池一起使用的入门者</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-jdbc/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-jersey</code></td>
<td>使用JAX-RS和Jersey构建RESTful Web应用程序的入门者。替代<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#spring-boot-starter-web"><code>spring-boot-starter-web</code></a></td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-jersey/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-jooq</code></td>
<td>使用jOOQ访问SQL数据库的初学者。替代<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#spring-boot-starter-data-jpa"><code>spring-boot-starter-data-jpa</code></a>或<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#spring-boot-starter-jdbc"><code>spring-boot-starter-jdbc</code></a></td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-jooq/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-json</code></td>
<td>阅读和写作json的初学者</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-json/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-jta-atomikos</code></td>
<td>使用Atomikos进行JTA交易的入门者</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-jta-atomikos/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-jta-bitronix</code></td>
<td>使用Bitronix进行JTA事务的入门者</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-jta-bitronix/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-mail</code></td>
<td>使用Java Mail和Spring Framework的电子邮件发送支持的入门者</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-mail/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-mustache</code></td>
<td>使用Mustache视图构建Web应用程序的入门者</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-mustache/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-oauth2-client</code></td>
<td>使用Spring安全性OAuth2 / OpenID Connect客户端功能的入门级产品</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-oauth2-client/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-oauth2-resource-server</code></td>
<td>使用Spring安全性OAuth2资源服务器功能的入门者</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-oauth2-resource-server/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-quartz</code></td>
<td>使用Quartz调度程序的入门者</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-quartz/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-security</code></td>
<td>使用Spring安全性的入门者</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-security/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-test</code></td>
<td>用于测试包含JUnit，Hamcrest和Mockito等库的Spring Boot应用程序的入门者</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-test/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-thymeleaf</code></td>
<td>使用Thymeleaf视图构建MVC Web应用程序的入门者</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-thymeleaf/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-validation</code></td>
<td>使用Java Bean验证与Hibernate Validator的初学者</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-validation/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-web</code></td>
<td>使用Spring MVC构建Web（包括RESTful）应用程序的入门者。使用Tomcat作为默认嵌入式容器</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-web/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-web-services</code></td>
<td>使用Spring Web服务的入门者</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-web-services/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-webflux</code></td>
<td>使用Spring Framework的Reactive Web支持构建WebFlux应用程序的初学者</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-webflux/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-websocket</code></td>
<td>使用Spring Framework的WebSocket支持构建WebSocket应用程序的入门者</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-websocket/pom.xml">双响炮</a></td>
</tr>
</tbody></table>
<p>除应用程序启动器外，还可以使用以下启动器添加 *<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready">生产就绪</a>*功能：</p>
<p><strong>表13.2。Spring Boot制作首发</strong></p>
<table>
<thead>
<tr>
<th>名称</th>
<th>描述</th>
<th>双响炮</th>
</tr>
</thead>
<tbody><tr>
<td><code>spring-boot-starter-actuator</code></td>
<td>使用Spring Boot的Actuator的启动器，它提供生产就绪功能，帮助您监控和管理您的应用程序</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-actuator/pom.xml">双响炮</a></td>
</tr>
</tbody></table>
<p>最后，Spring Boot还包括以下可用于排除或交换特定技术方面的启动器：</p>
<p><strong>表13.3。Spring Boot技术先发者</strong></p>
<table>
<thead>
<tr>
<th>名称</th>
<th>描述</th>
<th>双响炮</th>
</tr>
</thead>
<tbody><tr>
<td><code>spring-boot-starter-jetty</code></td>
<td>使用Jetty作为嵌入式servlet容器的入门。替代<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#spring-boot-starter-tomcat"><code>spring-boot-starter-tomcat</code></a></td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-jetty/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-log4j2</code></td>
<td>使用Log4j2进行日志记录的入门。替代<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#spring-boot-starter-logging"><code>spring-boot-starter-logging</code></a></td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-log4j2/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-logging</code></td>
<td>使用Logback进行日志记录的入门。默认日志启动器</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-logging/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-reactor-netty</code></td>
<td>使用Reactor Netty作为嵌入式响应式HTTP服务器的入门者。</td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-reactor-netty/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-tomcat</code></td>
<td>使用Tomcat作为嵌入式servlet容器的入门者。使用的默认servlet容器启动器<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#spring-boot-starter-web"><code>spring-boot-starter-web</code></a></td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-tomcat/pom.xml">双响炮</a></td>
</tr>
<tr>
<td><code>spring-boot-starter-undertow</code></td>
<td>使用Undertow作为嵌入式servlet容器的入门者。替代<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#spring-boot-starter-tomcat"><code>spring-boot-starter-tomcat</code></a></td>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-undertow/pom.xml">双响炮</a></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>有关其他社区贡献的启动器的列表，请参阅GitHub上<code>spring-boot-starters</code>模块中的 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/README.adoc">README文件</a>。</td>
</tr>
</tbody></table>
<h2 id="14-构建您的代码"><a href="#14-构建您的代码" class="headerlink" title="14.构建您的代码"></a>14.构建您的代码</h2><p>Spring Boot不需要任何特定的代码布局。但是，有一些最佳实践可以提供帮助。</p>
<h2 id="14-1使用“默认”包"><a href="#14-1使用“默认”包" class="headerlink" title="14.1使用“默认”包"></a>14.1使用“默认”包</h2><p>当一个类不包含<code>package</code>声明时，它被认为是在“默认包”中。通常不鼓励使用“默认包”，应该避免使用。对于使用<code>@ComponentScan</code>，<code>@EntityScan</code>或<code>@SpringBootApplication</code>注释的Spring Boot应用程序，它可能会导致特定问题，因为每个jar中的每个类都被读取。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>我们建议您遵循Java推荐的包命名约定并使用反向域名（例如，<code>com.example.project</code>）。</td>
</tr>
</tbody></table>
<h2 id="14-2找到主应用程序类"><a href="#14-2找到主应用程序类" class="headerlink" title="14.2找到主应用程序类"></a>14.2找到主应用程序类</h2><p>我们通常建议您将主应用程序类放在其他类之上的根包中。的<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-using-springbootapplication-annotation"><code>@SpringBootApplication</code>注释</a>往往放在主类，它隐式地定义某些项目碱“的搜索包”。例如，如果您正在编写JPA应用程序，则使用<code>@SpringBootApplication</code>带注释类的包来搜索<code>@Entity</code>项。使用根包还允许组件扫描仅应用于您的项目。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果您不想使用<code>@SpringBootApplication</code>，它导入的<code>@EnableAutoConfiguration</code>和<code>@ComponentScan</code>注释会定义该行为，因此您也可以使用它。</td>
</tr>
</tbody></table>
<p>以下清单显示了典型的布局：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">com</span><br><span class="line"> +- example</span><br><span class="line">     +- myapplication</span><br><span class="line">         +- Application.java</span><br><span class="line">         |</span><br><span class="line">         +- customer</span><br><span class="line">         |   +- Customer.java</span><br><span class="line">         |   +- CustomerController.java</span><br><span class="line">         |   +- CustomerService.java</span><br><span class="line">         |   +- CustomerRepository.java</span><br><span class="line">         |</span><br><span class="line">         +- order</span><br><span class="line">             +- Order.java</span><br><span class="line">             +- OrderController.java</span><br><span class="line">             +- OrderService.java</span><br><span class="line">             +- OrderRepository.java</span><br></pre></td></tr></table></figure>

<p><code>Application.java</code>文件将声明<code>main</code>方法以及基本<code>@SpringBootApplication</code>，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">package com.example.myapplication;</span><br><span class="line"></span><br><span class="line">import org.springframework.boot.SpringApplication;</span><br><span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line">@SpringBootApplication</span><br><span class="line">public class Application &#123;</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		SpringApplication.run(Application.class, args);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="15-配置类"><a href="#15-配置类" class="headerlink" title="15.配置类"></a>15.配置类</h2><p>Spring Boot支持基于Java的配置。虽然可以将<code>SpringApplication</code>与XML源一起使用，但我们通常建议您的主要来源是单个<code>@Configuration</code>类。通常，定义<code>main</code>方法的类是主要的<code>@Configuration</code>候选者。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>许多Spring配置示例已在Internet上发布，使用XML配置。如果可能，请始终尝试使用等效的基于Java的配置。搜索<code>Enable*</code>注释可能是一个很好的起点。</td>
</tr>
</tbody></table>
<h2 id="15-1导入其他配置类"><a href="#15-1导入其他配置类" class="headerlink" title="15.1导入其他配置类"></a>15.1导入其他配置类</h2><p>你不需要将所有<code>@Configuration</code>放入一个班级。<code>@Import</code>注释可用于导入其他配置类。或者，您可以使用<code>@ComponentScan</code>自动选取所有Spring组件，包括<code>@Configuration</code>类。</p>
<h2 id="15-2导入XML配置"><a href="#15-2导入XML配置" class="headerlink" title="15.2导入XML配置"></a>15.2导入XML配置</h2><p>如果您绝对必须使用基于XML的配置，我们建议您仍然使用<code>@Configuration</code>类。然后，您可以使用<code>@ImportResource</code>注释来加载XML配置文件。</p>
<h2 id="16-自动配置"><a href="#16-自动配置" class="headerlink" title="16.自动配置"></a>16.自动配置</h2><p>Spring Boot自动配置尝试根据您添加的jar依赖项自动配置您的Spring应用程序。例如，如果<code>HSQLDB</code>在您的类路径上，并且您尚未手动配置任何数据库连接beans，则Spring Boot会自动配置内存数据库。</p>
<p>您需要通过向<code>@Configuration</code>类之一添加<code>@EnableAutoConfiguration</code>或<code>@SpringBootApplication</code>注释来选择加入自动配置。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>您应该只添加一个<code>@SpringBootApplication</code>或<code>@EnableAutoConfiguration</code>注释。我们通常建议您仅将一个或另一个添加到主<code>@Configuration</code>类。</td>
</tr>
</tbody></table>
<h2 id="16-1逐步更换自动配置"><a href="#16-1逐步更换自动配置" class="headerlink" title="16.1逐步更换自动配置"></a>16.1逐步更换自动配置</h2><p>自动配置是非侵入性的。在任何时候，您都可以开始定义自己的配置以替换自动配置的特定部分。例如，如果添加自己的<code>DataSource</code> bean，则默认的嵌入式数据库支持会退回。</p>
<p>如果您需要了解当前正在应用的自动配置以及原因，请使用<code>--debug</code>开关启动您的应用程序。这样做可以为选择的核心记录器启用调试日志，并将条件报告记录到控制台。</p>
<h2 id="16-2禁用特定的自动配置类"><a href="#16-2禁用特定的自动配置类" class="headerlink" title="16.2禁用特定的自动配置类"></a>16.2禁用特定的自动配置类</h2><p>如果发现正在应用您不需要的特定自动配置类，则可以使用<code>@EnableAutoConfiguration</code>的exclude属性禁用它们，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.boot.autoconfigure.*;</span><br><span class="line">import org.springframework.boot.autoconfigure.jdbc.*;</span><br><span class="line">import org.springframework.context.annotation.*;</span><br><span class="line"></span><br><span class="line">@Configuration</span><br><span class="line">@EnableAutoConfiguration(exclude&#x3D;&#123;DataSourceAutoConfiguration.class&#125;)</span><br><span class="line">public class MyConfiguration &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果类不在类路径上，则可以使用注释的<code>excludeName</code>属性并指定完全限定名称。最后，您还可以使用<code>spring.autoconfigure.exclude</code>属性控制要排除的自动配置类列表。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>您可以在注释级别和使用属性定义排除项。</td>
</tr>
</tbody></table>
<h2 id="17-Spring-Beans和依赖注入"><a href="#17-Spring-Beans和依赖注入" class="headerlink" title="17. Spring Beans和依赖注入"></a>17. Spring Beans和依赖注入</h2><p>您可以自由使用任何标准Spring框架技术来定义beans及其注入的依赖项。为简单起见，我们经常发现使用<code>@ComponentScan</code>（找到你的beans）和使用<code>@Autowired</code>（做构造函数注入）效果很好。</p>
<p>如果按照上面的建议构建代码（在根包中定位应用程序类），则可以添加<code>@ComponentScan</code>而不带任何参数。您的所有应用程序组件（<code>@Component</code>，<code>@Service</code>，<code>@Repository</code>，<code>@Controller</code>等）都会自动注册为Spring Beans。</p>
<p>以下示例显示了<code>@Service</code> Bean，它使用构造函数注入来获取所需的<code>RiskAssessor</code> bean：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">package com.example.service;</span><br><span class="line"></span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line">@Service</span><br><span class="line">public class DatabaseAccountService implements AccountService &#123;</span><br><span class="line"></span><br><span class="line">	private final RiskAssessor riskAssessor;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	public DatabaseAccountService(RiskAssessor riskAssessor) &#123;</span><br><span class="line">		this.riskAssessor &#x3D; riskAssessor;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F; ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果bean有一个构造函数，则可以省略<code>@Autowired</code>，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Service</span><br><span class="line">public class DatabaseAccountService implements AccountService &#123;</span><br><span class="line"></span><br><span class="line">	private final RiskAssessor riskAssessor;</span><br><span class="line"></span><br><span class="line">	public DatabaseAccountService(RiskAssessor riskAssessor) &#123;</span><br><span class="line">		this.riskAssessor &#x3D; riskAssessor;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F; ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>请注意使用构造函数注入如何将<code>riskAssessor</code>字段标记为<code>final</code>，表示无法随后更改它。</td>
</tr>
</tbody></table>
<h2 id="18-使用-SpringBootApplication-Annotation"><a href="#18-使用-SpringBootApplication-Annotation" class="headerlink" title="18.使用@SpringBootApplication Annotation"></a>18.使用@SpringBootApplication Annotation</h2><p>许多Spring Boot开发人员喜欢他们的应用程序使用自动配置，组件扫描，并能够在他们的“应用程序类”上定义额外的配置。单个<code>@SpringBootApplication</code>注释可用于启用这三个功能，即：</p>
<ul>
<li><code>@EnableAutoConfiguration</code>：启用<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-auto-configuration">Spring Boot的自动配置机制</a></li>
<li><code>@ComponentScan</code>：对应用程序所在的软件包启用<code>@Component</code>扫描（请参阅<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-structuring-your-code">最佳实践</a>）</li>
<li><code>@Configuration</code>：允许在上下文中注册额外的beans或导入其他配置类</li>
</ul>
<p><code>@SpringBootApplication</code>注释等效于使用<code>@Configuration</code>，<code>@EnableAutoConfiguration</code>和<code>@ComponentScan</code>及其默认属性，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">package com.example.myapplication;</span><br><span class="line"></span><br><span class="line">import org.springframework.boot.SpringApplication;</span><br><span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line">@SpringBootApplication &#x2F;&#x2F; same as @Configuration @EnableAutoConfiguration @ComponentScan</span><br><span class="line">public class Application &#123;</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		SpringApplication.run(Application.class, args);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td><code>@SpringBootApplication</code>还提供了别名来自定义<code>@EnableAutoConfiguration</code>和<code>@ComponentScan</code>的属性。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>这些功能中的None是强制性的，您可以选择使用它启用的任何功能替换此单个注释。例如，您可能不希望在应用程序中使用组件扫描：<code>package com.example.myapplication; import org.springframework.boot.SpringApplication; import org.springframework.context.annotation.ComponentScan import org.springframework.context.annotation.Configuration; import org.springframework.context.annotation.Import; *@Configuration* *@EnableAutoConfiguration* *@Import(&#123; MyConfig.class, MyAnotherConfig.class &#125;)* public class Application &#123;     public static void main(String[] args) &#123;         SpringApplication.run(Application.class, args); &#125; &#125;</code>在此示例中，<code>Application</code>与任何其他Spring Boot应用程序一样，除了<code>@Component</code> - 未自动检测带注释的类，并且显式导入用户定义的beans（请参阅<code>@Import</code>） 。</td>
</tr>
</tbody></table>
<h2 id="19-运行您的应用程序"><a href="#19-运行您的应用程序" class="headerlink" title="19.运行您的应用程序"></a>19.运行您的应用程序</h2><p>将应用程序打包为jar并使用嵌入式HTTP服务器的最大优势之一是，您可以像运行任何其他服务器一样运行应用程序。调试Spring Boot应用程序也很容易。您不需要任何特殊的IDE插件或扩展。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>本节仅介绍基于罐子的包装。如果您选择将应用程序打包为war文件，则应参阅服务器和IDE文档。</td>
</tr>
</tbody></table>
<h2 id="19-1从IDE运行"><a href="#19-1从IDE运行" class="headerlink" title="19.1从IDE运行"></a>19.1从IDE运行</h2><p>您可以从IDE运行Spring Boot应用程序作为简单的Java应用程序。但是，您首先需要导入项目。导入步骤因IDE和构建系统而异。大多数IDE可以直接导入Maven项目。例如，Eclipse用户可以从<code>File</code>菜单中选择<code>Import…</code>→<code>Existing Maven Projects</code>。</p>
<p>如果无法将项目直接导入IDE，则可以使用构建插件生成IDE元数据。Maven包括<a target="_blank" rel="noopener" href="https://maven.apache.org/plugins/maven-eclipse-plugin/">Eclipse</a>和 <a target="_blank" rel="noopener" href="https://maven.apache.org/plugins/maven-idea-plugin/">IDEA的</a>插件 。Gradle提供<a target="_blank" rel="noopener" href="https://docs.gradle.org/4.2.1/userguide/userguide.html">各种IDE的</a>插件 。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果您不小心运行了两次Web应用程序，则会看到“端口已在使用中”错误。STS用户可以使用<code>Relaunch</code>按钮而不是<code>Run</code>按钮来确保关闭任何现有实例。</td>
</tr>
</tbody></table>
<h2 id="19-2作为打包应用程序运行"><a href="#19-2作为打包应用程序运行" class="headerlink" title="19.2作为打包应用程序运行"></a>19.2作为打包应用程序运行</h2><p>如果您使用Spring Boot Maven或Gradle插件创建可执行jar，则可以使用<code>java -jar</code>运行应用程序，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar target&#x2F;myapplication-0.0.1-SNAPSHOT.jar</span><br></pre></td></tr></table></figure>

<p>也可以运行启用了远程调试支持的打包应用程序。这样做可以将调试器附加到打包的应用程序，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ java -Xdebug -Xrunjdwp:server&#x3D;y,transport&#x3D;dt_socket,address&#x3D;8000,suspend&#x3D;n \</span><br><span class="line">       -jar target&#x2F;myapplication-0.0.1-SNAPSHOT.jar</span><br></pre></td></tr></table></figure>

<h2 id="19-3使用Maven插件"><a href="#19-3使用Maven插件" class="headerlink" title="19.3使用Maven插件"></a>19.3使用Maven插件</h2><p>Spring Boot Maven插件包含<code>run</code>目标，可用于快速编译和运行您的应用程序。应用程序以分解形式运行，就像在IDE中一样。以下示例显示了运行Spring Boot应用程序的典型Maven命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mvn spring-boot:run</span><br></pre></td></tr></table></figure>

<p>您可能还想使用<code>MAVEN_OPTS</code>操作系统环境变量，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ export MAVEN_OPTS&#x3D;-Xmx1024m</span><br></pre></td></tr></table></figure>

<h2 id="19-4使用Gradle插件"><a href="#19-4使用Gradle插件" class="headerlink" title="19.4使用Gradle插件"></a>19.4使用Gradle插件</h2><p>Spring Boot Gradle插件还包含<code>bootRun</code>任务，可用于以爆炸形式运行您的应用程序。每当您应用<code>org.springframework.boot</code>和<code>java</code>插件时，都会添加<code>bootRun</code>任务，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gradle bootRun</span><br></pre></td></tr></table></figure>

<p>您可能还想使用<code>JAVA_OPTS</code>操作系统环境变量，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ export JAVA_OPTS&#x3D;-Xmx1024m</span><br></pre></td></tr></table></figure>

<h2 id="19-5热插拔"><a href="#19-5热插拔" class="headerlink" title="19.5热插拔"></a>19.5热插拔</h2><p>由于Spring Boot应用程序只是普通的Java应用程序，因此JVM热交换应该是开箱即用的。JVM热交换在某种程度上受限于它可以替换的字节码。要获得更完整的解决方案， 可以使用<a target="_blank" rel="noopener" href="https://zeroturnaround.com/software/jrebel/">JRebel</a>。</p>
<p><code>spring-boot-devtools</code>模块还包括对快速应用程序重启的支持。有关详细信息，请参阅<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-devtools">本章</a>后面的<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-devtools">第20章“ </a><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-devtools"><em>开发人员工具”</em></a>部分和 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#howto-hotswapping">热交换“操作方法”</a>。</p>
<h2 id="20-开发人员工具"><a href="#20-开发人员工具" class="headerlink" title="20.开发人员工具"></a>20.开发人员工具</h2><p>Spring Boot包括一组额外的工具，可以使应用程序开发体验更加愉快。<code>spring-boot-devtools</code>模块可以包含在任何项目中，以提供额外的开发时间功能。要包含devtools支持，请将模块依赖项添加到您的构建中，如以下Maven和Gradle列表所示：</p>
<p><strong>Maven.</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">	&lt;dependency&gt;</span><br><span class="line">		&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">		&lt;artifactId&gt;spring-boot-devtools&lt;&#x2F;artifactId&gt;</span><br><span class="line">		&lt;optional&gt;true&lt;&#x2F;optional&gt;</span><br><span class="line">	&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;&#x2F;dependencies&gt;</span><br></pre></td></tr></table></figure>



<p><strong>Gradle.</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">configurations &#123;</span><br><span class="line">	developmentOnly</span><br><span class="line">	runtimeClasspath &#123;</span><br><span class="line">		extendsFrom developmentOnly</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">dependencies &#123;</span><br><span class="line">	developmentOnly(&quot;org.springframework.boot:spring-boot-devtools&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>运行完全打包的应用程序时会自动禁用开发人员工具。如果您的应用程序是从<code>java -jar</code>启动的，或者它是从特殊的类加载器启动的，则它被视为“生产应用程序”。在Maven中将依赖项标记为可选，或在Gradle中使用custom<code>developmentOnly</code>配置（如上所示）是防止devtools传递应用于使用项目的其他模块的最佳实践。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>重新打包的归档默认情况下不包含devtools。如果要使用 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-devtools-remote">某个远程devtools功能</a>，则需要禁用<code>excludeDevtools</code>构建属性以包含它。Maven和Gradle插件均支持该属性。</td>
</tr>
</tbody></table>
<h2 id="20-1-Property默认值"><a href="#20-1-Property默认值" class="headerlink" title="20.1 Property默认值"></a>20.1 Property默认值</h2><p>Spring Boot支持的几个库使用缓存来提高性能。例如，<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-spring-mvc-template-engines">模板引擎</a>缓存已编译的模板以避免重复解析模板文件。此外，Spring MVC可以在提供静态资源时为响应添加HTTP缓存头。</p>
<p>虽然缓存在生产中非常有用，但在开发过程中可能会适得其反，从而使您无法看到刚刚在应用程序中进行的更改。因此，spring-boot-devtools默认禁用缓存选项。</p>
<p>缓存选项通常由<code>application.properties</code>文件中的设置配置。例如，Thymeleaf提供<code>spring.thymeleaf.cache</code>财产。<code>spring-boot-devtools</code>模块不需要手动设置这些属性，而是自动应用合理的开发时配置。</p>
<p>由于在开发Spring MVC和Spring WebFlux应用程序时需要有关Web请求的更多信息，因此开发人员工具将为<code>web</code>日志记录组启用<code>DEBUG</code>日志记录。这将为您提供有关传入请求，处理程序正在处理它，响应结果等的信息。如果您希望记录所有请求详细信息（包括可能的敏感信息），您可以打开<code>spring.http.log-request-details</code>配置属性。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果您不希望应用属性默认值，则可以在<code>application.properties</code>中将<code>spring.devtools.add-properties</code>设置为<code>false</code>。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>有关devtools应用的属性的完整列表，请参阅 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-devtools/src/main/java/org/springframework/boot/devtools/env/DevToolsPropertyDefaultsPostProcessor.java">DevToolsPropertyDefaultsPostProcessor</a>。</td>
</tr>
</tbody></table>
<h2 id="20-2自动重启"><a href="#20-2自动重启" class="headerlink" title="20.2自动重启"></a>20.2自动重启</h2><p>只要类路径上的文件发生更改，使用<code>spring-boot-devtools</code>的应用程序就会自动重新启动。在IDE中工作时，这可能是一个有用的功能，因为它为代码更改提供了非常快速的反馈循环。默认情况下，将监视类路径上指向文件夹的任何条目的更改。请注意，某些资源（如静态资产和视图模板）<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-devtools-restart-exclude">无需重新启动应用程序</a>。</p>
<p><strong>触发重启</strong></p>
<p>由于DevTools监视类路径资源，因此触发重新启动的唯一方法是更新类路径。导致更新类路径的方式取决于您使用的IDE。在Eclipse中，保存修改后的文件会导致更新类路径并触发重新启动。在IntelliJ IDEA中，构建项目（<code>Build -&gt; Build Project</code>）具有相同的效果。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>只要启用了分叉，您也可以使用支持的构建插件（Maven和Gradle）启动应用程序，因为DevTools需要一个独立的应用程序类加载器才能正常运行。默认情况下，Gradle和Maven在类路径上检测到DevTools时会这样做。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>与LiveReload一起使用时，自动重启非常有效。 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-devtools-livereload">有关</a>详细信息，<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-devtools-livereload">请参阅LiveReload部分</a>。如果使用JRebel，则禁用自动重新启动以支持动态类重新加载。其他devtools功能（例如LiveReload和属性覆盖）仍然可以使用。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>DevTools依赖于应用程序上下文的关闭钩子来在重启期间关闭它。如果禁用了关闭挂钩（<code>SpringApplication.setRegisterShutdownHook(false)</code>），它将无法正常工作。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>在确定类路径上的条目是否应在更改时触发重新启动时，DevTools会自动忽略名为<code>spring-boot</code>，<code>spring-boot-devtools</code>，<code>spring-boot-autoconfigure</code>，<code>spring-boot-actuator</code>和<code>spring-boot-starter</code>的项目。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>DevTools需要自定义<code>ApplicationContext</code>使用的<code>ResourceLoader</code>。如果您的应用程序已经提供了一个，它将被包装。不支持直接覆盖<code>ApplicationContext</code>上的<code>getResource</code>方法。</td>
</tr>
</tbody></table>
<p><strong>重新启动vs Reload</strong></p>
<p>Spring Boot提供的重启技术使用两个类加载器。不更改的类（例如，来自第三方jar的类）将加载到<em>基</em> 类加载器中。您正在积极开发的类将加载到<em>重新启动的</em> 类加载器中。重新启动应用程序时，将<em>重新启动重新启动的</em>类加载器并创建一个新的类加载器。这种方法意味着应用程序重新启动通常比“冷启动”快得多，因为<em>基本</em>类加载器已经可用并已填充。</p>
<p>如果您发现重新启动对于您的应用程序来说不够快或遇到类加载问题，您可以考虑从ZeroTurnaround 重新加载<a target="_blank" rel="noopener" href="https://zeroturnaround.com/software/jrebel/">JRebel</a>等技术 。这些工作通过在加载类时重写类以使它们更适合重新加载。</p>
<h3 id="20-2-1记录条件评估中的变化"><a href="#20-2-1记录条件评估中的变化" class="headerlink" title="20.2.1记录条件评估中的变化"></a>20.2.1记录条件评估中的变化</h3><p>默认情况下，每次应用程序重新启动时，都会记录一个显示条件评估增量的报告。该报告显示在您进行更改（例如添加或删除beans和设置配置属性）时对应用程序的自动配置所做的更改。</p>
<p>要禁用报告的日志记录，请设置以下属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.devtools.restart.log-condition-evaluation-delta&#x3D;false</span><br></pre></td></tr></table></figure>

<h3 id="20-2-2不包括资源"><a href="#20-2-2不包括资源" class="headerlink" title="20.2.2不包括资源"></a>20.2.2不包括资源</h3><p>某些资源在更改时不一定需要触发重启。例如，可以就地编辑Thymeleaf模板。默认情况下，更改<code>/META-INF/maven</code>，<code>/META-INF/resources</code>，<code>/resources</code>，<code>/static</code>，<code>/public</code>或<code>/templates</code>中的资源不会触发重新启动，但会触发 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-devtools-livereload">实时重新加载</a>。如果要自定义这些排除项，可以使用<code>spring.devtools.restart.exclude</code>属性。例如，要仅排除<code>/static</code>和<code>/public</code>，您需要设置以下属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.devtools.restart.exclude&#x3D;static&#x2F;**,public&#x2F;**</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果要保留这些默认值并<em>添加</em>其他排除项，请改用<code>spring.devtools.restart.additional-exclude</code>属性。</td>
</tr>
</tbody></table>
<h3 id="20-2-3查看其他路径"><a href="#20-2-3查看其他路径" class="headerlink" title="20.2.3查看其他路径"></a>20.2.3查看其他路径</h3><p>当您对不在类路径中的文件进行更改时，您可能希望重新启动或重新加载应用程序。为此，请使用<code>spring.devtools.restart.additional-paths</code>属性配置其他路径以监视更改。您可以使用<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-devtools-restart-exclude">前面描述</a>的<code>spring.devtools.restart.exclude</code>属性 来控制其他路径下的更改是触发完全重新启动还是 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-devtools-livereload">实时重新加载</a>。</p>
<h3 id="20-2-4禁用重启"><a href="#20-2-4禁用重启" class="headerlink" title="20.2.4禁用重启"></a>20.2.4禁用重启</h3><p>如果您不想使用重新启动功能，可以使用<code>spring.devtools.restart.enabled</code>属性将其禁用。在大多数情况下，您可以在<code>application.properties</code>中设置此属性（这样做仍会初始化重新启动的类加载器，但它不会监视文件更改）。</p>
<p>如果您需要<em>完全</em>禁用重新启动支持（例如，因为它不能与特定库一起使用），则需要在调用<code>SpringApplication.run(…)</code>之前将<code>spring.devtools.restart.enabled</code> <code>System</code>属性设置为<code>false</code>，如如下例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">	System.setProperty(&quot;spring.devtools.restart.enabled&quot;, &quot;false&quot;);</span><br><span class="line">	SpringApplication.run(MyApp.class, args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="20-2-5使用触发文件"><a href="#20-2-5使用触发文件" class="headerlink" title="20.2.5使用触发文件"></a>20.2.5使用触发文件</h3><p>如果使用不断编译已更改文件的IDE，则可能更喜欢仅在特定时间触发重新启动。为此，您可以使用“触发器文件”，这是一个特殊文件，当您想要实际触发重新启动检查时，必须对其进行修改。更改文件只会触发检查，只有在Devtools检测到必须执行某些操作时才会重新启动。触发器文件可以手动更新，也可以使用IDE插件更新。</p>
<p>要使用触发器文件，请将<code>spring.devtools.restart.trigger-file</code>属性设置为触发器文件的路径。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>您可能希望将<code>spring.devtools.restart.trigger-file</code> <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-devtools-globalsettings">设置</a>为 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-devtools-globalsettings">全局设置</a>，以便所有项目的行为方式相同。</td>
</tr>
</tbody></table>
<h3 id="20-2-6自定义重启类加载器"><a href="#20-2-6自定义重启类加载器" class="headerlink" title="20.2.6自定义重启类加载器"></a>20.2.6自定义重启类加载器</h3><p>如前面在<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-spring-boot-restart-vs-reload">Restart vs Reload</a>部分中所述，使用两个类加载器实现了重启功能。对于大多数应用程序，此方法运行良好。但是，它有时会导致类加载问题。</p>
<p>默认情况下，IDE中的任何打开项目都使用“restart”类加载器加载，并且任何常规<code>.jar</code>文件都加载了“base”类加载器。如果您处理多模块项目，并且并非每个模块都导入到IDE中，则可能需要自定义内容。为此，您可以创建一个<code>META-INF/spring-devtools.properties</code>文件。</p>
<p><code>spring-devtools.properties</code>文件可以包含前缀为<code>restart.exclude</code>和<code>restart.include</code>的属性。<code>include</code>元素是应该被拉入“restart”类加载器的项目，<code>exclude</code>元素是应该被下推到“基础”类加载器中的项目。该属性的值是应用于类路径的正则表达式模式，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">restart.exclude.companycommonlibs&#x3D;&#x2F;mycorp-common-[\\w-]+\.jar</span><br><span class="line">restart.include.projectcommon&#x3D;&#x2F;mycorp-myproj-[\\w-]+\.jar</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>所有属性键必须是唯一的。只要属性以<code>restart.include.</code>或<code>restart.exclude.</code>开头，就会被考虑。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>从类路径中加载所有<code>META-INF/spring-devtools.properties</code>。您可以将文件打包到项目中，也可以打包在项目使用的库中。</td>
</tr>
</tbody></table>
<h3 id="20-2-7已知限制"><a href="#20-2-7已知限制" class="headerlink" title="20.2.7已知限制"></a>20.2.7已知限制</h3><p>对于使用标准<code>ObjectInputStream</code>反序列化的对象，重新启动功能不起作用。如果您需要反序列化数据，则可能需要将Spring的<code>ConfigurableObjectInputStream</code>与<code>Thread.currentThread().getContextClassLoader()</code>结合使用。</p>
<p>不幸的是，几个第三方库反序列化而没有考虑上下文类加载器。如果您发现此类问题，则需要向原始作者请求修复。</p>
<h2 id="20-3-LiveReload"><a href="#20-3-LiveReload" class="headerlink" title="20.3 LiveReload"></a>20.3 LiveReload</h2><p><code>spring-boot-devtools</code>模块包括一个嵌入式LiveReload服务器，可用于在更改资源时触发浏览器刷新。LiveReload浏览器扩展程序可从<a target="_blank" rel="noopener" href="http://livereload.com/extensions/">livereload.com</a>免费用于Chrome，Firefox和Safari 。</p>
<p>如果您不想在应用程序运行时启动LiveReload服务器，则可以将<code>spring.devtools.livereload.enabled</code>属性设置为<code>false</code>。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>您一次只能运行一个LiveReload服务器。在启动应用程序之前，请确保没有其他LiveReload服务器正在运行。如果从IDE启动多个应用程序，则只有第一个具有LiveReload支持。</td>
</tr>
</tbody></table>
<h2 id="20-4全局设置"><a href="#20-4全局设置" class="headerlink" title="20.4全局设置"></a>20.4全局设置</h2><p>您可以通过将名为<code>.spring-boot-devtools.properties</code>的文件添加到<code>$HOME</code>文件夹来配置全局devtools设置（请注意，文件名以“。”开头）。添加到此文件的任何属性<em>都</em>适用于计算机上使用devtools的<em>所有</em> Spring Boot应用程序。例如，要将restart配置为始终使用 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-devtools-restart-triggerfile">触发器文件</a>，您需要添加以下属性：</p>
<p><strong>〜/ .spring引导-devtools.properties。</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.devtools.reload.trigger-file&#x3D;.reloadtrigger</span><br></pre></td></tr></table></figure>



<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>在<code>.spring-boot-devtools.properties</code>中激活的<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-external-config-profile-specific-properties">配置文件</a>不会影响<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-external-config-profile-specific-properties">特定于配置文件的配置文件</a>的加载。</td>
</tr>
</tbody></table>
<h2 id="20-5远程应用程序"><a href="#20-5远程应用程序" class="headerlink" title="20.5远程应用程序"></a>20.5远程应用程序</h2><p>Spring Boot开发人员工具不仅限于本地开发。远程运行应用程序时，您还可以使用多个功能。远程支持是选择加入。要启用它，您需要确保重新打包的存档中包含<code>devtools</code>，如下面的清单所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">	&lt;plugins&gt;</span><br><span class="line">		&lt;plugin&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-boot-maven-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">			&lt;configuration&gt;</span><br><span class="line">				&lt;excludeDevtools&gt;false&lt;&#x2F;excludeDevtools&gt;</span><br><span class="line">			&lt;&#x2F;configuration&gt;</span><br><span class="line">		&lt;&#x2F;plugin&gt;</span><br><span class="line">	&lt;&#x2F;plugins&gt;</span><br><span class="line">&lt;&#x2F;build&gt;</span><br></pre></td></tr></table></figure>

<p>然后，您需要设置<code>spring.devtools.remote.secret</code>属性，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.devtools.remote.secret&#x3D;mysecret</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/warning.png" alt="[警告]"></th>
</tr>
</thead>
<tbody><tr>
<td>在远程应用程序上启用<code>spring-boot-devtools</code>存在安全风险。您永远不应该在生产部署上启用支持。</td>
</tr>
</tbody></table>
<p>远程devtools支持由两部分组成：一个接受连接的服务器端端点和一个在IDE中运行的客户端应用程序。设置<code>spring.devtools.remote.secret</code>属性后，将自动启用服务器组件。必须手动启动客户端组件。</p>
<h3 id="20-5-1运行远程客户端应用程序"><a href="#20-5-1运行远程客户端应用程序" class="headerlink" title="20.5.1运行远程客户端应用程序"></a>20.5.1运行远程客户端应用程序</h3><p>远程客户端应用程序旨在从IDE中运行。您需要使用与连接到的远程项目相同的类路径运行<code>org.springframework.boot.devtools.RemoteSpringApplication</code>。应用程序的单个必需参数是它连接的远程URL。</p>
<p>例如，如果您使用的是Eclipse或STS，并且已经部署到Cloud Foundry的项目名为<code>my-app</code>，则可以执行以下操作：</p>
<ul>
<li>从<code>Run</code>菜单中选择<code>Run Configurations…</code>。</li>
<li>创建一个新的<code>Java Application</code>“启动配置”。</li>
<li>浏览<code>my-app</code>项目。</li>
<li>使用<code>org.springframework.boot.devtools.RemoteSpringApplication</code>作为主类。</li>
<li>将<code>https://myapp.cfapps.io</code>添加到<code>Program arguments</code>（或任何远程URL）。</li>
</ul>
<p>正在运行的远程客户端可能类似于以下列表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">  .   ____          _                                              __ _ _</span><br><span class="line"> &#x2F;\\ &#x2F; ___&#39;_ __ _ _(_)_ __  __ _          ___               _      \ \ \ \</span><br><span class="line">( ( )\___ | &#39;_ | &#39;_| | &#39;_ \&#x2F; _&#96; |        | _ \___ _ __  ___| |_ ___ \ \ \ \</span><br><span class="line"> \\&#x2F;  ___)| |_)| | | | | || (_| []::::::[]   &#x2F; -_) &#39;  \&#x2F; _ \  _&#x2F; -_) ) ) ) )</span><br><span class="line">  &#39;  |____| .__|_| |_|_| |_\__, |        |_|_\___|_|_|_\___&#x2F;\__\___|&#x2F; &#x2F; &#x2F; &#x2F;</span><br><span class="line"> &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;|_|&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;|___&#x2F;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x2F;_&#x2F;_&#x2F;_&#x2F;</span><br><span class="line"> :: Spring Boot Remote :: 2.1.1.RELEASE</span><br><span class="line"></span><br><span class="line">2015-06-10 18:25:06.632  INFO 14938 --- [           main] o.s.b.devtools.RemoteSpringApplication   : Starting RemoteSpringApplication on pwmbp with PID 14938 (&#x2F;Users&#x2F;pwebb&#x2F;projects&#x2F;spring-boot&#x2F;code&#x2F;spring-boot-devtools&#x2F;target&#x2F;classes started by pwebb in &#x2F;Users&#x2F;pwebb&#x2F;projects&#x2F;spring-boot&#x2F;code&#x2F;spring-boot-samples&#x2F;spring-boot-sample-devtools)</span><br><span class="line">2015-06-10 18:25:06.671  INFO 14938 --- [           main] s.c.a.AnnotationConfigApplicationContext : Refreshing org.springframework.context.annotation.AnnotationConfigApplicationContext@2a17b7b6: startup date [Wed Jun 10 18:25:06 PDT 2015]; root of context hierarchy</span><br><span class="line">2015-06-10 18:25:07.043  WARN 14938 --- [           main] o.s.b.d.r.c.RemoteClientConfiguration    : The connection to http:&#x2F;&#x2F;localhost:8080 is insecure. You should use a URL starting with &#39;https:&#x2F;&#x2F;&#39;.</span><br><span class="line">2015-06-10 18:25:07.074  INFO 14938 --- [           main] o.s.b.d.a.OptionalLiveReloadServer       : LiveReload server is running on port 35729</span><br><span class="line">2015-06-10 18:25:07.130  INFO 14938 --- [           main] o.s.b.devtools.RemoteSpringApplication   : Started RemoteSpringApplication in 0.74 seconds (JVM running for 1.105)</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>因为远程客户端使用与真实应用程序相同的类路径，所以它可以直接读取应用程序属性。这是<code>spring.devtools.remote.secret</code>属性的读取方式并传递给服务器进行身份验证。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>始终建议使用<code>https://</code>作为连接协议，以便加密流量并且不会截获密码。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果需要使用代理来访问远程应用程序，请配置<code>spring.devtools.remote.proxy.host</code>和<code>spring.devtools.remote.proxy.port</code>属性。</td>
</tr>
</tbody></table>
<h3 id="20-5-2远程更新"><a href="#20-5-2远程更新" class="headerlink" title="20.5.2远程更新"></a>20.5.2远程更新</h3><p>远程客户端以与<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-devtools-restart">本地重新启动</a>相同的方式监视应用程序类路径以进行更改 。任何更新的资源都会被推送到远程应用程序，并且（<em>如果需要</em>）会触发重新启动。如果您迭代使用本地没有的云服务的功能，这将非常有用。通常，远程更新和重新启动比完全重建和部署周期快得多。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>仅在远程客户端运行时监视文件。如果在启动远程客户端之前更改文件，则不会将其推送到远程服务器。</td>
</tr>
</tbody></table>
<h2 id="21-包装您的生产应用程序"><a href="#21-包装您的生产应用程序" class="headerlink" title="21.包装您的生产应用程序"></a>21.包装您的生产应用程序</h2><p>可执行jar可用于生产部署。由于它们是独立的，因此它们也非常适合基于云的部署。</p>
<p>对于其他“生产就绪”功能，例如运行状况，审计和度量标准REST或JMX端点，请考虑添加<code>spring-boot-actuator</code>。有关详细信息*<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready">，</a>*请参见 *<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready">第V部分“Spring Boot Actuator：生产就绪功能”</a>*。</p>
<h2 id="22-接下来要阅读的内容"><a href="#22-接下来要阅读的内容" class="headerlink" title="22.接下来要阅读的内容"></a>22.接下来要阅读的内容</h2><p>您现在应该了解如何使用Spring Boot和一些您应该遵循的最佳实践。您现在可以继续深入了解特定的 *<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features">Spring Boot功能</a>*，或者您可以跳过并阅读Spring Boot 的“ <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready">生产就绪</a> ”方面。</p>
<h1 id="第四部分。Spring-Boot功能"><a href="#第四部分。Spring-Boot功能" class="headerlink" title="第四部分。Spring Boot功能"></a>第四部分。Spring Boot功能</h1><p>本节深入研究Spring Boot的细节。在这里，您可以了解您可能想要使用和自定义的主要功能。如果您还没有这样做，您可能需要阅读“ <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#getting-started">第二部分</a> ” <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#getting-started">，“入门</a> ”和“ <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot">第三部分”，使用Spring Boot“</a> ”部分，以便您掌握基础知识。</p>
<h2 id="23-SpringApplication"><a href="#23-SpringApplication" class="headerlink" title="23. SpringApplication"></a>23. SpringApplication</h2><p><code>SpringApplication</code>类提供了一种方便的方法来引导从<code>main()</code>方法启动的Spring应用程序。在许多情况下，您可以委托静态<code>SpringApplication.run</code>方法，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">	SpringApplication.run(MySpringConfiguration.class, args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当您的应用程序启动时，您应该看到类似于以下输出的内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">  .   ____          _            __ _ _</span><br><span class="line"> &#x2F;\\ &#x2F; ___&#39;_ __ _ _(_)_ __  __ _ \ \ \ \</span><br><span class="line">( ( )\___ | &#39;_ | &#39;_| | &#39;_ \&#x2F; _&#96; | \ \ \ \</span><br><span class="line"> \\&#x2F;  ___)| |_)| | | | | || (_| |  ) ) ) )</span><br><span class="line">  &#39;  |____| .__|_| |_|_| |_\__, | &#x2F; &#x2F; &#x2F; &#x2F;</span><br><span class="line"> &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;|_|&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;|___&#x2F;&#x3D;&#x2F;_&#x2F;_&#x2F;_&#x2F;</span><br><span class="line"> :: Spring Boot ::   v2.1.1.RELEASE</span><br><span class="line"></span><br><span class="line">2013-07-31 00:08:16.117  INFO 56603 --- [           main] o.s.b.s.app.SampleApplication            : Starting SampleApplication v0.1.0 on mycomputer with PID 56603 (&#x2F;apps&#x2F;myapp.jar started by pwebb)</span><br><span class="line">2013-07-31 00:08:16.166  INFO 56603 --- [           main] ationConfigServletWebServerApplicationContext : Refreshing org.springframework.boot.web.servlet.context.AnnotationConfigServletWebServerApplicationContext@6e5a8246: startup date [Wed Jul 31 00:08:16 PDT 2013]; root of context hierarchy</span><br><span class="line">2014-03-04 13:09:54.912  INFO 41370 --- [           main] .t.TomcatServletWebServerFactory : Server initialized with port: 8080</span><br><span class="line">2014-03-04 13:09:56.501  INFO 41370 --- [           main] o.s.b.s.app.SampleApplication            : Started SampleApplication in 2.992 seconds (JVM running for 3.658)</span><br></pre></td></tr></table></figure>

<p>默认情况下，会显示<code>INFO</code>日志记录消息，包括一些相关的启动详细信息，例如启动应用程序的用户。如果您需要<code>INFO</code>以外的日志级别，可以进行设置，如<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-custom-log-levels">第26.4节“日志级别”中所述</a>，</p>
<h2 id="23-1启动失败"><a href="#23-1启动失败" class="headerlink" title="23.1启动失败"></a>23.1启动失败</h2><p>如果您的应用程序无法启动，则已注册<code>FailureAnalyzers</code>有机会提供专用错误消息和具体操作来解决问题。例如，如果您在端口<code>8080</code>上启动Web应用程序并且该端口已在使用中，您应该会看到类似于以下消息的内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">***************************</span><br><span class="line">APPLICATION FAILED TO START</span><br><span class="line">***************************</span><br><span class="line"></span><br><span class="line">Description:</span><br><span class="line"></span><br><span class="line">Embedded servlet container failed to start. Port 8080 was already in use.</span><br><span class="line"></span><br><span class="line">Action:</span><br><span class="line"></span><br><span class="line">Identify and stop the process that&#39;s listening on port 8080 or configure this application to listen on another port.</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>Spring Boot提供了许多<code>FailureAnalyzer</code>实现，您可以 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#howto-failure-analyzer">添加自己的实现</a>。</td>
</tr>
</tbody></table>
<p>如果没有故障分析器能够处理异常，您仍然可以显示完整的条件报告，以便更好地了解出现了什么问题。为此，您需要 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-external-config">启用<code>debug</code>属性</a>或 为<code>org.springframework.boot.autoconfigure.logging.ConditionEvaluationReportLoggingListener</code> <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-custom-log-levels">启用<code>DEBUG</code>日志记录</a>。</p>
<p>例如，如果使用<code>java -jar</code>运行应用程序，则可以启用<code>debug</code>属性，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar myproject-0.0.1-SNAPSHOT.jar --debug</span><br></pre></td></tr></table></figure>

<h2 id="23-2自定义横幅"><a href="#23-2自定义横幅" class="headerlink" title="23.2自定义横幅"></a>23.2自定义横幅</h2><p>通过将<code>banner.txt</code>文件添加到类路径或将<code>spring.banner.location</code>属性设置为此类文件的位置，可以更改启动时打印的横幅。如果文件的编码不是UTF-8，则可以设置<code>spring.banner.charset</code>。除了文本文件，您还可以将<code>banner.gif</code>，<code>banner.jpg</code>或<code>banner.png</code>图像文件添加到类路径或设置<code>spring.banner.image.location</code>属性。图像将转换为ASCII艺术表示，并打印在任何文本横幅上方。</p>
<p>在<code>banner.txt</code>文件中，您可以使用以下任何占位符：</p>
<p><strong>表23.1。横幅变量</strong></p>
<table>
<thead>
<tr>
<th>变量</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>$&#123;application.version&#125;</code></td>
<td>应用程序的版本号，如<code>MANIFEST.MF</code>中声明的那样。例如，<code>Implementation-Version: 1.0</code>打印为<code>1.0</code>。</td>
</tr>
<tr>
<td><code>$&#123;application.formatted-version&#125;</code></td>
<td>应用程序的版本号，在<code>MANIFEST.MF</code>中声明并格式化以显示（用括号括起来并以<code>v</code>为前缀）。例如<code>(v1.0)</code>。</td>
</tr>
<tr>
<td><code>$&#123;spring-boot.version&#125;</code></td>
<td>您正在使用的Spring Boot版本。例如<code>2.1.1.RELEASE</code>。</td>
</tr>
<tr>
<td><code>$&#123;spring-boot.formatted-version&#125;</code></td>
<td>您正在使用的Spring Boot版本，格式化显示（用括号括起来并以<code>v</code>为前缀）。例如<code>(v2.1.1.RELEASE)</code>。</td>
</tr>
<tr>
<td><code>$&#123;Ansi.NAME&#125;</code>（或<code>$&#123;AnsiColor.NAME&#125;</code>，<code>$&#123;AnsiBackground.NAME&#125;</code>，<code>$&#123;AnsiStyle.NAME&#125;</code>）</td>
<td>其中<code>NAME</code>是ANSI转义码的名称。详情 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/ansi/AnsiPropertySource.java"><code>AnsiPropertySource</code></a>请见。</td>
</tr>
<tr>
<td><code>$&#123;application.title&#125;</code></td>
<td>申请的标题，如<code>MANIFEST.MF</code>中所述。例如<code>Implementation-Title: MyApp</code>打印为<code>MyApp</code>。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果要以编程方式生成横幅，可以使用<code>SpringApplication.setBanner(…)</code>方法。使用<code>org.springframework.boot.Banner</code>接口并实现您自己的<code>printBanner()</code>方法。</td>
</tr>
</tbody></table>
<p>您还可以使用<code>spring.main.banner-mode</code>属性来确定是否必须在<code>System.out</code>（<code>console</code>）上打印横幅，发送到配置的记录器（<code>log</code>），或者根本不产生横幅（<code>off</code>）。</p>
<p>打印的横幅以下列名称注册为单身bean：<code>springBootBanner</code>。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>YAML将<code>off</code>映射到<code>false</code>，因此如果要在应用程序中禁用横幅，请务必添加引号，如以下示例所示：<code>spring: main:     banner-mode: &quot;off&quot;</code></td>
</tr>
</tbody></table>
<h2 id="23-3自定义SpringApplication"><a href="#23-3自定义SpringApplication" class="headerlink" title="23.3自定义SpringApplication"></a>23.3自定义SpringApplication</h2><p>如果<code>SpringApplication</code>默认值不符合您的口味，您可以改为创建本地实例并对其进行自定义。例如，要关闭横幅，您可以写：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">	SpringApplication app &#x3D; new SpringApplication(MySpringConfiguration.class);</span><br><span class="line">	app.setBannerMode(Banner.Mode.OFF);</span><br><span class="line">	app.run(args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>传递给<code>SpringApplication</code>的构造函数参数是Spring beans的配置源。在大多数情况下，这些是对<code>@Configuration</code>类的引用，但它们也可以是对XML配置或应扫描的包的引用。</td>
</tr>
</tbody></table>
<p>也可以使用<code>application.properties</code>文件配置<code>SpringApplication</code>。有关详细信息*<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-external-config">，</a><em>请参见</em><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-external-config">第24章，</a>**<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-external-config">*外部化配置*</a>*。</p>
<p>有关配置选项的完整列表，请参阅 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/SpringApplication.html"><code>SpringApplication</code> Javadoc</a>。</p>
<h2 id="23-4-Fluent-Builder-API"><a href="#23-4-Fluent-Builder-API" class="headerlink" title="23.4 Fluent Builder API"></a>23.4 Fluent Builder API</h2><p>如果您需要构建<code>ApplicationContext</code>层次结构（具有父/子关系的多个上下文）或者您更喜欢使用“流畅”构建器API，则可以使用<code>SpringApplicationBuilder</code>。</p>
<p><code>SpringApplicationBuilder</code>允许您将多个方法调用链接在一起，并包含允许您创建层次结构的<code>parent</code>和<code>child</code>方法，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">new SpringApplicationBuilder()</span><br><span class="line">		.sources(Parent.class)</span><br><span class="line">		.child(Application.class)</span><br><span class="line">		.bannerMode(Banner.Mode.OFF)</span><br><span class="line">		.run(args);</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>创建<code>ApplicationContext</code>层次结构时存在一些限制。例如，Web组件<strong>必须</strong>包含在子上下文中，并且父/子上下文使用相同的<code>Environment</code>。有关详细信息，请参阅 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/builder/SpringApplicationBuilder.html"><code>SpringApplicationBuilder</code> Javadoc</a>。</td>
</tr>
</tbody></table>
<h2 id="23-5应用程序事件和监听器"><a href="#23-5应用程序事件和监听器" class="headerlink" title="23.5应用程序事件和监听器"></a>23.5应用程序事件和监听器</h2><p>除了通常的Spring框架事件之外，例如 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/javadoc-api/org/springframework/context/event/ContextRefreshedEvent.html"><code>ContextRefreshedEvent</code></a>，<code>SpringApplication</code>还会发送一些其他应用程序事件。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>某些事件实际上是在创建<code>ApplicationContext</code>之前触发的，因此您无法在<code>@Bean</code>上注册侦听器。您可以使用<code>SpringApplication.addListeners(…)</code>方法或<code>SpringApplicationBuilder.listeners(…)</code>方法注册它们。如果您希望自动注册这些侦听器，无论应用程序的创建方式如何，您都可以将<code>META-INF/spring.factories</code>文件添加到项目中并使用<code>org.springframework.context.ApplicationListener</code>键引用您的侦听器，如下所示：以下示例：<code>org.springframework.context.ApplicationListener=com.example.project.MyListener</code></td>
</tr>
</tbody></table>
<p>应用程序运行时，应按以下顺序发送应用程序事件：</p>
<ol>
<li>除了注册侦听器和初始化程序之外，在运行开始时但在任何处理之前发送<code>ApplicationStartingEvent</code>。</li>
<li>当在上下文中使用的<code>Environment</code>已知但在创建上下文之前，将发送<code>ApplicationEnvironmentPreparedEvent</code>。</li>
<li>在刷新开始之前但在加载bean定义之后发送<code>ApplicationPreparedEvent</code>。</li>
<li>在刷新上下文之后但在调用任何应用程序和命令行运行程序之前发送<code>ApplicationStartedEvent</code>。</li>
<li>在调用任何应用程序和命令行运行程序后发送<code>ApplicationReadyEvent</code>。它表示应用程序已准备好为请求提供服务。</li>
<li>如果启动时发生异常，则会发送<code>ApplicationFailedEvent</code>。</li>
</ol>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>您经常不需要使用应用程序事件，但知道它们存在可能很方便。在内部，Spring Boot使用事件来处理各种任务。</td>
</tr>
</tbody></table>
<p>应用程序事件使用Spring Framework的事件发布机制发送。此机制的一部分确保在子上下文中发布给侦听器的事件也会在任何祖先上下文中发布给侦听器。因此，如果您的应用程序使用<code>SpringApplication</code>实例的层次结构，则侦听器可能会收到相同类型的应用程序事件的多个实例。</p>
<p>为了允许侦听器区分其上下文的事件和后代上下文的事件，它应该请求注入其应用程序上下文，然后将注入的上下文与事件的上下文进行比较。可以通过实现<code>ApplicationContextAware</code>或者如果监听器是bean，使用<code>@Autowired</code>来注入上下文。</p>
<h2 id="23-6网络环境"><a href="#23-6网络环境" class="headerlink" title="23.6网络环境"></a>23.6网络环境</h2><p><code>SpringApplication</code>试图代表您创建正确类型的<code>ApplicationContext</code>。用于确定<code>WebApplicationType</code>的算法非常简单：</p>
<ul>
<li>如果存在Spring MVC，则使用<code>AnnotationConfigServletWebServerApplicationContext</code></li>
<li>如果Spring MVC不存在且存在Spring WebFlux，则使用<code>AnnotationConfigReactiveWebServerApplicationContext</code></li>
<li>否则，使用<code>AnnotationConfigApplicationContext</code></li>
</ul>
<p>这意味着如果您在同一个应用程序中使用Spring MVC和来自Spring WebFlux的新<code>WebClient</code>，默认情况下将使用Spring MVC。您可以通过调用<code>setWebApplicationType(WebApplicationType)</code>轻松覆盖它。</p>
<p>也可以通过调用<code>setApplicationContextClass(…)</code>来完全控制使用的<code>ApplicationContext</code>类型。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>在JUnit测试中使用<code>SpringApplication</code>时，通常需要调用<code>setWebApplicationType(WebApplicationType.NONE)</code>。</td>
</tr>
</tbody></table>
<h2 id="23-7访问应用程序参数"><a href="#23-7访问应用程序参数" class="headerlink" title="23.7访问应用程序参数"></a>23.7访问应用程序参数</h2><p>如果您需要访问传递给<code>SpringApplication.run(…)</code>的应用程序参数，则可以注入<code>org.springframework.boot.ApplicationArguments</code> bean。<code>ApplicationArguments</code>接口提供对原始<code>String[]</code>参数以及解析的<code>option</code>和<code>non-option</code>参数的访问，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.boot.*;</span><br><span class="line">import org.springframework.beans.factory.annotation.*;</span><br><span class="line">import org.springframework.stereotype.*;</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">public class MyBean &#123;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	public MyBean(ApplicationArguments args) &#123;</span><br><span class="line">		boolean debug &#x3D; args.containsOption(&quot;debug&quot;);</span><br><span class="line">		List&lt;String&gt; files &#x3D; args.getNonOptionArgs();</span><br><span class="line">		&#x2F;&#x2F; if run with &quot;--debug logfile.txt&quot; debug&#x3D;true, files&#x3D;[&quot;logfile.txt&quot;]</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>Spring Boot还注册<code>CommandLinePropertySource</code>和Spring <code>Environment</code>。这使您还可以使用<code>@Value</code>注释注入单个应用程序参数。</td>
</tr>
</tbody></table>
<h2 id="23-8使用ApplicationRunner或CommandLineRunner"><a href="#23-8使用ApplicationRunner或CommandLineRunner" class="headerlink" title="23.8使用ApplicationRunner或CommandLineRunner"></a>23.8使用ApplicationRunner或CommandLineRunner</h2><p>如果您需要在<code>SpringApplication</code>启动后运行某些特定代码，则可以实现<code>ApplicationRunner</code>或<code>CommandLineRunner</code>接口。两个接口以相同的方式工作，并提供单个<code>run</code>方法，该方法在<code>SpringApplication.run(…)</code>完成之前调用。</p>
<p><code>CommandLineRunner</code>接口提供对应用程序参数的访问，作为简单的字符串数组，而<code>ApplicationRunner</code>使用前面讨论的<code>ApplicationArguments</code>接口。以下示例显示<code>CommandLineRunner</code>和<code>run</code>方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.boot.*;</span><br><span class="line">import org.springframework.stereotype.*;</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">public class MyBean implements CommandLineRunner &#123;</span><br><span class="line"></span><br><span class="line">	public void run(String... args) &#123;</span><br><span class="line">		&#x2F;&#x2F; Do something...</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果定义了必须按特定顺序调用的多个<code>CommandLineRunner</code>或<code>ApplicationRunner</code> beans，则可以另外实现<code>org.springframework.core.Ordered</code>接口或使用<code>org.springframework.core.annotation.Order</code>注释。</p>
<h2 id="23-9申请退出"><a href="#23-9申请退出" class="headerlink" title="23.9申请退出"></a>23.9申请退出</h2><p>每个<code>SpringApplication</code>都会向JVM注册一个关闭钩子，以确保<code>ApplicationContext</code>在退出时正常关闭。可以使用所有标准Spring生命周期回调（例如<code>DisposableBean</code>接口或<code>@PreDestroy</code>注释）。</p>
<p>此外，beans如果希望在调用<code>SpringApplication.exit()</code>时返回特定的退出代码，则可以实现<code>org.springframework.boot.ExitCodeGenerator</code>接口。然后可以将此退出代码传递给<code>System.exit()</code>以将其作为状态代码返回，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootApplication</span><br><span class="line">public class ExitCodeApplication &#123;</span><br><span class="line"></span><br><span class="line">	@Bean</span><br><span class="line">	public ExitCodeGenerator exitCodeGenerator() &#123;</span><br><span class="line">		return () -&gt; 42;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		System.exit(SpringApplication</span><br><span class="line">				.exit(SpringApplication.run(ExitCodeApplication.class, args)));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此外，<code>ExitCodeGenerator</code>接口可以通过例外来实现。遇到这样的异常时，Spring Boot返回实现的<code>getExitCode()</code>方法提供的退出代码。</p>
<h2 id="23-10管理员功能"><a href="#23-10管理员功能" class="headerlink" title="23.10管理员功能"></a>23.10管理员功能</h2><p>通过指定<code>spring.application.admin.enabled</code>属性，可以为应用程序启用与管理相关的功能。这暴露了 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/admin/SpringApplicationAdminMXBean.java"><code>SpringApplicationAdminMXBean</code></a> 平台<code>MBeanServer</code>。您可以使用此功能远程管理您的Spring Boot应用程序。此功能对于任何服务包装器实现也很有用。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果您想知道应用程序正在运行的HTTP端口，请使用<code>local.server.port</code>的密钥获取该属性。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/caution.png" alt="[警告]"></th>
<th>警告</th>
</tr>
</thead>
<tbody><tr>
<td>启用此功能时要小心，因为MBean公开了一种关闭应用程序的方法。</td>
<td></td>
</tr>
</tbody></table>
<h2 id="24-外部配置"><a href="#24-外部配置" class="headerlink" title="24.外部配置"></a>24.外部配置</h2><p>Spring Boot允许您外部化您的配置，以便您可以在不同的环境中使用相同的应用程序代码。您可以使用属性文件，YAML文件，环境变量和命令行参数来外部化配置。Property值可以通过使用<code>@Value</code>注释直接注入beans，通过Spring的<code>Environment</code>抽象访问，或 通过<code>@ConfigurationProperties</code> <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-external-config-typesafe-configuration-properties">绑定到结构化对象</a>。</p>
<p>Spring Boot使用非常特殊的<code>PropertySource</code>顺序，旨在允许合理地覆盖值。按以下顺序考虑属性：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-devtools-globalsettings">Devtools</a> 主目录上的<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-devtools-globalsettings">全局设置属性</a>（当devtools处于活动状态时<code>~/.spring-boot-devtools.properties</code>）。</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/javadoc-api/org/springframework/test/context/TestPropertySource.html"><code>@TestPropertySource</code></a> 测试上的注释。</li>
<li><code>properties</code>属于您的测试。可 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-testing-spring-boot-applications-testing-autoconfigured-tests">用于测试特定应用程序片段</a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/test/context/SpringBootTest.html"><code>@SpringBootTest</code></a>的 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-testing-spring-boot-applications-testing-autoconfigured-tests">测试注释</a>。</li>
<li>命令行参数。</li>
<li>来自<code>SPRING_APPLICATION_JSON</code>的属性（嵌入在环境变量或系统属性中的内联JSON）。</li>
<li><code>ServletConfig</code> init参数。</li>
<li><code>ServletContext</code> init参数。</li>
<li>JNDI来自<code>java:comp/env</code>。</li>
<li>Java系统属性（<code>System.getProperties()</code>）。</li>
<li>OS环境变量。</li>
<li><code>RandomValuePropertySource</code>仅在<code>random.*</code>中具有属性。</li>
<li><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-external-config-profile-specific-properties">特定于配置文件的应用程序属性</a>在打包的jar之外（<code>application-&#123;profile&#125;.properties</code>和YAML变体）。</li>
<li>打包在jar中<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-external-config-profile-specific-properties">的特定于配置文件的应用程序属性</a>（<code>application-&#123;profile&#125;.properties</code>和YAML变体）。</li>
<li>打包jar之外的应用程序属性（<code>application.properties</code>和YAML变体）。</li>
<li>打包在jar中的应用程序属性（<code>application.properties</code>和YAML变体）。</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/javadoc-api/org/springframework/context/annotation/PropertySource.html"><code>@PropertySource</code></a> <code>@Configuration</code>课程上的注释。</li>
<li>默认属性（通过设置<code>SpringApplication.setDefaultProperties</code>指定）。</li>
</ol>
<p>为了提供一个具体示例，假设您开发了一个使用<code>name</code>属性的<code>@Component</code>，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.stereotype.*;</span><br><span class="line">import org.springframework.beans.factory.annotation.*;</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">public class MyBean &#123;</span><br><span class="line"></span><br><span class="line">    @Value(&quot;$&#123;name&#125;&quot;)</span><br><span class="line">    private String name;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在应用程序类路径上（例如，在jar中），您可以拥有一个<code>application.properties</code>文件，为<code>name</code>提供合理的默认属性值。在新环境中运行时，可以在jar之外提供覆盖<code>name</code>的<code>application.properties</code>文件。对于一次性测试，您可以使用特定的命令行开关启动（例如，<code>java -jar app.jar --name=&quot;Spring&quot;</code>）。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>可以在命令行上使用环境变量提供<code>SPRING_APPLICATION_JSON</code>属性。例如，您可以在UN * X shell中使用以下行：<code>$ SPRING_APPLICATION_JSON=&#39;&#123;&quot;acme&quot;:&#123;&quot;name&quot;:&quot;test&quot;&#125;&#125;&#39; java -jar myapp.jar</code>在前面的示例中，您最终在Spring <code>Environment</code>中使用<code>acme.name=test</code>。您还可以在System属性中将JSON提供为<code>spring.application.json</code>，如以下示例所示：<code>$ java -Dspring.application.json=&#39;&#123;&quot;name&quot;:&quot;test&quot;&#125;&#39; -jar myapp.jar</code>您还可以使用命令行参数提供JSON，如以下示例所示：<code>$ java -jar myapp.jar --spring.application.json=&#39;&#123;&quot;name&quot;:&quot;test&quot;&#125;&#39;</code>您还可以将JSON作为JNDI变量提供，如下所示：<code>java:comp/env/spring.application.json</code>。</td>
</tr>
</tbody></table>
<h2 id="24-1配置随机值"><a href="#24-1配置随机值" class="headerlink" title="24.1配置随机值"></a>24.1配置随机值</h2><p><code>RandomValuePropertySource</code>对于注入随机值（例如，进入秘密或测试用例）非常有用。它可以生成整数，长整数，uuids或字符串，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">my.secret&#x3D;$&#123;random.value&#125;</span><br><span class="line">my.number&#x3D;$&#123;random.int&#125;</span><br><span class="line">my.bignumber&#x3D;$&#123;random.long&#125;</span><br><span class="line">my.uuid&#x3D;$&#123;random.uuid&#125;</span><br><span class="line">my.number.less.than.ten&#x3D;$&#123;random.int(10)&#125;</span><br><span class="line">my.number.in.range&#x3D;$&#123;random.int[1024,65536]&#125;</span><br></pre></td></tr></table></figure>

<p><code>random.int*</code>语法为<code>OPEN value (,max) CLOSE</code>，其中<code>OPEN,CLOSE</code>为任意字符，<code>value,max</code>为整数。如果提供<code>max</code>，那么<code>value</code>是最小值，<code>max</code>是最大值（不包括）。</p>
<h2 id="24-2访问命令行属性"><a href="#24-2访问命令行属性" class="headerlink" title="24.2访问命令行属性"></a>24.2访问命令行属性</h2><p>默认情况下，<code>SpringApplication</code>将任何命令行选项参数（即以<code>--</code>开头的参数，例如<code>--server.port=9000</code>）转换为<code>property</code>，并将它们添加到Spring <code>Environment</code>。如前所述，命令行属性始终优先于其他属性源。</p>
<p>如果您不希望将命令行属性添加到<code>Environment</code>，则可以使用<code>SpringApplication.setAddCommandLineProperties(false)</code>禁用它们。</p>
<h2 id="24-3应用程序Property文件"><a href="#24-3应用程序Property文件" class="headerlink" title="24.3应用程序Property文件"></a>24.3应用程序Property文件</h2><p><code>SpringApplication</code>从以下位置的<code>application.properties</code>文件加载属性，并将它们添加到Spring <code>Environment</code>：</p>
<ol>
<li>当前目录的<code>/config</code>子目录</li>
<li>当前目录</li>
<li>classpath <code>/config</code>包</li>
<li>类路径根</li>
</ol>
<p>列表按优先级排序（在列表中较高位置定义的属性将覆盖在较低位置中定义的属性）。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>您还可以<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-external-config-yaml">使用YAML（’。mil’）文件</a>替代’.properties’。</td>
</tr>
</tbody></table>
<p>如果您不喜欢<code>application.properties</code>作为配置文件名，则可以通过指定<code>spring.config.name</code>环境属性来切换到另一个文件名。您还可以使用<code>spring.config.location</code>环境属性（以逗号分隔的目录位置或文件路径列表）来引用显式位置。以下示例显示如何指定其他文件名：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar myproject.jar --spring.config.name&#x3D;myproject</span><br></pre></td></tr></table></figure>

<p>以下示例显示如何指定两个位置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar myproject.jar --spring.config.location&#x3D;classpath:&#x2F;default.properties,classpath:&#x2F;override.properties</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/warning.png" alt="[警告]"></th>
</tr>
</thead>
<tbody><tr>
<td>很早就使用<code>spring.config.name</code>和<code>spring.config.location</code>来确定必须加载哪些文件，因此必须将它们定义为环境属性（通常是OS环境变量，系统属性或命令行参数）。</td>
</tr>
</tbody></table>
<p>如果<code>spring.config.location</code>包含目录（而不是文件），则它们应以<code>/</code>结束（并且在运行时，在加载之前附加从<code>spring.config.name</code>生成的名称，包括特定于配置文件的文件名） 。<code>spring.config.location</code>中指定的文件按原样使用，不支持特定于配置文件的变体，并且被任何特定于配置文件的属性覆盖。</p>
<p>以相反的顺序搜索配置位置。默认情况下，配置的位置为<code>classpath:/,classpath:/config/,file:./,file:./config/</code>。生成的搜索顺序如下：</p>
<ol>
<li><code>file:./config/</code></li>
<li><code>file:./</code></li>
<li><code>classpath:/config/</code></li>
<li><code>classpath:/</code></li>
</ol>
<p>使用<code>spring.config.location</code>配置自定义配置位置时，它们会替换默认位置。例如，如果<code>spring.config.location</code>配置了值<code>classpath:/custom-config/,file:./custom-config/</code>，则搜索顺序将变为：</p>
<ol>
<li><code>file:./custom-config/</code></li>
<li><code>classpath:custom-config/</code></li>
</ol>
<p>或者，当使用<code>spring.config.additional-location</code>配置自定义配置位置时，除了默认位置外，还会使用它们。在默认位置之前搜索其他位置。例如，如果配置了<code>classpath:/custom-config/,file:./custom-config/</code>的其他位置，则搜索顺序将变为以下内容：</p>
<ol>
<li><code>file:./custom-config/</code></li>
<li><code>classpath:custom-config/</code></li>
<li><code>file:./config/</code></li>
<li><code>file:./</code></li>
<li><code>classpath:/config/</code></li>
<li><code>classpath:/</code></li>
</ol>
<p>此搜索顺序允许您在一个配置文件中指定默认值，然后有选择地覆盖另一个配置文件中的值。您可以在<code>application.properties</code>（或您使用<code>spring.config.name</code>选择的任何其他基本名称）中的某个默认位置为您的应用程序提供默认值。然后，可以在运行时使用位于其中一个自定义位置的不同文件覆盖这些默认值。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果使用环境变量而不是系统属性，则大多数操作系统都不允许使用句点分隔的键名称，但您可以使用下划线（例如，<code>SPRING_CONFIG_NAME</code>而不是<code>spring.config.name</code>）。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果应用程序在容器中运行，则可以使用JNDI属性（在<code>java:comp/env</code>中）或servlet上下文初始化参数来代替环境变量或系统属性。</td>
</tr>
</tbody></table>
<h2 id="24-4特定于配置文件的属性"><a href="#24-4特定于配置文件的属性" class="headerlink" title="24.4特定于配置文件的属性"></a>24.4特定于配置文件的属性</h2><p>除了<code>application.properties</code>文件之外，还可以使用以下命名约定来定义特定于配置文件的属性：<code>application-&#123;profile&#125;.properties</code>。<code>Environment</code>有一组默认配置文件（默认情况下为<code>[default]</code>），如果未设置活动配置文件，则使用这些配置文件。换句话说，如果没有显式激活配置文件，则会加载<code>application-default.properties</code>中的属性。</p>
<p>特定于配置文件的属性从标准<code>application.properties</code>的相同位置加载，特定于配置文件的文件始终覆盖非特定文件，无论特定于配置文件的文件是在打包的jar内部还是外部。</p>
<p>如果指定了多个配置文件，则应用last-wins策略。例如，<code>spring.profiles.active</code>属性指定的配置文件将在通过<code>SpringApplication</code> API配置的配置文件之后添加，因此优先。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果您在<code>spring.config.location</code>中指定了任何文件，则不会考虑这些文件的特定于配置文件的变体。如果您还想使用特定于配置文件的属性，请使用<code>spring.config.location</code>中的目录。</td>
</tr>
</tbody></table>
<h2 id="24-5属性中的占位符"><a href="#24-5属性中的占位符" class="headerlink" title="24.5属性中的占位符"></a>24.5属性中的占位符</h2><p><code>application.properties</code>中的值在使用时通过现有的<code>Environment</code>进行过滤，因此您可以返回先前定义的值（例如，从系统属性中）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">app.name&#x3D;MyApp</span><br><span class="line">app.description&#x3D;$&#123;app.name&#125; is a Spring Boot application</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>您还可以使用此技术创建现有Spring Boot属性的“短”变体。有关详细信息，请参见*<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#howto-use-short-command-line-arguments">第77.4节“使用’短’命令行参数”</a>*方法。</td>
</tr>
</tbody></table>
<h2 id="24-6加密属性"><a href="#24-6加密属性" class="headerlink" title="24.6加密属性"></a>24.6加密属性</h2><p>Spring Boot没有为加密属性值提供任何内置支持，但是，它确实提供了修改Spring <code>Environment</code>中包含的值所必需的钩子点。<code>EnvironmentPostProcessor</code>界面允许您在应用程序启动之前操作<code>Environment</code>。有关详细信息<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#howto-customize-the-environment-or-application-context">，</a>请参见<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#howto-customize-the-environment-or-application-context">第76.3节“在开始之前自定义环境或ApplicationContext”</a> 。</p>
<p>如果您正在寻找一种存储凭据和密码的安全方法，那么 <a target="_blank" rel="noopener" href="https://cloud.spring.io/spring-cloud-vault/">Spring Cloud Vault</a>项目将支持在<a target="_blank" rel="noopener" href="https://www.vaultproject.io/">HashiCorp Vault中</a>存储外部化配置 。</p>
<h2 id="24-7使用YAML而不是属性"><a href="#24-7使用YAML而不是属性" class="headerlink" title="24.7使用YAML而不是属性"></a>24.7使用YAML而不是属性</h2><p><a target="_blank" rel="noopener" href="http://yaml.org/">YAML</a>是JSON的超集，因此是用于指定分层配置数据的便捷格式。只要在类路径上有<a target="_blank" rel="noopener" href="http://www.snakeyaml.org/">SnakeYAML</a>库，<code>SpringApplication</code>类就会自动支持YAML作为属性的替代 。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果您使用“Starters”，则<code>spring-boot-starter</code>会自动提供SnakeYAML。</td>
</tr>
</tbody></table>
<h3 id="24-7-1加载YAML"><a href="#24-7-1加载YAML" class="headerlink" title="24.7.1加载YAML"></a>24.7.1加载YAML</h3><p>Spring Framework提供了两个方便的类，可用于加载YAML文档。<code>YamlPropertiesFactoryBean</code>将YAML加载为<code>Properties</code>，<code>YamlMapFactoryBean</code>将YAML加载为<code>Map</code>。</p>
<p>例如，请考虑以下YAML文档：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">environments:</span><br><span class="line">	dev:</span><br><span class="line">		url: http:&#x2F;&#x2F;dev.example.com</span><br><span class="line">		name: Developer Setup</span><br><span class="line">	prod:</span><br><span class="line">		url: http:&#x2F;&#x2F;another.example.com</span><br><span class="line">		name: My Cool App</span><br></pre></td></tr></table></figure>

<p>前面的示例将转换为以下属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">environments.dev.url&#x3D;http:&#x2F;&#x2F;dev.example.com</span><br><span class="line">environments.dev.name&#x3D;Developer Setup</span><br><span class="line">environments.prod.url&#x3D;http:&#x2F;&#x2F;another.example.com</span><br><span class="line">environments.prod.name&#x3D;My Cool App</span><br></pre></td></tr></table></figure>

<p>YAML列表表示为具有<code>[index]</code>解除引用的属性键。例如，考虑以下YAML：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">my:</span><br><span class="line">servers:</span><br><span class="line">	- dev.example.com</span><br><span class="line">	- another.example.com</span><br></pre></td></tr></table></figure>

<p>前面的示例将转换为这些属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">my.servers[0]&#x3D;dev.example.com</span><br><span class="line">my.servers[1]&#x3D;another.example.com</span><br></pre></td></tr></table></figure>

<p>要使用Spring Boot的<code>Binder</code>实用程序（这是<code>@ConfigurationProperties</code>所做的）绑定到这样的属性，你需要在<code>java.util.List</code>类型的目标bean中拥有一个属性（或<code>Set</code>）您需要提供一个setter或用可变值初始化它。例如，以下示例绑定到前面显示的属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@ConfigurationProperties(prefix&#x3D;&quot;my&quot;)</span><br><span class="line">public class Config &#123;</span><br><span class="line"></span><br><span class="line">	private List&lt;String&gt; servers &#x3D; new ArrayList&lt;String&gt;();</span><br><span class="line"></span><br><span class="line">	public List&lt;String&gt; getServers() &#123;</span><br><span class="line">		return this.servers;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="24-7-2在Spring环境中将YAML公开为属性"><a href="#24-7-2在Spring环境中将YAML公开为属性" class="headerlink" title="24.7.2在Spring环境中将YAML公开为属性"></a>24.7.2在Spring环境中将YAML公开为属性</h3><p><code>YamlPropertySourceLoader</code>类可用于在Spring <code>Environment</code>中将YAML公开为<code>PropertySource</code>。这样做可以使用带有占位符语法的<code>@Value</code>注释来访问YAML属性。</p>
<h3 id="24-7-3多轮廓YAML文档"><a href="#24-7-3多轮廓YAML文档" class="headerlink" title="24.7.3多轮廓YAML文档"></a>24.7.3多轮廓YAML文档</h3><p>您可以使用<code>spring.profiles</code>键在单个文件中指定多个特定于配置文件的YAML文档，以指示文档何时应用，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">	address: 192.168.1.100</span><br><span class="line">---</span><br><span class="line">spring:</span><br><span class="line">	profiles: development</span><br><span class="line">server:</span><br><span class="line">	address: 127.0.0.1</span><br><span class="line">---</span><br><span class="line">spring:</span><br><span class="line">	profiles: production &amp; eu-central</span><br><span class="line">server:</span><br><span class="line">	address: 192.168.1.120</span><br></pre></td></tr></table></figure>

<p>在前面的示例中，如果<code>development</code>配置文件处于活动状态，则<code>server.address</code>属性为<code>127.0.0.1</code>。同样，如果<code>production</code> <strong>和</strong> <code>eu-central</code>配置文件处于活动状态，则<code>server.address</code>属性为<code>192.168.1.120</code>。如果<strong>未</strong>启用<code>development</code>，<code>production</code>和<code>eu-central</code>配置文件，则该属性的值为<code>192.168.1.100</code>。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>因此，<code>spring.profiles</code>可以包含简单的配置文件名称（例如<code>production</code>）或配置文件表达式。概要表达式允许表达更复杂的概要逻辑，例如`production &amp; (eu-central</td>
</tr>
</tbody></table>
<p>如果在应用程序上下文启动时没有显式激活，则激活默认配置文件。因此，在以下YAML中，我们设置<code>spring.security.user.password</code>的值，该值<strong>仅</strong>在“默认”配置文件中可用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 8000</span><br><span class="line">---</span><br><span class="line">spring:</span><br><span class="line">  profiles: default</span><br><span class="line">  security:</span><br><span class="line">    user:</span><br><span class="line">      password: weak</span><br></pre></td></tr></table></figure>

<p>然而，在以下示例中，始终设置密码，因为它未附加到任何配置文件，并且必须在必要时在所有其他配置文件中显式重置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 8000</span><br><span class="line">spring:</span><br><span class="line">  security:</span><br><span class="line">    user:</span><br><span class="line">      password: weak</span><br></pre></td></tr></table></figure>

<p>使用<code>spring.profiles</code>元素指定的Spring配置文件可以选择使用<code>!</code>字符来否定。如果为单个文档指定了否定和非否定的配置文件，则至少一个非否定的配置文件必须匹配，并且没有否定的配置文件可以匹配。</p>
<h3 id="24-7-4-YAML缺点"><a href="#24-7-4-YAML缺点" class="headerlink" title="24.7.4 YAML缺点"></a>24.7.4 YAML缺点</h3><p>无法使用<code>@PropertySource</code>注释加载YAML文件。因此，如果您需要以这种方式加载值，则需要使用属性文件。</p>
<h2 id="24-8类型安全配置属性"><a href="#24-8类型安全配置属性" class="headerlink" title="24.8类型安全配置属性"></a>24.8类型安全配置属性</h2><p>使用<code>@Value(&quot;$&#123;property&#125;&quot;)</code>注释来注入配置属性有时会很麻烦，特别是如果您正在使用多个属性或者您的数据本质上是分层的。Spring Boot提供了一种使用属性的替代方法，该方法允许强类型beans管理和验证应用程序的配置，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">package com.example;</span><br><span class="line"></span><br><span class="line">import java.net.InetAddress;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.Collections;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">import org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"></span><br><span class="line">@ConfigurationProperties(&quot;acme&quot;)</span><br><span class="line">public class AcmeProperties &#123;</span><br><span class="line"></span><br><span class="line">	private boolean enabled;</span><br><span class="line"></span><br><span class="line">	private InetAddress remoteAddress;</span><br><span class="line"></span><br><span class="line">	private final Security security &#x3D; new Security();</span><br><span class="line"></span><br><span class="line">	public boolean isEnabled() &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">	public void setEnabled(boolean enabled) &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">	public InetAddress getRemoteAddress() &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">	public void setRemoteAddress(InetAddress remoteAddress) &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">	public Security getSecurity() &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">	public static class Security &#123;</span><br><span class="line"></span><br><span class="line">		private String username;</span><br><span class="line"></span><br><span class="line">		private String password;</span><br><span class="line"></span><br><span class="line">		private List&lt;String&gt; roles &#x3D; new ArrayList&lt;&gt;(Collections.singleton(&quot;USER&quot;));</span><br><span class="line"></span><br><span class="line">		public String getUsername() &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">		public void setUsername(String username) &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">		public String getPassword() &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">		public void setPassword(String password) &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">		public List&lt;String&gt; getRoles() &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">		public void setRoles(List&lt;String&gt; roles) &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>前面的POJO定义了以下属性：</p>
<ul>
<li><code>acme.enabled</code>，默认值为<code>false</code>。</li>
<li><code>acme.remote-address</code>，其类型可以从<code>String</code>强制执行。</li>
<li><code>acme.security.username</code>，带有嵌套的“安全”对象，其名称由属性名称决定。特别是，那里根本没有使用返回类型，可能是<code>SecurityProperties</code>。</li>
<li><code>acme.security.password</code>.</li>
<li><code>acme.security.roles</code>，收集<code>String</code>。</li>
</ul>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>getter和setter通常是必需的，因为绑定是通过标准的Java Beans属性描述符，就像在Spring MVC中一样。在下列情况下可以省略setter：映射，只要它们被初始化，就需要一个getter但不一定是setter，因为它们可以被绑定器变异。可以通过索引（通常使用YAML）或使用单个逗号分隔值（属性）访问集合和数组。在后一种情况下，必须使用setter。我们建议始终为此类型添加setter。如果初始化集合，请确保它不是不可变的（如上例所示）。如果初始化嵌套的POJO属性（如前面示例中的<code>Security</code>字段），则不需要setter。如果您希望绑定器通过使用其默认构造函数动态创建实例，则需要一个setter。有些人使用Project Lombok自动添加getter和setter。确保Lombok不为此类型生成任何特定构造函数，因为容器会自动使用它来实例化对象。最后，仅考虑标准Java Bean属性，并且不支持对静态属性的绑定。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>另请参阅<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-external-config-vs-value"><code>@Value</code>和<code>@ConfigurationProperties</code>之间</a>的<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-external-config-vs-value">差异</a>。</td>
</tr>
</tbody></table>
<p>您还需要列出要在<code>@EnableConfigurationProperties</code>注释中注册的属性类，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@EnableConfigurationProperties(AcmeProperties.class)</span><br><span class="line">public class MyConfiguration &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>当<code>@ConfigurationProperties</code> bean以这种方式注册时，bean具有常规名称：<code>&lt;prefix&gt;-&lt;fqn&gt;</code>，其中<code>&lt;prefix&gt;</code>是<code>@ConfigurationProperties</code>注释中指定的环境键前缀<code>&lt;fqn&gt;</code>是bean的完全限定名称。如果注释未提供任何前缀，则仅使用bean的完全限定名称。上例中的bean名称为<code>acme-com.example.AcmeProperties</code>。</td>
</tr>
</tbody></table>
<p>即使前面的配置为<code>AcmeProperties</code>创建了常规bean，我们也建议<code>@ConfigurationProperties</code>仅处理环境，特别是不从上下文中注入其他beans。话虽如此，<code>@EnableConfigurationProperties</code>注释<em>也会</em>自动应用于您的项目，以便从<code>Environment</code>配置任何<em>现有</em> bean注释<code>@ConfigurationProperties</code>。您可以通过确保<code>AcmeProperties</code>已经是bean来快捷<code>MyConfiguration</code>，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">@ConfigurationProperties(prefix&#x3D;&quot;acme&quot;)</span><br><span class="line">public class AcmeProperties &#123;</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F; ... see the preceding example</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这种配置风格与<code>SpringApplication</code>外部YAML配置特别有效，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># application.yml</span><br><span class="line"></span><br><span class="line">acme:</span><br><span class="line">	remote-address: 192.168.1.1</span><br><span class="line">	security:</span><br><span class="line">		username: admin</span><br><span class="line">		roles:</span><br><span class="line">		  - USER</span><br><span class="line">		  - ADMIN</span><br><span class="line"></span><br><span class="line"># additional configuration as required</span><br></pre></td></tr></table></figure>

<p>要使用<code>@ConfigurationProperties</code> beans，您可以使用与任何其他bean相同的方式注入它们，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@Service</span><br><span class="line">public class MyService &#123;</span><br><span class="line"></span><br><span class="line">	private final AcmeProperties properties;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	public MyService(AcmeProperties properties) &#123;</span><br><span class="line">	    this.properties &#x3D; properties;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"> 	&#x2F;&#x2F;...</span><br><span class="line"></span><br><span class="line">	@PostConstruct</span><br><span class="line">	public void openConnection() &#123;</span><br><span class="line">		Server server &#x3D; new Server(this.properties.getRemoteAddress());</span><br><span class="line">		&#x2F;&#x2F; ...</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>使用<code>@ConfigurationProperties</code>还可以生成元数据文件，IDE可以使用这些文件为您自己的密钥提供自动完成功能。有关详细信息<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#configuration-metadata">，</a>请参阅 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#configuration-metadata">附录B，</a><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#configuration-metadata"><em>配置元数据</em></a>附录。</td>
</tr>
</tbody></table>
<h3 id="24-8-1第三方配置"><a href="#24-8-1第三方配置" class="headerlink" title="24.8.1第三方配置"></a>24.8.1第三方配置</h3><p>除了使用<code>@ConfigurationProperties</code>注释类之外，您还可以在公共<code>@Bean</code>方法上使用它。当您想要将属性绑定到控件之外的第三方组件时，这样做会特别有用。</p>
<p>要从<code>Environment</code>属性配置bean，请在其bean注册中添加<code>@ConfigurationProperties</code>，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@ConfigurationProperties(prefix &#x3D; &quot;another&quot;)</span><br><span class="line">@Bean</span><br><span class="line">public AnotherComponent anotherComponent() &#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用<code>another</code>前缀定义的任何属性都以与前面的<code>AcmeProperties</code>示例类似的方式映射到<code>AnotherComponent</code> bean。</p>
<h3 id="24-8-2松弛结合"><a href="#24-8-2松弛结合" class="headerlink" title="24.8.2松弛结合"></a>24.8.2松弛结合</h3><p>Spring Boot使用一些宽松的规则将<code>Environment</code>属性绑定到<code>@ConfigurationProperties</code> beans，因此不需要在<code>Environment</code>属性名称和bean属性之间进行精确匹配名称。这有用的常见示例包括破折号分隔的环境属性（例如，<code>context-path</code>绑定到<code>contextPath</code>）和大写环境属性（例如，<code>PORT</code>绑定到<code>port</code>）。</p>
<p>例如，考虑以下<code>@ConfigurationProperties</code>类：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@ConfigurationProperties(prefix&#x3D;&quot;acme.my-project.person&quot;)</span><br><span class="line">public class OwnerProperties &#123;</span><br><span class="line"></span><br><span class="line">	private String firstName;</span><br><span class="line"></span><br><span class="line">	public String getFirstName() &#123;</span><br><span class="line">		return this.firstName;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public void setFirstName(String firstName) &#123;</span><br><span class="line">		this.firstName &#x3D; firstName;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在前面的示例中，可以使用以下属性名称：</p>
<p><strong>表24.1。轻松绑定</strong></p>
<table>
<thead>
<tr>
<th>Property</th>
<th>注意</th>
</tr>
</thead>
<tbody><tr>
<td><code>acme.my-project.person.first-name</code></td>
<td>Kebab案例，建议在<code>.properties</code>和<code>.yml</code>文件中使用。</td>
</tr>
<tr>
<td><code>acme.myProject.person.firstName</code></td>
<td>标准的驼峰案例语法。</td>
</tr>
<tr>
<td><code>acme.my_project.person.first_name</code></td>
<td>下划线表示法，这是在<code>.properties</code>和<code>.yml</code>文件中使用的替代格式。</td>
</tr>
<tr>
<td><code>ACME_MYPROJECT_PERSON_FIRSTNAME</code></td>
<td>大写格式，使用系统环境变量时建议使用。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>注释的<code>prefix</code>值<em>必须</em>为kebab大小写（小写并以<code>-</code>分隔，例如<code>acme.my-project.person</code>）。</td>
</tr>
</tbody></table>
<p><strong>表24.2。每个属性源放宽绑定规则</strong></p>
<table>
<thead>
<tr>
<th>Property来源</th>
<th>简单</th>
<th>名单</th>
</tr>
</thead>
<tbody><tr>
<td>属性文件</td>
<td>骆驼案，烤肉串案例或下划线表示法</td>
<td>使用<code>[ ]</code>或逗号分隔值的标准列表语法</td>
</tr>
<tr>
<td>YAML文件</td>
<td>骆驼案，烤肉串案例或下划线表示法</td>
<td>标准YAML列表语法或逗号分隔值</td>
</tr>
<tr>
<td>环境变量</td>
<td>大写格式，下划线作为分隔符。<code>_</code>不应在属性名称中使用</td>
<td>由下划线包围的数字值，例如<code>MY_ACME_1_OTHER = my.acme[1].other</code></td>
</tr>
<tr>
<td>系统属性</td>
<td>骆驼案，烤肉串案例或下划线表示法</td>
<td>使用<code>[ ]</code>或逗号分隔值的标准列表语法</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>我们建议，在可能的情况下，属性以小写烤肉串格式存储，例如<code>my.property-name=acme</code>。</td>
</tr>
</tbody></table>
<p>绑定到<code>Map</code>属性时，如果<code>key</code>包含除小写字母数字字符或<code>-</code>以外的任何内容，则需要使用括号表示法以保留原始值。如果密钥未被<code>[]</code>包围，则删除任何非字母数字或<code>-</code>的字符。例如，考虑将以下属性绑定到<code>Map</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">acme:</span><br><span class="line">  map:</span><br><span class="line">    &quot;[&#x2F;key1]&quot;: value1</span><br><span class="line">    &quot;[&#x2F;key2]&quot;: value2</span><br><span class="line">    &#x2F;key3: value3</span><br></pre></td></tr></table></figure>

<p>上面的属性将绑定到<code>Map</code>，其中<code>/key1</code>，<code>/key2</code>和<code>key3</code>作为地图中的键。</p>
<h3 id="24-8-3合并复杂类型"><a href="#24-8-3合并复杂类型" class="headerlink" title="24.8.3合并复杂类型"></a>24.8.3合并复杂类型</h3><p>当列表在多个位置配置时，覆盖通过替换整个列表来工作。</p>
<p>例如，假设一个<code>MyPojo</code>对象，其<code>name</code>和<code>description</code>属性默认为<code>null</code>。以下示例公开了来自<code>AcmeProperties</code>的<code>MyPojo</code>对象的列表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@ConfigurationProperties(&quot;acme&quot;)</span><br><span class="line">public class AcmeProperties &#123;</span><br><span class="line"></span><br><span class="line">	private final List&lt;MyPojo&gt; list &#x3D; new ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">	public List&lt;MyPojo&gt; getList() &#123;</span><br><span class="line">		return this.list;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>请考虑以下配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">acme:</span><br><span class="line">  list:</span><br><span class="line">    - name: my name</span><br><span class="line">      description: my description</span><br><span class="line">---</span><br><span class="line">spring:</span><br><span class="line">  profiles: dev</span><br><span class="line">acme:</span><br><span class="line">  list:</span><br><span class="line">    - name: my another name</span><br></pre></td></tr></table></figure>

<p>如果<code>dev</code>配置文件未激活，<code>AcmeProperties.list</code>包含一个<code>MyPojo</code>条目，如前所述。但是，如果启用了<code>dev</code>配置文件，则<code>list</code> <em>仍然</em> 只包含一个条目（名称为<code>my another name</code>且描述为<code>null</code>）。此配置<em>不会</em>向列表添加第二个<code>MyPojo</code>实例，也不会合并项目。</p>
<p>在多个配置文件中指定<code>List</code>时，将使用具有最高优先级（并且仅具有该优先级）的配置文件。请考虑以下示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">acme:</span><br><span class="line">  list:</span><br><span class="line">    - name: my name</span><br><span class="line">      description: my description</span><br><span class="line">    - name: another name</span><br><span class="line">      description: another description</span><br><span class="line">---</span><br><span class="line">spring:</span><br><span class="line">  profiles: dev</span><br><span class="line">acme:</span><br><span class="line">  list:</span><br><span class="line">    - name: my another name</span><br></pre></td></tr></table></figure>

<p>在前面的示例中，如果<code>dev</code>配置文件处于活动状态，则<code>AcmeProperties.list</code>包含 <em>一个</em> <code>MyPojo</code>条目（名称为<code>my another name</code>，描述为<code>null</code>）。对于YAML，逗号分隔列表和YAML列表都可用于完全覆盖列表的内容。</p>
<p>对于<code>Map</code>属性，您可以绑定从多个源中提取的属性值。但是，对于多个源中的相同属性，使用具有最高优先级的属性。以下示例从<code>AcmeProperties</code>公开<code>Map&lt;String, MyPojo&gt;</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@ConfigurationProperties(&quot;acme&quot;)</span><br><span class="line">public class AcmeProperties &#123;</span><br><span class="line"></span><br><span class="line">	private final Map&lt;String, MyPojo&gt; map &#x3D; new HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">	public Map&lt;String, MyPojo&gt; getMap() &#123;</span><br><span class="line">		return this.map;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>请考虑以下配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">acme:</span><br><span class="line">  map:</span><br><span class="line">    key1:</span><br><span class="line">      name: my name 1</span><br><span class="line">      description: my description 1</span><br><span class="line">---</span><br><span class="line">spring:</span><br><span class="line">  profiles: dev</span><br><span class="line">acme:</span><br><span class="line">  map:</span><br><span class="line">    key1:</span><br><span class="line">      name: dev name 1</span><br><span class="line">    key2:</span><br><span class="line">      name: dev name 2</span><br><span class="line">      description: dev description 2</span><br></pre></td></tr></table></figure>

<p>如果<code>dev</code>个人资料未激活，则<code>AcmeProperties.map</code>包含一个密钥为<code>key1</code>的条目（名称为<code>my name 1</code>，描述为<code>my description 1</code>）。但是，如果<code>dev</code>配置文件已启用，则<code>map</code>包含两个带有密钥<code>key1</code>的条目（名称为<code>dev name 1</code>且描述为<code>my description 1</code>）和<code>key2</code>（带有名称<code>dev name 2</code>和描述<code>dev description 2</code>）。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>前面的合并规则适用于所有属性源的属性，而不仅仅是YAML文件。</td>
</tr>
</tbody></table>
<h3 id="24-8-4属性转换"><a href="#24-8-4属性转换" class="headerlink" title="24.8.4属性转换"></a>24.8.4属性转换</h3><p>Spring Boot在绑定到<code>@ConfigurationProperties</code> beans时尝试将外部应用程序属性强制转换为正确的类型。如果您需要自定义类型转换，则可以提供<code>ConversionService</code> bean（bean名为<code>conversionService</code>）或自定义属性编辑器（通过<code>CustomEditorConfigurer</code> bean）或自定义<code>Converters</code>（bean定义注释为<code>@ConfigurationPropertiesBinding</code>）。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>由于在应用程序生命周期中很早就请求bean，因此请确保限制<code>ConversionService</code>正在使用的依赖项。通常，您在创建时可能无法完全初始化所需的任何依赖项。如果配置密钥强制不需要，您可能需要重命名自定义<code>ConversionService</code>，并且只依赖于使用<code>@ConfigurationPropertiesBinding</code>限定的自定义转换器。</td>
</tr>
</tbody></table>
<h4 id="转换持续时间"><a href="#转换持续时间" class="headerlink" title="转换持续时间"></a>转换持续时间</h4><p>Spring Boot专门支持表达持续时间。如果公开<code>java.time.Duration</code>属性，则可以使用应用程序属性中的以下格式：</p>
<ul>
<li>常规<code>long</code>表示（使用毫秒作为默认单位，除非指定了<code>@DurationUnit</code>）</li>
<li><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/api//java/time/Duration.html#parse-java.lang.CharSequence-"><code>java.util.Duration</code>使用</a>的标准ISO-8601格式</li>
<li>更可读的格式，其中值和单位耦合（例如<code>10s</code>表示10秒）</li>
</ul>
<p>请考虑以下示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">@ConfigurationProperties(&quot;app.system&quot;)</span><br><span class="line">public class AppSystemProperties &#123;</span><br><span class="line"></span><br><span class="line">	@DurationUnit(ChronoUnit.SECONDS)</span><br><span class="line">	private Duration sessionTimeout &#x3D; Duration.ofSeconds(30);</span><br><span class="line"></span><br><span class="line">	private Duration readTimeout &#x3D; Duration.ofMillis(1000);</span><br><span class="line"></span><br><span class="line">	public Duration getSessionTimeout() &#123;</span><br><span class="line">		return this.sessionTimeout;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public void setSessionTimeout(Duration sessionTimeout) &#123;</span><br><span class="line">		this.sessionTimeout &#x3D; sessionTimeout;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public Duration getReadTimeout() &#123;</span><br><span class="line">		return this.readTimeout;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public void setReadTimeout(Duration readTimeout) &#123;</span><br><span class="line">		this.readTimeout &#x3D; readTimeout;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>要指定30秒的会话超时，<code>30</code>，<code>PT30S</code>和<code>30s</code>都是等效的。可以使用以下任何一种形式指定500ms的读取超时：<code>500</code>，<code>PT0.5S</code>和<code>500ms</code>。</p>
<p>您也可以使用任何支持的单位。这些是：</p>
<ul>
<li>纳秒时间为<code>ns</code></li>
<li><code>us</code>微秒</li>
<li><code>ms</code>毫秒</li>
<li><code>s</code>秒</li>
<li><code>m</code>分钟</li>
<li><code>h</code>几个小时</li>
<li><code>d</code>几天</li>
</ul>
<p>默认单位是毫秒，可以使用<code>@DurationUnit</code>覆盖，如上面的示例所示。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果要从仅使用<code>Long</code>来表示持续时间的先前版本升级，请确保定义单位（使用<code>@DurationUnit</code>），如果它不是切换到<code>Duration</code>旁边的毫秒。这样做可以提供透明的升级路径，同时支持更丰富的格式。</td>
</tr>
</tbody></table>
<h4 id="转换数据大小"><a href="#转换数据大小" class="headerlink" title="转换数据大小"></a>转换数据大小</h4><p>Spring Framework有一个<code>DataSize</code>值类型，允许以字节为单位表示大小。如果公开<code>DataSize</code>属性，则可以使用应用程序属性中的以下格式：</p>
<ul>
<li>常规<code>long</code>表示（使用字节作为默认单位，除非指定了<code>@DataSizeUnit</code>）</li>
<li>值和单元耦合的更易读的格式（例如<code>10MB</code>表示10兆字节）</li>
</ul>
<p>请考虑以下示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">@ConfigurationProperties(&quot;app.io&quot;)</span><br><span class="line">public class AppIoProperties &#123;</span><br><span class="line"></span><br><span class="line">	@DataSizeUnit(DataUnit.MEGABYTES)</span><br><span class="line">	private DataSize bufferSize &#x3D; DataSize.ofMegabytes(2);</span><br><span class="line"></span><br><span class="line">	private DataSize sizeThreshold &#x3D; DataSize.ofBytes(512);</span><br><span class="line"></span><br><span class="line">	public DataSize getBufferSize() &#123;</span><br><span class="line">		return this.bufferSize;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public void setBufferSize(DataSize bufferSize) &#123;</span><br><span class="line">		this.bufferSize &#x3D; bufferSize;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public DataSize getSizeThreshold() &#123;</span><br><span class="line">		return this.sizeThreshold;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public void setSizeThreshold(DataSize sizeThreshold) &#123;</span><br><span class="line">		this.sizeThreshold &#x3D; sizeThreshold;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>要指定10兆字节的缓冲区大小，<code>10</code>和<code>10MB</code>是等效的。可以将大小阈值256字节指定为<code>256</code>或<code>256B</code>。</p>
<p>您也可以使用任何支持的单位。这些是：</p>
<ul>
<li><code>B</code>表示字节</li>
<li>千字节<code>KB</code></li>
<li><code>MB</code>表示兆字节</li>
<li><code>GB</code>为千兆字节</li>
<li><code>TB</code>表示太字节</li>
</ul>
<p>默认单位是字节，可以使用<code>@DataSizeUnit</code>覆盖，如上面的示例所示。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果要从仅使用<code>Long</code>来表示大小的先前版本升级，请确保定义单位（使用<code>@DataSizeUnit</code>），如果它不是切换到<code>DataSize</code>旁边的字节。这样做可以提供透明的升级路径，同时支持更丰富的格式。</td>
</tr>
</tbody></table>
<h3 id="24-8-5-ConfigurationProperties验证"><a href="#24-8-5-ConfigurationProperties验证" class="headerlink" title="24.8.5 @ConfigurationProperties验证"></a>24.8.5 @ConfigurationProperties验证</h3><p>Spring Boot尝试使用Spring <code>@Validated</code>注释注释<code>@ConfigurationProperties</code>类。您可以直接在配置类上使用JSR-303 <code>javax.validation</code>约束注释。为此，请确保符合条件的JSR-303实现位于类路径上，然后将约束注释添加到字段中，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@ConfigurationProperties(prefix&#x3D;&quot;acme&quot;)</span><br><span class="line">@Validated</span><br><span class="line">public class AcmeProperties &#123;</span><br><span class="line"></span><br><span class="line">	@NotNull</span><br><span class="line">	private InetAddress remoteAddress;</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F; ... getters and setters</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>您还可以通过使用<code>@Validated</code>注释创建配置属性的<code>@Bean</code>方法来触发验证。</td>
</tr>
</tbody></table>
<p>虽然嵌套属性也会在绑定时进行验证，但最好还是将关联字段注释为<code>@Valid</code>。这可确保即使未找到嵌套属性也会触发验证。以下示例基于前面的<code>AcmeProperties</code>示例构建：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">@ConfigurationProperties(prefix&#x3D;&quot;acme&quot;)</span><br><span class="line">@Validated</span><br><span class="line">public class AcmeProperties &#123;</span><br><span class="line"></span><br><span class="line">	@NotNull</span><br><span class="line">	private InetAddress remoteAddress;</span><br><span class="line"></span><br><span class="line">	@Valid</span><br><span class="line">	private final Security security &#x3D; new Security();</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F; ... getters and setters</span><br><span class="line"></span><br><span class="line">	public static class Security &#123;</span><br><span class="line"></span><br><span class="line">		@NotEmpty</span><br><span class="line">		public String username;</span><br><span class="line"></span><br><span class="line">		&#x2F;&#x2F; ... getters and setters</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>您还可以通过创建名为<code>configurationPropertiesValidator</code>的bean定义来添加自定义Spring <code>Validator</code>。应该声明<code>@Bean</code>方法<code>static</code>。配置属性验证器是在应用程序生命周期的早期创建的，并且将<code>@Bean</code>方法声明为静态可以创建bean而无需实例化<code>@Configuration</code>类。这样做可以避免早期实例化可能导致的任何问题。有一个 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-samples/spring-boot-sample-property-validation">属性验证示例</a>，显示如何设置。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td><code>spring-boot-actuator</code>模块包含一个暴露所有<code>@ConfigurationProperties</code> beans的端点。将Web浏览器指向<code>/actuator/configprops</code>或使用等效的JMX端点。有关详细信息，请参阅“ <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready-endpoints">生产就绪功能</a> ”部分。</td>
</tr>
</tbody></table>
<h3 id="24-8-6-ConfigurationProperties与-Value"><a href="#24-8-6-ConfigurationProperties与-Value" class="headerlink" title="24.8.6 @ConfigurationProperties与@Value"></a>24.8.6 @ConfigurationProperties与@Value</h3><p><code>@Value</code>注释是核心容器功能，它不提供与类型安全配置属性相同的功能。下表总结了<code>@ConfigurationProperties</code>和<code>@Value</code>支持的功能：</p>
<table>
<thead>
<tr>
<th>特征</th>
<th><code>@ConfigurationProperties</code></th>
<th><code>@Value</code></th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-external-config-relaxed-binding">Relaxed binding</a></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#configuration-metadata">Meta-data support</a></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>SpEL</code> evaluation</td>
<td>No</td>
<td>Yes</td>
</tr>
</tbody></table>
<p>如果为自己的组件定义一组配置键，我们建议您将它们分组到带有<code>@ConfigurationProperties</code>注释的POJO中。您还应该知道，由于<code>@Value</code>不支持宽松绑定，因此如果您需要使用环境变量来提供值，则它不是一个好的候选者。</p>
<p>最后，虽然您可以在<code>@Value</code>中编写<code>SpEL</code>表达式，但不会从<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-external-config-application-property-files">应用程序属性文件中</a>处理此类表达式。</p>
<h2 id="25-简介"><a href="#25-简介" class="headerlink" title="25.简介"></a>25.简介</h2><p>Spring Profiles提供了一种隔离应用程序配置部分并使其仅在特定环境中可用的方法。任何<code>@Component</code>或<code>@Configuration</code>都可以用<code>@Profile</code>标记以限制何时加载，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@Profile(&quot;production&quot;)</span><br><span class="line">public class ProductionConfiguration &#123;</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F; ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>您可以使用<code>spring.profiles.active</code> <code>Environment</code>属性指定哪些配置文件处于活动状态。您可以使用本章前面介绍的任何方法指定属性。例如，您可以将其包含在<code>application.properties</code>中，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.profiles.active&#x3D;dev,hsqldb</span><br></pre></td></tr></table></figure>

<p>您还可以使用以下开关在命令行上指定它：<code>--spring.profiles.active=dev,hsqldb</code>。</p>
<h2 id="25-1添加活动配置文件"><a href="#25-1添加活动配置文件" class="headerlink" title="25.1添加活动配置文件"></a>25.1添加活动配置文件</h2><p><code>spring.profiles.active</code>属性遵循与其他属性相同的排序规则：最高<code>PropertySource</code>获胜。这意味着您可以在<code>application.properties</code>中指定活动配置文件，然后使用命令行开关<strong>替换</strong>它们。</p>
<p>有时，将特定于配置文件的属性<strong>添加</strong>到活动配置文件而不是替换它们是有用的。<code>spring.profiles.include</code>属性可用于无条件地添加活动配置文件。<code>SpringApplication</code>入口点还有一个用于设置其他配置文件的Java API（即，在<code>spring.profiles.active</code>属性激活的配置文件之上）。请参阅<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/SpringApplication.html">SpringApplication中</a>的<code>setAdditionalProfiles()</code>方法 。</p>
<p>例如，当使用开关<code>--spring.profiles.active=prod</code>运行具有以下属性的应用程序时，<code>proddb</code>和<code>prodmq</code>配置文件也会被激活：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">my.property: fromyamlfile</span><br><span class="line">---</span><br><span class="line">spring.profiles: prod</span><br><span class="line">spring.profiles.include:</span><br><span class="line">  - proddb</span><br><span class="line">  - prodmq</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>请记住，可以在YAML文档中定义<code>spring.profiles</code>属性，以确定此特定文档何时包含在配置中。有关更多详细信息<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#howto-change-configuration-depending-on-the-environment">，</a>请参见 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#howto-change-configuration-depending-on-the-environment">第77.7节“根据环境更改配置”</a>。</td>
</tr>
</tbody></table>
<h2 id="25-2以编程方式设置配置文件"><a href="#25-2以编程方式设置配置文件" class="headerlink" title="25.2以编程方式设置配置文件"></a>25.2以编程方式设置配置文件</h2><p>您可以在应用程序运行之前通过调用<code>SpringApplication.setAdditionalProfiles(…)</code>以编程方式设置活动配置文件。也可以使用Spring的<code>ConfigurableEnvironment</code>界面激活配置文件。</p>
<h2 id="25-3特定于配置文件的配置文件"><a href="#25-3特定于配置文件的配置文件" class="headerlink" title="25.3特定于配置文件的配置文件"></a>25.3特定于配置文件的配置文件</h2><p><code>application.properties</code>（或<code>application.yml</code>）的配置文件特定变体和通过<code>@ConfigurationProperties</code>引用的文件被视为文件并已加载。有关详细信息<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-external-config-profile-specific-properties">，</a>请参见“ <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-external-config-profile-specific-properties">第24.4节”“特定</a>于<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-external-config-profile-specific-properties">配置文件的属性”</a>。</p>
<h2 id="26-记录"><a href="#26-记录" class="headerlink" title="26.记录"></a>26.记录</h2><p>Spring Boot使用<a target="_blank" rel="noopener" href="https://commons.apache.org/logging">Commons Logging</a>进行所有内部日志记录，但保留底层日志实现。为<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/api//java/util/logging/package-summary.html">Java Util Logging</a>，<a target="_blank" rel="noopener" href="https://logging.apache.org/log4j/2.x/">Log4J2</a>和 <a target="_blank" rel="noopener" href="http://logback.qos.ch/">Logback</a>提供了默认配置 。在每种情况下，记录器都预先配置为使用控制台输出，并且还提供可选的文件输出。</p>
<p>默认情况下，如果使用“Starters”，则使用Logback进行日志记录。还包括适当的Logback路由，以确保使用Java Util Logging，Commons Logging，Log4J或SLF4J的依赖库都能正常工作。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>Java有很多日志框架可供使用。如果以上列表看起来令人困惑，请不要担心。通常，您不需要更改日志记录依赖项，并且Spring Boot默认值可以正常工作。</td>
</tr>
</tbody></table>
<h2 id="26。1日志格式"><a href="#26。1日志格式" class="headerlink" title="26。1日志格式"></a>26。1日志格式</h2><p>Spring Boot的默认日志输出类似于以下示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2014-03-05 10:57:51.112  INFO 45469 --- [           main] org.apache.catalina.core.StandardEngine  : Starting Servlet Engine: Apache Tomcat&#x2F;7.0.52</span><br><span class="line">2014-03-05 10:57:51.253  INFO 45469 --- [ost-startStop-1] o.a.c.c.C.[Tomcat].[localhost].[&#x2F;]       : Initializing Spring embedded WebApplicationContext</span><br><span class="line">2014-03-05 10:57:51.253  INFO 45469 --- [ost-startStop-1] o.s.web.context.ContextLoader            : Root WebApplicationContext: initialization completed in 1358 ms</span><br><span class="line">2014-03-05 10:57:51.698  INFO 45469 --- [ost-startStop-1] o.s.b.c.e.ServletRegistrationBean        : Mapping servlet: &#39;dispatcherServlet&#39; to [&#x2F;]</span><br><span class="line">2014-03-05 10:57:51.702  INFO 45469 --- [ost-startStop-1] o.s.b.c.embedded.FilterRegistrationBean  : Mapping filter: &#39;hiddenHttpMethodFilter&#39; to: [&#x2F;*]</span><br></pre></td></tr></table></figure>

<p>输出以下项目：</p>
<ul>
<li>日期和时间：毫秒精度，易于排序。</li>
<li>日志级别：<code>ERROR</code>，<code>WARN</code>，<code>INFO</code>，<code>DEBUG</code>或<code>TRACE</code>。</li>
<li>进程ID。</li>
<li>一个<code>---</code>分隔符，用于区分实际日志消息的开头。</li>
<li>线程名称：括在方括号中（可能会截断控制台输出）。</li>
<li>记录器名称：这通常是源类名称（通常缩写）。</li>
<li>日志消息。</li>
</ul>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>Logback没有<code>FATAL</code>级别。它映射到<code>ERROR</code>。</td>
</tr>
</tbody></table>
<h2 id="26-2控制台输出"><a href="#26-2控制台输出" class="headerlink" title="26.2控制台输出"></a>26.2控制台输出</h2><p>默认日志配置会在写入时将消息回显到控制台。默认情况下，会记录<code>ERROR</code> - 级别，<code>WARN</code> - 级别和<code>INFO</code>级别的消息。您还可以通过使用<code>--debug</code>标志启动应用程序来启用“调试”模式。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar myapp.jar --debug</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>您还可以在<code>application.properties</code>中指定<code>debug=true</code>。</td>
</tr>
</tbody></table>
<p>启用调试模式后，将选择一些核心记录器（嵌入式容器，Hibernate和Spring Boot）以输出更多信息。启用调试模式并<em>没有</em>将应用程序配置为记录与<code>DEBUG</code>级别的所有消息。</p>
<p>或者，您可以通过使用<code>--trace</code>标志（或<code>application.properties</code>中的<code>trace=true</code>）启动应用程序来启用“跟踪”模式。这样做可以为选择的核心记录器（嵌入式容器，Hibernate模式生成和整个Spring组合）启用跟踪日志记录。</p>
<h3 id="26-2-1彩色编码输出"><a href="#26-2-1彩色编码输出" class="headerlink" title="26.2.1彩色编码输出"></a>26.2.1彩色编码输出</h3><p>如果您的终端支持ANSI，则使用颜色输出来提高可读性。您可以将<code>spring.output.ansi.enabled</code>设置为 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/ansi/AnsiOutput.Enabled.html">支持的值</a>以覆盖自动检测。</p>
<p>使用<code>%clr</code>转换字配置颜色编码。在最简单的形式中，转换器根据日志级别为输出着色，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%clr(%5p)</span><br></pre></td></tr></table></figure>

<p>下表描述了日志级别到颜色的映射：</p>
<table>
<thead>
<tr>
<th>水平</th>
<th>颜色</th>
</tr>
</thead>
<tbody><tr>
<td><code>FATAL</code></td>
<td>Red</td>
</tr>
<tr>
<td><code>ERROR</code></td>
<td>Red</td>
</tr>
<tr>
<td><code>WARN</code></td>
<td>Yellow</td>
</tr>
<tr>
<td><code>INFO</code></td>
<td>Green</td>
</tr>
<tr>
<td><code>DEBUG</code></td>
<td>Green</td>
</tr>
<tr>
<td><code>TRACE</code></td>
<td>Green</td>
</tr>
</tbody></table>
<p>或者，您可以通过将其作为转换选项指定应使用的颜色或样式。例如，要使文本变为黄色，请使用以下设置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%clr(%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;)&#123;yellow&#125;</span><br></pre></td></tr></table></figure>

<p>支持以下颜色和样式：</p>
<ul>
<li><code>blue</code></li>
<li><code>cyan</code></li>
<li><code>faint</code></li>
<li><code>green</code></li>
<li><code>magenta</code></li>
<li><code>red</code></li>
<li><code>yellow</code></li>
</ul>
<h2 id="26-3文件输出"><a href="#26-3文件输出" class="headerlink" title="26.3文件输出"></a>26.3文件输出</h2><p>默认情况下，Spring Boot仅记录到控制台，不会写入日志文件。如果除了控制台输出之外还要编写日志文件，则需要设置<code>logging.file</code>或<code>logging.path</code>属性（例如，在<code>application.properties</code>中）。</p>
<p>下表显示了<code>logging.*</code>属性如何一起使用：</p>
<p><strong>表26.1。记录属性</strong></p>
<table>
<thead>
<tr>
<th><code>logging.file</code></th>
<th><code>logging.path</code></th>
<th>例</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><em>（没有）</em></td>
<td><em>（没有）</em></td>
<td></td>
<td>仅控制台记录。</td>
</tr>
<tr>
<td>具体文件</td>
<td><em>（没有）</em></td>
<td><code>my.log</code></td>
<td>写入指定的日志文件。名称可以是精确位置或相对于当前目录。</td>
</tr>
<tr>
<td><em>（没有）</em></td>
<td>具体目录</td>
<td><code>/var/log</code></td>
<td>将<code>spring.log</code>写入指定的目录。名称可以是精确位置或相对于当前目录。</td>
</tr>
</tbody></table>
<p>日志文件在达到10 MB时会轮换，与控制台输出一样，默认情况下会记录<code>ERROR</code> - 级别，<code>WARN</code> - 级别和<code>INFO</code>级别的消息。可以使用<code>logging.file.max-size</code>属性更改大小限制。除非已设置<code>logging.file.max-history</code>属性，否则以前轮换的文件将无限期归档。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>日志记录系统在应用程序生命周期的早期初始化。因此，在通过<code>@PropertySource</code>注释加载的属性文件中找不到日志记录属性。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>日志记录属性独立于实际的日志记录基础结构。因此，Spring Boot不管理特定的配置密钥（例如用于Logback的<code>logback.configurationFile</code>）。</td>
</tr>
</tbody></table>
<h2 id="26。4日志级别"><a href="#26。4日志级别" class="headerlink" title="26。4日志级别"></a>26。4日志级别</h2><p>所有受支持的日志记录系统都可以使用<code>logging.level.&lt;logger-name&gt;=&lt;level&gt;</code>在Spring <code>Environment</code>中设置记录器级别（例如，在<code>application.properties</code>中），其中<code>level</code>是TRACE，DEBUG，INFO之一，警告，错误，致命或关闭。可以使用<code>logging.level.root</code>配置<code>root</code>记录器。</p>
<p>以下示例显示<code>application.properties</code>中的潜在日志记录设置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">logging.level.root&#x3D;WARN</span><br><span class="line">logging.level.org.springframework.web&#x3D;DEBUG</span><br><span class="line">logging.level.org.hibernate&#x3D;ERROR</span><br></pre></td></tr></table></figure>

<h2 id="26。5日志组"><a href="#26。5日志组" class="headerlink" title="26。5日志组"></a>26。5日志组</h2><p>能够将相关记录器组合在一起以便可以同时配置它们通常很有用。例如，您通常可以更改<em>所有</em> Tomcat相关记录器的日志记录级别 ，但您无法轻松记住顶级软件包。</p>
<p>为此，Spring Boot允许您在Spring <code>Environment</code>中定义日志记录组。例如，以下是如何通过将“tomcat”组添加到<code>application.properties</code>来定义它：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logging.group.tomcat&#x3D;org.apache.catalina, org.apache.coyote, org.apache.tomcat</span><br></pre></td></tr></table></figure>

<p>定义后，您可以使用一行更改组中所有记录器的级别：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logging.level.tomcat&#x3D;TRACE</span><br></pre></td></tr></table></figure>

<p>Spring Boot包括以下可以开箱即用的预定义日志记录组：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>记录仪</th>
</tr>
</thead>
<tbody><tr>
<td>web</td>
<td><code>org.springframework.core.codec</code>, <code>org.springframework.http</code>, <code>org.springframework.web</code></td>
</tr>
<tr>
<td>sql</td>
<td><code>org.springframework.jdbc.core</code>, <code>org.hibernate.SQL</code></td>
</tr>
</tbody></table>
<h2 id="26-6自定义日志配置"><a href="#26-6自定义日志配置" class="headerlink" title="26.6自定义日志配置"></a>26.6自定义日志配置</h2><p>可以通过在类路径中包含相应的库来激活各种日志记录系统，并且可以通过在类路径的根目录中或在以下Spring <code>Environment</code>属性指定的位置提供合适的配置文件来进一步自定义： <code>logging.config</code>。</p>
<p>您可以使用<code>org.springframework.boot.logging.LoggingSystem</code>系统属性强制Spring Boot使用特定的日志记录系统。该值应该是<code>LoggingSystem</code>实现的完全限定类名。您还可以使用值<code>none</code>完全禁用Spring Boot的日志记录配置。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>由于<strong>在</strong>创建<code>ApplicationContext</code> <strong>之前</strong>初始化日志记录，因此无法控制Spring <code>@Configuration</code>文件中<code>@PropertySources</code>的日志记录。更改日志记录系统或完全禁用它的唯一方法是通过系统属性。</td>
</tr>
</tbody></table>
<p>根据您的日志记录系统，将加载以下文件：</p>
<table>
<thead>
<tr>
<th>记录系统</th>
<th>定制</th>
</tr>
</thead>
<tbody><tr>
<td>Logback</td>
<td><code>logback-spring.xml</code>, <code>logback-spring.groovy</code>, <code>logback.xml</code>, or <code>logback.groovy</code></td>
</tr>
<tr>
<td>Log4j2</td>
<td><code>log4j2-spring.xml</code> or <code>log4j2.xml</code></td>
</tr>
<tr>
<td>JDK (Java Util Logging)</td>
<td><code>logging.properties</code></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果可能，我们建议您使用<code>-spring</code>变体进行日志记录配置（例如，<code>logback-spring.xml</code>而不是<code>logback.xml</code>）。如果使用标准配置位置，Spring无法完全控制日志初始化。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/warning.png" alt="[警告]"></th>
</tr>
</thead>
<tbody><tr>
<td>Java Util Logging存在已知的类加载问题，这些问题在从“可执行jar”运行时会导致问题。如果可能的话，我们建议您在从“可执行jar”运行时避免使用它。</td>
</tr>
</tbody></table>
<p>为了帮助进行自定义，一些其他属性从Spring <code>Environment</code>传输到系统属性，如下表所述：</p>
<table>
<thead>
<tr>
<th>Spring环境</th>
<th>系统Property</th>
<th>评论</th>
</tr>
</thead>
<tbody><tr>
<td><code>logging.exception-conversion-word</code></td>
<td><code>LOG_EXCEPTION_CONVERSION_WORD</code></td>
<td>The conversion word used when logging exceptions.</td>
</tr>
<tr>
<td><code>logging.file</code></td>
<td><code>LOG_FILE</code></td>
<td>If defined, it is used in the default log configuration.</td>
</tr>
<tr>
<td><code>logging.file.max-size</code></td>
<td><code>LOG_FILE_MAX_SIZE</code></td>
<td>Maximum log file size (if LOG_FILE enabled). (Only supported with the default Logback setup.)</td>
</tr>
<tr>
<td><code>logging.file.max-history</code></td>
<td><code>LOG_FILE_MAX_HISTORY</code></td>
<td>Maximum number of archive log files to keep (if LOG_FILE enabled). (Only supported with the default Logback setup.)</td>
</tr>
<tr>
<td><code>logging.path</code></td>
<td><code>LOG_PATH</code></td>
<td>If defined, it is used in the default log configuration.</td>
</tr>
<tr>
<td><code>logging.pattern.console</code></td>
<td><code>CONSOLE_LOG_PATTERN</code></td>
<td>The log pattern to use on the console (stdout). (Only supported with the default Logback setup.)</td>
</tr>
<tr>
<td><code>logging.pattern.dateformat</code></td>
<td><code>LOG_DATEFORMAT_PATTERN</code></td>
<td>Appender pattern for log date format. (Only supported with the default Logback setup.)</td>
</tr>
<tr>
<td><code>logging.pattern.file</code></td>
<td><code>FILE_LOG_PATTERN</code></td>
<td>The log pattern to use in a file (if <code>LOG_FILE</code> is enabled). (Only supported with the default Logback setup.)</td>
</tr>
<tr>
<td><code>logging.pattern.level</code></td>
<td><code>LOG_LEVEL_PATTERN</code></td>
<td>The format to use when rendering the log level (default <code>%5p</code>). (Only supported with the default Logback setup.)</td>
</tr>
<tr>
<td><code>PID</code></td>
<td><code>PID</code></td>
<td>The current process ID (discovered if possible and when not already defined as an OS environment variable).</td>
</tr>
</tbody></table>
<p>所有受支持的日志记录系统在解析其配置文件时都可以参考系统属性。有关示例，请参阅<code>spring-boot.jar</code>中的默认配置：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot/src/main/resources/org/springframework/boot/logging/logback/defaults.xml">的logback</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot/src/main/resources/org/springframework/boot/logging/log4j2/log4j2.xml">Log4j 2</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot/src/main/resources/org/springframework/boot/logging/java/logging-file.properties">Java Util日志记录</a></li>
</ul>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果要在日志记录属性中使用占位符，则应使用 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-external-config-placeholders-in-properties">Spring Boot的语法，</a>而不是底层框架的语法。值得注意的是，如果使用Logback，则应使用<code>:</code>作为属性名称与其默认值之间的分隔符，而不是使用<code>:-</code>。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>您可以通过仅覆盖<code>LOG_LEVEL_PATTERN</code>（或带有Logback的<code>logging.pattern.level</code>）将MDC和其他临时内容添加到日志行。例如，如果使用<code>logging.pattern.level=user:%X&#123;user&#125; %5p</code>，则默认日志格式包含“user”的MDC条目（如果存在），如以下示例所示。<code>2015-09-30 12:30:04.031 user:someone INFO 22174 --- [  nio-8080-exec-0] demo.Controller Handling authenticated request</code></td>
</tr>
</tbody></table>
<h2 id="26-7-Logback-Extensions"><a href="#26-7-Logback-Extensions" class="headerlink" title="26.7 Logback Extensions"></a>26.7 Logback Extensions</h2><p>Spring Boot包含许多Logback扩展，可以帮助进行高级配置。您可以在<code>logback-spring.xml</code>配置文件中使用这些扩展名。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>由于标准<code>logback.xml</code>配置文件加载过早，因此无法在其中使用扩展。您需要使用<code>logback-spring.xml</code>或定义<code>logging.config</code>属性。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/warning.png" alt="[警告]"></th>
</tr>
</thead>
<tbody><tr>
<td>扩展不能与Logback的 <a target="_blank" rel="noopener" href="http://logback.qos.ch/manual/configuration.html#autoScan">配置扫描一起使用</a>。如果尝试这样做，则更改配置文件会导致类似于以下记录之一的错误：</td>
</tr>
</tbody></table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ERROR in ch.qos.logback.core.joran.spi.Interpreter@4:71 - no applicable action for [springProperty], current ElementPath is [[configuration][springProperty]]</span><br><span class="line">ERROR in ch.qos.logback.core.joran.spi.Interpreter@4:71 - no applicable action for [springProfile], current ElementPath is [[configuration][springProfile]]</span><br></pre></td></tr></table></figure>

<h3 id="26-7-1特定于配置文件的配置"><a href="#26-7-1特定于配置文件的配置" class="headerlink" title="26.7.1特定于配置文件的配置"></a>26.7.1特定于配置文件的配置</h3><p><code>&lt;springProfile&gt;</code>标记允许您根据活动的Spring配置文件选择性地包含或排除配置部分。<code>&lt;configuration&gt;</code>元素中的任何位置都支持配置文件节。使用<code>name</code>属性指定哪个配置文件接受配置。<code>&lt;springProfile&gt;</code>标记可以包含简单的配置文件名称（例如<code>staging</code>）或配置文件表达式。概要表达式允许表达更复杂的概要逻辑，例如<code>production &amp; (eu-central | eu-west)</code>。有关详细信息，请查阅 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/core.html#beans-definition-profiles-java">参考指南</a>。以下清单显示了三个示例配置文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;springProfile name&#x3D;&quot;staging&quot;&gt;</span><br><span class="line">	&lt;!-- configuration to be enabled when the &quot;staging&quot; profile is active --&gt;</span><br><span class="line">&lt;&#x2F;springProfile&gt;</span><br><span class="line"></span><br><span class="line">&lt;springProfile name&#x3D;&quot;dev | staging&quot;&gt;</span><br><span class="line">	&lt;!-- configuration to be enabled when the &quot;dev&quot; or &quot;staging&quot; profiles are active --&gt;</span><br><span class="line">&lt;&#x2F;springProfile&gt;</span><br><span class="line"></span><br><span class="line">&lt;springProfile name&#x3D;&quot;!production&quot;&gt;</span><br><span class="line">	&lt;!-- configuration to be enabled when the &quot;production&quot; profile is not active --&gt;</span><br><span class="line">&lt;&#x2F;springProfile&gt;</span><br></pre></td></tr></table></figure>

<h3 id="26-7-2环境属性"><a href="#26-7-2环境属性" class="headerlink" title="26.7.2环境属性"></a>26.7.2环境属性</h3><p><code>&lt;springProperty&gt;</code>标记允许您公开Spring <code>Environment</code>中的属性，以便在Logback中使用。如果要在Logback配置中访问<code>application.properties</code>文件中的值，这样做非常有用。标签的工作方式与Logback的标准<code>&lt;property&gt;</code>标签类似。但是，不是指定直接<code>value</code>，而是指定属性的<code>source</code>（来自<code>Environment</code>）。如果您需要将属性存储在<code>local</code>范围以外的其他位置，则可以使用<code>scope</code>属性。如果需要回退值（如果未在<code>Environment</code>中设置该属性），则可以使用<code>defaultValue</code>属性。以下示例显示如何公开在Logback中使用的属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;springProperty scope&#x3D;&quot;context&quot; name&#x3D;&quot;fluentHost&quot; source&#x3D;&quot;myapp.fluentd.host&quot;</span><br><span class="line">		defaultValue&#x3D;&quot;localhost&quot;&#x2F;&gt;</span><br><span class="line">&lt;appender name&#x3D;&quot;FLUENT&quot; class&#x3D;&quot;ch.qos.logback.more.appenders.DataFluentAppender&quot;&gt;</span><br><span class="line">	&lt;remoteHost&gt;$&#123;fluentHost&#125;&lt;&#x2F;remoteHost&gt;</span><br><span class="line">	...</span><br><span class="line">&lt;&#x2F;appender&gt;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>必须在烤肉串案例中指定<code>source</code>（例如<code>my.property-name</code>）。但是，可以使用宽松规则将属性添加到<code>Environment</code>。</td>
</tr>
</tbody></table>
<h2 id="27-JSON"><a href="#27-JSON" class="headerlink" title="27. JSON"></a>27. JSON</h2><p>Spring Boot提供了与三个JSON映射库的集成：</p>
<ul>
<li>GSON</li>
<li>Jackson</li>
<li>JSON-B</li>
</ul>
<p>Jackson是首选的默认库。</p>
<h2 id="27-1-Jackson"><a href="#27-1-Jackson" class="headerlink" title="27.1 Jackson"></a>27.1 Jackson</h2><p>提供了Jackson的自动配置，Jackson是<code>spring-boot-starter-json</code>的一部分。当Jackson在类路径上时，会自动配置<code>ObjectMapper</code> bean。提供了几个配置属性来自 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#howto-customize-the-jackson-objectmapper">定义<code>ObjectMapper</code>的配置</a>。</p>
<h2 id="27-2-Gson"><a href="#27-2-Gson" class="headerlink" title="27.2 Gson"></a>27.2 Gson</h2><p>提供Gson的自动配置。当Gson在类路径上时，会自动配置<code>Gson</code> bean。提供了几个<code>spring.gson.*</code>配置属性来自定义配置。为了获得更多控制，可以使用一个或多个<code>GsonBuilderCustomizer</code> beans。</p>
<h2 id="27-3-JSON-B"><a href="#27-3-JSON-B" class="headerlink" title="27.3 JSON-B"></a>27.3 JSON-B</h2><p>提供了JSON-B的自动配置。当JSON-B API和实现在类路径上时，将自动配置<code>Jsonb</code> bean。首选的JSON-B实现是Apache Johnzon，它提供了依赖关系管理。</p>
<h2 id="28-开发Web应用程序"><a href="#28-开发Web应用程序" class="headerlink" title="28.开发Web应用程序"></a>28.开发Web应用程序</h2><p>Spring Boot非常适合Web应用程序开发。您可以使用嵌入式Tomcat，Jetty，Undertow或Netty创建自包含的HTTP服务器。大多数Web应用程序使用<code>spring-boot-starter-web</code>模块快速启动和运行。您还可以使用<code>spring-boot-starter-webflux</code>模块选择构建响应式Web应用程序。</p>
<p>如果您还没有开发Spring Boot Web应用程序，可以按照“Hello World！”进行操作。“ *<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#getting-started-first-application">入门”</a>*部分中的示例 。</p>
<h2 id="28-1“Spring-Web-MVC框架”"><a href="#28-1“Spring-Web-MVC框架”" class="headerlink" title="28.1“Spring Web MVC框架”"></a>28.1“Spring Web MVC框架”</h2><p>在<a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/web.html#mvc">Spring Web框架</a>（通常简称为“Spring MVC”）是一种富含“模型视图控制器” Web框架。Spring MVC允许您创建特殊的<code>@Controller</code>或<code>@RestController</code> beans来处理传入的HTTP请求。控制器中的方法使用<code>@RequestMapping</code>注释映射到HTTP。</p>
<p>以下代码显示了为JSON数据提供服务的典型<code>@RestController</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">@RequestMapping(value&#x3D;&quot;&#x2F;users&quot;)</span><br><span class="line">public class MyRestController &#123;</span><br><span class="line"></span><br><span class="line">	@RequestMapping(value&#x3D;&quot;&#x2F;&#123;user&#125;&quot;, method&#x3D;RequestMethod.GET)</span><br><span class="line">	public User getUser(@PathVariable Long user) &#123;</span><br><span class="line">		&#x2F;&#x2F; ...</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@RequestMapping(value&#x3D;&quot;&#x2F;&#123;user&#125;&#x2F;customers&quot;, method&#x3D;RequestMethod.GET)</span><br><span class="line">	List&lt;Customer&gt; getUserCustomers(@PathVariable Long user) &#123;</span><br><span class="line">		&#x2F;&#x2F; ...</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@RequestMapping(value&#x3D;&quot;&#x2F;&#123;user&#125;&quot;, method&#x3D;RequestMethod.DELETE)</span><br><span class="line">	public User deleteUser(@PathVariable Long user) &#123;</span><br><span class="line">		&#x2F;&#x2F; ...</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Spring MVC是核心Spring框架的一部分，详细信息可在<a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/web.html#mvc">参考文档中找到</a>。还有一些指南涵盖Spring MVC，可在<a target="_blank" rel="noopener" href="https://spring.io/guides">spring.io/guides上找到</a>。</p>
<h3 id="28-1-1-Spring-MVC自动配置"><a href="#28-1-1-Spring-MVC自动配置" class="headerlink" title="28.1.1 Spring MVC自动配置"></a>28.1.1 Spring MVC自动配置</h3><p>Spring Boot为Spring MVC提供了自动配置，适用于大多数应用程序。</p>
<p>自动配置在Spring的默认值之上添加了以下功能：</p>
<ul>
<li>包含<code>ContentNegotiatingViewResolver</code>和<code>BeanNameViewResolver</code> beans。</li>
<li>支持提供静态资源，包括对WebJars的支持（ <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-spring-mvc-static-content">本文档稍后介绍</a>））。</li>
<li>自动注册<code>Converter</code>，<code>GenericConverter</code>和<code>Formatter</code> beans。</li>
<li>支持<code>HttpMessageConverters</code>（ <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-spring-mvc-message-converters">本文档稍后部分</a>）。</li>
<li>自动注册<code>MessageCodesResolver</code>（ <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-spring-message-codes">本文档后面部分</a>）。</li>
<li>静态<code>index.html</code>支持。</li>
<li>自定义<code>Favicon</code>支持（<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-spring-mvc-favicon">本文档稍后介绍</a>）。</li>
<li>自动使用<code>ConfigurableWebBindingInitializer</code> bean（本文 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-spring-mvc-web-binding-initializer">后面会介绍</a>）。</li>
</ul>
<p>如果你想保留Spring Boot MVC功能，并且你想添加额外的 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/web.html#mvc">MVC配置</a>（拦截器，格式化程序，视图控制器和其他功能），你可以添加自己的<code>@Configuration</code>类<code>WebMvcConfigurer</code>类但<strong>没有</strong> <code>@EnableWebMvc</code>。如果您希望提供<code>RequestMappingHandlerMapping</code>，<code>RequestMappingHandlerAdapter</code>或<code>ExceptionHandlerExceptionResolver</code>的自定义实例，则可以声明<code>WebMvcRegistrationsAdapter</code>实例以提供此类组件。</p>
<p>如果您想完全控制Spring MVC，可以添加自己的<code>@Configuration</code>注释<code>@EnableWebMvc</code>。</p>
<h3 id="28-1-2-HttpMessageConverters"><a href="#28-1-2-HttpMessageConverters" class="headerlink" title="28.1.2 HttpMessageConverters"></a>28.1.2 HttpMessageConverters</h3><p>Spring MVC使用<code>HttpMessageConverter</code>接口转换HTTP请求和响应。明智的默认设置包含在开箱即用中。例如，对象可以自动转换为JSON（通过使用Jackson库）或XML（如果可用，使用Jackson XML扩展，或者如果Jackson XML扩展不是，则使用JAXB可用）。默认情况下，字符串以<code>UTF-8</code>编码。</p>
<p>如果您需要添加或自定义转换器，可以使用Spring Boot的<code>HttpMessageConverters</code>类，如下面的清单所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.boot.autoconfigure.web.HttpMessageConverters;</span><br><span class="line">import org.springframework.context.annotation.*;</span><br><span class="line">import org.springframework.http.converter.*;</span><br><span class="line"></span><br><span class="line">@Configuration</span><br><span class="line">public class MyConfiguration &#123;</span><br><span class="line"></span><br><span class="line">	@Bean</span><br><span class="line">	public HttpMessageConverters customConverters() &#123;</span><br><span class="line">		HttpMessageConverter&lt;?&gt; additional &#x3D; ...</span><br><span class="line">		HttpMessageConverter&lt;?&gt; another &#x3D; ...</span><br><span class="line">		return new HttpMessageConverters(additional, another);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上下文中存在的任何<code>HttpMessageConverter</code> bean都将添加到转换器列表中。您也可以以相同的方式覆盖默认转换器。</p>
<h3 id="28-1-3自定义JSON序列化程序和反序列化程序"><a href="#28-1-3自定义JSON序列化程序和反序列化程序" class="headerlink" title="28.1.3自定义JSON序列化程序和反序列化程序"></a>28.1.3自定义JSON序列化程序和反序列化程序</h3><p>如果使用Jackson序列化和反序列化JSON数据，您可能需要编写自己的<code>JsonSerializer</code>和<code>JsonDeserializer</code>类。自定义序列化程序通常 <a target="_blank" rel="noopener" href="https://github.com/FasterXML/jackson-docs/wiki/JacksonHowToCustomSerializers">通过模块注册Jackson</a>，但Spring Boot提供了另一种<code>@JsonComponent</code>注释，可以更容易地直接注册Spring Beans。</p>
<p>您可以直接在<code>JsonSerializer</code>或<code>JsonDeserializer</code>实现上使用<code>@JsonComponent</code>注释。您还可以在包含序列化程序/反序列化程序作为内部类的类上使用它，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import java.io.*;</span><br><span class="line">import com.fasterxml.jackson.core.*;</span><br><span class="line">import com.fasterxml.jackson.databind.*;</span><br><span class="line">import org.springframework.boot.jackson.*;</span><br><span class="line"></span><br><span class="line">@JsonComponent</span><br><span class="line">public class Example &#123;</span><br><span class="line"></span><br><span class="line">	public static class Serializer extends JsonSerializer&lt;SomeObject&gt; &#123;</span><br><span class="line">		&#x2F;&#x2F; ...</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public static class Deserializer extends JsonDeserializer&lt;SomeObject&gt; &#123;</span><br><span class="line">		&#x2F;&#x2F; ...</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>ApplicationContext</code>中的所有<code>@JsonComponent</code> beans都会自动注册到Jackson。由于<code>@JsonComponent</code>使用<code>@Component</code>进行元注释，因此通常的组件扫描规则适用。</p>
<p>Spring Boot还提供 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/jackson/JsonObjectSerializer.java"><code>JsonObjectSerializer</code></a>与 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/jackson/JsonObjectDeserializer.java"><code>JsonObjectDeserializer</code></a>该给标准提供有用的替代基类Jackson版本序列化对象时。见 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/jackson/JsonObjectSerializer.html"><code>JsonObjectSerializer</code></a> 和<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/jackson/JsonObjectDeserializer.html"><code>JsonObjectDeserializer</code></a>在Javadoc了解详情。</p>
<h3 id="28-1-4-MessageCodesResolver"><a href="#28-1-4-MessageCodesResolver" class="headerlink" title="28.1.4 MessageCodesResolver"></a>28.1.4 MessageCodesResolver</h3><p>Spring MVC有一个生成错误代码的策略，用于从绑定错误中呈现错误消息：<code>MessageCodesResolver</code>。如果设置<code>spring.mvc.message-codes-resolver.format</code>属性<code>PREFIX_ERROR_CODE</code>或<code>POSTFIX_ERROR_CODE</code>，则Spring Boot会为您创建一个（请参阅枚举 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/javadoc-api/org/springframework/validation/DefaultMessageCodesResolver.Format.html"><code>DefaultMessageCodesResolver.Format</code></a>）。</p>
<h3 id="28-1-5静态内容"><a href="#28-1-5静态内容" class="headerlink" title="28.1.5静态内容"></a>28.1.5静态内容</h3><p>默认情况下，Spring Boot从类路径中的<code>/static</code>（或<code>/public</code>或<code>/resources</code>或<code>/META-INF/resources</code>）目录或<code>ServletContext</code>的根目录中提供静态内容。它使用来自Spring MVC的<code>ResourceHttpRequestHandler</code>，以便您可以通过添加自己的<code>WebMvcConfigurer</code>并覆盖<code>addResourceHandlers</code>方法来修改该行为。</p>
<p>在独立的Web应用程序中，容器中的默认servlet也会启用，并作为后备，如果Spring决定不处理它，则从<code>ServletContext</code>的根目录提供内容。大多数情况下，这不会发生（除非您修改默认的MVC配置），因为Spring始终可以通过<code>DispatcherServlet</code>处理请求。</p>
<p>默认情况下，资源映射到<code>/**</code>，但您可以使用<code>spring.mvc.static-path-pattern</code>属性对其进行调整。例如，将所有资源重新定位到<code>/resources/**</code>可以实现如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.mvc.static-path-pattern&#x3D;&#x2F;resources&#x2F;**</span><br></pre></td></tr></table></figure>

<p>您还可以使用<code>spring.resources.static-locations</code>属性自定义静态资源位置（将默认值替换为目录位置列表）。根Servlet上下文路径<code>&quot;/&quot;</code>也会自动添加为位置。</p>
<p>除了前面提到的“标准”静态资源位置之外，还为<a target="_blank" rel="noopener" href="https://www.webjars.org/">Webjars内容</a>制作了一个特例。如果它们以Webjars格式打包，那么具有<code>/webjars/**</code>中路径的任何资源都将从jar文件中提供。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果您的应用程序打包为jar，请不要使用<code>src/main/webapp</code>目录。虽然这个目录是一个通用的标准，它的工作原理<strong>只是</strong>战争的包装，它是默默大多数构建工具忽略，如果你生成一个罐子。</td>
</tr>
</tbody></table>
<p>Spring Boot还支持Spring MVC提供的高级资源处理功能，允许使用缓存破坏静态资源等用例或使用与Webjars无关的URL。</p>
<p>要为Webjars使用版本无关的URL，请添加<code>webjars-locator-core</code>依赖项。然后声明你的Webjar。以jQuery为例，添加<code>&quot;/webjars/jquery/jquery.min.js&quot;</code>会产生<code>&quot;/webjars/jquery/x.y.z/jquery.min.js&quot;</code>。其中<code>x.y.z</code>是Webjar版本。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果使用JBoss，则需要声明<code>webjars-locator-jboss-vfs</code>依赖项而不是<code>webjars-locator-core</code>。否则，所有Webjars都将解析为<code>404</code>。</td>
</tr>
</tbody></table>
<p>要使用缓存清除，以下配置会为所有静态资源配置缓存清除解决方案，从而在URL中有效添加内容哈希（例如<code>&lt;link href=&quot;/css/spring-2a2d595e6ed9a0b24f027f2b63b134d6.css&quot;/&gt;</code>）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.resources.chain.strategy.content.enabled&#x3D;true</span><br><span class="line">spring.resources.chain.strategy.content.paths&#x3D;&#x2F;**</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>由于为Thymeleaf和FreeMarker自动配置了<code>ResourceUrlEncodingFilter</code>，因此在运行时可以在模板中重写资源链接。您应该在使用JSP时手动声明此过滤器。其他模板引擎目前不是自动支持的，但可以使用自定义模板宏/帮助程序和使用 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/javadoc-api/org/springframework/web/servlet/resource/ResourceUrlProvider.html"><code>ResourceUrlProvider</code></a>。</td>
</tr>
</tbody></table>
<p>使用（例如）JavaScript模块加载器动态加载资源时，不能重命名文件。这就是为什么其他策略也得到支持并可以合并的原因。“固定”策略在URL中添加静态版本字符串而不更改文件名，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">spring.resources.chain.strategy.content.enabled&#x3D;true</span><br><span class="line">spring.resources.chain.strategy.content.paths&#x3D;&#x2F;**</span><br><span class="line">spring.resources.chain.strategy.fixed.enabled&#x3D;true</span><br><span class="line">spring.resources.chain.strategy.fixed.paths&#x3D;&#x2F;js&#x2F;lib&#x2F;</span><br><span class="line">spring.resources.chain.strategy.fixed.version&#x3D;v12</span><br></pre></td></tr></table></figure>

<p>使用此配置，位于<code>&quot;/js/lib/&quot;</code>下的JavaScript模块使用固定版本控制策略（<code>&quot;/v12/js/lib/mymodule.js&quot;</code>），而其他资源仍使用内容1（<code>&lt;link href=&quot;/css/spring-2a2d595e6ed9a0b24f027f2b63b134d6.css&quot;/&gt;</code>）。</p>
<p>有关<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/ResourceProperties.java"><code>ResourceProperties</code></a> 更多支持选项，请参阅</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>此功能已在专门的<a target="_blank" rel="noopener" href="https://spring.io/blog/2014/07/24/spring-framework-4-1-handling-static-web-resources">博客文章</a>和Spring Framework的 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/web.html#mvc-config-static-resources">参考文档中</a>进行了详细描述 。</td>
</tr>
</tbody></table>
<h3 id="28-1-6欢迎页面"><a href="#28-1-6欢迎页面" class="headerlink" title="28.1.6欢迎页面"></a>28.1.6欢迎页面</h3><p>Spring Boot支持静态和模板化的欢迎页面。它首先在配置的静态内容位置中查找<code>index.html</code>文件。如果找不到，则会查找<code>index</code>模板。如果找到任何一个，它将自动用作应用程序的欢迎页面。</p>
<h3 id="28-1-7自定义Favicon"><a href="#28-1-7自定义Favicon" class="headerlink" title="28.1.7自定义Favicon"></a>28.1.7自定义Favicon</h3><p>Spring Boot在配置的静态内容位置和类路径的根（按此顺序）中查找<code>favicon.ico</code>。如果存在这样的文件，它将自动用作应用程序的favicon。</p>
<h3 id="28-1-8路径匹配和内容协商"><a href="#28-1-8路径匹配和内容协商" class="headerlink" title="28.1.8路径匹配和内容协商"></a>28.1.8路径匹配和内容协商</h3><p>Spring MVC可以通过查看请求路径并将其与应用程序中定义的映射相匹配（例如，关于Controller方法的<code>@GetMapping</code>注释），将传入的HTTP请求映射到处理程序。</p>
<p>Spring Boot默认情况下选择禁用后缀模式匹配，这意味着像<code>&quot;GET /projects/spring-boot.json&quot;</code>这样的请求将不会与<code>@GetMapping(&quot;/projects/spring-boot&quot;)</code>映射匹配。这被认为是<a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/web.html#mvc-ann-requestmapping-suffix-pattern-match">Spring MVC应用程序</a>的 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/web.html#mvc-ann-requestmapping-suffix-pattern-match">最佳实践</a>。对于没有发送正确“接受”请求标头的HTTP客户端，此功能在过去主要有用; 我们需要确保将正确的内容类型发送给客户端。如今，内容协商更加可靠。</p>
<p>还有其他方法可以处理不一致发送正确“接受”请求标头的HTTP客户端。我们可以使用查询参数来确保<code>&quot;GET /projects/spring-boot?format=json&quot;</code>之类的请求映射到<code>@GetMapping(&quot;/projects/spring-boot&quot;)</code>，而不是使用后缀匹配：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">spring.mvc.contentnegotiation.favor-parameter&#x3D;true</span><br><span class="line"></span><br><span class="line"># We can change the parameter name, which is &quot;format&quot; by default:</span><br><span class="line"># spring.mvc.contentnegotiation.parameter-name&#x3D;myparam</span><br><span class="line"></span><br><span class="line"># We can also register additional file extensions&#x2F;media types with:</span><br><span class="line">spring.mvc.contentnegotiation.media-types.markdown&#x3D;text&#x2F;markdown</span><br></pre></td></tr></table></figure>

<p>如果您了解警告并仍希望您的应用程序使用后缀模式匹配，则需要以下配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.mvc.contentnegotiation.favor-path-extension&#x3D;true</span><br><span class="line">spring.mvc.pathmatch.use-suffix-pattern&#x3D;true</span><br></pre></td></tr></table></figure>

<p>或者，不是打开所有后缀模式，而是仅支持已注册的后缀模式更安全：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">spring.mvc.contentnegotiation.favor-path-extension&#x3D;true</span><br><span class="line">spring.mvc.pathmatch.use-registered-suffix-pattern&#x3D;true</span><br><span class="line"></span><br><span class="line"># You can also register additional file extensions&#x2F;media types with:</span><br><span class="line"># spring.mvc.contentnegotiation.media-types.adoc&#x3D;text&#x2F;asciidoc</span><br></pre></td></tr></table></figure>

<h3 id="28-1-9-ConfigurableWebBindingInitializer"><a href="#28-1-9-ConfigurableWebBindingInitializer" class="headerlink" title="28.1.9 ConfigurableWebBindingInitializer"></a>28.1.9 ConfigurableWebBindingInitializer</h3><p>Spring MVC使用<code>WebBindingInitializer</code>为特定请求初始化<code>WebDataBinder</code>。如果您创建自己的<code>ConfigurableWebBindingInitializer</code> <code>@Bean</code>，Spring Boot会自动配置Spring MVC以使用它。</p>
<h3 id="28-1-10模板引擎"><a href="#28-1-10模板引擎" class="headerlink" title="28.1.10模板引擎"></a>28.1.10模板引擎</h3><p>除REST Web服务外，您还可以使用Spring MVC来提供动态HTML内容。Spring MVC支持各种模板技术，包括Thymeleaf，FreeMarker和JSP。此外，许多其他模板引擎包括他们自己的Spring MVC集成。</p>
<p>Spring Boot包括对以下模板引擎的自动配置支持：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://freemarker.apache.org/docs/">FreeMarker的</a></li>
<li><a target="_blank" rel="noopener" href="http://docs.groovy-lang.org/docs/next/html/documentation/template-engines.html#_the_markuptemplateengine">Groovy的</a></li>
<li><a target="_blank" rel="noopener" href="http://www.thymeleaf.org/">Thymeleaf</a></li>
<li><a target="_blank" rel="noopener" href="https://mustache.github.io/">胡子</a></li>
</ul>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果可能，应该避免使用JSP。将它们与嵌入式servlet容器一起使用时有几个 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-jsp-limitations">已知的限制</a>。</td>
</tr>
</tbody></table>
<p>当您使用其中一个模板引擎和默认配置时，您的模板将从<code>src/main/resources/templates</code>自动获取。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>根据您运行应用程序的方式，IntelliJ IDEA以不同方式对类路径进行排序。从主方法在IDE中运行应用程序会产生与使用Maven或Gradle或其打包的jar运行应用程序时不同的顺序。这可能导致Spring Boot无法在类路径上找到模板。如果遇到此问题，可以在IDE中重新排序类路径，以便首先放置模块的类和资源。或者，您可以配置模板前缀以搜索类路径上的每个<code>templates</code>目录，如下所示：<code>classpath*:/templates/</code>。</td>
</tr>
</tbody></table>
<h3 id="28-1-11错误处理"><a href="#28-1-11错误处理" class="headerlink" title="28.1.11错误处理"></a>28.1.11错误处理</h3><p>默认情况下，Spring Boot提供<code>/error</code>映射，以合理的方式处理所有错误，并在servlet容器中注册为“全局”错误页面。对于计算机客户端，它会生成一个JSON响应，其中包含错误，HTTP状态和异常消息的详细信息。对于浏览器客户端，有一个“whitelabel”错误视图，以HTML格式呈现相同的数据（要自定义它，添加一个解析为<code>error</code>的<code>View</code>）。要完全替换默认行为，您可以实现<code>ErrorController</code>并注册该类型的bean定义或添加bean类型<code>ErrorAttributes</code>以使用现有机制但替换内容。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td><code>BasicErrorController</code>可以用作自定义<code>ErrorController</code>的基类。如果要为新内容类型添加处理程序，则此功能特别有用（默认情况下，专门处理<code>text/html</code>并为其他所有内容提供后备）。为此，请扩展<code>BasicErrorController</code>，添加具有<code>produces</code>属性的<code>@RequestMapping</code>的公共方法，并创建新类型的bean。</td>
</tr>
</tbody></table>
<p>您还可以定义使用<code>@ControllerAdvice</code>注释的类，以自定义要为特定控制器和/或异常类型返回的JSON文档，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@ControllerAdvice(basePackageClasses &#x3D; AcmeController.class)</span><br><span class="line">public class AcmeControllerAdvice extends ResponseEntityExceptionHandler &#123;</span><br><span class="line"></span><br><span class="line">	@ExceptionHandler(YourException.class)</span><br><span class="line">	@ResponseBody</span><br><span class="line">	ResponseEntity&lt;?&gt; handleControllerException(HttpServletRequest request, Throwable ex) &#123;</span><br><span class="line">		HttpStatus status &#x3D; getStatus(request);</span><br><span class="line">		return new ResponseEntity&lt;&gt;(new CustomErrorType(status.value(), ex.getMessage()), status);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	private HttpStatus getStatus(HttpServletRequest request) &#123;</span><br><span class="line">		Integer statusCode &#x3D; (Integer) request.getAttribute(&quot;javax.servlet.error.status_code&quot;);</span><br><span class="line">		if (statusCode &#x3D;&#x3D; null) &#123;</span><br><span class="line">			return HttpStatus.INTERNAL_SERVER_ERROR;</span><br><span class="line">		&#125;</span><br><span class="line">		return HttpStatus.valueOf(statusCode);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在前面的示例中，如果<code>YourException</code>在与<code>AcmeController</code>相同的包中定义的控制器抛出，则使用<code>CustomErrorType</code> POJO的JSON表示而不是<code>ErrorAttributes</code>表示。</p>
<h4 id="自定义错误页面"><a href="#自定义错误页面" class="headerlink" title="自定义错误页面"></a>自定义错误页面</h4><p>如果要显示给定状态代码的自定义HTML错误页面，可以将文件添加到<code>/error</code>文件夹。错误页面可以是静态HTML（即，添加到任何静态资源文件夹下），也可以使用模板构建。文件名应该是确切的状态代码或系列掩码。</p>
<p>例如，要将<code>404</code>映射到静态HTML文件，您的文件夹结构将如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">src&#x2F;</span><br><span class="line"> +- main&#x2F;</span><br><span class="line">     +- java&#x2F;</span><br><span class="line">     |   + &lt;source code&gt;</span><br><span class="line">     +- resources&#x2F;</span><br><span class="line">         +- public&#x2F;</span><br><span class="line">             +- error&#x2F;</span><br><span class="line">             |   +- 404.html</span><br><span class="line">             +- &lt;other public assets&gt;</span><br></pre></td></tr></table></figure>

<p>要使用FreeMarker模板映射所有<code>5xx</code>错误，您的文件夹结构如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">src&#x2F;</span><br><span class="line"> +- main&#x2F;</span><br><span class="line">     +- java&#x2F;</span><br><span class="line">     |   + &lt;source code&gt;</span><br><span class="line">     +- resources&#x2F;</span><br><span class="line">         +- templates&#x2F;</span><br><span class="line">             +- error&#x2F;</span><br><span class="line">             |   +- 5xx.ftl</span><br><span class="line">             +- &lt;other templates&gt;</span><br></pre></td></tr></table></figure>

<p>对于更复杂的映射，您还可以添加实现<code>ErrorViewResolver</code>接口的beans，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public class MyErrorViewResolver implements ErrorViewResolver &#123;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public ModelAndView resolveErrorView(HttpServletRequest request,</span><br><span class="line">			HttpStatus status, Map&lt;String, Object&gt; model) &#123;</span><br><span class="line">		&#x2F;&#x2F; Use the request or status to optionally return a ModelAndView</span><br><span class="line">		return ...</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>您还可以使用常规的Spring MVC功能，例如 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/web.html#mvc-exceptionhandlers"><code>@ExceptionHandler</code>方法</a>和 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/web.html#mvc-ann-controller-advice"><code>@ControllerAdvice</code></a>。<code>ErrorController</code>然后选择任何未处理的异常。</p>
<h4 id="将错误页面映射到Spring-MVC之外"><a href="#将错误页面映射到Spring-MVC之外" class="headerlink" title="将错误页面映射到Spring MVC之外"></a>将错误页面映射到Spring MVC之外</h4><p>对于不使用Spring MVC的应用程序，可以使用<code>ErrorPageRegistrar</code>接口直接注册<code>ErrorPages</code>。这种抽象直接与底层嵌入式servlet容器一起工作，即使你没有Spring MVC <code>DispatcherServlet</code>也可以工作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">public ErrorPageRegistrar errorPageRegistrar()&#123;</span><br><span class="line">	return new MyErrorPageRegistrar();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; ...</span><br><span class="line"></span><br><span class="line">private static class MyErrorPageRegistrar implements ErrorPageRegistrar &#123;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public void registerErrorPages(ErrorPageRegistry registry) &#123;</span><br><span class="line">		registry.addErrorPages(new ErrorPage(HttpStatus.BAD_REQUEST, &quot;&#x2F;400&quot;));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果你注册<code>ErrorPage</code>的路径最终由<code>Filter</code>处理（如某些非Spring网页框架，如Jersey和Wicket），那么<code>Filter</code>必须显式注册为<code>ERROR</code>调度程序，如以下示例所示：</td>
</tr>
</tbody></table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">public FilterRegistrationBean myFilter() &#123;</span><br><span class="line">	FilterRegistrationBean registration &#x3D; new FilterRegistrationBean();</span><br><span class="line">	registration.setFilter(new MyFilter());</span><br><span class="line">	...</span><br><span class="line">	registration.setDispatcherTypes(EnumSet.allOf(DispatcherType.class));</span><br><span class="line">	return registration;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>请注意，默认值<code>FilterRegistrationBean</code>不包括<code>ERROR</code>调度程序类型。</p>
<p>小心：当部署到servlet容器时，Spring Boot使用其错误页面过滤器将具有错误状态的请求转发到相应的错误页面。如果尚未提交响应，则只能将请求转发到正确的错误页面。缺省情况下，WebSphere Application Server 8.0及更高版本在成功完成servlet的服务方法后提交响应。您应该通过将<code>com.ibm.ws.webcontainer.invokeFlushAfterService</code>设置为<code>false</code>来禁用此行为。</p>
<h3 id="28-1-12-Spring-HATEOAS"><a href="#28-1-12-Spring-HATEOAS" class="headerlink" title="28.1.12 Spring HATEOAS"></a>28.1.12 Spring HATEOAS</h3><p>如果您开发使用超媒体的RESTful API，Spring Boot为Spring HATEOAS提供了适用于大多数应用程序的自动配置。自动配置取代了使用<code>@EnableHypermediaSupport</code>并注册多个beans以简化基于超媒体的应用程序的需求，包括<code>LinkDiscoverers</code>（用于客户端支持）和<code>ObjectMapper</code>配置为正确地将响应编组到所需的表示中。<code>ObjectMapper</code>是通过设置各种<code>spring.jackson.*</code>属性或（如果存在）<code>Jackson2ObjectMapperBuilder</code> bean来自定义的。</p>
<p>您可以使用<code>@EnableHypermediaSupport</code>控制Spring HATEOAS的配置。请注意，这样做会禁用前面描述的<code>ObjectMapper</code>自定义。</p>
<h3 id="28-1-13-CORS支持"><a href="#28-1-13-CORS支持" class="headerlink" title="28.1.13 CORS支持"></a>28.1.13 CORS支持</h3><p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Cross-origin_resource_sharing">跨源资源共享</a> （CORS）是<a target="_blank" rel="noopener" href="https://caniuse.com/#feat=cors">大多数浏览器</a>实现 的<a target="_blank" rel="noopener" href="https://www.w3.org/TR/cors/">W3C规范</a>，允许您以灵活的方式指定授权何种跨域请求，而不是使用一些不太安全且功能较弱的方法，如IFRAME或JSONP。</p>
<p>从版本4.2开始，Spring MVC <a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/web.html#cors">支持CORS</a>。 在Spring Boot应用程序中使用带有 注释的<a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/web.html#controller-method-cors-configuration">控制器方法CORS配置</a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/javadoc-api/org/springframework/web/bind/annotation/CrossOrigin.html"><code>@CrossOrigin</code></a>不需要任何特定配置。 可以通过使用自定义的<code>addCorsMappings(CorsRegistry)</code>方法注册<code>WebMvcConfigurer</code> bean来定义<a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/web.html#global-cors-configuration">全局CORS配置</a>，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class MyConfiguration &#123;</span><br><span class="line"></span><br><span class="line">	@Bean</span><br><span class="line">	public WebMvcConfigurer corsConfigurer() &#123;</span><br><span class="line">		return new WebMvcConfigurer() &#123;</span><br><span class="line">			@Override</span><br><span class="line">			public void addCorsMappings(CorsRegistry registry) &#123;</span><br><span class="line">				registry.addMapping(&quot;&#x2F;api&#x2F;**&quot;);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="28-2“Spring-WebFlux框架”"><a href="#28-2“Spring-WebFlux框架”" class="headerlink" title="28.2“Spring WebFlux框架”"></a>28.2“Spring WebFlux框架”</h2><p>Spring WebFlux是Spring Framework 5.0中引入的新的响应式Web框架。与Spring MVC不同，它不需要Servlet API，完全异步且无阻塞，并 通过<a target="_blank" rel="noopener" href="https://projectreactor.io/">Reactor项目</a>实现<a target="_blank" rel="noopener" href="http://www.reactive-streams.org/">Reactive Streams</a>规范。</p>
<p>Spring WebFlux有两种版本：功能和注释。基于注释的注释非常接近Spring MVC模型，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;&#x2F;users&quot;)</span><br><span class="line">public class MyRestController &#123;</span><br><span class="line"></span><br><span class="line">	@GetMapping(&quot;&#x2F;&#123;user&#125;&quot;)</span><br><span class="line">	public Mono&lt;User&gt; getUser(@PathVariable Long user) &#123;</span><br><span class="line">		&#x2F;&#x2F; ...</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@GetMapping(&quot;&#x2F;&#123;user&#125;&#x2F;customers&quot;)</span><br><span class="line">	public Flux&lt;Customer&gt; getUserCustomers(@PathVariable Long user) &#123;</span><br><span class="line">		&#x2F;&#x2F; ...</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@DeleteMapping(&quot;&#x2F;&#123;user&#125;&quot;)</span><br><span class="line">	public Mono&lt;User&gt; deleteUser(@PathVariable Long user) &#123;</span><br><span class="line">		&#x2F;&#x2F; ...</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>“WebFlux.fn”是功能变体，它将路由配置与请求的实际处理分开，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class RoutingConfiguration &#123;</span><br><span class="line"></span><br><span class="line">	@Bean</span><br><span class="line">	public RouterFunction&lt;ServerResponse&gt; monoRouterFunction(UserHandler userHandler) &#123;</span><br><span class="line">		return route(GET(&quot;&#x2F;&#123;user&#125;&quot;).and(accept(APPLICATION_JSON)), userHandler::getUser)</span><br><span class="line">				.andRoute(GET(&quot;&#x2F;&#123;user&#125;&#x2F;customers&quot;).and(accept(APPLICATION_JSON)), userHandler::getUserCustomers)</span><br><span class="line">				.andRoute(DELETE(&quot;&#x2F;&#123;user&#125;&quot;).and(accept(APPLICATION_JSON)), userHandler::deleteUser);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">public class UserHandler &#123;</span><br><span class="line"></span><br><span class="line">	public Mono&lt;ServerResponse&gt; getUser(ServerRequest request) &#123;</span><br><span class="line">		&#x2F;&#x2F; ...</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public Mono&lt;ServerResponse&gt; getUserCustomers(ServerRequest request) &#123;</span><br><span class="line">		&#x2F;&#x2F; ...</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public Mono&lt;ServerResponse&gt; deleteUser(ServerRequest request) &#123;</span><br><span class="line">		&#x2F;&#x2F; ...</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>WebFlux是Spring框架的一部分，详细信息可在其 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/web-reactive.html#webflux-fn">参考文档中找到</a>。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>您可以根据需要定义尽可能多的<code>RouterFunction</code> beans来模块化路由器的定义。如果您需要应用优先级，可以订购Beans。</td>
</tr>
</tbody></table>
<p>要开始使用，请将<code>spring-boot-starter-webflux</code>模块添加到您的应用程序中。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>在您的应用程序中添加<code>spring-boot-starter-web</code>和<code>spring-boot-starter-webflux</code>模块会导致Spring Boot自动配置Spring MVC，而不是WebFlux。选择此行为是因为许多Spring开发人员将<code>spring-boot-starter-webflux</code>添加到他们的Spring MVC应用程序以使用被动<code>WebClient</code>。您仍然可以通过将所选应用程序类型设置为<code>SpringApplication.setWebApplicationType(WebApplicationType.REACTIVE)</code>来强制执行您的选择。</td>
</tr>
</tbody></table>
<h3 id="28-2-1-Spring-WebFlux自动配置"><a href="#28-2-1-Spring-WebFlux自动配置" class="headerlink" title="28.2.1 Spring WebFlux自动配置"></a>28.2.1 Spring WebFlux自动配置</h3><p>Spring Boot为Spring WebFlux提供自动配置，适用于大多数应用程序。</p>
<p>自动配置在Spring的默认值之上添加了以下功能：</p>
<ul>
<li>为<code>HttpMessageReader</code>和<code>HttpMessageWriter</code>实例配置编解码器（ <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-webflux-httpcodecs">本文档后面会介绍</a>）。</li>
<li>支持提供静态资源，包括对WebJars的支持（ <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-spring-mvc-static-content">本文档后面将介绍</a>）。</li>
</ul>
<p>如果你想保留Spring Boot WebFlux功能，并且想要添加额外的 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/web.html#web-reactive">WebFlux配置</a>，你可以添加自己的<code>@Configuration</code>类<code>WebFluxConfigurer</code>但<strong>没有</strong> <code>@EnableWebFlux</code>。</p>
<p>如果您想完全控制Spring WebFlux，可以使用<code>@EnableWebFlux</code>添加自己的<code>@Configuration</code>注释。</p>
<h3 id="28-2-2带有HttpMessageReaders和HttpMessageWriters的HTTP编解码器"><a href="#28-2-2带有HttpMessageReaders和HttpMessageWriters的HTTP编解码器" class="headerlink" title="28.2.2带有HttpMessageReaders和HttpMessageWriters的HTTP编解码器"></a>28.2.2带有HttpMessageReaders和HttpMessageWriters的HTTP编解码器</h3><p>Spring WebFlux使用<code>HttpMessageReader</code>和<code>HttpMessageWriter</code>接口转换HTTP请求和响应。通过查看类路径中可用的库，它们配置为<code>CodecConfigurer</code>以具有合理的默认值。</p>
<p>Spring Boot通过使用<code>CodecCustomizer</code>实例进一步自定义。例如，<code>spring.jackson.*</code>配置密钥应用于Jackson编解码器。</p>
<p>如果需要添加或自定义编解码器，可以创建自定义<code>CodecCustomizer</code>组件，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.boot.web.codec.CodecCustomizer;</span><br><span class="line"></span><br><span class="line">@Configuration</span><br><span class="line">public class MyConfiguration &#123;</span><br><span class="line"></span><br><span class="line">	@Bean</span><br><span class="line">	public CodecCustomizer myCodecCustomizer() &#123;</span><br><span class="line">		return codecConfigurer -&gt; &#123;</span><br><span class="line">			&#x2F;&#x2F; ...</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>您还可以利用<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-json-components">Boot的自定义JSON序列化程序和反序列化程序</a>。</p>
<h3 id="28-2-3静态内容"><a href="#28-2-3静态内容" class="headerlink" title="28.2.3静态内容"></a>28.2.3静态内容</h3><p>默认情况下，Spring Boot从类路径中名为<code>/static</code>（或<code>/public</code>或<code>/resources</code>或<code>/META-INF/resources</code>）的目录中提供静态内容。它使用来自Spring WebFlux的<code>ResourceWebHandler</code>，以便您可以通过添加自己的<code>WebFluxConfigurer</code>并覆盖<code>addResourceHandlers</code>方法来修改该行为。</p>
<p>默认情况下，资源映射到<code>/**</code>，但您可以通过设置<code>spring.webflux.static-path-pattern</code>属性来调整它。例如，将所有资源重新定位到<code>/resources/**</code>可以实现如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.webflux.static-path-pattern&#x3D;&#x2F;resources&#x2F;**</span><br></pre></td></tr></table></figure>

<p>您还可以使用<code>spring.resources.static-locations</code>自定义静态资源位置。这样做会将默认值替换为目录位置列表。如果这样做，默认的欢迎页面检测会切换到您的自定义位置。因此，如果您在启动时的任何位置都有<code>index.html</code>，那么它就是应用程序的主页。</p>
<p>除了前面列出的“标准”静态资源位置之外，还为<a target="_blank" rel="noopener" href="https://www.webjars.org/">Webjars内容</a>制作了一个特例。如果文件以Webjars格式打包，那么具有<code>/webjars/**</code>中路径的任何资源都将从jar文件中提供。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>Spring WebFlux应用程序并不严格依赖于Servlet API，因此它们不能作为war文件部署，也不能使用<code>src/main/webapp</code>目录。</td>
</tr>
</tbody></table>
<h3 id="28-2-4模板引擎"><a href="#28-2-4模板引擎" class="headerlink" title="28.2.4模板引擎"></a>28.2.4模板引擎</h3><p>除REST Web服务外，您还可以使用Spring WebFlux来提供动态HTML内容。Spring WebFlux支持各种模板技术，包括Thymeleaf，FreeMarker和Mustache。</p>
<p>Spring Boot包括对以下模板引擎的自动配置支持：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://freemarker.apache.org/docs/">FreeMarker的</a></li>
<li><a target="_blank" rel="noopener" href="http://www.thymeleaf.org/">Thymeleaf</a></li>
<li><a target="_blank" rel="noopener" href="https://mustache.github.io/">胡子</a></li>
</ul>
<p>当您使用其中一个模板引擎和默认配置时，您的模板将从<code>src/main/resources/templates</code>自动获取。</p>
<h3 id="28-2-5错误处理"><a href="#28-2-5错误处理" class="headerlink" title="28.2.5错误处理"></a>28.2.5错误处理</h3><p>Spring Boot提供<code>WebExceptionHandler</code>以合理的方式处理所有错误。它在处理顺序中的位置紧接在WebFlux提供的处理程序之前，这被认为是最后的。对于计算机客户端，它会生成一个JSON响应，其中包含错误，HTTP状态和异常消息的详细信息。对于浏览器客户端，有一个“whitelabel”错误处理程序，它以HTML格式呈现相同的数据。您还可以提供自己的HTML模板来显示错误（请参阅 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-webflux-error-handling-custom-error-pages">下一节</a>）。</p>
<p>自定义此功能的第一步通常涉及使用现有机制，但替换或扩充错误内容。为此，您可以添加bean类型<code>ErrorAttributes</code>。</p>
<p>要更改错误处理行为，您可以实现<code>ErrorWebExceptionHandler</code>并注册该类型的bean定义。因为<code>WebExceptionHandler</code>非常低级，Spring Boot还提供了一个方便的<code>AbstractErrorWebExceptionHandler</code>来让你以WebFlux函数方式处理错误，如下例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public class CustomErrorWebExceptionHandler extends AbstractErrorWebExceptionHandler &#123;</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F; Define constructor here</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	protected RouterFunction&lt;ServerResponse&gt; getRoutingFunction(ErrorAttributes errorAttributes) &#123;</span><br><span class="line"></span><br><span class="line">		return RouterFunctions</span><br><span class="line">				.route(aPredicate, aHandler)</span><br><span class="line">				.andRoute(anotherPredicate, anotherHandler);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>要获得更完整的图片，您还可以直接继承<code>DefaultErrorWebExceptionHandler</code>并覆盖特定方法。</p>
<h4 id="自定义错误页面-1"><a href="#自定义错误页面-1" class="headerlink" title="自定义错误页面"></a>自定义错误页面</h4><p>如果要显示给定状态代码的自定义HTML错误页面，可以将文件添加到<code>/error</code>文件夹。错误页面可以是静态HTML（即，添加到任何静态资源文件夹下）或使用模板构建。文件名应该是确切的状态代码或系列掩码。</p>
<p>例如，要将<code>404</code>映射到静态HTML文件，您的文件夹结构将如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">src&#x2F;</span><br><span class="line"> +- main&#x2F;</span><br><span class="line">     +- java&#x2F;</span><br><span class="line">     |   + &lt;source code&gt;</span><br><span class="line">     +- resources&#x2F;</span><br><span class="line">         +- public&#x2F;</span><br><span class="line">             +- error&#x2F;</span><br><span class="line">             |   +- 404.html</span><br><span class="line">             +- &lt;other public assets&gt;</span><br></pre></td></tr></table></figure>

<p>要使用Mustache模板映射所有<code>5xx</code>错误，您的文件夹结构如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">src&#x2F;</span><br><span class="line"> +- main&#x2F;</span><br><span class="line">     +- java&#x2F;</span><br><span class="line">     |   + &lt;source code&gt;</span><br><span class="line">     +- resources&#x2F;</span><br><span class="line">         +- templates&#x2F;</span><br><span class="line">             +- error&#x2F;</span><br><span class="line">             |   +- 5xx.mustache</span><br><span class="line">             +- &lt;other templates&gt;</span><br></pre></td></tr></table></figure>

<h3 id="28-2-6-Web过滤器"><a href="#28-2-6-Web过滤器" class="headerlink" title="28.2.6 Web过滤器"></a>28.2.6 Web过滤器</h3><p>Spring WebFlux提供了一个<code>WebFilter</code>接口，可以实现过滤HTTP请求 - 响应交换。在应用程序上下文中找到的<code>WebFilter</code> beans将自动用于过滤每个交换。</p>
<p>如果过滤器的顺序很重要，则可以实现<code>Ordered</code>或使用<code>@Order</code>进行注释。Spring Boot自动配置可以为您配置Web过滤器。执行此操作时，将使用下表中显示的订单：</p>
<table>
<thead>
<tr>
<th>网络过滤器</th>
<th>订购</th>
</tr>
</thead>
<tbody><tr>
<td><code>MetricsWebFilter</code></td>
<td><code>Ordered.HIGHEST_PRECEDENCE + 1</code></td>
</tr>
<tr>
<td><code>WebFilterChainProxy</code> (Spring Security)</td>
<td><code>-100</code></td>
</tr>
<tr>
<td><code>HttpTraceWebFilter</code></td>
<td><code>Ordered.LOWEST_PRECEDENCE - 10</code></td>
</tr>
</tbody></table>
<h2 id="28-3-JAX-RS和Jersey"><a href="#28-3-JAX-RS和Jersey" class="headerlink" title="28.3 JAX-RS和Jersey"></a>28.3 JAX-RS和Jersey</h2><p>如果您更喜欢REST端点的JAX-RS编程模型，则可以使用其中一个可用的实现而不是Spring MVC。<a target="_blank" rel="noopener" href="https://jersey.github.io/">Jersey</a>和 <a target="_blank" rel="noopener" href="https://cxf.apache.org/">Apache CXF</a>开箱即用。CXF要求您在应用程序上下文中将<code>Servlet</code>或<code>Filter</code>注册为<code>@Bean</code>。Jersey具有一些本地Spring支持，因此我们还在Spring Boot中为其提供了自动配置支持以及启动器。</p>
<p>要开始使用Jersey，请将<code>spring-boot-starter-jersey</code>作为依赖项包含在内，然后需要一个<code>@Bean</code>类型<code>ResourceConfig</code>，在其中注册所有端点，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class JerseyConfig extends ResourceConfig &#123;</span><br><span class="line"></span><br><span class="line">	public JerseyConfig() &#123;</span><br><span class="line">		register(Endpoint.class);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/warning.png" alt="[警告]"></th>
</tr>
</thead>
<tbody><tr>
<td>Jersey对扫描可执行档案的支持相当有限。例如，它无法扫描<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#deployment-install">完全可执行jar文件</a>中的包中的端点，也无法在运行可执行war文件时扫描<code>WEB-INF/classes</code>中的端点。为避免此限制，不应使用<code>packages</code>方法，并且应使用<code>register</code>方法单独注册端点，如上例所示。</td>
</tr>
</tbody></table>
<p>对于更高级的自定义，您还可以注册实现<code>ResourceConfigCustomizer</code>的任意数量的beans。</p>
<p>所有已注册的端点都应为<code>@Components</code>，并带有HTTP资源注释（<code>@GET</code>和其他），如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">@Path(&quot;&#x2F;hello&quot;)</span><br><span class="line">public class Endpoint &#123;</span><br><span class="line"></span><br><span class="line">	@GET</span><br><span class="line">	public String message() &#123;</span><br><span class="line">		return &quot;Hello&quot;;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由于<code>Endpoint</code>是Spring <code>@Component</code>，其生命周期由Spring管理，您可以使用<code>@Autowired</code>注释注入依赖项并使用<code>@Value</code>注释注入外部组态。默认情况下，Jersey servlet已注册并映射到<code>/*</code>。您可以通过将<code>@ApplicationPath</code>添加到<code>ResourceConfig</code>来更改映射。</p>
<p>默认情况下，Jersey设置为名为<code>jerseyServletRegistration</code>的<code>ServletRegistrationBean</code>类型的<code>@Bean</code>中的Servlet。默认情况下，servlet是懒惰地初始化的，但您可以通过设置<code>spring.jersey.servlet.load-on-startup</code>来自定义该行为。您可以通过创建一个具有相同名称的自己来禁用或覆盖bean。您也可以通过设置<code>spring.jersey.type=filter</code>来使用过滤器而不是servlet（在这种情况下，要替换或覆盖的<code>@Bean</code>为<code>jerseyFilterRegistration</code>）。过滤器的<code>@Order</code>，您可以使用<code>spring.jersey.filter.order</code>进行设置。通过使用<code>spring.jersey.init.*</code>指定属性映射，可以为servlet和过滤器注册提供init参数。</p>
<p>有一个<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-samples/spring-boot-sample-jersey">Jersey样本，</a>以便您可以看到如何设置。</p>
<h2 id="28-4嵌入式Servlet容器支持"><a href="#28-4嵌入式Servlet容器支持" class="headerlink" title="28.4嵌入式Servlet容器支持"></a>28.4嵌入式Servlet容器支持</h2><p>Spring Boot包括对嵌入式<a target="_blank" rel="noopener" href="https://tomcat.apache.org/">Tomcat</a>， <a target="_blank" rel="noopener" href="https://www.eclipse.org/jetty/">Jetty</a>和<a target="_blank" rel="noopener" href="http://undertow.io/">Undertow</a>服务器的支持。大多数开发人员使用适当的“Starter”来获取完全配置的实例。默认情况下，嵌入式服务器侦听端口<code>8080</code>上的HTTP请求。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/warning.png" alt="[警告]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果您选择在<a target="_blank" rel="noopener" href="https://www.centos.org/">CentOS</a>上使用Tomcat ，请注意，默认情况下，临时目录用于存储已编译的JSP，文件上载等。当您的应用程序运行时，<code>tmpwatch</code>可能会删除此目录，从而导致失败。要避免此行为，您可能希望自定义<code>tmpwatch</code>配置，以便不删除<code>tomcat.*</code>目录或配置<code>server.tomcat.basedir</code>，以便嵌入式Tomcat使用不同的位置。</td>
</tr>
</tbody></table>
<h3 id="28-4-1-Servlet，过滤器和监听器"><a href="#28-4-1-Servlet，过滤器和监听器" class="headerlink" title="28.4.1 Servlet，过滤器和监听器"></a>28.4.1 Servlet，过滤器和监听器</h3><p>使用嵌入式servlet容器时，可以使用Spring beans或扫描Servlet组件，从Servlet规范中注册servlet，过滤器和所有侦听器（例如<code>HttpSessionListener</code>）。</p>
<h4 id="注册Servlet，过滤器和监听器Spring-Beans"><a href="#注册Servlet，过滤器和监听器Spring-Beans" class="headerlink" title="注册Servlet，过滤器和监听器Spring Beans"></a>注册Servlet，过滤器和监听器Spring Beans</h4><p>在嵌入式容器中注册了Spring bean的任何<code>Servlet</code>，<code>Filter</code>或servlet <code>*Listener</code>实例。如果要在配置期间引用<code>application.properties</code>中的值，这可能特别方便。</p>
<p>默认情况下，如果上下文仅包含一个Servlet，则它将映射到<code>/</code>。在多个servlet beans的情况下，bean名称用作路径前缀。过滤器映射到<code>/*</code>。</p>
<p>如果基于约定的映射不够灵活，您可以使用<code>ServletRegistrationBean</code>，<code>FilterRegistrationBean</code>和<code>ServletListenerRegistrationBean</code>类进行完全控制。</p>
<p>Spring Boot附带了许多可以定义Filter beans的自动配置。以下是过滤器及其各自顺序的一些示例（较低的顺序值表示较高的优先级）：</p>
<table>
<thead>
<tr>
<th>Servlet过滤器</th>
<th>订购</th>
</tr>
</thead>
<tbody><tr>
<td><code>OrderedCharacterEncodingFilter</code></td>
<td><code>Ordered.HIGHEST_PRECEDENCE</code></td>
</tr>
<tr>
<td><code>WebMvcMetricsFilter</code></td>
<td><code>Ordered.HIGHEST_PRECEDENCE + 1</code></td>
</tr>
<tr>
<td><code>ErrorPageFilter</code></td>
<td><code>Ordered.HIGHEST_PRECEDENCE + 1</code></td>
</tr>
<tr>
<td><code>HttpTraceFilter</code></td>
<td><code>Ordered.LOWEST_PRECEDENCE - 10</code></td>
</tr>
</tbody></table>
<p>将Filter beans无序放置通常是安全的。</p>
<p>如果需要特定订单，则应避免在<code>Ordered.HIGHEST_PRECEDENCE</code>处配置读取请求正文的筛选器，因为它可能违反应用程序的字符编码配置。如果Servlet过滤器包装请求，则应使用小于或等于<code>OrderedFilter.REQUEST_WRAPPER_FILTER_MAX_ORDER</code>的顺序进行配置。</p>
<h3 id="28-4-2-Servlet上下文初始化"><a href="#28-4-2-Servlet上下文初始化" class="headerlink" title="28.4.2 Servlet上下文初始化"></a>28.4.2 Servlet上下文初始化</h3><p>嵌入式servlet容器不直接执行Servlet 3.0+ <code>javax.servlet.ServletContainerInitializer</code>接口或Spring的<code>org.springframework.web.WebApplicationInitializer</code>接口。这是一项有意的设计决策，旨在降低设计在战争中运行的第三方图书馆可能会破坏Spring Boot应用程序的风险。</p>
<p>如果需要在Spring Boot应用程序中执行servlet上下文初始化，则应注册实现<code>org.springframework.boot.web.servlet.ServletContextInitializer</code>接口的bean。单<code>onStartup</code>方法提供对<code>ServletContext</code>的访问，如果需要，可以很容易地用作现有<code>WebApplicationInitializer</code>的适配器。</p>
<h4 id="扫描Servlet，过滤器和侦听器"><a href="#扫描Servlet，过滤器和侦听器" class="headerlink" title="扫描Servlet，过滤器和侦听器"></a>扫描Servlet，过滤器和侦听器</h4><p>使用嵌入式容器时，可以使用<code>@ServletComponentScan</code>启用使用<code>@WebServlet</code>，<code>@WebFilter</code>和<code>@WebListener</code>注释的类的自动注册。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td><code>@ServletComponentScan</code>对独立容器没有影响，其中使用容器的内置发现机制。</td>
</tr>
</tbody></table>
<h3 id="28-4-3-ServletWebServerApplicationContext"><a href="#28-4-3-ServletWebServerApplicationContext" class="headerlink" title="28.4.3 ServletWebServerApplicationContext"></a>28.4.3 ServletWebServerApplicationContext</h3><p>在引擎盖下，Spring Boot使用不同类型的<code>ApplicationContext</code>来支持嵌入式servlet容器。<code>ServletWebServerApplicationContext</code>是<code>WebApplicationContext</code>的一种特殊类型，它通过搜索单个<code>ServletWebServerFactory</code> bean来引导自己。通常会自动配置<code>TomcatServletWebServerFactory</code>，<code>JettyServletWebServerFactory</code>或<code>UndertowServletWebServerFactory</code>。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>您通常不需要了解这些实现类。大多数应用程序都是自动配置的，并且代表您创建了相应的<code>ApplicationContext</code>和<code>ServletWebServerFactory</code>。</td>
</tr>
</tbody></table>
<h3 id="28-4-4自定义嵌入式Servlet容器"><a href="#28-4-4自定义嵌入式Servlet容器" class="headerlink" title="28.4.4自定义嵌入式Servlet容器"></a>28.4.4自定义嵌入式Servlet容器</h3><p>可以使用Spring <code>Environment</code>属性配置公共servlet容器设置。通常，您将在<code>application.properties</code>文件中定义属性。</p>
<p>常用服务器设置包括：</p>
<ul>
<li>网络设置：侦听传入HTTP请求的端口（<code>server.port</code>），绑定到<code>server.address</code>的接口地址，依此类推。</li>
<li>会话设置：会话是持久的（<code>server.servlet.session.persistence</code>），会话超时（<code>server.servlet.session.timeout</code>），会话数据的位置（<code>server.servlet.session.store-dir</code>）和会话cookie配置（<code>server.servlet.session.cookie.*</code>）。</li>
<li>错误管理：错误页面的位置（<code>server.error.path</code>）等。</li>
<li><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#howto-configure-ssl">SSL</a></li>
<li><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#how-to-enable-http-response-compression">HTTP压缩</a></li>
</ul>
<p>Spring Boot尝试尽可能多地暴露常见设置，但这并非总是可行。对于这些情况，专用命名空间提供特定于服务器的自定义（请参阅<code>server.tomcat</code>和<code>server.undertow</code>）。例如， 可以使用嵌入式servlet容器的特定功能配置<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#howto-configure-accesslogs">访问日志</a>。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>请参阅 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/ServerProperties.java"><code>ServerProperties</code></a>课程以获取完整列表。</td>
</tr>
</tbody></table>
<h4 id="程序化定制"><a href="#程序化定制" class="headerlink" title="程序化定制"></a>程序化定制</h4><p>如果需要以编程方式配置嵌入式servlet容器，可以注册实现<code>WebServerFactoryCustomizer</code>接口的Spring bean。<code>WebServerFactoryCustomizer</code>提供对<code>ConfigurableServletWebServerFactory</code>的访问，其中包括许多自定义setter方法。以下示例以编程方式设置端口：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.boot.web.server.WebServerFactoryCustomizer;</span><br><span class="line">import org.springframework.boot.web.servlet.server.ConfigurableServletWebServerFactory;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">public class CustomizationBean implements WebServerFactoryCustomizer&lt;ConfigurableServletWebServerFactory&gt; &#123;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public void customize(ConfigurableServletWebServerFactory server) &#123;</span><br><span class="line">		server.setPort(9000);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td><code>TomcatServletWebServerFactory</code>，<code>JettyServletWebServerFactory</code>和<code>UndertowServletWebServerFactory</code>是<code>ConfigurableServletWebServerFactory</code>的专用变体，分别为Tomcat，Jetty和Undertow提供了额外的自定义setter方法。</td>
</tr>
</tbody></table>
<h4 id="直接自定义ConfigurableServletWebServerFactory"><a href="#直接自定义ConfigurableServletWebServerFactory" class="headerlink" title="直接自定义ConfigurableServletWebServerFactory"></a>直接自定义ConfigurableServletWebServerFactory</h4><p>如果前面的自定义技术太有限，您可以自己注册<code>TomcatServletWebServerFactory</code>，<code>JettyServletWebServerFactory</code>或<code>UndertowServletWebServerFactory</code> bean。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">public ConfigurableServletWebServerFactory webServerFactory() &#123;</span><br><span class="line">	TomcatServletWebServerFactory factory &#x3D; new TomcatServletWebServerFactory();</span><br><span class="line">	factory.setPort(9000);</span><br><span class="line">	factory.setSessionTimeout(10, TimeUnit.MINUTES);</span><br><span class="line">	factory.addErrorPages(new ErrorPage(HttpStatus.NOT_FOUND, &quot;&#x2F;notfound.html&quot;));</span><br><span class="line">	return factory;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>为许多配置选项提供了Setter。如果您需要做一些更具异国情调的事情，还会提供一些受保护的方法“挂钩”。有关详细信息，请参阅 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/web/servlet/server/ConfigurableServletWebServerFactory.html">源代码文档</a>。</p>
<h3 id="28-4-5-JSP限制"><a href="#28-4-5-JSP限制" class="headerlink" title="28.4.5 JSP限制"></a>28.4.5 JSP限制</h3><p>运行使用嵌入式servlet容器的Spring Boot应用程序（并打包为可执行存档）时，JSP支持存在一些限制。</p>
<ul>
<li>使用Jetty和Tomcat，如果使用war包装，它应该可以工作。使用<code>java -jar</code>启动时，可执行战争将起作用，并且还可以部署到任何标准容器。使用可执行jar时不支持JSP。</li>
<li>Undertow不支持JSP。</li>
<li>创建自定义<code>error.jsp</code>页面不会覆盖<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-error-handling">错误处理</a>的默认视图 。 应该使用<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-error-handling-custom-error-pages">自定义错误页面</a>。</li>
</ul>
<p>有一个<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-samples/spring-boot-sample-web-jsp">JSP示例，</a>以便您可以看到如何设置。</p>
<h2 id="28-5嵌入式Reactive-Server支持"><a href="#28-5嵌入式Reactive-Server支持" class="headerlink" title="28.5嵌入式Reactive Server支持"></a>28.5嵌入式Reactive Server支持</h2><p>Spring Boot包括对以下嵌入式响应式Web服务器的支持：Reactor Netty，Tomcat，Jetty和Undertow。大多数开发人员使用适当的“Starter”来获取完全配置的实例。默认情况下，嵌入式服务器在端口8080上侦听HTTP请求。</p>
<h2 id="28-6-Reactive-Server资源配置"><a href="#28-6-Reactive-Server资源配置" class="headerlink" title="28.6 Reactive Server资源配置"></a>28.6 Reactive Server资源配置</h2><p>在自动配置Reactor Netty或Jetty服务器时，Spring Boot将创建特定的beans，它将为服务器实例提供HTTP资源：<code>ReactorResourceFactory</code>或<code>JettyResourceFactory</code>。</p>
<p>默认情况下，这些资源也将与Reactor Netty和Jetty客户端共享以获得最佳性能，具体如下：</p>
<ul>
<li>相同的技术用于服务器和客户端</li>
<li>客户端实例使用由Spring Boot自动配置的<code>WebClient.Builder</code> bean构建</li>
</ul>
<p>开发人员可以通过提供自定义<code>ReactorResourceFactory</code>或<code>JettyResourceFactory</code> bean覆盖Jetty和Reactor Netty的资源配置 - 这将应用于客户端和服务器。</p>
<p>您可以在<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-webclient-runtime">WebClient Runtime部分中</a>了解有关客户端资源配置的更多信息 。</p>
<h2 id="29-安全"><a href="#29-安全" class="headerlink" title="29.安全"></a>29.安全</h2><p>如果<a target="_blank" rel="noopener" href="https://projects.spring.io/spring-security/">Spring安全</a>性在类路径上，则默认情况下Web应用程序是安全的。Spring Boot依赖于Spring安全性的内容协商策略来确定是使用<code>httpBasic</code>还是<code>formLogin</code>。要向Web应用程序添加方法级安全性，您还可以使用所需设置添加<code>@EnableGlobalMethodSecurity</code>。其他信息可在 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-security/site/docs/5.1.2.RELEASE/reference/htmlsingle#jc-method">Spring安全参考指南中找到</a>。</p>
<p>默认<code>UserDetailsService</code>只有一个用户。用户名为<code>user</code>，密码是随机的，在应用程序启动时以INFO级别打印，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Using generated security password: 78fa095d-3f4c-48b1-ad50-e24c31d5cf35</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果您对日志记录配置进行微调，请确保将<code>org.springframework.boot.autoconfigure.security</code>类别设置为记录<code>INFO</code>级别的消息。否则，不会打印默认密码。</td>
</tr>
</tbody></table>
<p>您可以通过提供<code>spring.security.user.name</code>和<code>spring.security.user.password</code>来更改用户名和密码。</p>
<p>您在Web应用程序中默认获得的基本功能包括：</p>
<ul>
<li><code>UserDetailsService</code>（对于WebFlux应用程序，为<code>ReactiveUserDetailsService</code>）bean具有内存存储，单个用户具有生成的密码（请参阅 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/security/SecurityProperties.User.html"><code>SecurityProperties.User</code></a> 用户的属性）。</li>
<li>基于表单的登录或HTTP基本安全性（取决于Content-Type），用于整个应用程序（如果执行器在类路径上，则包括执行器端点）。</li>
<li>用于发布身份验证事件的<code>DefaultAuthenticationEventPublisher</code>。</li>
</ul>
<p>您可以为其添加bean来提供不同的<code>AuthenticationEventPublisher</code>。</p>
<h2 id="29-1-MVC安全性"><a href="#29-1-MVC安全性" class="headerlink" title="29.1 MVC安全性"></a>29.1 MVC安全性</h2><p>默认安全配置在<code>SecurityAutoConfiguration</code>和<code>UserDetailsServiceAutoConfiguration</code>中实现。<code>SecurityAutoConfiguration</code>导入用于Web安全的<code>SpringBootWebSecurityConfiguration</code>和用于配置身份验证的<code>UserDetailsServiceAutoConfiguration</code>，这在非Web应用程序中也是相关的。要完全关闭默认Web应用程序安全配置，您可以添加bean类型<code>WebSecurityConfigurerAdapter</code>（这样做不会禁用<code>UserDetailsService</code>配置或Actuator的安全性）。</p>
<p>要同时关闭<code>UserDetailsService</code>配置，您可以添加bean类型<code>UserDetailsService</code>，<code>AuthenticationProvider</code>或<code>AuthenticationManager</code>。<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-samples/">Spring Boot示例中</a>有几个安全应用程序可以帮助您开始使用常见用例。</p>
<p>可以通过添加自定义<code>WebSecurityConfigurerAdapter</code>来覆盖访问规则。Spring Boot提供了便捷方法，可用于覆盖执行器端点和静态资源的访问规则。<code>EndpointRequest</code>可用于创建基于<code>management.endpoints.web.base-path</code>属性的<code>RequestMatcher</code>。<code>PathRequest</code>可用于为常用位置的资源创建<code>RequestMatcher</code>。</p>
<h2 id="29-2-WebFlux安全性"><a href="#29-2-WebFlux安全性" class="headerlink" title="29.2 WebFlux安全性"></a>29.2 WebFlux安全性</h2><p>与Spring MVC应用程序类似，您可以通过添加<code>spring-boot-starter-security</code>依赖项来保护WebFlux应用程序。默认安全配置在<code>ReactiveSecurityAutoConfiguration</code>和<code>UserDetailsServiceAutoConfiguration</code>中实现。<code>ReactiveSecurityAutoConfiguration</code>导入用于Web安全的<code>WebFluxSecurityConfiguration</code>和用于配置身份验证的<code>UserDetailsServiceAutoConfiguration</code>，这在非Web应用程序中也是相关的。要完全关闭默认Web应用程序安全配置，您可以添加bean类型<code>WebFilterChainProxy</code>（这样做不会禁用<code>UserDetailsService</code>配置或执行器的安全性）。</p>
<p>要同时关闭<code>UserDetailsService</code>配置，您可以添加bean类型<code>ReactiveUserDetailsService</code>或<code>ReactiveAuthenticationManager</code>。</p>
<p>可以通过添加自定义<code>SecurityWebFilterChain</code>来配置访问规则。Spring Boot提供了便捷方法，可用于覆盖执行器端点和静态资源的访问规则。<code>EndpointRequest</code>可用于创建基于<code>management.endpoints.web.base-path</code>属性的<code>ServerWebExchangeMatcher</code>。</p>
<p><code>PathRequest</code>可用于为常用位置的资源创建<code>ServerWebExchangeMatcher</code>。</p>
<p>例如，您可以通过添加以下内容来自定义安全配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">public SecurityWebFilterChain springSecurityFilterChain(ServerHttpSecurity http) &#123;</span><br><span class="line">	return http</span><br><span class="line">		.authorizeExchange()</span><br><span class="line">			.matchers(PathRequest.toStaticResources().atCommonLocations()).permitAll()</span><br><span class="line">			.pathMatchers(&quot;&#x2F;foo&quot;, &quot;&#x2F;bar&quot;)</span><br><span class="line">				.authenticated().and()</span><br><span class="line">			.formLogin().and()</span><br><span class="line">		.build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="29-3-OAuth2"><a href="#29-3-OAuth2" class="headerlink" title="29.3 OAuth2"></a>29.3 OAuth2</h2><p><a target="_blank" rel="noopener" href="https://oauth.net/2/">OAuth2</a>是Spring支持的广泛使用的授权框架。</p>
<h3 id="29-3-1客户"><a href="#29-3-1客户" class="headerlink" title="29.3.1客户"></a>29.3.1客户</h3><p>如果您的类路径上有<code>spring-security-oauth2-client</code>，则可以利用一些自动配置来轻松设置OAuth2 / Open ID Connect客户端。此配置使用<code>OAuth2ClientProperties</code>下的属性。相同的属性适用于servlet和反应应用程序。</p>
<p>您可以在<code>spring.security.oauth2.client</code>前缀下注册多个OAuth2客户端和提供商，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">spring.security.oauth2.client.registration.my-client-1.client-id&#x3D;abcd</span><br><span class="line">spring.security.oauth2.client.registration.my-client-1.client-secret&#x3D;password</span><br><span class="line">spring.security.oauth2.client.registration.my-client-1.client-name&#x3D;Client for user scope</span><br><span class="line">spring.security.oauth2.client.registration.my-client-1.provider&#x3D;my-oauth-provider</span><br><span class="line">spring.security.oauth2.client.registration.my-client-1.scope&#x3D;user</span><br><span class="line">spring.security.oauth2.client.registration.my-client-1.redirect-uri-template&#x3D;http:&#x2F;&#x2F;my-redirect-uri.com</span><br><span class="line">spring.security.oauth2.client.registration.my-client-1.client-authentication-method&#x3D;basic</span><br><span class="line">spring.security.oauth2.client.registration.my-client-1.authorization-grant-type&#x3D;authorization_code</span><br><span class="line"></span><br><span class="line">spring.security.oauth2.client.registration.my-client-2.client-id&#x3D;abcd</span><br><span class="line">spring.security.oauth2.client.registration.my-client-2.client-secret&#x3D;password</span><br><span class="line">spring.security.oauth2.client.registration.my-client-2.client-name&#x3D;Client for email scope</span><br><span class="line">spring.security.oauth2.client.registration.my-client-2.provider&#x3D;my-oauth-provider</span><br><span class="line">spring.security.oauth2.client.registration.my-client-2.scope&#x3D;email</span><br><span class="line">spring.security.oauth2.client.registration.my-client-2.redirect-uri-template&#x3D;http:&#x2F;&#x2F;my-redirect-uri.com</span><br><span class="line">spring.security.oauth2.client.registration.my-client-2.client-authentication-method&#x3D;basic</span><br><span class="line">spring.security.oauth2.client.registration.my-client-2.authorization-grant-type&#x3D;authorization_code</span><br><span class="line"></span><br><span class="line">spring.security.oauth2.client.provider.my-oauth-provider.authorization-uri&#x3D;http:&#x2F;&#x2F;my-auth-server&#x2F;oauth&#x2F;authorize</span><br><span class="line">spring.security.oauth2.client.provider.my-oauth-provider.token-uri&#x3D;http:&#x2F;&#x2F;my-auth-server&#x2F;oauth&#x2F;token</span><br><span class="line">spring.security.oauth2.client.provider.my-oauth-provider.user-info-uri&#x3D;http:&#x2F;&#x2F;my-auth-server&#x2F;userinfo</span><br><span class="line">spring.security.oauth2.client.provider.my-oauth-provider.user-info-authentication-method&#x3D;header</span><br><span class="line">spring.security.oauth2.client.provider.my-oauth-provider.jwk-set-uri&#x3D;http:&#x2F;&#x2F;my-auth-server&#x2F;token_keys</span><br><span class="line">spring.security.oauth2.client.provider.my-oauth-provider.user-name-attribute&#x3D;name</span><br></pre></td></tr></table></figure>

<p>对于支持<a target="_blank" rel="noopener" href="https://openid.net/specs/openid-connect-discovery-1_0.html">OpenID Connect发现的</a> OpenID Connect提供程序，可以进一步简化配置。提供程序需要配置<code>issuer-uri</code>，这是它声明为其颁发者标识符的URI。例如，如果提供的<code>issuer-uri</code>为“<a target="_blank" rel="noopener" href="https://example.com”,则会将`openid/">https://example.com”，则会将`OpenID</a> Provider Configuration Request<code>设置为“https://example.com/.well-known/openid-configuration”。结果预计为</code>OpenID Provider Configuration Response<code>。以下示例显示如何使用</code>issuer-uri`配置OpenID Connect Provider：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.security.oauth2.client.provider.oidc-provider.issuer-uri&#x3D;https:&#x2F;&#x2F;dev-123456.oktapreview.com&#x2F;oauth2&#x2F;default&#x2F;</span><br></pre></td></tr></table></figure>

<p>默认情况下，Spring安全性<code>OAuth2LoginAuthenticationFilter</code>仅处理与<code>/login/oauth2/code/*</code>匹配的网址。如果要自定义<code>redirect-uri</code>以使用其他模式，则需要提供配置以处理该自定义模式。例如，对于servlet应用程序，您可以添加类似于以下内容的<code>WebSecurityConfigurerAdapter</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public class OAuth2LoginSecurityConfig extends WebSecurityConfigurerAdapter &#123;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	protected void configure(HttpSecurity http) throws Exception &#123;</span><br><span class="line">		http</span><br><span class="line">			.authorizeRequests()</span><br><span class="line">				.anyRequest().authenticated()</span><br><span class="line">				.and()</span><br><span class="line">			.oauth2Login()</span><br><span class="line">				.redirectionEndpoint()</span><br><span class="line">					.baseUri(&quot;&#x2F;custom-callback&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="OAuth2共同提供者的客户注册"><a href="#OAuth2共同提供者的客户注册" class="headerlink" title="OAuth2共同提供者的客户注册"></a>OAuth2共同提供者的客户注册</h4><p>对于常见的OAuth2和OpenID提供商，包括Google，Github，Facebook和Okta，我们提供了一组提供商默认值（分别为<code>google</code>，<code>github</code>，<code>facebook</code>和<code>okta</code> ）。</p>
<p>如果您不需要自定义这些提供程序，则可以将<code>provider</code>属性设置为您需要推断默认值的属性。此外，如果客户端注册的密钥与默认支持的提供者匹配，则Spring Boot也会推断出。</p>
<p>换句话说，以下示例中的两个配置使用Google提供程序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">spring.security.oauth2.client.registration.my-client.client-id&#x3D;abcd</span><br><span class="line">spring.security.oauth2.client.registration.my-client.client-secret&#x3D;password</span><br><span class="line">spring.security.oauth2.client.registration.my-client.provider&#x3D;google</span><br><span class="line"></span><br><span class="line">spring.security.oauth2.client.registration.google.client-id&#x3D;abcd</span><br><span class="line">spring.security.oauth2.client.registration.google.client-secret&#x3D;password</span><br></pre></td></tr></table></figure>

<h3 id="29-3-2资源服务器"><a href="#29-3-2资源服务器" class="headerlink" title="29.3.2资源服务器"></a>29.3.2资源服务器</h3><p>如果类路径上有<code>spring-security-oauth2-resource-server</code>，只要指定了JWK Set URI或OIDC Issuer URI，Spring Boot就可以设置OAuth2资源服务器，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.security.oauth2.resourceserver.jwt.jwk-set-uri&#x3D;https:&#x2F;&#x2F;example.com&#x2F;oauth2&#x2F;default&#x2F;v1&#x2F;keys</span><br><span class="line">spring.security.oauth2.resourceserver.jwt.issuer-uri&#x3D;https:&#x2F;&#x2F;dev-123456.oktapreview.com&#x2F;oauth2&#x2F;default&#x2F;</span><br></pre></td></tr></table></figure>

<p>相同的属性适用于servlet和反应应用程序。</p>
<p>或者，您可以为servlet应用程序定义自己的<code>JwtDecoder</code> bean，或者为响应式应用程序定义<code>ReactiveJwtDecoder</code>。</p>
<h3 id="29-3-3授权服务器"><a href="#29-3-3授权服务器" class="headerlink" title="29.3.3授权服务器"></a>29.3.3授权服务器</h3><p>目前，Spring安全性不支持实施OAuth 2.0授权服务器。但是，此功能可从<a target="_blank" rel="noopener" href="https://projects.spring.io/spring-security-oauth/">Spring安全OAuth</a>项目获得，该项目最终将完全被Spring安全性取代。在此之前，您可以使用<code>spring-security-oauth2-autoconfigure</code>模块轻松设置OAuth 2.0授权服务器; 请参阅其<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-security-oauth2-boot">文档</a>以获取说明</p>
<h2 id="29-4执行器安全性"><a href="#29-4执行器安全性" class="headerlink" title="29.4执行器安全性"></a>29.4执行器安全性</h2><p>出于安全考虑，默认情况下禁用<code>/health</code>和<code>/info</code>以外的所有执行器。<code>management.endpoints.web.exposure.include</code>属性可用于启用执行器。</p>
<p>如果Spring安全性在类路径上且没有其他WebSecurityConfigurerAdapter存在，则<code>/health</code>和<code>/info</code>以外的所有执行器都由Spring Boot自动配置保护。如果您定义自定义<code>WebSecurityConfigurerAdapter</code>，则Spring Boot自动配置将退回，您将完全控制执行器访问规则。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>在设置<code>management.endpoints.web.exposure.include</code>之前，请确保暴露的执行器不包含敏感信息和/或通过将它们放在防火墙后面或通过Spring安全性等方式进行保护。</td>
</tr>
</tbody></table>
<h3 id="29-4-1跨站点请求伪造保护"><a href="#29-4-1跨站点请求伪造保护" class="headerlink" title="29.4.1跨站点请求伪造保护"></a>29.4.1跨站点请求伪造保护</h3><p>由于Spring Boot依赖于Spring安全性的默认值，因此默认情况下会启用CSRF保护。这意味着当使用默认安全配置时，需要<code>POST</code>（关闭和记录器端点），<code>PUT</code>或<code>DELETE</code>的执行器端点将获得403禁止错误。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>我们建议仅在创建非浏览器客户端使用的服务时才完全禁用CSRF保护。</td>
</tr>
</tbody></table>
<p>有关CSRF保护的其他信息，请参阅 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-security/site/docs/5.1.2.RELEASE/reference/htmlsingle#csrf">Spring安全参考指南</a>。</p>
<h2 id="30-使用SQL数据库"><a href="#30-使用SQL数据库" class="headerlink" title="30.使用SQL数据库"></a>30.使用SQL数据库</h2><p>在<a target="_blank" rel="noopener" href="https://projects.spring.io/spring-framework/">Spring框架</a>提供用于使用<code>JdbcTemplate</code>完成“对象关系映射”的技术，如休眠使用SQL数据库，从直接JDBC访问广泛的支持。<a target="_blank" rel="noopener" href="https://projects.spring.io/spring-data/">Spring数据</a>提供了更多级别的功能：直接从接口创建<code>Repository</code>实现，并使用约定从方法名称生成查询。</p>
<h2 id="30-1配置数据源"><a href="#30-1配置数据源" class="headerlink" title="30.1配置数据源"></a>30.1配置数据源</h2><p>Java的<code>javax.sql.DataSource</code>接口提供了一种使用数据库连接的标准方法。传统上，’DataSource’使用<code>URL</code>以及一些凭据来建立数据库连接。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>有关更多高级示例，请参阅<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#howto-configure-a-datasource">“操作方法”部分</a>，通常是为了完全控制DataSource的配置。</td>
</tr>
</tbody></table>
<h3 id="30-1-1嵌入式数据库支持"><a href="#30-1-1嵌入式数据库支持" class="headerlink" title="30.1.1嵌入式数据库支持"></a>30.1.1嵌入式数据库支持</h3><p>通过使用内存中嵌入式数据库来开发应用程序通常很方便。显然，内存数据库不提供持久存储。您需要在应用程序启动时填充数据库，并准备在应用程序结束时丢弃数据。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>“操作方法”部分包含<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#howto-database-initialization">有关如何初始化数据库的部分</a>。</td>
</tr>
</tbody></table>
<p>Spring Boot可以自动配置嵌入式<a target="_blank" rel="noopener" href="http://www.h2database.com/">H2</a>， <a target="_blank" rel="noopener" href="http://hsqldb.org/">HSQL</a>和<a target="_blank" rel="noopener" href="https://db.apache.org/derby/">Derby</a>数据库。您无需提供任何连接URL。您只需要包含要使用的嵌入式数据库的构建依赖项。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果您在测试中使用此功能，您可能会注意到整个测试套件都会重复使用相同的数据库，无论您使用的应用程序上下文的数量如何。如果要确保每个上下文都有一个单独的嵌入式数据库，则应将<code>spring.datasource.generate-unique-name</code>设置为<code>true</code>。</td>
</tr>
</tbody></table>
<p>例如，典型的POM依赖关系如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-boot-starter-data-jpa&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.hsqldb&lt;&#x2F;groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;hsqldb&lt;&#x2F;artifactId&gt;</span><br><span class="line">	&lt;scope&gt;runtime&lt;&#x2F;scope&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>您需要依赖<code>spring-jdbc</code>才能自动配置嵌入式数据库。在这个例子中，它通过<code>spring-boot-starter-data-jpa</code>传递。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果由于某种原因，您确实为嵌入式数据库配置了连接URL，请注意确保禁用数据库的自动关闭。如果您使用H2，则应使用<code>DB_CLOSE_ON_EXIT=FALSE</code>来执行此操作。如果使用HSQLDB，则应确保未使用<code>shutdown=true</code>。禁用数据库的自动关闭允许Spring Boot控制数据库何时关闭，从而确保在不再需要访问数据库时发生这种情况。</td>
</tr>
</tbody></table>
<h3 id="30-1-2连接到生产数据库"><a href="#30-1-2连接到生产数据库" class="headerlink" title="30.1.2连接到生产数据库"></a>30.1.2连接到生产数据库</h3><p>也可以使用池<code>DataSource</code>自动配置生产数据库连接。Spring Boot使用以下算法选择特定实现：</p>
<ol>
<li>我们更喜欢<a target="_blank" rel="noopener" href="https://github.com/brettwooldridge/HikariCP">HikariCP</a>的性能和并发性。如果HikariCP可用，我们总是选择它。</li>
<li>否则，如果Tomcat池<code>DataSource</code>可用，我们将使用它。</li>
<li>如果HikariCP和Tomcat池化数据源都不可用，并且 <a target="_blank" rel="noopener" href="https://commons.apache.org/proper/commons-dbcp/">Commons DBCP2</a>可用，我们就会使用它。</li>
</ol>
<p>如果您使用<code>spring-boot-starter-jdbc</code>或<code>spring-boot-starter-data-jpa</code>“starters”，则会自动获得<code>HikariCP</code>的依赖关系。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>您可以完全绕过该算法，并通过设置<code>spring.datasource.type</code>属性指定要使用的连接池。如果您在Tomcat容器中运行应用程序，这一点尤为重要，因为默认情况下会提供<code>tomcat-jdbc</code>。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>始终可以手动配置其他连接池。如果您定义自己的<code>DataSource</code> bean，则不会进行自动配置。</td>
</tr>
</tbody></table>
<p>DataSource配置由<code>spring.datasource.*</code>中的外部配置属性控制。例如，您可以在<code>application.properties</code>中声明以下部分：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">spring.datasource.url&#x3D;jdbc:mysql:&#x2F;&#x2F;localhost&#x2F;test</span><br><span class="line">spring.datasource.username&#x3D;dbuser</span><br><span class="line">spring.datasource.password&#x3D;dbpass</span><br><span class="line">spring.datasource.driver-class-name&#x3D;com.mysql.jdbc.Driver</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>您至少应该通过设置<code>spring.datasource.url</code>属性来指定URL。否则，Spring Boot会尝试自动配置嵌入式数据库。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>您通常不需要指定<code>driver-class-name</code>，因为Spring Boot可以从<code>url</code>中为大多数数据库推断出它。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>对于要创建的池<code>DataSource</code>，我们需要能够验证有效的<code>Driver</code>类是否可用，因此我们在执行任何操作之前检查它。换句话说，如果设置<code>spring.datasource.driver-class-name=com.mysql.jdbc.Driver</code>，那么该类必须是可加载的。</td>
</tr>
</tbody></table>
<p>有关<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jdbc/DataSourceProperties.java"><code>DataSourceProperties</code></a> 更多支持的选项，请参阅 。无论实际实施如何，这些都是标准选项。还可以使用各自的前缀（<code>spring.datasource.hikari.*</code>，<code>spring.datasource.tomcat.*</code>和<code>spring.datasource.dbcp2.*</code>）来微调特定于实现的设置。有关更多详细信息，请参阅您正在使用的连接池实现的文档。</p>
<p>例如，如果使用 <a target="_blank" rel="noopener" href="https://tomcat.apache.org/tomcat-8.0-doc/jdbc-pool.html#Common_Attributes">Tomcat连接池</a>，则可以自定义许多其他设置，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Number of ms to wait before throwing an exception if no connection is available.</span><br><span class="line">spring.datasource.tomcat.max-wait&#x3D;10000</span><br><span class="line"></span><br><span class="line"># Maximum number of active connections that can be allocated from this pool at the same time.</span><br><span class="line">spring.datasource.tomcat.max-active&#x3D;50</span><br><span class="line"></span><br><span class="line"># Validate the connection before borrowing it from the pool.</span><br><span class="line">spring.datasource.tomcat.test-on-borrow&#x3D;true</span><br></pre></td></tr></table></figure>

<h3 id="30-1-3连接到JNDI数据源"><a href="#30-1-3连接到JNDI数据源" class="headerlink" title="30.1.3连接到JNDI数据源"></a>30.1.3连接到JNDI数据源</h3><p>如果将Spring Boot应用程序部署到Application Server，则可能希望使用Application Server的内置功能配置和管理DataSource，并使用JNDI访问它。</p>
<p><code>spring.datasource.jndi-name</code>属性可用作<code>spring.datasource.url</code>，<code>spring.datasource.username</code>和<code>spring.datasource.password</code>属性的替代，以从特定JNDI位置访问<code>DataSource</code>。例如，<code>application.properties</code>中的以下部分显示了如何访问定义的<code>DataSource</code> JBoss AS：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.datasource.jndi-name&#x3D;java:jboss&#x2F;datasources&#x2F;customers</span><br></pre></td></tr></table></figure>

<h2 id="30-2使用JdbcTemplate"><a href="#30-2使用JdbcTemplate" class="headerlink" title="30.2使用JdbcTemplate"></a>30.2使用JdbcTemplate</h2><p>Spring的<code>JdbcTemplate</code>和<code>NamedParameterJdbcTemplate</code>类是自动配置的，您可以<code>@Autowire</code>直接将它们放入您自己的beans中，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">public class MyBean &#123;</span><br><span class="line"></span><br><span class="line">	private final JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	public MyBean(JdbcTemplate jdbcTemplate) &#123;</span><br><span class="line">		this.jdbcTemplate &#x3D; jdbcTemplate;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F; ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>您可以使用<code>spring.jdbc.template.*</code>属性自定义模板的某些属性，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.jdbc.template.max-rows&#x3D;500</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td><code>NamedParameterJdbcTemplate</code>在幕后重用了相同的<code>JdbcTemplate</code>实例。如果定义了多个<code>JdbcTemplate</code>并且不存在主要候选者，则不会自动配置<code>NamedParameterJdbcTemplate</code>。</td>
</tr>
</tbody></table>
<h2 id="30-3-JPA和Spring数据JPA"><a href="#30-3-JPA和Spring数据JPA" class="headerlink" title="30.3 JPA和Spring数据JPA"></a>30.3 JPA和Spring数据JPA</h2><p>Java Persistence API是一种标准技术，可让您将对象“映射”到关系数据库。<code>spring-boot-starter-data-jpa</code> POM提供了一种快速入门方式。它提供以下关键依赖项：</p>
<ul>
<li>Hibernate：最受欢迎的JPA实现之一。</li>
<li>Spring Data JPA：使实现基于JPA的存储库变得容易。</li>
<li>Spring ORM：来自Spring框架的核心ORM支持。</li>
</ul>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>我们不会在这里详细介绍JPA或<a target="_blank" rel="noopener" href="https://projects.spring.io/spring-data/">Spring数据</a>。您可以按照<a target="_blank" rel="noopener" href="https://spring.io/guides/gs/accessing-data-jpa/">“访问数据与JPA”</a> 从指导<a target="_blank" rel="noopener" href="https://spring.io/">spring.io</a>和读取<a target="_blank" rel="noopener" href="https://projects.spring.io/spring-data-jpa/">Spring数据JPA</a>和 <a target="_blank" rel="noopener" href="https://hibernate.org/orm/documentation/">Hibernate的</a>参考文档。</td>
</tr>
</tbody></table>
<h3 id="30-3-1实体类"><a href="#30-3-1实体类" class="headerlink" title="30.3.1实体类"></a>30.3.1实体类</h3><p>传统上，JPA“实体”类在<code>persistence.xml</code>文件中指定。使用Spring Boot时，不需要此文件，而是使用“实体扫描”。默认情况下，将搜索主配置类（注释为<code>@EnableAutoConfiguration</code>或<code>@SpringBootApplication</code>）下的所有包。</p>
<p>任何注明<code>@Entity</code>，<code>@Embeddable</code>或<code>@MappedSuperclass</code>的类都会被考虑。典型的实体类类似于以下示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">package com.example.myapp.domain;</span><br><span class="line"></span><br><span class="line">import java.io.Serializable;</span><br><span class="line">import javax.persistence.*;</span><br><span class="line"></span><br><span class="line">@Entity</span><br><span class="line">public class City implements Serializable &#123;</span><br><span class="line"></span><br><span class="line">	@Id</span><br><span class="line">	@GeneratedValue</span><br><span class="line">	private Long id;</span><br><span class="line"></span><br><span class="line">	@Column(nullable &#x3D; false)</span><br><span class="line">	private String name;</span><br><span class="line"></span><br><span class="line">	@Column(nullable &#x3D; false)</span><br><span class="line">	private String state;</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F; ... additional members, often include @OneToMany mappings</span><br><span class="line"></span><br><span class="line">	protected City() &#123;</span><br><span class="line">		&#x2F;&#x2F; no-args constructor required by JPA spec</span><br><span class="line">		&#x2F;&#x2F; this one is protected since it shouldn&#39;t be used directly</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public City(String name, String state) &#123;</span><br><span class="line">		this.name &#x3D; name;</span><br><span class="line">		this.state &#x3D; state;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public String getName() &#123;</span><br><span class="line">		return this.name;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public String getState() &#123;</span><br><span class="line">		return this.state;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F; ... etc</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>您可以使用<code>@EntityScan</code>注释自定义实体扫描位置。请参阅“ <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#howto-separate-entity-definitions-from-spring-configuration">第84.4节</a> ” <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#howto-separate-entity-definitions-from-spring-configuration">，“Spring配置”中的@Entity定义“</a> ”操作方法。</td>
</tr>
</tbody></table>
<h3 id="30-3-2-Spring数据JPA存储库"><a href="#30-3-2-Spring数据JPA存储库" class="headerlink" title="30.3.2 Spring数据JPA存储库"></a>30.3.2 Spring数据JPA存储库</h3><p><a target="_blank" rel="noopener" href="https://projects.spring.io/spring-data-jpa/">Spring数据JPA</a>存储库是您可以定义以访问数据的接口。JPA查询是从您的方法名称自动创建的。例如，<code>CityRepository</code>接口可能会声明<code>findAllByState(String state)</code>方法来查找给定状态中的所有城市。</p>
<p>对于更复杂的查询，您可以使用Spring Data的<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-data/jpa/docs/current/api/org/springframework/data/jpa/repository/Query.html"><code>Query</code></a>注释来注释您的方法 。</p>
<p>Spring数据存储库通常从<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data/repository/Repository.html"><code>Repository</code></a>或 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data/repository/CrudRepository.html"><code>CrudRepository</code></a> 接口扩展 。如果使用自动配置，则会从包含主配置类（使用<code>@EnableAutoConfiguration</code>或<code>@SpringBootApplication</code>注释的包）的包中搜索存储库。</p>
<p>以下示例显示了典型的Spring数据存储库接口定义：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">package com.example.myapp.domain;</span><br><span class="line"></span><br><span class="line">import org.springframework.data.domain.*;</span><br><span class="line">import org.springframework.data.repository.*;</span><br><span class="line"></span><br><span class="line">public interface CityRepository extends Repository&lt;City, Long&gt; &#123;</span><br><span class="line"></span><br><span class="line">	Page&lt;City&gt; findAll(Pageable pageable);</span><br><span class="line"></span><br><span class="line">	City findByNameAndStateAllIgnoringCase(String name, String state);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Spring数据JPA存储库支持三种不同的引导模式：default，deferred和lazy。要启用延迟或延迟引导，请将<code>spring.data.jpa.repositories.bootstrap-mode</code>分别设置为<code>deferred</code>或<code>lazy</code>。使用延迟或延迟引导时，自动配置的<code>EntityManagerFactoryBuilder</code>将使用上下文的异步任务执行程序（如果有）作为引导程序执行程序。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>我们几乎没有触及Spring Data JPA的表面。有关完整的详细信息，请参阅<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/">Spring Data JPA参考文档</a>。</td>
</tr>
</tbody></table>
<h3 id="30-3-3创建和删除JPA数据库"><a href="#30-3-3创建和删除JPA数据库" class="headerlink" title="30.3.3创建和删除JPA数据库"></a>30.3.3创建和删除JPA数据库</h3><p>默认情况下，<strong>仅</strong>当您使用嵌入式数据库（H2，HSQL或Derby）时，<strong>才会</strong>自动创建JPA数据库。您可以使用<code>spring.jpa.*</code>属性显式配置JPA设置。例如，要创建和删除表，可以将以下行添加到<code>application.properties</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.jpa.hibernate.ddl-auto&#x3D;create-drop</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>Hibernate自己的内部属性名称（如果你碰巧更好地记住它）是<code>hibernate.hbm2ddl.auto</code>。您可以使用<code>spring.jpa.properties.*</code>（在将它们添加到实体管理器之前删除前缀）来设置它以及其他Hibernate本机属性。以下行显示了为Hibernate设置JPA属性的示例：</td>
</tr>
</tbody></table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.jpa.properties.hibernate.globally_quoted_identifiers&#x3D;true</span><br></pre></td></tr></table></figure>

<p>前面示例中的行将<code>hibernate.globally_quoted_identifiers</code>属性的值<code>true</code>传递给Hibernate实体管理器。</p>
<p>默认情况下，DDL执行（或验证）将延迟到<code>ApplicationContext</code>开始。还有一个<code>spring.jpa.generate-ddl</code>标志，但如果Hibernate自动配置处于活动状态，则不会使用它，因为<code>ddl-auto</code>设置更精细。</p>
<h3 id="30-3-4在View中打开EntityManager"><a href="#30-3-4在View中打开EntityManager" class="headerlink" title="30.3.4在View中打开EntityManager"></a>30.3.4在View中打开EntityManager</h3><p>如果您正在运行Web应用程序，则默认情况下Spring Boot会注册 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/javadoc-api/org/springframework/orm/jpa/support/OpenEntityManagerInViewInterceptor.html"><code>OpenEntityManagerInViewInterceptor</code></a> 以应用“在视图中打开EntityManager”模式，以允许在Web视图中进行延迟加载。如果您不想要此行为，则应在<code>application.properties</code>中将<code>spring.jpa.open-in-view</code>设置为<code>false</code>。</p>
<h2 id="30-4-Spring数据JDBC"><a href="#30-4-Spring数据JDBC" class="headerlink" title="30.4 Spring数据JDBC"></a>30.4 Spring数据JDBC</h2><p>Spring数据包括JDBC的存储库支持，并将自动为<code>CrudRepository</code>上的方法生成SQL。对于更高级的查询，提供了<code>@Query</code>注释。</p>
<p>当必要的依赖项在类路径上时，Spring Boot将自动配置Spring数据的JDBC存储库。可以使用<code>spring-boot-starter-data-jdbc</code>上的单个依赖项将它们添加到项目中。如有必要，您可以通过向应用程序添加<code>@EnableJdbcRepositories</code>注释或<code>JdbcConfiguration</code>子类来控制Spring Data JDBC的配置。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>有关Spring数据JDBC的完整详细信息，请参阅 <a target="_blank" rel="noopener" href="https://projects.spring.io/spring-data-jdbc/">参考文档</a>。</td>
</tr>
</tbody></table>
<h2 id="30-5使用H2的Web控制台"><a href="#30-5使用H2的Web控制台" class="headerlink" title="30.5使用H2的Web控制台"></a>30.5使用H2的Web控制台</h2><p>该<a target="_blank" rel="noopener" href="http://www.h2database.com/">H2数据库</a>提供了一个 <a target="_blank" rel="noopener" href="http://www.h2database.com/html/quickstart.html#h2_console">基于浏览器的控制台</a>是Spring Boot可以自动为您配置。满足以下条件时，将自动配置控制台：</p>
<ul>
<li>您正在开发基于servlet的Web应用程序。</li>
<li><code>com.h2database:h2</code>在类路径上。</li>
<li>您正在使用<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-devtools">Spring Boot的开发人员工具</a>。</li>
</ul>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果您没有使用Spring Boot的开发人员工具但仍想使用H2的控制台，则可以使用值<code>true</code>配置<code>spring.h2.console.enabled</code>属性。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>H2控制台仅用于开发期间，因此您应该注意确保生产中<code>spring.h2.console.enabled</code>未设置为<code>true</code>。</td>
</tr>
</tbody></table>
<h3 id="30-5-1更改H2控制台的路径"><a href="#30-5-1更改H2控制台的路径" class="headerlink" title="30.5.1更改H2控制台的路径"></a>30.5.1更改H2控制台的路径</h3><p>默认情况下，控制台位于<code>/h2-console</code>。您可以使用<code>spring.h2.console.path</code>属性自定义控制台的路径。</p>
<h2 id="30-6使用jOOQ"><a href="#30-6使用jOOQ" class="headerlink" title="30.6使用jOOQ"></a>30.6使用jOOQ</h2><p>Java面向对象查询（<a target="_blank" rel="noopener" href="http://www.jooq.org/">jOOQ</a>）是<a target="_blank" rel="noopener" href="http://www.datageekery.com/">Data Geekery的</a>一个流行产品， 它从您的数据库生成Java代码，并允许您通过其流畅的API构建类型安全的SQL查询。商业版和开源版都可以与Spring Boot一起使用。</p>
<h3 id="30-6-1代码生成"><a href="#30-6-1代码生成" class="headerlink" title="30.6.1代码生成"></a>30.6.1代码生成</h3><p>要使用jOOQ类型安全查询，您需要从数据库模式生成Java类。您可以按照<a target="_blank" rel="noopener" href="https://www.jooq.org/doc/3.11.7/manual-single-page/#jooq-in-7-steps-step3">jOOQ用户手册中</a>的说明进行 <a target="_blank" rel="noopener" href="https://www.jooq.org/doc/3.11.7/manual-single-page/#jooq-in-7-steps-step3">操作</a>。如果您使用<code>jooq-codegen-maven</code>插件并且还使用<code>spring-boot-starter-parent</code>“父POM”，则可以安全地省略插件的<code>&lt;version&gt;</code>标记。您还可以使用Spring引导定义的版本变量（例如<code>h2.version</code>）来声明插件的数据库依赖性。以下清单显示了一个示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;plugin&gt;</span><br><span class="line">	&lt;groupId&gt;org.jooq&lt;&#x2F;groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;jooq-codegen-maven&lt;&#x2F;artifactId&gt;</span><br><span class="line">	&lt;executions&gt;</span><br><span class="line">		...</span><br><span class="line">	&lt;&#x2F;executions&gt;</span><br><span class="line">	&lt;dependencies&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;com.h2database&lt;&#x2F;groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;h2&lt;&#x2F;artifactId&gt;</span><br><span class="line">			&lt;version&gt;$&#123;h2.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">		&lt;&#x2F;dependency&gt;</span><br><span class="line">	&lt;&#x2F;dependencies&gt;</span><br><span class="line">	&lt;configuration&gt;</span><br><span class="line">		&lt;jdbc&gt;</span><br><span class="line">			&lt;driver&gt;org.h2.Driver&lt;&#x2F;driver&gt;</span><br><span class="line">			&lt;url&gt;jdbc:h2:~&#x2F;yourdatabase&lt;&#x2F;url&gt;</span><br><span class="line">		&lt;&#x2F;jdbc&gt;</span><br><span class="line">		&lt;generator&gt;</span><br><span class="line">			...</span><br><span class="line">		&lt;&#x2F;generator&gt;</span><br><span class="line">	&lt;&#x2F;configuration&gt;</span><br><span class="line">&lt;&#x2F;plugin&gt;</span><br></pre></td></tr></table></figure>

<h3 id="30-6-2使用DSLContext"><a href="#30-6-2使用DSLContext" class="headerlink" title="30.6.2使用DSLContext"></a>30.6.2使用DSLContext</h3><p>jOOQ提供的流畅API通过<code>org.jooq.DSLContext</code>接口启动。Spring Boot将<code>DSLContext</code>自动配置为Spring Bean并将其连接到您的应用<code>DataSource</code>。要使用<code>DSLContext</code>，您可以<code>@Autowire</code>，如下例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class JooqExample implements CommandLineRunner &#123;</span><br><span class="line"></span><br><span class="line">	private final DSLContext create;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	public JooqExample(DSLContext dslContext) &#123;</span><br><span class="line">		this.create &#x3D; dslContext;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>jOOQ手册倾向于使用名为<code>create</code>的变量来保存<code>DSLContext</code>。</td>
</tr>
</tbody></table>
<p>然后，您可以使用<code>DSLContext</code>构建查询，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public List&lt;GregorianCalendar&gt; authorsBornAfter1980() &#123;</span><br><span class="line">	return this.create.selectFrom(AUTHOR)</span><br><span class="line">		.where(AUTHOR.DATE_OF_BIRTH.greaterThan(new GregorianCalendar(1980, 0, 1)))</span><br><span class="line">		.fetch(AUTHOR.DATE_OF_BIRTH);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="30-6-3-jOOQ-SQL方言"><a href="#30-6-3-jOOQ-SQL方言" class="headerlink" title="30.6.3 jOOQ SQL方言"></a>30.6.3 jOOQ SQL方言</h3><p>除非已配置<code>spring.jooq.sql-dialect</code>属性，否则Spring Boot将确定用于数据源的SQL方言。如果Spring Boot无法检测到方言，则使用<code>DEFAULT</code>。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>Spring Boot只能自动配置开源版本的jOOQ支持的方言。</td>
</tr>
</tbody></table>
<h3 id="30-6-4自定义jOOQ"><a href="#30-6-4自定义jOOQ" class="headerlink" title="30.6.4自定义jOOQ"></a>30.6.4自定义jOOQ</h3><p>通过定义自己的<code>@Bean</code>定义可以实现更高级的自定义，这些定义在创建jOOQ <code>Configuration</code>时使用。您可以为以下jOOQ类型定义beans：</p>
<ul>
<li><code>ConnectionProvider</code></li>
<li><code>ExecutorProvider</code></li>
<li><code>TransactionProvider</code></li>
<li><code>RecordMapperProvider</code></li>
<li><code>RecordUnmapperProvider</code></li>
<li><code>RecordListenerProvider</code></li>
<li><code>ExecuteListenerProvider</code></li>
<li><code>VisitListenerProvider</code></li>
<li><code>TransactionListenerProvider</code></li>
</ul>
<p>如果您想完全控制jOOQ配置，也可以创建自己的<code>org.jooq.Configuration</code> <code>@Bean</code>。</p>
<h2 id="31-使用NoSQL-Technologies"><a href="#31-使用NoSQL-Technologies" class="headerlink" title="31.使用NoSQL Technologies"></a>31.使用NoSQL Technologies</h2><p>Spring数据提供了其他项目，可帮助您访问各种NoSQL技术，包括： <a target="_blank" rel="noopener" href="https://projects.spring.io/spring-data-mongodb/">MongoDB</a>， <a target="_blank" rel="noopener" href="https://projects.spring.io/spring-data-neo4j/">Neo4J</a>， <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-data-elasticsearch/">Elasticsearch</a>， <a target="_blank" rel="noopener" href="https://projects.spring.io/spring-data-solr/">Solr</a>， <a target="_blank" rel="noopener" href="https://projects.spring.io/spring-data-redis/">Redis</a>， <a target="_blank" rel="noopener" href="https://projects.spring.io/spring-data-gemfire/">Gemfire</a>， <a target="_blank" rel="noopener" href="https://projects.spring.io/spring-data-cassandra/">Cassandra</a>， <a target="_blank" rel="noopener" href="https://projects.spring.io/spring-data-couchbase/">Couchbase</a>和 <a target="_blank" rel="noopener" href="https://projects.spring.io/spring-data-ldap/">LDAP</a>。Spring Boot为Redis，MongoDB，Neo4j，Elasticsearch，Solr Cassandra，Couchbase和LDAP提供自动配置。您可以使用其他项目，但必须自己配置它们。请参阅<a target="_blank" rel="noopener" href="https://projects.spring.io/spring-data">projects.spring.io/spring-data</a>上的相应参考文档 。</p>
<h2 id="31-1-Redis"><a href="#31-1-Redis" class="headerlink" title="31.1 Redis"></a>31.1 Redis</h2><p><a target="_blank" rel="noopener" href="http://redis.io/">Redis</a>是一个缓存，消息代理和功能丰富的键值存储。Spring Boot为<a target="_blank" rel="noopener" href="https://github.com/lettuce-io/lettuce-core/">Lettuce</a>和 <a target="_blank" rel="noopener" href="https://github.com/xetorthio/jedis/">Jedis</a>客户端库提供了基本的自动配置， 并为<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-data-redis">Spring数据Redis</a>提供了它们之外的抽象。</p>
<p>有一个<code>spring-boot-starter-data-redis</code>“Starter”用于以方便的方式收集依赖项。默认情况下，它使用 <a target="_blank" rel="noopener" href="https://github.com/lettuce-io/lettuce-core/">Lettuce</a>。该启动器处理传统和反应应用程序。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>我们还提供<code>spring-boot-starter-data-redis-reactive</code>“Starter”以与其他具有反应支持的商店保持一致。</td>
</tr>
</tbody></table>
<h3 id="31-1-1连接到Redis"><a href="#31-1-1连接到Redis" class="headerlink" title="31.1.1连接到Redis"></a>31.1.1连接到Redis</h3><p>您可以像注射任何其他Spring Bean一样注入自动配置的<code>RedisConnectionFactory</code>，<code>StringRedisTemplate</code>或vanilla <code>RedisTemplate</code>实例。默认情况下，实例尝试在<code>localhost:6379</code>连接到Redis服务器。以下列表显示了此类bean的示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class MyBean &#123;</span><br><span class="line"></span><br><span class="line">	private StringRedisTemplate template;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	public MyBean(StringRedisTemplate template) &#123;</span><br><span class="line">		this.template &#x3D; template;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F; ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>您还可以注册实现<code>LettuceClientConfigurationBuilderCustomizer</code>的任意数量的beans以进行更高级的自定义。如果您使用Jedis，也可以使用<code>JedisClientConfigurationBuilderCustomizer</code>。</td>
</tr>
</tbody></table>
<p>如果您添加自己配置的任何类型的<code>@Bean</code>，它将替换默认值（<code>RedisTemplate</code>除外，当排除基于bean名称时，<code>redisTemplate</code> ，而不是它的类型）。默认情况下，如果类路径上有<code>commons-pool2</code>，则会出现池连接工厂。</p>
<h2 id="31-2-MongoDB"><a href="#31-2-MongoDB" class="headerlink" title="31.2 MongoDB"></a>31.2 MongoDB</h2><p><a target="_blank" rel="noopener" href="https://www.mongodb.com/">MongoDB</a>是一个开源的NoSQL文档数据库，它使用类似JSON的模式而不是传统的基于表的关系数据。Spring Boot提供了一些使用MongoDB的便利，包括<code>spring-boot-starter-data-mongodb</code>和<code>spring-boot-starter-data-mongodb-reactive</code>“Starters”。</p>
<h3 id="31-2-1连接MongoDB数据库"><a href="#31-2-1连接MongoDB数据库" class="headerlink" title="31.2.1连接MongoDB数据库"></a>31.2.1连接MongoDB数据库</h3><p>要访问Mongo数据库，您可以注入自动配置的<code>org.springframework.data.mongodb.MongoDbFactory</code>。默认情况下，实例尝试在<code>mongodb://localhost/test</code>连接到MongoDB服务器。以下示例显示如何连接到MongoDB数据库：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.data.mongodb.MongoDbFactory;</span><br><span class="line">import com.mongodb.DB;</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">public class MyBean &#123;</span><br><span class="line"></span><br><span class="line">	private final MongoDbFactory mongo;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	public MyBean(MongoDbFactory mongo) &#123;</span><br><span class="line">		this.mongo &#x3D; mongo;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F; ...</span><br><span class="line"></span><br><span class="line">	public void example() &#123;</span><br><span class="line">		DB db &#x3D; mongo.getDb();</span><br><span class="line">		&#x2F;&#x2F; ...</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>您可以设置<code>spring.data.mongodb.uri</code>属性以更改URL并配置其他设置，例如<em>副本集</em>，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.data.mongodb.uri&#x3D;mongodb:&#x2F;&#x2F;user:secret@mongo1.example.com:12345,mongo2.example.com:23456&#x2F;test</span><br></pre></td></tr></table></figure>

<p>或者，只要您使用Mongo 2.x，就可以指定<code>host</code> / <code>port</code>。例如，您可以在<code>application.properties</code>中声明以下设置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.data.mongodb.host&#x3D;mongoserver</span><br><span class="line">spring.data.mongodb.port&#x3D;27017</span><br></pre></td></tr></table></figure>

<p>如果您已经定义了自己的<code>MongoClient</code>，它将用于自动配置合适的<code>MongoDbFactory</code>。支持<code>com.mongodb.MongoClient</code>和<code>com.mongodb.client.MongoClient</code>。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果您使用Mongo 3.0 Java驱动程序，则不支持<code>spring.data.mongodb.host</code>和<code>spring.data.mongodb.port</code>。在这种情况下，<code>spring.data.mongodb.uri</code>应该用于提供所有配置。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果未指定<code>spring.data.mongodb.port</code>，则使用默认值<code>27017</code>。您可以从前面显示的示例中删除此行。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果您不使用Spring Data Mongo，则可以注入<code>com.mongodb.MongoClient</code> beans而不是<code>MongoDbFactory</code>。如果您想完全控制建立MongoDB连接，您也可以声明自己的<code>MongoDbFactory</code>或<code>MongoClient</code> bean。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果您使用的是反应式驱动程序，则SSL需要Netty。如果Netty可用且自己的工厂尚未自定义，则自动配置会自动配置此工厂。</td>
</tr>
</tbody></table>
<h3 id="31-2-2-MongoTemplate"><a href="#31-2-2-MongoTemplate" class="headerlink" title="31.2.2 MongoTemplate"></a>31.2.2 MongoTemplate</h3><p><a target="_blank" rel="noopener" href="https://projects.spring.io/spring-data-mongodb/">Spring数据MongoDB</a>提供了一个<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-data/mongodb/docs/current/api/org/springframework/data/mongodb/core/MongoTemplate.html"><code>MongoTemplate</code></a>与Spring <code>JdbcTemplate</code>设计非常相似的 类。与<code>JdbcTemplate</code>一样，Spring Boot为您自动配置bean以注入模板，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.data.mongodb.core.MongoTemplate;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">public class MyBean &#123;</span><br><span class="line"></span><br><span class="line">	private final MongoTemplate mongoTemplate;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	public MyBean(MongoTemplate mongoTemplate) &#123;</span><br><span class="line">		this.mongoTemplate &#x3D; mongoTemplate;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F; ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>有关完整的详细信息，请参阅 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-data/mongodb/docs/current/api/org/springframework/data/mongodb/core/MongoOperations.html"><code>MongoOperations</code> Javadoc</a>。</p>
<h3 id="31-2-3-Spring数据MongoDB存储库"><a href="#31-2-3-Spring数据MongoDB存储库" class="headerlink" title="31.2.3 Spring数据MongoDB存储库"></a>31.2.3 Spring数据MongoDB存储库</h3><p>Spring数据包括MongoDB的存储库支持。与前面讨论的JPA存储库一样，基本原则是基于方法名称自动构造查询。</p>
<p>实际上，Spring Data JPA和Spring Data MongoDB共享相同的公共基础结构。您可以从前面获取JPA示例，假设<code>City</code>现在是Mongo数据类而不是JPA <code>@Entity</code>，它的工作方式相同，如下例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">package com.example.myapp.domain;</span><br><span class="line"></span><br><span class="line">import org.springframework.data.domain.*;</span><br><span class="line">import org.springframework.data.repository.*;</span><br><span class="line"></span><br><span class="line">public interface CityRepository extends Repository&lt;City, Long&gt; &#123;</span><br><span class="line"></span><br><span class="line">	Page&lt;City&gt; findAll(Pageable pageable);</span><br><span class="line"></span><br><span class="line">	City findByNameAndStateAllIgnoringCase(String name, String state);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>您可以使用<code>@EntityScan</code>注释自定义文档扫描位置。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>有关Spring Data MongoDB的完整详细信息，包括其丰富的对象映射技术，请参阅其<a target="_blank" rel="noopener" href="https://projects.spring.io/spring-data-mongodb/">参考文档</a>。</td>
</tr>
</tbody></table>
<h3 id="31-2-4嵌入式Mongo"><a href="#31-2-4嵌入式Mongo" class="headerlink" title="31.2.4嵌入式Mongo"></a>31.2.4嵌入式Mongo</h3><p>Spring Boot为<a target="_blank" rel="noopener" href="https://github.com/flapdoodle-oss/de.flapdoodle.embed.mongo">Embedded Mongo</a>提供自动配置 。要在Spring Boot应用程序中使用它，请在<code>de.flapdoodle.embed:de.flapdoodle.embed.mongo</code>上添加依赖项。</p>
<p>可以通过设置<code>spring.data.mongodb.port</code>属性来配置Mongo侦听的端口。要使用随机分配的空闲端口，请使用值0. <code>MongoAutoConfiguration</code>创建的<code>MongoClient</code>将自动配置为使用随机分配的端口。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果未配置自定义端口，则嵌入式支持默认使用随机端口（而不是27017）。</td>
</tr>
</tbody></table>
<p>如果类路径上有SLF4J，则Mongo生成的输出会自动路由到名为<code>org.springframework.boot.autoconfigure.mongo.embedded.EmbeddedMongo</code>的记录器。</p>
<p>您可以声明自己的<code>IMongodConfig</code>和<code>IRuntimeConfig</code> beans来控制Mongo实例的配置和日志路由。</p>
<h2 id="31-3-Neo4j"><a href="#31-3-Neo4j" class="headerlink" title="31.3 Neo4j"></a>31.3 Neo4j</h2><p><a target="_blank" rel="noopener" href="http://neo4j.com/">Neo4j</a>是一个开源的NoSQL图形数据库，它使用由一级关系连接的节点的丰富数据模型，与传统的RDBMS方法相比，它更适合于连接的大数据。Spring Boot为使用Neo4j提供了一些便利，包括<code>spring-boot-starter-data-neo4j</code>“Starter”。</p>
<h3 id="31-3-1连接到Neo4j数据库"><a href="#31-3-1连接到Neo4j数据库" class="headerlink" title="31.3.1连接到Neo4j数据库"></a>31.3.1连接到Neo4j数据库</h3><p>要访问Neo4j服务器，您可以注入自动配置的<code>org.neo4j.ogm.session.Session</code>。默认情况下，实例尝试使用Bolt协议连接到<code>localhost:7687</code>的Neo4j服务器。以下示例显示了如何注入Neo4j <code>Session</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class MyBean &#123;</span><br><span class="line"></span><br><span class="line">	private final Session session;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	public MyBean(Session session) &#123;</span><br><span class="line">		this.session &#x3D; session;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F; ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>您可以通过设置<code>spring.data.neo4j.*</code>属性来配置要使用的URI和凭据，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring.data.neo4j.uri&#x3D;bolt:&#x2F;&#x2F;my-server:7687</span><br><span class="line">spring.data.neo4j.username&#x3D;neo4j</span><br><span class="line">spring.data.neo4j.password&#x3D;secret</span><br></pre></td></tr></table></figure>

<p>您可以通过添加<code>org.neo4j.ogm.config.Configuration</code> <code>@Bean</code>来完全控制会话创建。此外，添加<code>@Bean</code>类型<code>SessionFactory</code>会禁用自动配置并为您提供完全控制权。</p>
<h3 id="31-3-2使用嵌入模式"><a href="#31-3-2使用嵌入模式" class="headerlink" title="31.3.2使用嵌入模式"></a>31.3.2使用嵌入模式</h3><p>如果将<code>org.neo4j:neo4j-ogm-embedded-driver</code>添加到应用程序的依赖项中，Spring Boot会自动配置Neo4j的进程内嵌入式实例，该应用程序在应用程序关闭时不会保留任何数据。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>由于嵌入式Neo4j OGM驱动程序本身不提供Neo4j内核，因此您必须自己声明<code>org.neo4j:neo4j</code>为依赖项。有关兼容版本的列表，请参阅 <a target="_blank" rel="noopener" href="https://neo4j.com/docs/ogm-manual/current/reference/#reference:getting-started">Neo4j OGM文档</a>。</td>
</tr>
</tbody></table>
<p>当类路径上有多个驱动程序时，嵌入式驱动程序优先于其他驱动程序。您可以通过设置<code>spring.data.neo4j.embedded.enabled=false</code>来明确禁用嵌入模式。</p>
<p>如果嵌入式驱动程序和Neo4j内核如上所述位于类路径上，则<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-testing-spring-boot-applications-testing-autoconfigured-neo4j-test">数据Neo4j测试会</a>自动使用嵌入式Neo4j实例。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>您可以通过在配置中提供数据库文件的路径来为嵌入模式启用持久性，例如<code>spring.data.neo4j.uri=file://var/tmp/graph.db</code>。</td>
</tr>
</tbody></table>
<h3 id="31-3-3-Neo4jSession"><a href="#31-3-3-Neo4jSession" class="headerlink" title="31.3.3 Neo4jSession"></a>31.3.3 Neo4jSession</h3><p>默认情况下，如果您正在运行Web应用程序，则会话将绑定到该线程以进行整个请求处理（即，它使用“在视图中打开会话”模式）。如果您不想要此行为，请将以下行添加到您的<code>application.properties</code>文件中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.data.neo4j.open-in-view&#x3D;false</span><br></pre></td></tr></table></figure>

<h3 id="31-3-4-Spring数据Neo4j存储库"><a href="#31-3-4-Spring数据Neo4j存储库" class="headerlink" title="31.3.4 Spring数据Neo4j存储库"></a>31.3.4 Spring数据Neo4j存储库</h3><p>Spring数据包括Neo4j的存储库支持。</p>
<p>Spring数据Neo4j与Spring Data JPA共享公共基础架构，正如许多其他Spring数据模块那样。您可以从之前的JPA示例中将<code>City</code>定义为Neo4j OGM <code>@NodeEntity</code>而不是JPA <code>@Entity</code>，并且存储库抽象以相同的方式工作，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">package com.example.myapp.domain;</span><br><span class="line"></span><br><span class="line">import java.util.Optional;</span><br><span class="line"></span><br><span class="line">import org.springframework.data.neo4j.repository.*;</span><br><span class="line"></span><br><span class="line">public interface CityRepository extends Neo4jRepository&lt;City, Long&gt; &#123;</span><br><span class="line"></span><br><span class="line">	Optional&lt;City&gt; findOneByNameAndState(String name, String state);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>spring-boot-starter-data-neo4j</code>“Starter”启用存储库支持以及事务管理。您可以在<code>@Configuration</code> - bean上分别使用<code>@EnableNeo4jRepositories</code>和<code>@EntityScan</code>来自定义位置以查找存储库和实体。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>有关Spring Data Neo4j的完整详细信息，包括其对象映射技术，请参阅<a target="_blank" rel="noopener" href="https://projects.spring.io/spring-data-neo4j/">参考文档</a>。</td>
</tr>
</tbody></table>
<h2 id="31-4-Gemfire"><a href="#31-4-Gemfire" class="headerlink" title="31.4 Gemfire"></a>31.4 Gemfire</h2><p><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-data-gemfire">Spring数据Gemfire</a>为访问<a target="_blank" rel="noopener" href="https://pivotal.io/big-data/pivotal-gemfire#details">Pivotal Gemfire</a>数据管理平台提供了方便的Spring友好工具 。有一个<code>spring-boot-starter-data-gemfire</code>“Starter”用于以方便的方式收集依赖项。目前没有Gemfire的自动配置支持，但您可以使用<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-data-gemfire/blob/master/src/main/java/org/springframework/data/gemfire/repository/config/EnableGemfireRepositories.java">单个注释</a>启用Spring数据存储库 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-data-gemfire/blob/master/src/main/java/org/springframework/data/gemfire/repository/config/EnableGemfireRepositories.java">：<code>@EnableGemfireRepositories</code></a>。</p>
<h2 id="31-5-Solr"><a href="#31-5-Solr" class="headerlink" title="31.5 Solr"></a>31.5 Solr</h2><p><a target="_blank" rel="noopener" href="https://lucene.apache.org/solr/">Apache Solr</a>是一个搜索引擎。Spring Boot为Solr 5客户端库提供了基本的自动配置，并在<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-data-solr">Spring Data Solr</a>提供了它上面的抽象。有一个<code>spring-boot-starter-data-solr</code>“Starter”用于以方便的方式收集依赖项。</p>
<h3 id="31-5-1连接到Solr"><a href="#31-5-1连接到Solr" class="headerlink" title="31.5.1连接到Solr"></a>31.5.1连接到Solr</h3><p>您可以像注射任何其他Spring bean一样注入自动配置的<code>SolrClient</code>实例。默认情况下，实例尝试连接到<code>localhost:8983/solr</code>的服务器。以下示例显示了如何注入Solr bean：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class MyBean &#123;</span><br><span class="line"></span><br><span class="line">	private SolrClient solr;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	public MyBean(SolrClient solr) &#123;</span><br><span class="line">		this.solr &#x3D; solr;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F; ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果您添加<code>SolrClient</code>类型的<code>@Bean</code>，它将替换默认值。</p>
<h3 id="31-5-2-Spring数据Solr存储库"><a href="#31-5-2-Spring数据Solr存储库" class="headerlink" title="31.5.2 Spring数据Solr存储库"></a>31.5.2 Spring数据Solr存储库</h3><p>Spring数据包括Apache Solr的存储库支持。与前面讨论的JPA存储库一样，基本原则是根据方法名称自动构建查询。</p>
<p>实际上，Spring Data JPA和Spring Data Solr共享相同的公共基础结构。您可以从前面获取JPA示例，假设<code>City</code>现在是<code>@SolrDocument</code>类而不是JPA <code>@Entity</code>，它的工作方式相同。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>有关Spring Data Solr的完整详细信息，请参阅 <a target="_blank" rel="noopener" href="https://projects.spring.io/spring-data-solr/">参考文档</a>。</td>
</tr>
</tbody></table>
<h2 id="31-6-Elasticsearch"><a href="#31-6-Elasticsearch" class="headerlink" title="31.6 Elasticsearch"></a>31.6 Elasticsearch</h2><p><a target="_blank" rel="noopener" href="https://www.elastic.co/products/elasticsearch">Elasticsearch</a>是一个开源，分布式，RESTful搜索和分析引擎。Spring Boot为Elasticsearch提供基本的自动配置。</p>
<p>Spring Boot支持多个HTTP客户端：</p>
<ul>
<li>官方Java“低级”和“高级”REST客户端</li>
<li><a target="_blank" rel="noopener" href="https://github.com/searchbox-io/Jest">笑话</a></li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-data-elasticsearch">Spring Data Elasticsearch</a>仍在使用传输客户端 ，您可以使用<code>spring-boot-starter-data-elasticsearch</code>“Starter”开始使用它。</p>
<h3 id="31-6-1-REST客户端连接到Elasticsearch"><a href="#31-6-1-REST客户端连接到Elasticsearch" class="headerlink" title="31.6.1 REST客户端连接到Elasticsearch"></a>31.6.1 REST客户端连接到Elasticsearch</h3><p>Elasticsearch提供了 <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/index.html">两个</a> 可用于查询集群的<a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/index.html">REST客户端</a>：“低级”客户端和“高级”客户端。</p>
<p>如果您对类路径具有<code>org.elasticsearch.client:elasticsearch-rest-client</code>依赖关系，Spring Boot将自动配置并注册默认目标为<code>localhost:9200</code>的<code>RestClient</code> bean。您可以进一步调整<code>RestClient</code>的配置方式，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring.elasticsearch.rest.uris&#x3D;http:&#x2F;&#x2F;search.example.com:9200</span><br><span class="line">spring.elasticsearch.rest.username&#x3D;user</span><br><span class="line">spring.elasticsearch.rest.password&#x3D;secret</span><br></pre></td></tr></table></figure>

<p>您还可以注册实现<code>RestClientBuilderCustomizer</code>的任意数量的beans以进行更高级的自定义。要完全控制注册，请定义<code>RestClient</code> bean。</p>
<p>如果您对类路径具有<code>org.elasticsearch.client:elasticsearch-rest-high-level-client</code>依赖关系，Spring Boot将自动配置<code>RestHighLevelClient</code>，其包装任何现有的<code>RestClient</code> bean，重用其HTTP配置。</p>
<h3 id="31-6-2使用Jest连接到Elasticsearch"><a href="#31-6-2使用Jest连接到Elasticsearch" class="headerlink" title="31.6.2使用Jest连接到Elasticsearch"></a>31.6.2使用Jest连接到Elasticsearch</h3><p>如果类路径上有<code>Jest</code>，则可以注入一个自动配置的<code>JestClient</code>，默认情况下为<code>localhost:9200</code>。您可以进一步调整客户端的配置方式，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">spring.elasticsearch.jest.uris&#x3D;http:&#x2F;&#x2F;search.example.com:9200</span><br><span class="line">spring.elasticsearch.jest.read-timeout&#x3D;10000</span><br><span class="line">spring.elasticsearch.jest.username&#x3D;user</span><br><span class="line">spring.elasticsearch.jest.password&#x3D;secret</span><br></pre></td></tr></table></figure>

<p>您还可以注册实现<code>HttpClientConfigBuilderCustomizer</code>的任意数量的beans以进行更高级的自定义。以下示例调整其他HTTP设置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">static class HttpSettingsCustomizer implements HttpClientConfigBuilderCustomizer &#123;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public void customize(HttpClientConfig.Builder builder) &#123;</span><br><span class="line">		builder.maxTotalConnection(100).defaultMaxTotalConnectionPerRoute(5);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>要完全控制注册，请定义<code>JestClient</code> bean。</p>
<h3 id="31-6-3使用Spring数据连接到Elasticsearch"><a href="#31-6-3使用Spring数据连接到Elasticsearch" class="headerlink" title="31.6.3使用Spring数据连接到Elasticsearch"></a>31.6.3使用Spring数据连接到Elasticsearch</h3><p>要连接到Elasticsearch，您必须提供一个或多个群集节点的地址。可以通过将<code>spring.data.elasticsearch.cluster-nodes</code>属性设置为逗号分隔的<code>host:port</code>列表来指定地址。有了这种配置，<code>ElasticsearchTemplate</code>或<code>TransportClient</code>可以像任何其他Spring bean一样注入，如下例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">spring.data.elasticsearch.cluster-nodes&#x3D;localhost:9300</span><br><span class="line">@Component</span><br><span class="line">public class MyBean &#123;</span><br><span class="line"></span><br><span class="line">	private final ElasticsearchTemplate template;</span><br><span class="line"></span><br><span class="line">	public MyBean(ElasticsearchTemplate template) &#123;</span><br><span class="line">		this.template &#x3D; template;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F; ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果您添加自己的<code>ElasticsearchTemplate</code>或<code>TransportClient</code> <code>@Bean</code>，则会替换默认值。</p>
<h3 id="31-6-4-Spring数据Elasticsearch存储库"><a href="#31-6-4-Spring数据Elasticsearch存储库" class="headerlink" title="31.6.4 Spring数据Elasticsearch存储库"></a>31.6.4 Spring数据Elasticsearch存储库</h3><p>Spring数据包括Elasticsearch的存储库支持。与前面讨论的JPA存储库一样，基本原则是根据方法名称自动为您构建查询。</p>
<p>事实上，Spring Data JPA和Spring Data Elasticsearch共享相同的通用基础架构。您可以从之前获取JPA示例，假设<code>City</code>现在是Elasticsearch <code>@Document</code>类而不是JPA <code>@Entity</code>，它的工作方式相同。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>有关Spring Data Elasticsearch的完整详细信息，请参阅 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-data/elasticsearch/docs/">参考文档</a>。</td>
</tr>
</tbody></table>
<h2 id="31-7-Cassandra"><a href="#31-7-Cassandra" class="headerlink" title="31.7 Cassandra"></a>31.7 Cassandra</h2><p><a target="_blank" rel="noopener" href="https://cassandra.apache.org/">Cassandra</a>是一个开源的分布式数据库管理系统，旨在处理许多商用服务器上的大量数据。Spring Boot提供Cassandra的自动配置以及<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-data-cassandra">Spring数据Cassandra</a>提供的摘要。有一个<code>spring-boot-starter-data-cassandra</code>“Starter”用于以方便的方式收集依赖项。</p>
<h3 id="31-7-1连接到Cassandra"><a href="#31-7-1连接到Cassandra" class="headerlink" title="31.7.1连接到Cassandra"></a>31.7.1连接到Cassandra</h3><p>您可以像对待任何其他Spring Bean一样注入自动配置的<code>CassandraTemplate</code>或Cassandra <code>Session</code>实例。<code>spring.data.cassandra.*</code>属性可用于自定义连接。通常，您提供<code>keyspace-name</code>和<code>contact-points</code>属性，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.data.cassandra.keyspace-name&#x3D;mykeyspace</span><br><span class="line">spring.data.cassandra.contact-points&#x3D;cassandrahost1,cassandrahost2</span><br></pre></td></tr></table></figure>

<p>您还可以注册实现<code>ClusterBuilderCustomizer</code>的任意数量的beans以进行更高级的自定义。</p>
<p>以下代码清单显示了如何注入Cassandra bean：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class MyBean &#123;</span><br><span class="line"></span><br><span class="line">	private CassandraTemplate template;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	public MyBean(CassandraTemplate template) &#123;</span><br><span class="line">		this.template &#x3D; template;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F; ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果您添加<code>CassandraTemplate</code>类型的<code>@Bean</code>，它将替换默认值。</p>
<h3 id="31-7-2-Spring数据Cassandra存储库"><a href="#31-7-2-Spring数据Cassandra存储库" class="headerlink" title="31.7.2 Spring数据Cassandra存储库"></a>31.7.2 Spring数据Cassandra存储库</h3><p>Spring数据包括Cassandra的基本存储库支持。目前，这比前面讨论的JPA存储库更有限，需要使用<code>@Query</code>来注释finder方法。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>有关Spring数据Cassandra的完整详细信息，请参阅 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-data/cassandra/docs/">参考文档</a>。</td>
</tr>
</tbody></table>
<h2 id="31-8-Couchbase"><a href="#31-8-Couchbase" class="headerlink" title="31.8 Couchbase"></a>31.8 Couchbase</h2><p><a target="_blank" rel="noopener" href="https://www.couchbase.com/">Couchbase</a>是一个开源的，分布式的，多模型的NoSQL面向文档的数据库，针对交互式应用程序进行了优化。Spring Boot提供了Couchbase的自动配置以及<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-data-couchbase">Spring Data Couchbase</a>提供的抽象 。有<code>spring-boot-starter-data-couchbase</code>和<code>spring-boot-starter-data-couchbase-reactive</code>“Starters”用于以方便的方式收集依赖项。</p>
<h3 id="31-8-1连接Couchbase"><a href="#31-8-1连接Couchbase" class="headerlink" title="31.8.1连接Couchbase"></a>31.8.1连接Couchbase</h3><p>您可以通过添加Couchbase SDK和一些配置来获得<code>Bucket</code>和<code>Cluster</code>。<code>spring.couchbase.*</code>属性可用于自定义连接。通常，您提供引导主机，存储桶名称和密码，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring.couchbase.bootstrap-hosts&#x3D;my-host-1,192.168.1.123</span><br><span class="line">spring.couchbase.bucket.name&#x3D;my-bucket</span><br><span class="line">spring.couchbase.bucket.password&#x3D;secret</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>您需要<em>至少</em>提供引导主机，在这种情况下，存储桶名称为<code>default</code>，密码为空字符串。或者，您可以定义自己的<code>org.springframework.data.couchbase.config.CouchbaseConfigurer</code> <code>@Bean</code>来控制整个配置。</td>
</tr>
</tbody></table>
<p>也可以自定义一些<code>CouchbaseEnvironment</code>设置。例如，以下配置更改用于打开新<code>Bucket</code>的超时并启用SSL支持：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring.couchbase.env.timeouts.connect&#x3D;3000</span><br><span class="line">spring.couchbase.env.ssl.key-store&#x3D;&#x2F;location&#x2F;of&#x2F;keystore.jks</span><br><span class="line">spring.couchbase.env.ssl.key-store-password&#x3D;secret</span><br></pre></td></tr></table></figure>

<p>查看<code>spring.couchbase.env.*</code>属性以获取更多详细信息。</p>
<h3 id="31-8-2-Spring数据Couchbase存储库"><a href="#31-8-2-Spring数据Couchbase存储库" class="headerlink" title="31.8.2 Spring数据Couchbase存储库"></a>31.8.2 Spring数据Couchbase存储库</h3><p>Spring数据包括Couchbase的存储库支持。有关Spring Data Couchbase的完整详细信息，请参阅 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-data/couchbase/docs/current/reference/html/">参考文档</a>。</p>
<p>您可以像使用任何其他Spring Bean一样注入自动配置的<code>CouchbaseTemplate</code>实例，前提是<em>默认</em> <code>CouchbaseConfigurer</code>可用（当您启用Couchbase支持时会发生这种情况，如前所述）。</p>
<p>以下示例显示了如何注入Couchbase bean：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class MyBean &#123;</span><br><span class="line"></span><br><span class="line">	private final CouchbaseTemplate template;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	public MyBean(CouchbaseTemplate template) &#123;</span><br><span class="line">		this.template &#x3D; template;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F; ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>您可以在自己的配置中定义一些beans来覆盖自动配置提供的内容：</p>
<ul>
<li><code>CouchbaseTemplate</code> <code>@Bean</code>，名称为<code>couchbaseTemplate</code>。</li>
<li><code>IndexManager</code> <code>@Bean</code>，名称为<code>couchbaseIndexManager</code>。</li>
<li><code>CustomConversions</code> <code>@Bean</code>，名称为<code>couchbaseCustomConversions</code>。</li>
</ul>
<p>为避免在您自己的配置中对这些名称进行硬编码，您可以重用Spring Data Couchbase提供的<code>BeanNames</code>。例如，您可以自定义要使用的转换器，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class SomeConfiguration &#123;</span><br><span class="line"></span><br><span class="line">	@Bean(BeanNames.COUCHBASE_CUSTOM_CONVERSIONS)</span><br><span class="line">	public CustomConversions myCustomConversions() &#123;</span><br><span class="line">		return new CustomConversions(...);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F; ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果您想完全绕过Spring Data Couchbase的自动配置，请提供您自己的<code>org.springframework.data.couchbase.config.AbstractCouchbaseDataConfiguration</code>实现。</td>
</tr>
</tbody></table>
<h2 id="31-9-LDAP"><a href="#31-9-LDAP" class="headerlink" title="31.9 LDAP"></a>31.9 LDAP</h2><p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Lightweight_Directory_Access_Protocol">LDAP</a>（轻量级目录访问协议）是一种开放的，与供应商无关的行业标准应用程序协议，用于通过IP网络访问和维护分布式目录信息服务。Spring Boot为任何兼容的LDAP服务器提供自动配置，并为<a target="_blank" rel="noopener" href="https://www.ldap.com/unboundid-ldap-sdk-for-java">UnboundID</a>支持嵌入式内存中LDAP服务器 。</p>
<p>LDAP抽象由 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-data-ldap">Spring数据LDAP提供</a>。有一个<code>spring-boot-starter-data-ldap</code>“Starter”用于以方便的方式收集依赖项。</p>
<h3 id="31-9-1连接LDAP服务器"><a href="#31-9-1连接LDAP服务器" class="headerlink" title="31.9.1连接LDAP服务器"></a>31.9.1连接LDAP服务器</h3><p>要连接到LDAP服务器，请确保声明对<code>spring-boot-starter-data-ldap</code>“Starter”或<code>spring-ldap-core</code>的依赖关系，然后在application.properties中声明服务器的URL，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring.ldap.urls&#x3D;ldap:&#x2F;&#x2F;myserver:1235</span><br><span class="line">spring.ldap.username&#x3D;admin</span><br><span class="line">spring.ldap.password&#x3D;secret</span><br></pre></td></tr></table></figure>

<p>如果需要自定义连接设置，可以使用<code>spring.ldap.base</code>和<code>spring.ldap.base-environment</code>属性。</p>
<p>根据这些设置自动配置<code>LdapContextSource</code>。如果您需要自定义它，例如使用<code>PooledContextSource</code>，您仍然可以注入自动配置的<code>LdapContextSource</code>。请务必将自定义的<code>ContextSource</code>标记为<code>@Primary</code>，以便自动配置的<code>LdapTemplate</code>使用它。</p>
<h3 id="31-9-2-Spring数据LDAP存储库"><a href="#31-9-2-Spring数据LDAP存储库" class="headerlink" title="31.9.2 Spring数据LDAP存储库"></a>31.9.2 Spring数据LDAP存储库</h3><p>Spring数据包括LDAP的存储库支持。有关Spring数据LDAP的完整详细信息，请参阅 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-data/ldap/docs/1.0.x/reference/html/">参考文档</a>。</p>
<p>您也可以像对待任何其他Spring Bean一样注入自动配置的<code>LdapTemplate</code>实例，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class MyBean &#123;</span><br><span class="line"></span><br><span class="line">	private final LdapTemplate template;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	public MyBean(LdapTemplate template) &#123;</span><br><span class="line">		this.template &#x3D; template;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F; ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="31-9-3嵌入式内存LDAP服务器"><a href="#31-9-3嵌入式内存LDAP服务器" class="headerlink" title="31.9.3嵌入式内存LDAP服务器"></a>31.9.3嵌入式内存LDAP服务器</h3><p>出于测试目的，Spring Boot支持从<a target="_blank" rel="noopener" href="https://www.ldap.com/unboundid-ldap-sdk-for-java">UnboundID</a>自动配置内存中LDAP服务器。要配置服务器，请向<code>com.unboundid:unboundid-ldapsdk</code>添加依赖项并声明<code>base-dn</code>属性，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.ldap.embedded.base-dn&#x3D;dc&#x3D;spring,dc&#x3D;io</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>可以定义多个base-dn值，但是，由于可分辨名称通常包含逗号，因此必须使用正确的符号来定义它们。在yaml文件中，您可以使用yaml列表表示法：<code>spring.ldap.embedded.base-dn:  - dc=spring,dc=io  - dc=pivotal,dc=io</code>在属性文件中，必须包含索引作为属性名称的一部分：<code>spring.ldap.embedded.base-dn[0]=dc=spring,dc=io spring.ldap.embedded.base-dn[1]=dc=pivotal,dc=io</code></td>
</tr>
</tbody></table>
<p>默认情况下，服务器在随机端口上启动并触发常规LDAP支持。无需指定<code>spring.ldap.urls</code>属性。</p>
<p>如果类路径上有<code>schema.ldif</code>文件，则用于初始化服务器。如果要从其他资源加载初始化脚本，还可以使用<code>spring.ldap.embedded.ldif</code>属性。</p>
<p>默认情况下，标准模式用于验证<code>LDIF</code>文件。您可以通过设置<code>spring.ldap.embedded.validation.enabled</code>属性完全关闭验证。如果您有自定义属性，则可以使用<code>spring.ldap.embedded.validation.schema</code>来定义自定义属性类型或对象类。</p>
<h2 id="31-10-InfluxDB"><a href="#31-10-InfluxDB" class="headerlink" title="31.10 InfluxDB"></a>31.10 InfluxDB</h2><p><a target="_blank" rel="noopener" href="https://www.influxdata.com/">InfluxDB</a>是一个开源时间序列数据库，针对运营监控，应用程序指标，物联网传感器数据和实时分析等领域中的时间序列数据的快速，高可用性存储和检索进行了优化。</p>
<h3 id="31-10-1连接到InfluxDB"><a href="#31-10-1连接到InfluxDB" class="headerlink" title="31.10.1连接到InfluxDB"></a>31.10.1连接到InfluxDB</h3><p>Spring Boot自动配置<code>InfluxDB</code>实例，前提是<code>influxdb-java</code>客户端在类路径上并且设置了数据库的URL，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.influx.url&#x3D;http:&#x2F;&#x2F;172.0.0.1:8086</span><br></pre></td></tr></table></figure>

<p>如果与InfluxDB的连接需要用户和密码，则可以相应地设置<code>spring.influx.user</code>和<code>spring.influx.password</code>属性。</p>
<p>InfluxDB依赖于OkHttp。如果您需要在后台调整http客户端<code>InfluxDB</code>，则可以注册<code>InfluxDbOkHttpClientBuilderProvider</code> bean。</p>
<h2 id="32-缓存"><a href="#32-缓存" class="headerlink" title="32.缓存"></a>32.缓存</h2><p>Spring框架支持透明地向应用程序添加缓存。从本质上讲，抽象将缓存应用于方法，从而根据缓存中可用的信息减少执行次数。缓存逻辑应用透明，不会对调用者造成任何干扰。只要通过<code>@EnableCaching</code>注释启用了缓存支持，Spring Boot就会自动配置缓存基础结构。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/integration.html#cache">有关</a>详细信息，请查看Spring框架参考的<a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/integration.html#cache">相关部分</a>。</td>
</tr>
</tbody></table>
<p>简而言之，将缓存添加到服务操作就像在其方法中添加相关注释一样简单，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.cache.annotation.Cacheable;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">public class MathService &#123;</span><br><span class="line"></span><br><span class="line">	@Cacheable(&quot;piDecimals&quot;)</span><br><span class="line">	public int computePiDecimal(int i) &#123;</span><br><span class="line">		&#x2F;&#x2F; ...</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此示例演示了如何在可能代价高昂的操作上使用缓存。在调用<code>computePiDecimal</code>之前，抽象在<code>piDecimals</code>缓存中查找与<code>i</code>参数匹配的条目。如果找到条目，则缓存中的内容会立即返回给调用者，并且不会调用该方法。否则，将调用该方法，并在返回值之前更新缓存。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/caution.png" alt="[警告]"></th>
<th>警告</th>
</tr>
</thead>
<tbody><tr>
<td>您还可以透明地使用标准JSR-107（JCache）注释（例如<code>@CacheResult</code>）。但是，我们强烈建议您不要混用和匹配Spring Cache和JCache注释。</td>
<td></td>
</tr>
</tbody></table>
<p>如果您不添加任何特定的缓存库，Spring Boot会自动配置在内存中使用并发映射的 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-caching-provider-simple">简单提供程序</a>。当需要缓存时（例如前面示例中的<code>piDecimals</code>），此提供程序会为您创建缓存。简单的提供程序并不是真正推荐用于生产用途，但它非常适合入门并确保您了解这些功能。当您决定使用缓存提供程序时，请务必阅读其文档以了解如何配置应用程序使用的缓存。几乎所有提供程序都要求您显式配置在应用程序中使用的每个缓存。有些提供了一种自定义<code>spring.cache.cache-names</code>属性定义的默认缓存的方法。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>还可以透明地 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/integration.html#cache-annotations-put">更新</a>或 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/integration.html#cache-annotations-evict">逐出</a>缓存中的数据。</td>
</tr>
</tbody></table>
<h2 id="32-1支持的缓存提供程序"><a href="#32-1支持的缓存提供程序" class="headerlink" title="32.1支持的缓存提供程序"></a>32.1支持的缓存提供程序</h2><p>缓存抽象不提供实际存储，并依赖于<code>org.springframework.cache.Cache</code>和<code>org.springframework.cache.CacheManager</code>接口实现的抽象。</p>
<p>如果您尚未定义类型为<code>CacheManager</code>的bean或名为<code>cacheResolver</code>的<code>CacheResolver</code>（请参阅参考资料 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/javadoc-api/org/springframework/cache/annotation/CachingConfigurer.html"><code>CachingConfigurer</code></a>），则Spring Boot会尝试检测以下提供程序（按指示顺序）：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-caching-provider-generic">通用</a></li>
<li><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-caching-provider-jcache">JCache（JSR-107）</a>（EhCache 3，Hazelcast，Infinispan等）</li>
<li><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-caching-provider-ehcache2">EhCache 2.x</a></li>
<li><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-caching-provider-hazelcast">Hazelcast</a></li>
<li><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-caching-provider-infinispan">Infinispan</a></li>
<li><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-caching-provider-couchbase">Couchbase</a></li>
<li><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-caching-provider-redis">Redis</a></li>
<li><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-caching-provider-caffeine">Caffeine</a></li>
<li><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-caching-provider-simple">简单</a></li>
</ol>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>也可以通过设置<code>spring.cache.type</code>属性来<em>强制</em>特定的缓存提供程序。如果您需要在某些环境（例如测试）中<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-caching-provider-none">完全禁用缓存，</a>请使用此属性 。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>使用<code>spring-boot-starter-cache</code>“Starter”快速添加基本缓存依赖项。首发进入<code>spring-context-support</code>。如果手动添加依赖项，则必须包含<code>spring-context-support</code>才能使用JCache，EhCache 2.x或Guava支持。</td>
</tr>
</tbody></table>
<p>如果Wavefront自动配置<code>CacheManager</code>，则可以通过公开实现<code>CacheManagerCustomizer</code>接口的bean来完全初始化之前调整其配置。以下示例设置一个标志，表示应将null值传递给底层映射：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">public CacheManagerCustomizer&lt;ConcurrentMapCacheManager&gt; cacheManagerCustomizer() &#123;</span><br><span class="line">	return new CacheManagerCustomizer&lt;ConcurrentMapCacheManager&gt;() &#123;</span><br><span class="line">		@Override</span><br><span class="line">		public void customize(ConcurrentMapCacheManager cacheManager) &#123;</span><br><span class="line">			cacheManager.setAllowNullValues(false);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>在前面的示例中，预计会自动配置<code>ConcurrentMapCacheManager</code>。如果不是这种情况（您提供了自己的配置或自动配置了不同的缓存提供程序），则根本不会调用自定义程序。您可以拥有任意数量的自定义程序，也可以使用<code>@Order</code>或<code>Ordered</code>订购它们。</td>
</tr>
</tbody></table>
<h3 id="32-1-1通用"><a href="#32-1-1通用" class="headerlink" title="32.1.1通用"></a>32.1.1通用</h3><p>如果上下文定义<em>至少</em>一个<code>org.springframework.cache.Cache</code> bean，则使用通用缓存。创建了包含该类型的所有beans的<code>CacheManager</code>。</p>
<h3 id="32-1-2-JCache（JSR-107）"><a href="#32-1-2-JCache（JSR-107）" class="headerlink" title="32.1.2 JCache（JSR-107）"></a>32.1.2 JCache（JSR-107）</h3><p><a target="_blank" rel="noopener" href="https://jcp.org/en/jsr/detail?id=107">JCache</a>通过类路径上的<code>javax.cache.spi.CachingProvider</code>进行自举（即类路径上存在符合JSR-107的缓存库），<code>spring-boot-starter-cache</code>由<code>spring-boot-starter-cache</code>“Starter”提供。可以使用各种兼容库，Spring Boot为Ehcache 3，Hazelcast和Infinispan提供依赖关系管理。还可以添加任何其他兼容库。</p>
<p>可能会出现多个提供程序，在这种情况下必须明确指定提供程序。即使JSR-107标准没有强制使用标准化方法来定义配置文件的位置，Spring Boot也会尽力适应使用实现细节设置缓存，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">   # Only necessary if more than one provider is present</span><br><span class="line">spring.cache.jcache.provider&#x3D;com.acme.MyCachingProvider</span><br><span class="line">spring.cache.jcache.config&#x3D;classpath:acme.xml</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>当缓存库同时提供本机实现和JSR-107支持时，Spring Boot更喜欢JSR-107支持，因此如果切换到不同的JSR-107实现，则可以使用相同的功能。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>Spring Boot <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-hazelcast">普遍支持Hazelcast</a>。如果单个<code>HazelcastInstance</code>可用，它也会自动重用于<code>CacheManager</code>，除非指定了<code>spring.cache.jcache.config</code>属性。</td>
</tr>
</tbody></table>
<p>有两种方法可以自定义基础<code>javax.cache.cacheManager</code>：</p>
<ul>
<li>可以通过设置<code>spring.cache.cache-names</code>属性在启动时创建缓存。如果定义了自定义<code>javax.cache.configuration.Configuration</code> bean，则会使用它来自定义它们。</li>
<li>使用<code>CacheManager</code>的引用调用<code>org.springframework.boot.autoconfigure.cache.JCacheManagerCustomizer</code> beans进行完全自定义。</li>
</ul>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果定义了标准<code>javax.cache.CacheManager</code> bean，它将自动包装在抽象所需的<code>org.springframework.cache.CacheManager</code>实现中。没有进一步的自定义。</td>
</tr>
</tbody></table>
<h3 id="32-1-3-EhCache-2-x"><a href="#32-1-3-EhCache-2-x" class="headerlink" title="32.1.3 EhCache 2.x"></a>32.1.3 EhCache 2.x</h3><p>如果可以在类路径的根目录中找到名为<code>ehcache.xml</code>的文件，则使用<a target="_blank" rel="noopener" href="http://www.ehcache.org/">EhCache 2.x. </a>如果找到EhCache 2.x，则<code>spring-boot-starter-cache</code>“Starter”提供的<code>EhCacheCacheManager</code>用于引导缓存管理器。还可以提供备用配置文件，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.cache.ehcache.config&#x3D;classpath:config&#x2F;another-config.xml</span><br></pre></td></tr></table></figure>

<h3 id="32-1-4-Hazelcast"><a href="#32-1-4-Hazelcast" class="headerlink" title="32.1.4 Hazelcast"></a>32.1.4 Hazelcast</h3><p>Spring Boot <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-hazelcast">普遍支持Hazelcast</a>。如果已自动配置<code>HazelcastInstance</code>，则会自动将其包装在<code>CacheManager</code>中。</p>
<h3 id="32-1-5-Infinispan"><a href="#32-1-5-Infinispan" class="headerlink" title="32.1.5 Infinispan"></a>32.1.5 Infinispan</h3><p><a target="_blank" rel="noopener" href="http://infinispan.org/">Infinispan</a>没有默认配置文件位置，因此必须明确指定。否则，使用默认引导程序。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.cache.infinispan.config&#x3D;infinispan.xml</span><br></pre></td></tr></table></figure>

<p>可以通过设置<code>spring.cache.cache-names</code>属性在启动时创建缓存。如果定义了自定义<code>ConfigurationBuilder</code> bean，则它用于自定义缓存。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>Spring Boot中Infinispan的支持仅限于嵌入模式，并且非常基础。如果您想要更多选项，则应使用官方Infinispan Spring Boot启动器。有关更多详细信息，请参阅 <a target="_blank" rel="noopener" href="https://github.com/infinispan/infinispan-spring-boot">Infinispan的文档</a>。</td>
</tr>
</tbody></table>
<h3 id="32-1-6-Couchbase"><a href="#32-1-6-Couchbase" class="headerlink" title="32.1.6 Couchbase"></a>32.1.6 Couchbase</h3><p>如果<a target="_blank" rel="noopener" href="https://www.couchbase.com/">Couchbase</a> Java客户端和<code>couchbase-spring-cache</code>实现可用并且已<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-couchbase">配置</a> Couchbase ，则会自动配置<code>CouchbaseCacheManager</code>。通过设置<code>spring.cache.cache-names</code>属性，还可以在启动时创建其他缓存。这些缓存在自动配置的<code>Bucket</code>上运行。您可以<em>还</em>通过使用定制创建另一个<code>Bucket</code>额外的缓存。假设你需要两个缓存（<code>cache1</code>和<code>cache2</code>）在“主”<code>Bucket</code>和一个（<code>cache3</code>）缓存上，自定义时间为2秒，“另一个”<code>Bucket</code>。您可以通过配置创建前两个缓存，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.cache.cache-names&#x3D;cache1,cache2</span><br></pre></td></tr></table></figure>

<p>然后，您可以定义<code>@Configuration</code>类来配置额外的<code>Bucket</code>和<code>cache3</code>缓存，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class CouchbaseCacheConfiguration &#123;</span><br><span class="line"></span><br><span class="line">	private final Cluster cluster;</span><br><span class="line"></span><br><span class="line">	public CouchbaseCacheConfiguration(Cluster cluster) &#123;</span><br><span class="line">		this.cluster &#x3D; cluster;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Bean</span><br><span class="line">	public Bucket anotherBucket() &#123;</span><br><span class="line">		return this.cluster.openBucket(&quot;another&quot;, &quot;secret&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Bean</span><br><span class="line">	public CacheManagerCustomizer&lt;CouchbaseCacheManager&gt; cacheManagerCustomizer() &#123;</span><br><span class="line">		return c -&gt; &#123;</span><br><span class="line">			c.prepareCache(&quot;cache3&quot;, CacheBuilder.newInstance(anotherBucket())</span><br><span class="line">					.withExpiration(2));</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此示例配置重用通过自动配置创建的<code>Cluster</code>。</p>
<h3 id="32-1-7-Redis"><a href="#32-1-7-Redis" class="headerlink" title="32.1.7 Redis"></a>32.1.7 Redis</h3><p>如果<a target="_blank" rel="noopener" href="http://redis.io/">Redis</a>可用且已配置，则会自动配置<code>RedisCacheManager</code>。通过设置<code>spring.cache.cache-names</code>属性可以在启动时创建其他缓存，并且可以使用<code>spring.cache.redis.*</code>属性配置缓存默认值。例如，以下配置创建<code>cache1</code>和<code>cache2</code>缓存，<em>生存时间为</em> 10分钟：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.cache.cache-names&#x3D;cache1,cache2</span><br><span class="line">spring.cache.redis.time-to-live&#x3D;600000</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>默认情况下，会添加一个键前缀，以便在两个单独的缓存使用相同的键时，Redis没有重叠的键，并且不能返回无效值。如果您创建自己的<code>RedisCacheManager</code>，我们强烈建议您启用此设置。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>您可以通过添加自己的<code>RedisCacheConfiguration</code> <code>@Bean</code>来完全控制配置。如果您正在寻找自定义序列化策略，这可能很有用。</td>
</tr>
</tbody></table>
<h3 id="32-1-8-Caffeine"><a href="#32-1-8-Caffeine" class="headerlink" title="32.1.8 Caffeine"></a>32.1.8 Caffeine</h3><p><a target="_blank" rel="noopener" href="https://github.com/ben-manes/caffeine">Caffeine</a>是Java 8重写的Guava缓存，取代了对Guava的支持。如果存在Caffeine，则自动配置<code>CaffeineCacheManager</code>（由<code>spring-boot-starter-cache</code>“Starter”提供）。可以通过设置<code>spring.cache.cache-names</code>属性在启动时创建缓存，并且可以通过以下之一（按指示的顺序）自定义缓存：</p>
<ol>
<li>由<code>spring.cache.caffeine.spec</code>定义的缓存规范</li>
<li>定义了<code>com.github.benmanes.caffeine.cache.CaffeineSpec</code> bean</li>
<li>定义了<code>com.github.benmanes.caffeine.cache.Caffeine</code> bean</li>
</ol>
<p>例如，以下配置创建<code>cache1</code>和<code>cache2</code>缓存，最大大小为500，<em>生存时间为</em> 10分钟</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.cache.cache-names&#x3D;cache1,cache2</span><br><span class="line">spring.cache.caffeine.spec&#x3D;maximumSize&#x3D;500,expireAfterAccess&#x3D;600s</span><br></pre></td></tr></table></figure>

<p>如果定义了<code>com.github.benmanes.caffeine.cache.CacheLoader</code> bean，它将自动与<code>CaffeineCacheManager</code>相关联。由于<code>CacheLoader</code>将与缓存管理器管理的<em>所有</em>缓存关联，因此必须将其定义为<code>CacheLoader&lt;Object, Object&gt;</code>。自动配置忽略任何其他泛型类型。</p>
<h3 id="32-1-9简单"><a href="#32-1-9简单" class="headerlink" title="32.1.9简单"></a>32.1.9简单</h3><p>如果找不到其他提供程序，则配置使用<code>ConcurrentHashMap</code>作为缓存存储的简单实现。如果您的应用程序中没有缓存库，则这是默认值。默认情况下，会根据需要创建缓存，但您可以通过设置<code>cache-names</code>属性来限制可用缓存列表。例如，如果您只想要<code>cache1</code>和<code>cache2</code>缓存，请按如下所示设置<code>cache-names</code>属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.cache.cache-names&#x3D;cache1,cache2</span><br></pre></td></tr></table></figure>

<p>如果这样做并且您的应用程序使用未列出的缓存，则在需要缓存时它会在运行时失败，但在启动时则不会。这类似于“真实”缓存提供程序在使用未声明的缓存时的行为方式。</p>
<h3 id="32-1-10-None"><a href="#32-1-10-None" class="headerlink" title="32.1.10 None"></a>32.1.10 None</h3><p>当配置中存在<code>@EnableCaching</code>时，也需要合适的缓存配置。如果需要在某些环境中完全禁用缓存，请将缓存类型强制为<code>none</code>以使用no-op实现，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.cache.type&#x3D;none</span><br></pre></td></tr></table></figure>

<h2 id="33-消息传递"><a href="#33-消息传递" class="headerlink" title="33.消息传递"></a>33.消息传递</h2><p>Spring框架为与消息传递系统的集成提供了广泛的支持，从使用<code>JmsTemplate</code>的JMS API的简化使用到异步接收消息的完整基础结构。Spring AMQP为高级消息队列协议提供了类似的功能集。Spring Boot还为<code>RabbitTemplate</code>和RabbitMQ提供了自动配置选项。Spring WebSocket本身包含对STOMP消息传递的支持，Spring Boot通过启动器和少量自动配置支持。Spring Boot也支持Apache Kafka。</p>
<h2 id="33-1-JMS"><a href="#33-1-JMS" class="headerlink" title="33.1 JMS"></a>33.1 JMS</h2><p><code>javax.jms.ConnectionFactory</code>接口提供了一种创建<code>javax.jms.Connection</code>的标准方法，用于与JMS代理进行交互。虽然Spring需要<code>ConnectionFactory</code>来使用JMS，但您通常不需要自己直接使用它，而是可以依赖更高级别的消息传递抽象。（有关详细信息，请参阅Spring框架参考文档的 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/integration.html#jms">相关部分</a>。）Spring Boot还自动配置发送和接收消息所需的基础结构。</p>
<h3 id="33-1-1-ActiveMQ支持"><a href="#33-1-1-ActiveMQ支持" class="headerlink" title="33.1.1 ActiveMQ支持"></a>33.1.1 ActiveMQ支持</h3><p>当<a target="_blank" rel="noopener" href="http://activemq.apache.org/">ActiveMQ</a>在类路径上可用时，Spring Boot也可以配置<code>ConnectionFactory</code>。如果代理存在，则会自动启动并配置嵌入式代理（前提是未通过配置指定代理URL）。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果使用<code>spring-boot-starter-activemq</code>，则提供连接或嵌入ActiveMQ实例的必要依赖项，以及与JMS集成的Spring基础结构。</td>
</tr>
</tbody></table>
<p>ActiveMQ配置由<code>spring.activemq.*</code>中的外部配置属性控制。例如，您可以在<code>application.properties</code>中声明以下部分：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring.activemq.broker-url&#x3D;tcp:&#x2F;&#x2F;192.168.1.210:9876</span><br><span class="line">spring.activemq.user&#x3D;admin</span><br><span class="line">spring.activemq.password&#x3D;secret</span><br></pre></td></tr></table></figure>

<p>默认情况下，<code>CachingConnectionFactory</code>使用<code>spring.jms.*</code>中的外部配置属性可以控制的合理设置包装本机<code>ConnectionFactory</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.jms.cache.session-cache-size&#x3D;5</span><br></pre></td></tr></table></figure>

<p>如果您更愿意使用本机池，则可以通过向<code>org.messaginghub:pooled-jms</code>添加依赖项并相应地配置<code>JmsPoolConnectionFactory</code>来实现，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.activemq.pool.enabled&#x3D;true</span><br><span class="line">spring.activemq.pool.max-connections&#x3D;50</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>有关<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jms/activemq/ActiveMQProperties.java"><code>ActiveMQProperties</code></a> 更多支持的选项，请参阅 。您还可以注册实现<code>ActiveMQConnectionFactoryCustomizer</code>的任意数量的beans以进行更高级的自定义。</td>
</tr>
</tbody></table>
<p>默认情况下，ActiveMQ会创建一个目标（如果它尚不存在），以便根据提供的名称解析目标。</p>
<h3 id="33-1-2阿耳忒弥斯支持"><a href="#33-1-2阿耳忒弥斯支持" class="headerlink" title="33.1.2阿耳忒弥斯支持"></a>33.1.2阿耳忒弥斯支持</h3><p>Spring Boot可以在检测到类路径上的<a target="_blank" rel="noopener" href="http://activemq.apache.org/artemis/">Artemis</a>可用时自动配置<code>ConnectionFactory</code> 。如果存在代理，则会自动启动并配置嵌入式代理（除非已明确设置mode属性）。支持的模式是<code>embedded</code>（以明确表示需要嵌入式代理，如果代理路径在类路径上不可用则发生错误）和<code>native</code>（使用{11 /连接到代理）传输协议）。配置后者时，Spring Boot使用默认设置配置连接到本地计算机上运行的代理的<code>ConnectionFactory</code>。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果使用<code>spring-boot-starter-artemis</code>，则会提供连接到现有Artemis实例的必要依赖项，以及与JMS集成的Spring基础结构。将<code>org.apache.activemq:artemis-jms-server</code>添加到您的应用程序可让您使用嵌入模式。</td>
</tr>
</tbody></table>
<p>Artemis配置由<code>spring.artemis.*</code>中的外部配置属性控制。例如，您可以在<code>application.properties</code>中声明以下部分：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">spring.artemis.mode&#x3D;native</span><br><span class="line">spring.artemis.host&#x3D;192.168.1.210</span><br><span class="line">spring.artemis.port&#x3D;9876</span><br><span class="line">spring.artemis.user&#x3D;admin</span><br><span class="line">spring.artemis.password&#x3D;secret</span><br></pre></td></tr></table></figure>

<p>嵌入代理时，您可以选择是否要启用持久性并列出应该可用的目标。这些可以指定为逗号分隔列表以使用默认选项创建它们，或者您可以分别为高级队列和主题配置定义<code>org.apache.activemq.artemis.jms.server.config.JMSQueueConfiguration</code>或<code>org.apache.activemq.artemis.jms.server.config.TopicConfiguration</code>类型的bean。</p>
<p>默认情况下，<code>CachingConnectionFactory</code>使用<code>spring.jms.*</code>中的外部配置属性可以控制的合理设置包装本机<code>ConnectionFactory</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.jms.cache.session-cache-size&#x3D;5</span><br></pre></td></tr></table></figure>

<p>如果您更愿意使用本机池，则可以通过向<code>org.messaginghub:pooled-jms</code>添加依赖关系并相应地配置<code>JmsPoolConnectionFactory</code>来实现，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.artemis.pool.enabled&#x3D;true</span><br><span class="line">spring.artemis.pool.max-connections&#x3D;50</span><br></pre></td></tr></table></figure>

<p>有关<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jms/artemis/ArtemisProperties.java"><code>ArtemisProperties</code></a> 更多支持选项，请参阅</p>
<p>不使用JNDI查找，并使用Artemis配置中的<code>name</code>属性或通过配置提供的名称来解析目标名称。</p>
<h3 id="33-1-3使用JNDI-ConnectionFactory"><a href="#33-1-3使用JNDI-ConnectionFactory" class="headerlink" title="33.1.3使用JNDI ConnectionFactory"></a>33.1.3使用JNDI ConnectionFactory</h3><p>如果您在应用程序服务器中运行应用程序，Spring Boot会尝试使用JNDI找到JMS <code>ConnectionFactory</code>。默认情况下，会检查<code>java:/JmsXA</code>和<code>java:/XAConnectionFactory</code>位置。如果需要指定备用位置，可以使用<code>spring.jms.jndi-name</code>属性，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.jms.jndi-name&#x3D;java:&#x2F;MyConnectionFactory</span><br></pre></td></tr></table></figure>

<h3 id="33-1-4发送消息"><a href="#33-1-4发送消息" class="headerlink" title="33.1.4发送消息"></a>33.1.4发送消息</h3><p>Spring的<code>JmsTemplate</code>是自动配置的，您可以将其直接自动装入您自己的beans，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.jms.core.JmsTemplate;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">public class MyBean &#123;</span><br><span class="line"></span><br><span class="line">	private final JmsTemplate jmsTemplate;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	public MyBean(JmsTemplate jmsTemplate) &#123;</span><br><span class="line">		this.jmsTemplate &#x3D; jmsTemplate;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F; ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/javadoc-api/org/springframework/jms/core/JmsMessagingTemplate.html"><code>JmsMessagingTemplate</code></a>可以以类似的方式注射。如果定义了<code>DestinationResolver</code>或<code>MessageConverter</code> bean，则会自动将其与自动配置的<code>JmsTemplate</code>相关联。</td>
</tr>
</tbody></table>
<h3 id="33-1-5接收消息"><a href="#33-1-5接收消息" class="headerlink" title="33.1.5接收消息"></a>33.1.5接收消息</h3><p>当存在JMS基础结构时，可以使用<code>@JmsListener</code>注释任何bean以创建侦听器端点。如果未定义<code>JmsListenerContainerFactory</code>，则会自动配置默认值。如果定义了<code>DestinationResolver</code>或<code>MessageConverter</code> beans，它将自动关联到默认工厂。</p>
<p>默认情况下，默认工厂是事务性的。如果您在存在<code>JtaTransactionManager</code>的基础结构中运行，则默认情况下它与侦听器容器关联。如果不是，则启用<code>sessionTransacted</code>标志。在后一种情况下，您可以通过在侦听器方法（或其委托）上添加<code>@Transactional</code>，将本地数据存储事务与传入消息的处理相关联。这确保了在本地事务完成后确认传入消息。这还包括发送已在同一JMS会话上执行的响应消息。</p>
<p>以下组件在<code>someQueue</code>目标上创建一个侦听器端点：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class MyBean &#123;</span><br><span class="line"></span><br><span class="line">	@JmsListener(destination &#x3D; &quot;someQueue&quot;)</span><br><span class="line">	public void processMessage(String content) &#123;</span><br><span class="line">		&#x2F;&#x2F; ...</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>有关 更多详细信息，请参阅<a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/javadoc-api/org/springframework/jms/annotation/EnableJms.html"><code>@EnableJms</code>的Javadoc</a>。</td>
</tr>
</tbody></table>
<p>如果您需要创建更多<code>JmsListenerContainerFactory</code>实例，或者如果要覆盖默认值，Spring Boot提供<code>DefaultJmsListenerContainerFactoryConfigurer</code>，您可以使用<code>DefaultJmsListenerContainerFactoryConfigurer</code>来初始化<code>DefaultJmsListenerContainerFactory</code>，其设置与自动配置。</p>
<p>例如，以下示例公开了另一个使用特定<code>MessageConverter</code>的工厂：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">static class JmsConfiguration &#123;</span><br><span class="line"></span><br><span class="line">	@Bean</span><br><span class="line">	public DefaultJmsListenerContainerFactory myFactory(</span><br><span class="line">			DefaultJmsListenerContainerFactoryConfigurer configurer) &#123;</span><br><span class="line">		DefaultJmsListenerContainerFactory factory &#x3D;</span><br><span class="line">				new DefaultJmsListenerContainerFactory();</span><br><span class="line">		configurer.configure(factory, connectionFactory());</span><br><span class="line">		factory.setMessageConverter(myMessageConverter());</span><br><span class="line">		return factory;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后您可以在任何<code>@JmsListener</code> - 注释方法中使用工厂，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class MyBean &#123;</span><br><span class="line"></span><br><span class="line">	@JmsListener(destination &#x3D; &quot;someQueue&quot;, containerFactory&#x3D;&quot;myFactory&quot;)</span><br><span class="line">	public void processMessage(String content) &#123;</span><br><span class="line">		&#x2F;&#x2F; ...</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="33-2-AMQP"><a href="#33-2-AMQP" class="headerlink" title="33.2 AMQP"></a>33.2 AMQP</h2><p>高级消息队列协议（AMQP）是面向消息的中间件的平台中立的线级协议。Spring AMQP项目将核心Spring概念应用于基于AMQP的消息传递解决方案的开发。Spring Boot为通过RabbitMQ使用AMQP提供了一些便利，包括<code>spring-boot-starter-amqp</code>“Starter”。</p>
<h3 id="33-2-1-RabbitMQ支持"><a href="#33-2-1-RabbitMQ支持" class="headerlink" title="33.2.1 RabbitMQ支持"></a>33.2.1 RabbitMQ支持</h3><p><a target="_blank" rel="noopener" href="https://www.rabbitmq.com/">RabbitMQ</a>是一个基于AMQP协议的轻量级，可靠，可扩展且可移植的消息代理。Spring使用<code>RabbitMQ</code>通过AMQP协议进行通信。</p>
<p>RabbitMQ配置由<code>spring.rabbitmq.*</code>中的外部配置属性控制。例如，您可以在<code>application.properties</code>中声明以下部分：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">spring.rabbitmq.host&#x3D;localhost</span><br><span class="line">spring.rabbitmq.port&#x3D;5672</span><br><span class="line">spring.rabbitmq.username&#x3D;admin</span><br><span class="line">spring.rabbitmq.password&#x3D;secret</span><br></pre></td></tr></table></figure>

<p>如果上下文中存在<code>ConnectionNameStrategy</code> bean，它将自动用于命名由自动配置的<code>ConnectionFactory</code>创建的连接。有关<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/amqp/RabbitProperties.java"><code>RabbitProperties</code></a>更多支持的选项，请参阅 。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>有关详细信息<a target="_blank" rel="noopener" href="https://spring.io/blog/2010/06/14/understanding-amqp-the-protocol-used-by-rabbitmq/">，</a>请参阅 <a target="_blank" rel="noopener" href="https://spring.io/blog/2010/06/14/understanding-amqp-the-protocol-used-by-rabbitmq/">了解AMQP，RabbitMQ使用的协议</a>。</td>
</tr>
</tbody></table>
<h3 id="33-2-2发送消息"><a href="#33-2-2发送消息" class="headerlink" title="33.2.2发送消息"></a>33.2.2发送消息</h3><p>Spring的<code>AmqpTemplate</code>和<code>AmqpAdmin</code>是自动配置的，您可以将它们直接自动装入您自己的beans，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.amqp.core.AmqpAdmin;</span><br><span class="line">import org.springframework.amqp.core.AmqpTemplate;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">public class MyBean &#123;</span><br><span class="line"></span><br><span class="line">	private final AmqpAdmin amqpAdmin;</span><br><span class="line">	private final AmqpTemplate amqpTemplate;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	public MyBean(AmqpAdmin amqpAdmin, AmqpTemplate amqpTemplate) &#123;</span><br><span class="line">		this.amqpAdmin &#x3D; amqpAdmin;</span><br><span class="line">		this.amqpTemplate &#x3D; amqpTemplate;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F; ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-amqp/docs/current/api/org/springframework/amqp/rabbit/core/RabbitMessagingTemplate.html"><code>RabbitMessagingTemplate</code></a> 可以以类似的方式注射。如果定义了<code>MessageConverter</code> bean，它将自动关联到自动配置的<code>AmqpTemplate</code>。</td>
</tr>
</tbody></table>
<p>如有必要，任何定义为bean的<code>org.springframework.amqp.core.Queue</code>都将自动用于在RabbitMQ实例上声明相应的队列。</p>
<p>要重试操作，可以在<code>AmqpTemplate</code>上启用重试（例如，在代理连接丢失的情况下）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.rabbitmq.template.retry.enabled&#x3D;true</span><br><span class="line">spring.rabbitmq.template.retry.initial-interval&#x3D;2s</span><br></pre></td></tr></table></figure>

<p>默认情况下禁用重试。您还可以通过声明<code>RabbitRetryTemplateCustomizer</code> bean以编程方式自定义<code>RetryTemplate</code>。</p>
<h3 id="33-2-3接收消息"><a href="#33-2-3接收消息" class="headerlink" title="33.2.3接收消息"></a>33.2.3接收消息</h3><p>当Rabbit基础结构存在时，任何bean都可以使用<code>@RabbitListener</code>进行注释以创建侦听器端点。如果未定义<code>RabbitListenerContainerFactory</code>，则会自动配置默认值<code>SimpleRabbitListenerContainerFactory</code>，您可以使用<code>spring.rabbitmq.listener.type</code>属性切换到直接容器。如果定义了<code>MessageConverter</code>或<code>MessageRecoverer</code> bean，它将自动与默认工厂关联。</p>
<p>以下示例组件在<code>someQueue</code>队列上创建一个侦听器端点：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class MyBean &#123;</span><br><span class="line"></span><br><span class="line">	@RabbitListener(queues &#x3D; &quot;someQueue&quot;)</span><br><span class="line">	public void processMessage(String content) &#123;</span><br><span class="line">		&#x2F;&#x2F; ...</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>有关详细信息，请参阅<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-amqp/docs/current/api/org/springframework/amqp/rabbit/annotation/EnableRabbit.html"><code>@EnableRabbit</code>的Javadoc</a>。</td>
</tr>
</tbody></table>
<p>如果您需要创建更多<code>RabbitListenerContainerFactory</code>个实例，或者如果要覆盖默认值，Spring Boot会提供<code>SimpleRabbitListenerContainerFactoryConfigurer</code>和<code>DirectRabbitListenerContainerFactoryConfigurer</code>，您可以使用它来初始化<code>SimpleRabbitListenerContainerFactory</code>和<code>DirectRabbitListenerContainerFactory</code>具有与自动配置使用的工厂相同的设置。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>您选择的容器类型无关紧要。这两个beans由自动配置公开。</td>
</tr>
</tbody></table>
<p>例如，以下配置类公开了另一个使用特定<code>MessageConverter</code>的工厂：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">static class RabbitConfiguration &#123;</span><br><span class="line"></span><br><span class="line">	@Bean</span><br><span class="line">	public SimpleRabbitListenerContainerFactory myFactory(</span><br><span class="line">			SimpleRabbitListenerContainerFactoryConfigurer configurer) &#123;</span><br><span class="line">		SimpleRabbitListenerContainerFactory factory &#x3D;</span><br><span class="line">				new SimpleRabbitListenerContainerFactory();</span><br><span class="line">		configurer.configure(factory, connectionFactory);</span><br><span class="line">		factory.setMessageConverter(myMessageConverter());</span><br><span class="line">		return factory;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后你可以在任何<code>@RabbitListener</code> - 注释方法中使用工厂，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class MyBean &#123;</span><br><span class="line"></span><br><span class="line">	@RabbitListener(queues &#x3D; &quot;someQueue&quot;, containerFactory&#x3D;&quot;myFactory&quot;)</span><br><span class="line">	public void processMessage(String content) &#123;</span><br><span class="line">		&#x2F;&#x2F; ...</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>您可以启用重试来处理侦听器抛出异常的情况。默认情况下，使用<code>RejectAndDontRequeueRecoverer</code>，但您可以定义自己的<code>MessageRecoverer</code>。当重试耗尽时，如果代理配置了这样做，则拒绝该消息并将其丢弃或路由到死信交换。默认情况下，禁用重试。您还可以通过声明<code>RabbitRetryTemplateCustomizer</code> bean以编程方式自定义<code>RetryTemplate</code>。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/important.png" alt="[重要]"></th>
<th>重要</th>
</tr>
</thead>
<tbody><tr>
<td>默认情况下，如果禁用重试并且侦听器抛出异常，则会无限期地重试传递。您可以通过两种方式修改此行为：将<code>defaultRequeueRejected</code>属性设置为<code>false</code>，以便尝试零重新传递或抛出<code>AmqpRejectAndDontRequeueException</code>以表示应拒绝该消息。后者是启用重试并且达到最大传递尝试次数时使用的机制。</td>
<td></td>
</tr>
</tbody></table>
<h2 id="33-3-Apache-Kafka支持"><a href="#33-3-Apache-Kafka支持" class="headerlink" title="33.3 Apache Kafka支持"></a>33.3 Apache Kafka支持</h2><p>通过提供<code>spring-kafka</code>项目的自动配置来支持<a target="_blank" rel="noopener" href="https://kafka.apache.org/">Apache Kafka</a>。</p>
<p>Kafka配置由<code>spring.kafka.*</code>中的外部配置属性控制。例如，您可以在<code>application.properties</code>中声明以下部分：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.kafka.bootstrap-servers&#x3D;localhost:9092</span><br><span class="line">spring.kafka.consumer.group-id&#x3D;myGroup</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>要在启动时创建主题，请添加bean类型<code>NewTopic</code>。如果主题已存在，则忽略bean。</td>
</tr>
</tbody></table>
<p>有关<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/kafka/KafkaProperties.java"><code>KafkaProperties</code></a> 更多支持选项，请参阅</p>
<h3 id="33-3-1发送消息"><a href="#33-3-1发送消息" class="headerlink" title="33.3.1发送消息"></a>33.3.1发送消息</h3><p>Spring的<code>KafkaTemplate</code>是自动配置的，您可以直接在自己的beans中自动装配它，如下例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class MyBean &#123;</span><br><span class="line"></span><br><span class="line">	private final KafkaTemplate kafkaTemplate;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	public MyBean(KafkaTemplate kafkaTemplate) &#123;</span><br><span class="line">		this.kafkaTemplate &#x3D; kafkaTemplate;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F; ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果定义了属性<code>spring.kafka.producer.transaction-id-prefix</code>，则会自动配置<code>KafkaTransactionManager</code>。此外，如果定义了<code>RecordMessageConverter</code> bean，它将自动与自动配置的<code>KafkaTemplate</code>相关联。</td>
</tr>
</tbody></table>
<h3 id="33-3-2接收消息"><a href="#33-3-2接收消息" class="headerlink" title="33.3.2接收消息"></a>33.3.2接收消息</h3><p>当存在Apache Kafka基础结构时，可以使用<code>@KafkaListener</code>注释任何bean以创建侦听器端点。如果未定义<code>KafkaListenerContainerFactory</code>，则会使用<code>spring.kafka.listener.*</code>中定义的键自动配置默认值。</p>
<p>以下组件在<code>someTopic</code>主题上创建一个侦听器端点：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class MyBean &#123;</span><br><span class="line"></span><br><span class="line">	@KafkaListener(topics &#x3D; &quot;someTopic&quot;)</span><br><span class="line">	public void processMessage(String content) &#123;</span><br><span class="line">		&#x2F;&#x2F; ...</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果定义了<code>KafkaTransactionManager</code> bean，它将自动关联到容器工厂。同样，如果定义了<code>RecordMessageConverter</code>，<code>ErrorHandler</code>或<code>AfterRollbackProcessor</code> bean，它将自动与默认工厂相关联。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>自定义<code>ChainedKafkaTransactionManager</code>必须标记为<code>@Primary</code>，因为它通常会引用自动配置的<code>KafkaTransactionManager</code> bean。</td>
</tr>
</tbody></table>
<h3 id="33-3-3卡夫卡流"><a href="#33-3-3卡夫卡流" class="headerlink" title="33.3.3卡夫卡流"></a>33.3.3卡夫卡流</h3><p>Apache Kafka的Spring提供了一个工厂bean来创建一个<code>StreamsBuilder</code>对象并管理其流的生命周期。Spring Boot只要<code>kafka-streams</code>在类路径上，并且通过<code>@EnableKafkaStreams</code>注释启用Kafka Streams，就会自动配置所需的<code>KafkaStreamsConfiguration</code> bean。</p>
<p>启用Kafka Streams意味着必须设置应用程序ID和引导程序服务器。可以使用<code>spring.kafka.streams.application-id</code>配置前者，如果未设置，则默认为<code>spring.application.name</code>。后者可以全局设置或专门为流而重写。</p>
<p>使用专用属性可以使用其他几个属性; 可以使用<code>spring.kafka.streams.properties</code>命名空间设置其他任意Kafka属性。有关更多信息<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-kafka-extra-props">，</a>另请参见<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-kafka-extra-props">第33.3.4节“其他Kafka属性”</a>。</p>
<p>要使用工厂bean，只需将<code>StreamsBuilder</code>连接到<code>@Bean</code>，如下例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@EnableKafkaStreams</span><br><span class="line">static class KafkaStreamsExampleConfiguration &#123;</span><br><span class="line"></span><br><span class="line">	@Bean</span><br><span class="line">	public KStream&lt;Integer, String&gt; kStream(StreamsBuilder streamsBuilder) &#123;</span><br><span class="line">		KStream&lt;Integer, String&gt; stream &#x3D; streamsBuilder.stream(&quot;ks1In&quot;);</span><br><span class="line">		stream.map((k, v) -&gt; new KeyValue&lt;&gt;(k, v.toUpperCase())).to(&quot;ks1Out&quot;,</span><br><span class="line">				Produced.with(Serdes.Integer(), new JsonSerde&lt;&gt;()));</span><br><span class="line">		return stream;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>默认情况下，由其创建的<code>StreamBuilder</code>对象管理的流将自动启动。您可以使用<code>spring.kafka.streams.auto-startup</code>属性自定义此行为。</p>
<h3 id="33-3-4附加Kafka属性"><a href="#33-3-4附加Kafka属性" class="headerlink" title="33.3.4附加Kafka属性"></a>33.3.4附加Kafka属性</h3><p>自动配置支持的属性显示在 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#common-application-properties">附录A，<em>常见应用程序属性中</em></a>。请注意，在大多数情况下，这些属性（连字符或camelCase）直接映射到Apache Kafka点状属性。有关详细信息，请参阅Apache Kafka文档。</p>
<p>这些属性中的前几个适用于所有组件（生产者，使用者，管理员和流），但如果您希望使用不同的值，则可以在组件级别指定。Apache Kafka指定重要性为HIGH，MEDIUM或LOW的属性。Spring Boot auto-configuration支持所有HIGH重要性属性，一些选定的MEDIUM和LOW属性，以及任何没有默认值的属性。</p>
<p>只有Kafka支持的属性的一部分可以通过<code>KafkaProperties</code>类直接获得。如果您希望使用不直接支持的其他属性配置生产者或使用者，请使用以下属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">spring.kafka.properties.prop.one&#x3D;first</span><br><span class="line">spring.kafka.admin.properties.prop.two&#x3D;second</span><br><span class="line">spring.kafka.consumer.properties.prop.three&#x3D;third</span><br><span class="line">spring.kafka.producer.properties.prop.four&#x3D;fourth</span><br><span class="line">spring.kafka.streams.properties.prop.five&#x3D;fifth</span><br></pre></td></tr></table></figure>

<p>这将常见的<code>prop.one</code> Kafka属性设置为<code>first</code>（适用于生产者，消费者和管理员），将<code>prop.two</code> admin属性设置为<code>second</code>，将<code>prop.three</code>使用者属性设置为<code>third</code> ，<code>prop.four</code>生产者属性为<code>fourth</code>，<code>prop.five</code>流属性为<code>fifth</code>。</p>
<p>您还可以按如下方式配置Spring Kafka <code>JsonDeserializer</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring.kafka.consumer.value-deserializer&#x3D;org.springframework.kafka.support.serializer.JsonDeserializer</span><br><span class="line">spring.kafka.consumer.properties.spring.json.value.default.type&#x3D;com.example.Invoice</span><br><span class="line">spring.kafka.consumer.properties.spring.json.trusted.packages&#x3D;com.example,org.acme</span><br></pre></td></tr></table></figure>

<p>同样，您可以禁用在标头中发送类型信息的<code>JsonSerializer</code>默认行为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.kafka.producer.value-serializer&#x3D;org.springframework.kafka.support.serializer.JsonSerializer</span><br><span class="line">spring.kafka.producer.properties.spring.json.add.type.headers&#x3D;false</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/important.png" alt="[重要]"></th>
<th>重要</th>
</tr>
</thead>
<tbody><tr>
<td>以这种方式设置的属性会覆盖Spring Boot明确支持的任何配置项。</td>
<td></td>
</tr>
</tbody></table>
<h2 id="34-使用RestTemplate调用REST服务"><a href="#34-使用RestTemplate调用REST服务" class="headerlink" title="34.使用RestTemplate调用REST服务"></a>34.使用<code>RestTemplate</code>调用REST服务</h2><p>如果需要从应用程序调用远程REST服务，可以使用Spring Framework的<a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/javadoc-api/org/springframework/web/client/RestTemplate.html"><code>RestTemplate</code></a>类。由于<code>RestTemplate</code>实例在使用之前通常需要进行自定义，因此Spring Boot不提供任何单个自动配置<code>RestTemplate</code> bean。但是，它会自动配置<code>RestTemplateBuilder</code>，可在需要时用于创建<code>RestTemplate</code>实例。自动配置的<code>RestTemplateBuilder</code>确保将合理的<code>HttpMessageConverters</code>应用于<code>RestTemplate</code>实例。</p>
<p>以下代码显示了一个典型示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Service</span><br><span class="line">public class MyService &#123;</span><br><span class="line"></span><br><span class="line">	private final RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">	public MyService(RestTemplateBuilder restTemplateBuilder) &#123;</span><br><span class="line">		this.restTemplate &#x3D; restTemplateBuilder.build();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public Details someRestCall(String name) &#123;</span><br><span class="line">		return this.restTemplate.getForObject(&quot;&#x2F;&#123;name&#125;&#x2F;details&quot;, Details.class, name);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td><code>RestTemplateBuilder</code>包含许多可用于快速配置<code>RestTemplate</code>的有用方法。例如，要添加BASIC auth支持，可以使用<code>builder.basicAuthentication(&quot;user&quot;, &quot;password&quot;).build()</code>。</td>
</tr>
</tbody></table>
<h2 id="34-1-RestTemplate自定义"><a href="#34-1-RestTemplate自定义" class="headerlink" title="34.1 RestTemplate自定义"></a>34.1 RestTemplate自定义</h2><p><code>RestTemplate</code>自定义有三种主要方法，具体取决于您希望自定义应用的广泛程度。</p>
<p>要使任何自定义的范围尽可能窄，请注入自动配置的<code>RestTemplateBuilder</code>，然后根据需要调用其方法。每个方法调用都返回一个新的<code>RestTemplateBuilder</code>实例，因此自定义只会影响构建器的这种使用。</p>
<p>要进行应用程序范围的附加自定义，请使用<code>RestTemplateCustomizer</code> bean。所有这些beans都会自动注册到自动配置的<code>RestTemplateBuilder</code>，并应用于使用它构建的任何模板。</p>
<p>以下示例显示了一个自定义程序，它为除<code>192.168.0.5</code>之外的所有主机配置代理的使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">static class ProxyCustomizer implements RestTemplateCustomizer &#123;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public void customize(RestTemplate restTemplate) &#123;</span><br><span class="line">		HttpHost proxy &#x3D; new HttpHost(&quot;proxy.example.com&quot;);</span><br><span class="line">		HttpClient httpClient &#x3D; HttpClientBuilder.create()</span><br><span class="line">				.setRoutePlanner(new DefaultProxyRoutePlanner(proxy) &#123;</span><br><span class="line"></span><br><span class="line">					@Override</span><br><span class="line">					public HttpHost determineProxy(HttpHost target,</span><br><span class="line">							HttpRequest request, HttpContext context)</span><br><span class="line">							throws HttpException &#123;</span><br><span class="line">						if (target.getHostName().equals(&quot;192.168.0.5&quot;)) &#123;</span><br><span class="line">							return null;</span><br><span class="line">						&#125;</span><br><span class="line">						return super.determineProxy(target, request, context);</span><br><span class="line">					&#125;</span><br><span class="line"></span><br><span class="line">				&#125;).build();</span><br><span class="line">		restTemplate.setRequestFactory(</span><br><span class="line">				new HttpComponentsClientHttpRequestFactory(httpClient));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后，最极端（也很少使用）的选项是创建自己的<code>RestTemplateBuilder</code> bean。这样做会关闭<code>RestTemplateBuilder</code>的自动配置，并阻止使用任何<code>RestTemplateCustomizer</code> beans。</p>
<h2 id="35-使用WebClient调用REST服务"><a href="#35-使用WebClient调用REST服务" class="headerlink" title="35.使用WebClient调用REST服务"></a>35.使用<code>WebClient</code>调用REST服务</h2><p>如果您的类路径上有Spring WebFlux，您还可以选择使用<code>WebClient</code>来调用远程REST服务。与<code>RestTemplate</code>相比，该客户端具有更多功能感并且完全被动。您可以<a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/web-reactive.html#webflux-client">在Spring框架文档</a>的专用<a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/web-reactive.html#webflux-client">部分中</a>了解有关<code>WebClient</code>的更多信息 。</p>
<p>Spring Boot为您创建并预先配置<code>WebClient.Builder</code>; 强烈建议将其注入您的组件并使用它来创建<code>WebClient</code>实例。Spring Boot正在配置该构建器以共享HTTP资源，以与服务器相同的方式反映编解码器设置（请参阅 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-webflux-httpcodecs">WebFlux HTTP编解码器自动配置</a>）等。</p>
<p>以下代码显示了一个典型示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@Service</span><br><span class="line">public class MyService &#123;</span><br><span class="line"></span><br><span class="line">	private final WebClient webClient;</span><br><span class="line"></span><br><span class="line">	public MyService(WebClient.Builder webClientBuilder) &#123;</span><br><span class="line">		this.webClient &#x3D; webClientBuilder.baseUrl(&quot;http:&#x2F;&#x2F;example.org&quot;).build();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public Mono&lt;Details&gt; someRestCall(String name) &#123;</span><br><span class="line">		return this.webClient.get().uri(&quot;&#x2F;&#123;name&#125;&#x2F;details&quot;, name)</span><br><span class="line">						.retrieve().bodyToMono(Details.class);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="35-1-WebClient运行时"><a href="#35-1-WebClient运行时" class="headerlink" title="35.1 WebClient运行时"></a>35.1 WebClient运行时</h2><p>Spring Boot将自动检测用于驱动<code>WebClient</code>的<code>ClientHttpConnector</code>，具体取决于应用程序类路径上可用的库。目前，支持Reactor Netty和Jetty RS客户端。</p>
<p><code>spring-boot-starter-webflux</code>启动程序默认依赖于<code>io.projectreactor.netty:reactor-netty</code>，它带来了服务器和客户端实现。如果您选择将Jetty用作反应式服务器，则应该在Jetty Reactive HTTP客户端库<code>org.eclipse.jetty:jetty-reactive-httpclient</code>上添加依赖项。对服务器和客户端使用相同的技术具有优势，因为它将自动在客户端和服务器之间共享HTTP资源。</p>
<p>开发人员可以通过提供自定义<code>ReactorResourceFactory</code>或<code>JettyResourceFactory</code> bean覆盖Jetty和Reactor Netty的资源配置 - 这将应用于客户端和服务器。</p>
<p>如果您希望覆盖客户端的该选项，您可以定义自己的<code>ClientHttpConnector</code> bean并完全控制客户端配置。</p>
<p>您可以<a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/web-reactive.html#webflux-client-builder">在Spring框架参考文档中</a>了解有关<a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/web-reactive.html#webflux-client-builder"><code>WebClient</code>配置选项的</a>更多信息 。</p>
<h2 id="35-2-WebClient自定义"><a href="#35-2-WebClient自定义" class="headerlink" title="35.2 WebClient自定义"></a>35.2 WebClient自定义</h2><p><code>WebClient</code>自定义有三种主要方法，具体取决于您希望自定义应用的广泛程度。</p>
<p>要使任何自定义的范围尽可能窄，请注入自动配置的<code>WebClient.Builder</code>，然后根据需要调用其方法。<code>WebClient.Builder</code>实例是有状态的：构建器上的任何更改都会反映在随后使用它创建的所有客户端中。如果要使用相同的构建器创建多个客户端，还可以考虑使用<code>WebClient.Builder other = builder.clone();</code>克隆构建器。</p>
<p>要对所有<code>WebClient.Builder</code>实例进行应用程序范围的附加自定义，您可以声明<code>WebClientCustomizer</code> beans并在注入点本地更改<code>WebClient.Builder</code>。</p>
<p>最后，您可以回退到原始API并使用<code>WebClient.create()</code>。在这种情况下，不应用自动配置或<code>WebClientCustomizer</code>。</p>
<h2 id="36-验证"><a href="#36-验证" class="headerlink" title="36.验证"></a>36.验证</h2><p>只要JSR-303实现（例如Hibernate验证器）在类路径上，Bean验证1.1支持的方法验证功能就会自动启用。这使得bean方法可以使用<code>javax.validation</code>对其参数和/或返回值的约束进行注释。具有此类带注释方法的目标类需要在类型级别使用<code>@Validated</code>注释进行注释，以便搜索其内联约束注释的方法。</p>
<p>例如，以下服务触发第一个参数的验证，确保其大小在8到10之间：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Service</span><br><span class="line">@Validated</span><br><span class="line">public class MyBean &#123;</span><br><span class="line"></span><br><span class="line">	public Archive findByCodeAndAuthor(@Size(min &#x3D; 8, max &#x3D; 10) String code,</span><br><span class="line">			Author author) &#123;</span><br><span class="line">		...</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="37-发送电子邮件"><a href="#37-发送电子邮件" class="headerlink" title="37.发送电子邮件"></a>37.发送电子邮件</h2><p>Spring框架提供了使用<code>JavaMailSender</code>界面发送电子邮件的简单抽象，Spring Boot为其提供了自动配置以及启动器模块。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>有关如何使用<code>JavaMailSender</code>的详细说明，请参阅<a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/integration.html#mail">参考文档</a>。</td>
</tr>
</tbody></table>
<p>如果<code>spring.mail.host</code>和相关库（由<code>spring-boot-starter-mail</code>定义）可用，则创建默认值<code>JavaMailSender</code>（如果不存在）。可以通过<code>spring.mail</code>命名空间中的配置项进一步自定义发件人。有关<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/mail/MailProperties.java"><code>MailProperties</code></a>详细信息，请参阅</p>
<p>特别是，某些默认超时值是无限的，您可能希望更改它以避免线程被无响应的邮件服务器阻塞，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring.mail.properties.mail.smtp.connectiontimeout&#x3D;5000</span><br><span class="line">spring.mail.properties.mail.smtp.timeout&#x3D;3000</span><br><span class="line">spring.mail.properties.mail.smtp.writetimeout&#x3D;5000</span><br></pre></td></tr></table></figure>

<p>也可以使用JNDI中的现有<code>Session</code>配置<code>JavaMailSender</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.mail.jndi-name&#x3D;mail&#x2F;Session</span><br></pre></td></tr></table></figure>

<p>设置<code>jndi-name</code>时，它优先于所有其他与会话相关的设置。</p>
<h2 id="38-使用JTA的分布式事务"><a href="#38-使用JTA的分布式事务" class="headerlink" title="38.使用JTA的分布式事务"></a>38.使用JTA的分布式事务</h2><p>Spring Boot通过使用<a target="_blank" rel="noopener" href="http://www.atomikos.com/">Atomikos</a>或<a target="_blank" rel="noopener" href="https://github.com/bitronix/btm">Bitronix</a> 嵌入式事务管理器支持跨多个XA资源的分布式JTA事务。部署到合适的Java EE Application Server时，也支持JTA事务。</p>
<p>检测到JTA环境时，Spring的<code>JtaTransactionManager</code>用于管理事务。自动配置的JMS，DataSource和JPA beans已升级为支持XA事务。您可以使用标准Spring惯用语（例如<code>@Transactional</code>）来参与分布式事务。如果您在JTA环境中并且仍想使用本地事务，则可以将<code>spring.jta.enabled</code>属性设置为<code>false</code>以禁用JTA自动配置。</p>
<h2 id="38-1使用Atomikos事务管理器"><a href="#38-1使用Atomikos事务管理器" class="headerlink" title="38.1使用Atomikos事务管理器"></a>38.1使用Atomikos事务管理器</h2><p><a target="_blank" rel="noopener" href="https://www.atomikos.com/">Atomikos</a>是一个流行的开源事务管理器，可以嵌入到您的Spring Boot应用程序中。您可以使用<code>spring-boot-starter-jta-atomikos</code> Starter引入相应的Atomikos库。Spring Boot自动配置Atomikos并确保将适当的<code>depends-on</code>设置应用于Spring beans以正确启动和关闭顺序。</p>
<p>默认情况下，Atomikos事务日志将写入应用程序主目录（应用程序jar文件所在的目录）中的<code>transaction-logs</code>目录。您可以通过在<code>application.properties</code>文件中设置<code>spring.jta.log-dir</code>属性来自定义此目录的位置。以<code>spring.jta.atomikos.properties</code>开头的属性也可用于自定义Atomikos <code>UserTransactionServiceImp</code>。有关 完整的详细信息，请参阅 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/jta/atomikos/AtomikosProperties.html"><code>AtomikosProperties</code> Javadoc</a>。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>为确保多个事务管理器可以安全地协调相同的资源管理器，必须为每个Atomikos实例配置唯一ID。默认情况下，此ID是运行Atomikos的计算机的IP地址。要确保生产中的唯一性，应为应用程序的每个实例配置具有不同值的<code>spring.jta.transaction-manager-id</code>属性。</td>
</tr>
</tbody></table>
<h2 id="38-2使用Bitronix事务管理器"><a href="#38-2使用Bitronix事务管理器" class="headerlink" title="38.2使用Bitronix事务管理器"></a>38.2使用Bitronix事务管理器</h2><p><a target="_blank" rel="noopener" href="https://github.com/bitronix/btm">Bitronix</a>是一种流行的开源JTA事务管理器实现。您可以使用<code>spring-boot-starter-jta-bitronix</code>启动程序将适当的Bitronix依赖项添加到项目中。与Atomikos一样，Spring Boot自动配置Bitronix并对beans进行后处理，以确保启动和关闭顺序正确。</p>
<p>默认情况下，Bitronix事务日志文件（<code>part1.btm</code>和<code>part2.btm</code>）将写入应用程序主目录中的<code>transaction-logs</code>目录。您可以通过设置<code>spring.jta.log-dir</code>属性来自定义此目录的位置。以<code>spring.jta.bitronix.properties</code>开头的属性也绑定到<code>bitronix.tm.Configuration</code> bean，允许完全自定义。有关详细信息，请参阅 <a target="_blank" rel="noopener" href="https://github.com/bitronix/btm/wiki/Transaction-manager-configuration">Bitronix文档</a>。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>为确保多个事务管理器可以安全地协调相同的资源管理器，必须为每个Bitronix实例配置唯一的ID。默认情况下，此ID是运行Bitronix的计算机的IP地址。为了确保生产的唯一性，您应该为应用程序的每个实例配置不同值的<code>spring.jta.transaction-manager-id</code>属性。</td>
</tr>
</tbody></table>
<h2 id="38-3使用Java-EE托管事务管理器"><a href="#38-3使用Java-EE托管事务管理器" class="headerlink" title="38.3使用Java EE托管事务管理器"></a>38.3使用Java EE托管事务管理器</h2><p>如果将Spring Boot应用程序打包为<code>war</code>或<code>ear</code>文件并将其部署到Java EE应用程序服务器，则可以使用应用程序服务器的内置事务管理器。Spring Boot尝试通过查看常见的JNDI位置（<code>java:comp/UserTransaction</code>，<code>java:comp/TransactionManager</code>等）来自动配置事务管理器。如果使用应用程序服务器提供的事务服务，通常还需要确保所有资源都由服务器管理并通过JNDI公开。Spring Boot尝试通过在JNDI路径（<code>java:/JmsXA</code>或<code>java:/XAConnectionFactory</code>）查找<code>ConnectionFactory</code>来自动配置JMS，并且可以使用<code>spring.datasource.jndi-name</code>属性来配置<code>DataSource</code>。<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-connecting-to-a-jndi-datasource"><code>spring.datasource.jndi-name</code>属性</a> 配置{1801 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-connecting-to-a-jndi-datasource">}</a> /}。</p>
<h2 id="38-4混合XA和非XA-JMS连接"><a href="#38-4混合XA和非XA-JMS连接" class="headerlink" title="38.4混合XA和非XA JMS连接"></a>38.4混合XA和非XA JMS连接</h2><p>使用JTA时，主JMS <code>ConnectionFactory</code> bean可识别XA并参与分布式事务。在某些情况下，您可能希望使用非XA <code>ConnectionFactory</code>处理某些JMS消息。例如，您的JMS处理逻辑可能需要比XA超时更长的时间。</p>
<p>如果你想使用非XA <code>ConnectionFactory</code>，你可以注入<code>nonXaJmsConnectionFactory</code> bean而不是<code>@Primary</code> <code>jmsConnectionFactory</code> bean。为了保持一致性，使用bean别名<code>xaJmsConnectionFactory</code>也提供了<code>jmsConnectionFactory</code> bean。</p>
<p>以下示例显示如何注入<code>ConnectionFactory</code>实例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Inject the primary (XA aware) ConnectionFactory</span><br><span class="line">@Autowired</span><br><span class="line">private ConnectionFactory defaultConnectionFactory;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Inject the XA aware ConnectionFactory (uses the alias and injects the same as above)</span><br><span class="line">@Autowired</span><br><span class="line">@Qualifier(&quot;xaJmsConnectionFactory&quot;)</span><br><span class="line">private ConnectionFactory xaConnectionFactory;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Inject the non-XA aware ConnectionFactory</span><br><span class="line">@Autowired</span><br><span class="line">@Qualifier(&quot;nonXaJmsConnectionFactory&quot;)</span><br><span class="line">private ConnectionFactory nonXaConnectionFactory;</span><br></pre></td></tr></table></figure>

<h2 id="38-5支持替代嵌入式事务管理器"><a href="#38-5支持替代嵌入式事务管理器" class="headerlink" title="38.5支持替代嵌入式事务管理器"></a>38.5支持替代嵌入式事务管理器</h2><p>该<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/jms/XAConnectionFactoryWrapper.java"><code>XAConnectionFactoryWrapper</code></a> 和<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/jdbc/XADataSourceWrapper.java"><code>XADataSourceWrapper</code></a>接口可用于支持替代嵌入式事务经理。接口负责包装<code>XAConnectionFactory</code>和<code>XADataSource</code> beans并将它们公开为常规<code>ConnectionFactory</code>和<code>DataSource</code> beans，它们透明地注册分布式事务。如果您在<code>ApplicationContext</code>中注册了<code>JtaTransactionManager</code> bean和相应的XA包装beans，则DataSource和JMS自动配置将使用JTA变体。</p>
<p>该<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/jta/bitronix/BitronixXAConnectionFactoryWrapper.java">BitronixXAConnectionFactoryWrapper</a> 和<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/jta/bitronix/BitronixXADataSourceWrapper.java">BitronixXADataSourceWrapper</a> 提供了如何编写XA包装很好的例子。</p>
<h2 id="39-Hazelcast"><a href="#39-Hazelcast" class="headerlink" title="39. Hazelcast"></a>39. Hazelcast</h2><p>如果<a target="_blank" rel="noopener" href="https://hazelcast.com/">Hazelcast</a>在类路径上并找到合适的配置，Spring Boot会自动配置您可以在应用程序中注入的<code>HazelcastInstance</code>。</p>
<p>如果你定义<code>com.hazelcast.config.Config</code> bean，Spring Boot使用它。如果您的配置定义了实例名称，Spring Boot会尝试查找现有实例而不是创建新实例。</p>
<p>您还可以指定要通过配置使用的<code>hazelcast.xml</code>配置文件，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.hazelcast.config&#x3D;classpath:config&#x2F;my-hazelcast.xml</span><br></pre></td></tr></table></figure>

<p>否则，Spring Boot会尝试从默认位置找到Hazelcast配置：工作目录中的<code>hazelcast.xml</code>或类路径的根目录。我们还检查是否设置了<code>hazelcast.config</code>系统属性。有关更多详细信息，请参阅 <a target="_blank" rel="noopener" href="http://docs.hazelcast.org/docs/latest/manual/html-single/">Hazelcast文档</a>。</p>
<p>如果类路径中存在<code>hazelcast-client</code>，则Spring Boot首先尝试通过检查以下配置选项来创建客户端：</p>
<ul>
<li>存在<code>com.hazelcast.client.config.ClientConfig</code> bean。</li>
<li>由<code>spring.hazelcast.config</code>属性定义的配置文件。</li>
<li><code>hazelcast.client.config</code>系统属性的存在。</li>
<li>工作目录中的<code>hazelcast-client.xml</code>或类路径的根目录。</li>
</ul>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>Spring Boot还<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-caching-provider-hazelcast">为Hazelcast</a>提供了 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-caching-provider-hazelcast">明确的缓存支持</a>。如果启用了缓存，<code>HazelcastInstance</code>将自动包含在<code>CacheManager</code>实现中。</td>
</tr>
</tbody></table>
<h2 id="40-Quartz-Scheduler"><a href="#40-Quartz-Scheduler" class="headerlink" title="40. Quartz Scheduler"></a>40. Quartz Scheduler</h2><p>Spring Boot为使用<a target="_blank" rel="noopener" href="http://www.quartz-scheduler.org/">Quartz调度程序</a>提供了一些便利 ，包括<code>spring-boot-starter-quartz</code>“Starter”。如果Quartz可用，则自动配置<code>Scheduler</code>（通过<code>SchedulerFactoryBean</code>抽象）。</p>
<p>自动选取以下类型的Beans并与<code>Scheduler</code>相关联：</p>
<ul>
<li><code>JobDetail</code>：定义一个特定的工作。可以使用<code>JobBuilder</code> API构建<code>JobDetail</code>个实例。</li>
<li><code>Calendar</code>.</li>
<li><code>Trigger</code>：定义何时触发特定作业。</li>
</ul>
<p>默认情况下，使用内存中的<code>JobStore</code>。但是，如果应用程序中有<code>DataSource</code> bean并且相应地配置了<code>spring.quartz.job-store-type</code>属性，则可以配置基于JDBC的存储，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.quartz.job-store-type&#x3D;jdbc</span><br></pre></td></tr></table></figure>

<p>使用JDBC存储时，可以在启动时初始化架构，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.quartz.jdbc.initialize-schema&#x3D;always</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/warning.png" alt="[警告]"></th>
</tr>
</thead>
<tbody><tr>
<td>默认情况下，使用Quartz库提供的标准脚本检测并初始化数据库。这些脚本删除现有表，在每次重启时删除所有触发器。也可以通过设置<code>spring.quartz.jdbc.schema</code>属性来提供自定义脚本。</td>
</tr>
</tbody></table>
<p>要让Quartz使用<code>DataSource</code>而不是应用程序的主<code>DataSource</code>，请声明<code>DataSource</code> bean，用<code>@QuartzDataSource</code>注释其<code>@Bean</code>方法。这样做可确保<code>SchedulerFactoryBean</code>和架构初始化都使用特定于Quartz的<code>DataSource</code>。</p>
<p>默认情况下，配置创建的作业不会覆盖已从永久性作业存储区读取的已注册作业。要启用覆盖现有作业定义，请设置<code>spring.quartz.overwrite-existing-jobs</code>属性。</p>
<p>可以使用<code>spring.quartz</code>属性和<code>SchedulerFactoryBeanCustomizer</code> beans自定义Quartz Scheduler配置，这允许程序化<code>SchedulerFactoryBean</code>自定义。可以使用<code>spring.quartz.properties.*</code>自定义高级Quartz配置属性。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>特别是，<code>Executor</code> bean与调度程序无关，因为Quartz提供了一种通过<code>spring.quartz.properties</code>配置调度程序的方法。如果需要自定义任务执行程序，请考虑实现<code>SchedulerFactoryBeanCustomizer</code>。</td>
</tr>
</tbody></table>
<p>作业可以定义setter以注入数据映射属性。常规beans也可以以类似的方式注入，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">public class SampleJob extends QuartzJobBean &#123;</span><br><span class="line"></span><br><span class="line">	private MyService myService;</span><br><span class="line"></span><br><span class="line">	private String name;</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F; Inject &quot;MyService&quot; bean</span><br><span class="line">	public void setMyService(MyService myService) &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F; Inject the &quot;name&quot; job data property</span><br><span class="line">	public void setName(String name) &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	protected void executeInternal(JobExecutionContext context)</span><br><span class="line">			throws JobExecutionException &#123;</span><br><span class="line">		...</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="41-任务执行和调度"><a href="#41-任务执行和调度" class="headerlink" title="41.任务执行和调度"></a>41.任务执行和调度</h2><p>在上下文中没有<code>TaskExecutor</code> bean的情况下，Spring Boot使用合理的默认值自动配置<code>ThreadPoolTaskExecutor</code>，这些默认值可以自动与异步任务执行相关联（<code>@EnableAsync</code>）和Spring MVC异步请求处理。</p>
<p>线程池使用8个核心线程，可根据负载增长和缩小。可以使用<code>spring.task.execution</code>命名空间对这些默认设置进行微调，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring.task.execution.pool.max-threads&#x3D;16</span><br><span class="line">spring.task.execution.pool.queue-capacity&#x3D;100</span><br><span class="line">spring.task.execution.pool.keep-alive&#x3D;10s</span><br></pre></td></tr></table></figure>

<p>这会将线程池更改为使用有界队列，以便在队列满（100个任务）时，线程池增加到最多16个线程。当线程在闲置10秒（而不是默认为60秒）时回收线程时，池的收缩会更加激进。</p>
<p>如果需要与计划任务执行（<code>@EnableScheduling</code>）相关联，也可以自动配置<code>ThreadPoolTaskScheduler</code>。默认情况下，线程池使用一个线程，并且可以使用<code>spring.task.scheduling</code>命名空间对这些设置进行微调。</p>
<p>如果需要创建自定义执行程序或调度程序，则在上下文中可以使用<code>TaskExecutorBuilder</code> bean和<code>TaskSchedulerBuilder</code> bean。</p>
<h2 id="42-Spring-Integration"><a href="#42-Spring-Integration" class="headerlink" title="42. Spring Integration"></a>42. Spring Integration</h2><p>Spring Boot为使用<a target="_blank" rel="noopener" href="https://projects.spring.io/spring-integration/">Spring集成</a>提供了一些便利，包括<code>spring-boot-starter-integration</code>“Starter”。Spring集成提供了有关消息传递以及其他传输（如HTTP，TCP等）的抽象。如果类路径上有Spring Integration，则通过<code>@EnableIntegration</code>注释初始化它。</p>
<p>Spring Boot还配置由附加Spring Integration模块的存在触发的一些功能。如果<code>spring-integration-jmx</code>也在类路径上，则通过JMX发布消息处理统计信息。如果<code>spring-integration-jdbc</code>可用，则可以在启动时创建默认数据库模式，如以下行所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.integration.jdbc.initialize-schema&#x3D;always</span><br></pre></td></tr></table></figure>

<p>有关 详细信息，请参阅 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/integration/IntegrationAutoConfiguration.java"><code>IntegrationAutoConfiguration</code></a> 和<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/integration/IntegrationProperties.java"><code>IntegrationProperties</code></a>类。</p>
<p>默认情况下，如果存在千分尺<code>meterRegistry</code> bean，则千分尺将管理Spring Integration指标。如果您希望使用旧版Spring Integration指标，请在应用程序上下文中添加<code>DefaultMetricsFactory</code> bean。</p>
<h2 id="43-Spring-Session"><a href="#43-Spring-Session" class="headerlink" title="43. Spring Session"></a>43. Spring Session</h2><p>Spring Boot为各种数据存储提供<a target="_blank" rel="noopener" href="https://projects.spring.io/spring-session/">Spring Session</a>自动配置。构建Servlet Web应用程序时，可以自动配置以下存储：</p>
<ul>
<li>JDBC</li>
<li>Redis</li>
<li>Hazelcast</li>
<li>MongoDB的</li>
</ul>
<p>构建响应式Web应用程序时，可以自动配置以下存储：</p>
<ul>
<li>Redis</li>
<li>MongoDB的</li>
</ul>
<p>如果类路径中存在单个Spring Session模块，则Spring Boot会自动使用该存储实现。如果您有多个实现，则必须选择<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/session/StoreType.java"><code>StoreType</code></a>要用于存储会话的实现。例如，要使用JDBC作为后端存储，您可以按如下方式配置应用程序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.session.store-type&#x3D;jdbc</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>您可以通过将<code>store-type</code>设置为<code>none</code>来禁用Spring Session。</td>
</tr>
</tbody></table>
<p>每个商店都有特定的附加设置。例如，可以为JDBC存储定制表的名称，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.session.jdbc.table-name&#x3D;SESSIONS</span><br></pre></td></tr></table></figure>

<p>要设置会话超时，可以使用<code>spring.session.timeout</code>属性。如果未设置该属性，则自动配置将回退到<code>server.servlet.session.timeout</code>的值。</p>
<h2 id="44-对JMX的监测和管理"><a href="#44-对JMX的监测和管理" class="headerlink" title="44.对JMX的监测和管理"></a>44.对JMX的监测和管理</h2><p>Java Management Extensions（JMX）提供了一种监视和管理应用程序的标准机制。默认情况下，Spring Boot会创建一个ID为<code>mbeanServer</code>的<code>MBeanServer</code> bean，并公开使用Spring JMX注释（<code>@ManagedResource</code>注释的任何beans， <code>@ManagedAttribute</code>或<code>@ManagedOperation</code>）。</p>
<p>有关<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jmx/JmxAutoConfiguration.java"><code>JmxAutoConfiguration</code></a> 详细信息，请参阅 课程。</p>
<h2 id="45-测试"><a href="#45-测试" class="headerlink" title="45.测试"></a>45.测试</h2><p>Spring Boot提供了许多实用程序和注释来帮助您测试应用程序。测试支持由两个模块提供：<code>spring-boot-test</code>包含核心项，<code>spring-boot-test-autoconfigure</code>支持测试的自动配置。</p>
<p>大多数开发人员使用<code>spring-boot-starter-test</code>“Starter”，它导入Spring Boot测试模块以及JUnit，AssertJ，Hamcrest和许多其他有用的库。</p>
<h2 id="45-1测试范围依赖性"><a href="#45-1测试范围依赖性" class="headerlink" title="45.1测试范围依赖性"></a>45.1测试范围依赖性</h2><p><code>spring-boot-starter-test</code>“Starter”（在<code>test</code> <code>scope</code>中）包含以下提供的库：</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://junit.org/">JUnit</a>：单元测试Java应用程序的事实标准。</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/testing.html#integration-testing">Spring测试</a>和Spring Boot测试：Spring Boot应用程序的实用程序和集成测试支持。</li>
<li><a target="_blank" rel="noopener" href="https://joel-costigliola.github.io/assertj/">AssertJ</a>：一个流畅的断言库。</li>
<li><a target="_blank" rel="noopener" href="http://hamcrest.org/JavaHamcrest/">Hamcrest</a>：匹配器对象库（也称为约束或谓词）。</li>
<li><a target="_blank" rel="noopener" href="http://mockito.org/">Mockito</a>：一个Java <a target="_blank" rel="noopener" href="http://mockito.org/">模拟</a>框架。</li>
<li><a target="_blank" rel="noopener" href="https://github.com/skyscreamer/JSONassert">JSONassert</a>：JSON的断言库。</li>
<li><a target="_blank" rel="noopener" href="https://github.com/jayway/JsonPath">JsonPath</a>：JSON的XPath。</li>
</ul>
<p>我们通常发现这些常用库在编写测试时很有用。如果这些库不适合您的需求，您可以添加自己的其他测试依赖项。</p>
<h2 id="45-2测试Spring应用程序"><a href="#45-2测试Spring应用程序" class="headerlink" title="45.2测试Spring应用程序"></a>45.2测试Spring应用程序</h2><p>依赖注入的一个主要优点是它应该使您的代码更容易进行单元测试。您可以使用<code>new</code>运算符实例化对象，甚至不涉及Spring。您还可以使用<em>模拟对象</em>而不是真正的依赖项。</p>
<p>通常，您需要超越单元测试并开始集成测试（使用Spring <code>ApplicationContext</code>）。能够在不需要部署应用程序或需要连接到其他基础架构的情况下执行集成测试非常有用。</p>
<p>Spring框架包括用于此类集成测试的专用测试模块。您可以直接向<code>org.springframework:spring-test</code>声明依赖关系，或使用<code>spring-boot-starter-test</code>“Starter”将其传递给它。</p>
<p>如果您之前未使用过<code>spring-test</code>模块，则应首先阅读Spring框架参考文档的 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/testing.html#testing">相关部分</a>。</p>
<h2 id="45-3测试Spring-Boot应用程序"><a href="#45-3测试Spring-Boot应用程序" class="headerlink" title="45.3测试Spring Boot应用程序"></a>45.3测试Spring Boot应用程序</h2><p>Spring Boot应用程序是Spring <code>ApplicationContext</code>，因此除了通常使用vanilla Spring上下文所做的测试之外，没有什么特别的要做。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>仅当您使用<code>SpringApplication</code>创建外部属性，日志记录和Spring Boot的其他功能时，才会默认安装在上下文中。</td>
</tr>
</tbody></table>
<p>Spring Boot提供了<code>@SpringBootTest</code>注释，当您需要Spring引导功能时，可以将其用作标准<code>spring-test</code> <code>@ContextConfiguration</code>注释的替代。注释的工作原理是 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-testing-spring-boot-applications-detecting-config">通过<code>SpringApplication</code>创建测试中使用的<code>ApplicationContext</code></a>。除了<code>@SpringBootTest</code>之外，还提供了许多其他注释来 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-testing-spring-boot-applications-testing-autoconfigured-tests">测试</a>应用程序的<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-testing-spring-boot-applications-testing-autoconfigured-tests">更具体的切片</a>。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果您使用的是JUnit 4，请不要忘记在测试中添加<code>@RunWith(SpringRunner.class)</code>，否则注释将被忽略。如果您正在使用JUnit 5，则无需将等效的<code>@ExtendWith(SpringExtension)</code>添加为<code>@SpringBootTest</code>，而其他<code>@…Test</code>注释已经使用它进行注释。</td>
</tr>
</tbody></table>
<p>默认情况下，<code>@SpringBootTest</code>将无法启动服务器。您可以使用<code>@SpringBootTest</code>的<code>webEnvironment</code>属性来进一步优化测试的运行方式：</p>
<ul>
<li><code>MOCK</code>（默认）：加载网络<code>ApplicationContext</code>并提供模拟网络环境。使用此批注时，不会启动嵌入式服务器。如果您的类路径上没有Web环境，则此模式将透明地回退到创建常规非Web <code>ApplicationContext</code>。它可以与 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-testing-spring-boot-applications-testing-with-mock-environment"><code>@AutoConfigureMockMvc</code>或<code>@AutoConfigureWebTestClient</code>一起</a>用于基于模拟的Web应用程序测试。</li>
<li><code>RANDOM_PORT</code>：加载<code>WebServerApplicationContext</code>并提供真实的网络环境。嵌入式服务器启动并在随机端口上侦听。</li>
<li><code>DEFINED_PORT</code>：加载<code>WebServerApplicationContext</code>并提供真实的网络环境。嵌入式服务器启动并侦听定义的端口（来自您的<code>application.properties</code>）或默认端口<code>8080</code>。</li>
<li><code>NONE</code>：使用<code>SpringApplication</code>加载<code>ApplicationContext</code>但不提供 <em>任何</em>网络环境（模拟或其他）。</li>
</ul>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果您的测试是<code>@Transactional</code>，则默认情况下会在每个测试方法的末尾回滚事务。但是，当使用<code>RANDOM_PORT</code>或<code>DEFINED_PORT</code>的这种安排隐式地提供真正的servlet环境时，HTTP客户端和服务器在单独的线程中运行，因此在单独的事务中运行。在这种情况下，在服务器上启动的任何事务都不会回滚。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果您的应用程序使用不同的管理服务器端口，<code>@SpringBootTest</code>和<code>webEnvironment = WebEnvironment.RANDOM_PORT</code>也将在单独的随机端口上启动管理服务器。</td>
</tr>
</tbody></table>
<h3 id="45-3-1检测Web应用程序类型"><a href="#45-3-1检测Web应用程序类型" class="headerlink" title="45.3.1检测Web应用程序类型"></a>45.3.1检测Web应用程序类型</h3><p>如果Spring MVC可用，则配置基于MVC的常规应用程序上下文。如果您只有Spring WebFlux，我们将检测到并配置基于WebFlux的应用程序上下文。</p>
<p>如果两者都存在，Spring MVC优先。如果要在此方案中测试响应式Web应用程序，则必须设置<code>spring.main.web-application-type</code>属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@SpringBootTest(properties &#x3D; &quot;spring.main.web-application-type&#x3D;reactive&quot;)</span><br><span class="line">public class MyWebFluxTests &#123; ... &#125;</span><br></pre></td></tr></table></figure>

<h3 id="45-3-2检测测试配置"><a href="#45-3-2检测测试配置" class="headerlink" title="45.3.2检测测试配置"></a>45.3.2检测测试配置</h3><p>如果您熟悉Spring测试框架，则可能习惯使用<code>@ContextConfiguration(classes=…)</code>来指定要加载的Spring <code>@Configuration</code>。或者，您可能经常在测试中使用嵌套的<code>@Configuration</code>类。</p>
<p>在测试Spring Boot应用程序时，通常不需要这样做。只要您没有明确定义一个，Spring Boot的<code>@*Test</code>注释就会自动搜索您的主要配置。</p>
<p>搜索算法从包含测试的包开始工作，直到找到使用<code>@SpringBootApplication</code>或<code>@SpringBootConfiguration</code>注释的类。只要您以合理的方式<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-structuring-your-code">构建代码</a>，通常就会找到主要配置。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果使用 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-testing-spring-boot-applications-testing-autoconfigured-tests">测试批注来测试应用程序的更具体的片段</a>，则应避免在<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-testing-spring-boot-applications-testing-user-configuration">main方法的应用程序类中</a>添加特定于特定区域的配置设置 。<code>@SpringBootApplication</code>的基础组件扫描配置定义了排除过滤器，用于确保切片按预期工作。如果您在<code>@SpringBootApplication</code> - 带注释的类上使用明确的<code>@ComponentScan</code>指令，请注意这些过滤器将被禁用。如果您正在使用切片，则应再次定义它们。</td>
</tr>
</tbody></table>
<p>如果要自定义主要配置，可以使用嵌套的<code>@TestConfiguration</code>类。与嵌套的<code>@Configuration</code>类不同，它将用于代替应用程序的主要配置，除了应用程序的主要配置之外，还使用嵌套的<code>@TestConfiguration</code>类。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>Spring的测试框架在测试之间缓存应用程序上下文。因此，只要您的测试共享相同的配置（无论如何发现），加载上下文的潜在耗时过程只发生一次。</td>
</tr>
</tbody></table>
<h3 id="45-3-3排除测试配置"><a href="#45-3-3排除测试配置" class="headerlink" title="45.3.3排除测试配置"></a>45.3.3排除测试配置</h3><p>如果您的应用程序使用组件扫描（例如，如果您使用<code>@SpringBootApplication</code>或<code>@ComponentScan</code>），您可能会发现仅为特定测试创建的顶级配置类会意外地在任何地方进行检索。</p>
<p>如前所述，<code>@TestConfiguration</code>可用于测试的内部类以自定义主要配置。<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-testing-spring-boot-applications-detecting-config">前面所看到的</a>，1941年{/}可以在一个内部类的测试的用于定制的主配置。当放置在顶级类时，<code>@TestConfiguration</code>表示不应通过扫描拾取<code>src/test/java</code>中的类。然后，您可以在需要的位置显式导入该类，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@SpringBootTest</span><br><span class="line">@Import(MyTestsConfiguration.class)</span><br><span class="line">public class MyTests &#123;</span><br><span class="line"></span><br><span class="line">	@Test</span><br><span class="line">	public void exampleTest() &#123;</span><br><span class="line">		...</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果您直接使用<code>@ComponentScan</code>（即不通过<code>@SpringBootApplication</code>），则需要使用<code>TypeExcludeFilter</code>注册。有关详细信息，请参阅 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/context/TypeExcludeFilter.html">Javadoc</a>。</td>
</tr>
</tbody></table>
<h3 id="45-3-4使用模拟环境进行测试"><a href="#45-3-4使用模拟环境进行测试" class="headerlink" title="45.3.4使用模拟环境进行测试"></a>45.3.4使用模拟环境进行测试</h3><p>默认情况下，<code>@SpringBootTest</code>无法启动服务器。如果您要针对此模拟环境测试Web端点，则可以另外进行配置 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference//testing.html#spring-mvc-test-framework"><code>MockMvc</code></a>，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">import org.junit.Test;</span><br><span class="line">import org.junit.runner.RunWith;</span><br><span class="line"></span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;</span><br><span class="line">import org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line">import org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line">import org.springframework.test.web.servlet.MockMvc;</span><br><span class="line"></span><br><span class="line">import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;</span><br><span class="line">import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.content;</span><br><span class="line">import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;</span><br><span class="line"></span><br><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@SpringBootTest</span><br><span class="line">@AutoConfigureMockMvc</span><br><span class="line">public class MockMvcExampleTests &#123;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	private MockMvc mvc;</span><br><span class="line"></span><br><span class="line">	@Test</span><br><span class="line">	public void exampleTest() throws Exception &#123;</span><br><span class="line">		this.mvc.perform(get(&quot;&#x2F;&quot;)).andExpect(status().isOk())</span><br><span class="line">				.andExpect(content().string(&quot;Hello World&quot;));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果您只想关注网络层而不是开始一个完整的<code>ApplicationContext</code>，请考虑 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-testing-spring-boot-applications-testing-autoconfigured-mvc-tests">使用<code>@WebMvcTest</code></a>。</td>
</tr>
</tbody></table>
<p>或者，您可以配置a <a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/testing.html#webtestclient-tests"><code>WebTestClient</code></a>，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import org.junit.Test;</span><br><span class="line">import org.junit.runner.RunWith;</span><br><span class="line"></span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.boot.test.autoconfigure.web.reactive.AutoConfigureWebTestClient;</span><br><span class="line">import org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line">import org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line">import org.springframework.test.web.reactive.server.WebTestClient;</span><br><span class="line"></span><br><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@SpringBootTest</span><br><span class="line">@AutoConfigureWebTestClient</span><br><span class="line">public class MockWebTestClientExampleTests &#123;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	private WebTestClient webClient;</span><br><span class="line"></span><br><span class="line">	@Test</span><br><span class="line">	public void exampleTest() &#123;</span><br><span class="line">		this.webClient.get().uri(&quot;&#x2F;&quot;).exchange().expectStatus().isOk()</span><br><span class="line">				.expectBody(String.class).isEqualTo(&quot;Hello World&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="45-3-5使用正在运行的服务器进行测试"><a href="#45-3-5使用正在运行的服务器进行测试" class="headerlink" title="45.3.5使用正在运行的服务器进行测试"></a>45.3.5使用正在运行的服务器进行测试</h3><p>如果您需要启动完整运行的服务器，我们建议您使用随机端口。如果使用<code>@SpringBootTest(webEnvironment=WebEnvironment.RANDOM_PORT)</code>，则每次测试运行时随机选择一个可用端口。</p>
<p><code>@LocalServerPort</code>注释可用于 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#howto-discover-the-http-port-at-runtime">注入</a>测试中<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#howto-discover-the-http-port-at-runtime">使用的实际端口</a>。为方便起见，需要对启动的服务器进行REST调用的测试还可以<code>@Autowire</code> a <a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/testing.html#webtestclient-tests"><code>WebTestClient</code></a>，它解析了与正在运行的服务器的相对链接，并附带了用于验证响应的专用API，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import org.junit.Test;</span><br><span class="line">import org.junit.runner.RunWith;</span><br><span class="line"></span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line">import org.springframework.boot.test.context.SpringBootTest.WebEnvironment;</span><br><span class="line">import org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line">import org.springframework.test.web.reactive.server.WebTestClient;</span><br><span class="line"></span><br><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@SpringBootTest(webEnvironment &#x3D; WebEnvironment.RANDOM_PORT)</span><br><span class="line">public class RandomPortWebTestClientExampleTests &#123;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	private WebTestClient webClient;</span><br><span class="line"></span><br><span class="line">	@Test</span><br><span class="line">	public void exampleTest() &#123;</span><br><span class="line">		this.webClient.get().uri(&quot;&#x2F;&quot;).exchange().expectStatus().isOk()</span><br><span class="line">				.expectBody(String.class).isEqualTo(&quot;Hello World&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此设置在类路径上需要<code>spring-webflux</code>。如果您不能或不会添加webflux，Spring Boot还提供<code>TestRestTemplate</code>设施：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import org.junit.Test;</span><br><span class="line">import org.junit.runner.RunWith;</span><br><span class="line"></span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line">import org.springframework.boot.test.context.SpringBootTest.WebEnvironment;</span><br><span class="line">import org.springframework.boot.test.web.client.TestRestTemplate;</span><br><span class="line">import org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line">import static org.assertj.core.api.Assertions.assertThat;</span><br><span class="line"></span><br><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@SpringBootTest(webEnvironment &#x3D; WebEnvironment.RANDOM_PORT)</span><br><span class="line">public class RandomPortTestRestTemplateExampleTests &#123;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	private TestRestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">	@Test</span><br><span class="line">	public void exampleTest() &#123;</span><br><span class="line">		String body &#x3D; this.restTemplate.getForObject(&quot;&#x2F;&quot;, String.class);</span><br><span class="line">		assertThat(body).isEqualTo(&quot;Hello World&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="45-3-6使用JMX"><a href="#45-3-6使用JMX" class="headerlink" title="45.3.6使用JMX"></a>45.3.6使用JMX</h3><p>当测试上下文框架缓存上下文时，默认情况下禁用JMX以防止相同的组件在同一域上注册。如果此类测试需要访问<code>MBeanServer</code>，请考虑将其标记为脏：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@SpringBootTest(properties &#x3D; &quot;spring.jmx.enabled&#x3D;true&quot;)</span><br><span class="line">@DirtiesContext</span><br><span class="line">public class SampleJmxTests &#123;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	private MBeanServer mBeanServer;</span><br><span class="line"></span><br><span class="line">	@Test</span><br><span class="line">	public void exampleTest() &#123;</span><br><span class="line">		&#x2F;&#x2F; ...</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="45-3-7嘲弄和间谍活动Beans"><a href="#45-3-7嘲弄和间谍活动Beans" class="headerlink" title="45.3.7嘲弄和间谍活动Beans"></a>45.3.7嘲弄和间谍活动Beans</h3><p>运行测试时，有时需要在应用程序上下文中模拟某些组件。例如，您可能拥有在开发期间不可用的某些远程服务的外观。当您想要模拟在真实环境中可能难以触发的故障时，模拟也很有用。</p>
<p>Spring Boot包含<code>@MockBean</code>注释，可用于为<code>ApplicationContext</code>内的bean定义Mockito模拟。您可以使用注释添加新的beans或替换单个现有的bean定义。注释可以直接用于测试类，测试中的字段或<code>@Configuration</code>类和字段。在字段上使用时，也会注入创建的模拟的实例。模拟beans在每种测试方法后自动重置。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果您的测试使用Spring Boot的测试注释之一（例如<code>@SpringBootTest</code>），则会自动启用此功能。要以不同的排列方式使用此功能，必须显式添加侦听器，如以下示例所示：<code>@TestExecutionListeners(MockitoTestExecutionListener.class)</code></td>
</tr>
</tbody></table>
<p>以下示例使用模拟实现替换现有的<code>RemoteService</code> bean：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">import org.junit.*;</span><br><span class="line">import org.junit.runner.*;</span><br><span class="line">import org.springframework.beans.factory.annotation.*;</span><br><span class="line">import org.springframework.boot.test.context.*;</span><br><span class="line">import org.springframework.boot.test.mock.mockito.*;</span><br><span class="line">import org.springframework.test.context.junit4.*;</span><br><span class="line"></span><br><span class="line">import static org.assertj.core.api.Assertions.*;</span><br><span class="line">import static org.mockito.BDDMockito.*;</span><br><span class="line"></span><br><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@SpringBootTest</span><br><span class="line">public class MyTests &#123;</span><br><span class="line"></span><br><span class="line">	@MockBean</span><br><span class="line">	private RemoteService remoteService;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	private Reverser reverser;</span><br><span class="line"></span><br><span class="line">	@Test</span><br><span class="line">	public void exampleTest() &#123;</span><br><span class="line">		&#x2F;&#x2F; RemoteService has been injected into the reverser bean</span><br><span class="line">		given(this.remoteService.someCall()).willReturn(&quot;mock&quot;);</span><br><span class="line">		String reverse &#x3D; reverser.reverseSomeCall();</span><br><span class="line">		assertThat(reverse).isEqualTo(&quot;kcom&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此外，您可以使用<code>@SpyBean</code>将任何现有的bean与Mockito <code>spy</code>包装在一起。有关详细信息，请参阅<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/test/mock/mockito/SpyBean.html">Javadoc</a>。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>虽然Spring的测试框架在测试之间缓存应用程序上下文并重用共享相同配置的测试的上下文，但使用<code>@MockBean</code>或<code>@SpyBean</code>会影响缓存密钥，这很可能会增加缓存密钥的数量。上下文。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果您使用<code>@SpyBean</code>监视bean并使用<code>@Cacheable</code>方法按名称引用参数，则必须使用<code>-parameters</code>编译应用程序。这可以确保在bean被监视后，参数名称可用于缓存基础结构。</td>
</tr>
</tbody></table>
<h3 id="45-3-8自动配置的测试"><a href="#45-3-8自动配置的测试" class="headerlink" title="45.3.8自动配置的测试"></a>45.3.8自动配置的测试</h3><p>Spring Boot的自动配置系统适用于应用程序，但有时对于测试来说有点太多了。通常，只需加载测试应用程序“切片”所需的配置部分。例如，您可能希望测试Spring MVC控制器是否正确映射URL，并且您不希望在这些测试中涉及数据库调用，或者您可能想要测试JPA实体，并且您对Web不感兴趣这些测试运行时的图层。</p>
<p><code>spring-boot-test-autoconfigure</code>模块包括许多可用于自动配置这种“切片”的注释。它们中的每一个都以类似的方式工作，提供<code>@…Test</code>注释，用于加载<code>ApplicationContext</code>和一个或多个<code>@AutoConfigure…</code>注释，可用于自定义自动配置设置。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>每个切片都将组件扫描限制为适当的组件，并加载一组非常有限的自动配置类。如果您需要排除其中一个，则大多数<code>@…Test</code>注释都会提供<code>excludeAutoConfiguration</code>属性。或者，您可以使用<code>@ImportAutoConfiguration#exclude</code>。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>不支持在一次测试中使用多个<code>@…Test</code>注释包含多个“切片”。如果您需要多个“切片”，请选择<code>@…Test</code>注释之一并手动包含其他“切片”的<code>@AutoConfigure…</code>注释。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>也可以将<code>@AutoConfigure…</code>注释与标准<code>@SpringBootTest</code>注释一起使用。如果您对“切片”应用程序不感兴趣，但想要一些自动配置的测试beans，则可以使用此组合。</td>
</tr>
</tbody></table>
<h3 id="45-3-9自动配置的JSON测试"><a href="#45-3-9自动配置的JSON测试" class="headerlink" title="45.3.9自动配置的JSON测试"></a>45.3.9自动配置的JSON测试</h3><p>要测试该对象JSON序列化和反序列化是否按预期工作，您可以使用<code>@JsonTest</code>注释。<code>@JsonTest</code>自动配置可用的受支持的JSON映射器，它可以是以下库之一：</p>
<ul>
<li>Jackson <code>ObjectMapper</code>，任何<code>@JsonComponent</code> beans和任何Jackson <code>Module</code> s</li>
<li><code>Gson</code></li>
<li><code>Jsonb</code></li>
</ul>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>可以<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#test-auto-configuration">在附录中找到</a> <code>@JsonTest</code>启用的自动配置列表 。</td>
</tr>
</tbody></table>
<p>如果需要配置自动配置的元素，可以使用<code>@AutoConfigureJsonTesters</code>注释。</p>
<p>Spring Boot包括基于AssertJ的助手，它们与JSONAssert和JsonPath库一起使用，以检查JSON是否按预期显示。<code>JacksonTester</code>，<code>GsonTester</code>，<code>JsonbTester</code>和<code>BasicJsonTester</code>类可分别用于Jackson，Gson，Jsonb和Strings。使用<code>@JsonTest</code>时，测试类上的任何辅助字段都可以是<code>@Autowired</code>。以下示例显示了Jackson的测试类：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">import org.junit.*;</span><br><span class="line">import org.junit.runner.*;</span><br><span class="line">import org.springframework.beans.factory.annotation.*;</span><br><span class="line">import org.springframework.boot.test.autoconfigure.json.*;</span><br><span class="line">import org.springframework.boot.test.context.*;</span><br><span class="line">import org.springframework.boot.test.json.*;</span><br><span class="line">import org.springframework.test.context.junit4.*;</span><br><span class="line"></span><br><span class="line">import static org.assertj.core.api.Assertions.*;</span><br><span class="line"></span><br><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@JsonTest</span><br><span class="line">public class MyJsonTests &#123;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	private JacksonTester&lt;VehicleDetails&gt; json;</span><br><span class="line"></span><br><span class="line">	@Test</span><br><span class="line">	public void testSerialize() throws Exception &#123;</span><br><span class="line">		VehicleDetails details &#x3D; new VehicleDetails(&quot;Honda&quot;, &quot;Civic&quot;);</span><br><span class="line">		&#x2F;&#x2F; Assert against a &#96;.json&#96; file in the same package as the test</span><br><span class="line">		assertThat(this.json.write(details)).isEqualToJson(&quot;expected.json&quot;);</span><br><span class="line">		&#x2F;&#x2F; Or use JSON path based assertions</span><br><span class="line">		assertThat(this.json.write(details)).hasJsonPathStringValue(&quot;@.make&quot;);</span><br><span class="line">		assertThat(this.json.write(details)).extractingJsonPathStringValue(&quot;@.make&quot;)</span><br><span class="line">				.isEqualTo(&quot;Honda&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Test</span><br><span class="line">	public void testDeserialize() throws Exception &#123;</span><br><span class="line">		String content &#x3D; &quot;&#123;\&quot;make\&quot;:\&quot;Ford\&quot;,\&quot;model\&quot;:\&quot;Focus\&quot;&#125;&quot;;</span><br><span class="line">		assertThat(this.json.parse(content))</span><br><span class="line">				.isEqualTo(new VehicleDetails(&quot;Ford&quot;, &quot;Focus&quot;));</span><br><span class="line">		assertThat(this.json.parseObject(content).getMake()).isEqualTo(&quot;Ford&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>JSON帮助程序类也可以直接用于标准单元测试。为此，如果不使用<code>@JsonTest</code>，请在<code>@Before</code>方法中调用助手的<code>initFields</code>方法。</td>
</tr>
</tbody></table>
<h3 id="45-3-10自动配置的Spring-MVC测试"><a href="#45-3-10自动配置的Spring-MVC测试" class="headerlink" title="45.3.10自动配置的Spring MVC测试"></a>45.3.10自动配置的Spring MVC测试</h3><p>要测试Spring MVC控制器是否按预期工作，请使用<code>@WebMvcTest</code>注释。<code>@WebMvcTest</code>自动配置Spring MVC基础设施并将扫描beans限制为<code>@Controller</code>，<code>@ControllerAdvice</code>，<code>@JsonComponent</code>，<code>Converter</code>，<code>GenericConverter</code>，<code>Filter</code>，<code>WebMvcConfigurer</code>和<code>HandlerMethodArgumentResolver</code>。使用此注释时，不会扫描常规<code>@Component</code> beans。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>可以<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#test-auto-configuration">在附录中找到</a> <code>@WebMvcTest</code>启用的自动配置设置列表 。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果您需要注册额外的组件，例如Jackson <code>Module</code>，则可以在测试中使用<code>@Import</code>导入其他配置类。</td>
</tr>
</tbody></table>
<p>通常，<code>@WebMvcTest</code>仅限于一个控制器，并与<code>@MockBean</code>结合使用，为所需的协作者提供模拟实现。</p>
<p><code>@WebMvcTest</code>也自动配置<code>MockMvc</code>。Mock MVC提供了一种快速测试MVC控制器的强大方法，无需启动完整的HTTP服务器。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>您还可以使用<code>@AutoConfigureMockMvc</code>对其进行注释，以非<code>@WebMvcTest</code>（例如<code>@SpringBootTest</code>）自动配置<code>MockMvc</code>。以下示例使用<code>MockMvc</code>：</td>
</tr>
</tbody></table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">import org.junit.*;</span><br><span class="line">import org.junit.runner.*;</span><br><span class="line">import org.springframework.beans.factory.annotation.*;</span><br><span class="line">import org.springframework.boot.test.autoconfigure.web.servlet.*;</span><br><span class="line">import org.springframework.boot.test.mock.mockito.*;</span><br><span class="line"></span><br><span class="line">import static org.assertj.core.api.Assertions.*;</span><br><span class="line">import static org.mockito.BDDMockito.*;</span><br><span class="line">import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*;</span><br><span class="line">import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.*;</span><br><span class="line"></span><br><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@WebMvcTest(UserVehicleController.class)</span><br><span class="line">public class MyControllerTests &#123;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	private MockMvc mvc;</span><br><span class="line"></span><br><span class="line">	@MockBean</span><br><span class="line">	private UserVehicleService userVehicleService;</span><br><span class="line"></span><br><span class="line">	@Test</span><br><span class="line">	public void testExample() throws Exception &#123;</span><br><span class="line">		given(this.userVehicleService.getVehicleDetails(&quot;sboot&quot;))</span><br><span class="line">				.willReturn(new VehicleDetails(&quot;Honda&quot;, &quot;Civic&quot;));</span><br><span class="line">		this.mvc.perform(get(&quot;&#x2F;sboot&#x2F;vehicle&quot;).accept(MediaType.TEXT_PLAIN))</span><br><span class="line">				.andExpect(status().isOk()).andExpect(content().string(&quot;Honda Civic&quot;));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果需要配置自动配置的元素（例如，应该应用servlet过滤器时），可以使用<code>@AutoConfigureMockMvc</code>注释中的属性。</td>
</tr>
</tbody></table>
<p>如果您使用HtmlUnit或Selenium，则自动配置还会提供HTMLUnit <code>WebClient</code> bean和/或<code>WebDriver</code> bean。以下示例使用HtmlUnit：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">import com.gargoylesoftware.htmlunit.*;</span><br><span class="line">import org.junit.*;</span><br><span class="line">import org.junit.runner.*;</span><br><span class="line">import org.springframework.beans.factory.annotation.*;</span><br><span class="line">import org.springframework.boot.test.autoconfigure.web.servlet.*;</span><br><span class="line">import org.springframework.boot.test.mock.mockito.*;</span><br><span class="line"></span><br><span class="line">import static org.assertj.core.api.Assertions.*;</span><br><span class="line">import static org.mockito.BDDMockito.*;</span><br><span class="line"></span><br><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@WebMvcTest(UserVehicleController.class)</span><br><span class="line">public class MyHtmlUnitTests &#123;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	private WebClient webClient;</span><br><span class="line"></span><br><span class="line">	@MockBean</span><br><span class="line">	private UserVehicleService userVehicleService;</span><br><span class="line"></span><br><span class="line">	@Test</span><br><span class="line">	public void testExample() throws Exception &#123;</span><br><span class="line">		given(this.userVehicleService.getVehicleDetails(&quot;sboot&quot;))</span><br><span class="line">				.willReturn(new VehicleDetails(&quot;Honda&quot;, &quot;Civic&quot;));</span><br><span class="line">		HtmlPage page &#x3D; this.webClient.getPage(&quot;&#x2F;sboot&#x2F;vehicle.html&quot;);</span><br><span class="line">		assertThat(page.getBody().getTextContent()).isEqualTo(&quot;Honda Civic&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>默认情况下，Spring Boot将<code>WebDriver</code> beans置于特殊的“范围”中，以确保驱动程序在每次测试后退出并注入新实例。如果您不想要此行为，可以将<code>@Scope(&quot;singleton&quot;)</code>添加到<code>WebDriver</code> <code>@Bean</code>定义中。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/warning.png" alt="[警告]"></th>
</tr>
</thead>
<tbody><tr>
<td>Spring Boot创建的<code>webDriver</code>范围将替换任何用户定义的同名范围。如果您定义自己的<code>webDriver</code>范围，则在使用<code>@WebMvcTest</code>时可能会发现它停止工作。</td>
</tr>
</tbody></table>
<p>如果您在类路径上拥有Spring安全性，<code>@WebMvcTest</code>也会扫描<code>WebSecurityConfigurer</code> beans。您可以使用Spring安全性测试支持，而不是完全禁用此类测试的安全性。有关如何使用Spring安全性<code>MockMvc</code>支持的更多详细信息，请参阅*<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#howto-use-test-with-spring-security">本章80，*使用Spring安全*</a>*性操作方法部分进行测试。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>有时写Spring MVC测试是不够的; Spring Boot可以帮助您<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-testing-spring-boot-applications-testing-with-running-server">使用实际服务器</a>运行 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-testing-spring-boot-applications-testing-with-running-server">完整的端到端测试</a>。</td>
</tr>
</tbody></table>
<h3 id="45-3-11自动配置Spring-WebFlux测试"><a href="#45-3-11自动配置Spring-WebFlux测试" class="headerlink" title="45.3.11自动配置Spring WebFlux测试"></a>45.3.11自动配置Spring WebFlux测试</h3><p>要测试<a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference//web-reactive.html">Spring WebFlux</a>控制器是否按预期工作，您可以使用<code>@WebFluxTest</code>注释。<code>@WebFluxTest</code>自动配置Spring WebFlux基础架构，并将扫描的beans限制为<code>@Controller</code>，<code>@ControllerAdvice</code>，<code>@JsonComponent</code>，<code>Converter</code>，<code>GenericConverter</code>和<code>WebFluxConfigurer</code>。使用<code>@WebFluxTest</code>注释时，不会扫描常规<code>@Component</code> beans。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>可以<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#test-auto-configuration">在附录中找到</a> <code>@WebFluxTest</code>启用的自动配置列表 。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果需要注册额外的组件，例如Jackson <code>Module</code>，则可以在测试中使用<code>@Import</code>导入其他配置类。</td>
</tr>
</tbody></table>
<p>通常，<code>@WebFluxTest</code>仅限于单个控制器，并与<code>@MockBean</code>注释结合使用，为所需的协作者提供模拟实现。</p>
<p><code>@WebFluxTest</code>也是自动配置 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/testing.html#webtestclient"><code>WebTestClient</code></a>，它提供了一种快速测试WebFlux控制器的强大方法，无需启动完整的HTTP服务器。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>您还可以通过使用<code>@AutoConfigureWebTestClient</code>对其进行注释，在非<code>@WebFluxTest</code>（例如<code>@SpringBootTest</code>）中自动配置<code>WebTestClient</code>。以下示例显示了同时使用<code>@WebFluxTest</code>和<code>WebTestClient</code>的类：</td>
</tr>
</tbody></table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">import org.junit.Test;</span><br><span class="line">import org.junit.runner.RunWith;</span><br><span class="line"></span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.boot.test.autoconfigure.web.reactive.WebFluxTest;</span><br><span class="line">import org.springframework.http.MediaType;</span><br><span class="line">import org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line">import org.springframework.test.web.reactive.server.WebTestClient;</span><br><span class="line"></span><br><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@WebFluxTest(UserVehicleController.class)</span><br><span class="line">public class MyControllerTests &#123;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	private WebTestClient webClient;</span><br><span class="line"></span><br><span class="line">	@MockBean</span><br><span class="line">	private UserVehicleService userVehicleService;</span><br><span class="line"></span><br><span class="line">	@Test</span><br><span class="line">	public void testExample() throws Exception &#123;</span><br><span class="line">		given(this.userVehicleService.getVehicleDetails(&quot;sboot&quot;))</span><br><span class="line">				.willReturn(new VehicleDetails(&quot;Honda&quot;, &quot;Civic&quot;));</span><br><span class="line">		this.webClient.get().uri(&quot;&#x2F;sboot&#x2F;vehicle&quot;).accept(MediaType.TEXT_PLAIN)</span><br><span class="line">				.exchange()</span><br><span class="line">				.expectStatus().isOk()</span><br><span class="line">				.expectBody(String.class).isEqualTo(&quot;Honda Civic&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>此设置仅由WebFlux应用程序支持，因为在模拟的Web应用程序中使用<code>WebTestClient</code>目前仅适用于WebFlux。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td><code>@WebFluxTest</code>无法检测通过功能Web框架注册的路由。要在上下文中测试<code>RouterFunction</code> beans，请考虑通过<code>@Import</code>或使用<code>@SpringBootTest</code>自行导入<code>RouterFunction</code>。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>有时写Spring WebFlux测试是不够的; Spring Boot可以帮助您<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-testing-spring-boot-applications-testing-with-running-server">使用实际服务器</a>运行 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-testing-spring-boot-applications-testing-with-running-server">完整的端到端测试</a>。</td>
</tr>
</tbody></table>
<h3 id="45-3-12自动配置的数据JPA测试"><a href="#45-3-12自动配置的数据JPA测试" class="headerlink" title="45.3.12自动配置的数据JPA测试"></a>45.3.12自动配置的数据JPA测试</h3><p>您可以使用<code>@DataJpaTest</code>注释来测试JPA应用程序。默认情况下，它配置内存中的嵌入式数据库，扫描<code>@Entity</code>类，并配置Spring Data JPA存储库。常规<code>@Component</code> beans未加载到<code>ApplicationContext</code>。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>可以<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#test-auto-configuration">在附录中找到</a> <code>@DataJpaTest</code>启用的自动配置设置列表 。</td>
</tr>
</tbody></table>
<p>默认情况下，数据JPA测试是事务性的，并在每次测试结束时回滚。有关 更多详细信息，请参阅Spring框架参考文档中的<a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/testing.html#testcontext-tx-enabling-transactions">相关部分</a>。如果这不是您想要的，您可以为测试或整个类禁用事务管理，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import org.junit.Test;</span><br><span class="line">import org.junit.runner.RunWith;</span><br><span class="line">import org.springframework.boot.test.autoconfigure.orm.jpa.DataJpaTest;</span><br><span class="line">import org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line">import org.springframework.transaction.annotation.Propagation;</span><br><span class="line">import org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@DataJpaTest</span><br><span class="line">@Transactional(propagation &#x3D; Propagation.NOT_SUPPORTED)</span><br><span class="line">public class ExampleNonTransactionalTests &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>数据JPA测试也可以注入 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-test-autoconfigure/src/main/java/org/springframework/boot/test/autoconfigure/orm/jpa/TestEntityManager.java"><code>TestEntityManager</code></a> bean，它提供了专门为测试设计的标准JPA <code>EntityManager</code>的替代方案。如果要在<code>@DataJpaTest</code>实例之外使用<code>TestEntityManager</code>，还可以使用<code>@AutoConfigureTestEntityManager</code>注释。如果您需要，也可以使用<code>JdbcTemplate</code>。以下示例显示正在使用的<code>@DataJpaTest</code>注释：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import org.junit.*;</span><br><span class="line">import org.junit.runner.*;</span><br><span class="line">import org.springframework.boot.test.autoconfigure.orm.jpa.*;</span><br><span class="line"></span><br><span class="line">import static org.assertj.core.api.Assertions.*;</span><br><span class="line"></span><br><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@DataJpaTest</span><br><span class="line">public class ExampleRepositoryTests &#123;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	private TestEntityManager entityManager;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	private UserRepository repository;</span><br><span class="line"></span><br><span class="line">	@Test</span><br><span class="line">	public void testExample() throws Exception &#123;</span><br><span class="line">		this.entityManager.persist(new User(&quot;sboot&quot;, &quot;1234&quot;));</span><br><span class="line">		User user &#x3D; this.repository.findByUsername(&quot;sboot&quot;);</span><br><span class="line">		assertThat(user.getUsername()).isEqualTo(&quot;sboot&quot;);</span><br><span class="line">		assertThat(user.getVin()).isEqualTo(&quot;1234&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>内存中嵌入式数据库通常适用于测试，因为它们速度快且不需要任何安装。但是，如果您更喜欢对真实数据库运行测试，则可以使用<code>@AutoConfigureTestDatabase</code>注释，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@DataJpaTest</span><br><span class="line">@AutoConfigureTestDatabase(replace&#x3D;Replace.NONE)</span><br><span class="line">public class ExampleRepositoryTests &#123;</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F; ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="45-3-13自动配置的JDBC测试"><a href="#45-3-13自动配置的JDBC测试" class="headerlink" title="45.3.13自动配置的JDBC测试"></a>45.3.13自动配置的JDBC测试</h3><p><code>@JdbcTest</code>类似于<code>@DataJpaTest</code>，但适用于仅需要<code>DataSource</code>并且不使用Spring数据JDBC的测试。默认情况下，它配置内存中嵌入式数据库和<code>JdbcTemplate</code>。常规<code>@Component</code> beans未加载到<code>ApplicationContext</code>。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>可以<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#test-auto-configuration">在附录中找到</a> <code>@JdbcTest</code>启用的自动配置列表 。</td>
</tr>
</tbody></table>
<p>默认情况下，JDBC测试是事务性的，并在每次测试结束时回滚。有关更多详细信息，请参阅Spring框架参考文档中的 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/testing.html#testcontext-tx-enabling-transactions">相关部分</a>。如果这不是您想要的，您可以禁用测试或整个类的事务管理，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import org.junit.Test;</span><br><span class="line">import org.junit.runner.RunWith;</span><br><span class="line">import org.springframework.boot.test.autoconfigure.jdbc.JdbcTest;</span><br><span class="line">import org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line">import org.springframework.transaction.annotation.Propagation;</span><br><span class="line">import org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@JdbcTest</span><br><span class="line">@Transactional(propagation &#x3D; Propagation.NOT_SUPPORTED)</span><br><span class="line">public class ExampleNonTransactionalTests &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果您希望测试针对真实数据库运行，则可以使用<code>@AutoConfigureTestDatabase</code>注释，方法与<code>DataJpaTest</code>相同。（参见“ <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-testing-spring-boot-applications-testing-autoconfigured-jpa-test">第45.3.12节</a> ” <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-testing-spring-boot-applications-testing-autoconfigured-jpa-test">，“自动配置的数据JPA测试”</a> “。）</p>
<h3 id="45-3-14自动配置的数据JDBC测试"><a href="#45-3-14自动配置的数据JDBC测试" class="headerlink" title="45.3.14自动配置的数据JDBC测试"></a>45.3.14自动配置的数据JDBC测试</h3><p><code>@DataJdbcTest</code>类似于<code>@JdbcTest</code>，但适用于使用Spring数据JDBC存储库的测试。默认情况下，它配置内存中的嵌入式数据库，<code>JdbcTemplate</code>和Spring数据JDBC存储库。常规<code>@Component</code> beans未加载到<code>ApplicationContext</code>。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>可以<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#test-auto-configuration">在附录中找到</a> <code>@DataJdbcTest</code>启用的自动配置列表 。</td>
</tr>
</tbody></table>
<p>默认情况下，数据JDBC测试是事务性的，并在每次测试结束时回滚。有关 更多详细信息，请参阅Spring框架参考文档中的<a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/testing.html#testcontext-tx-enabling-transactions">相关部分</a>。如果这不是您想要的，您可以禁用测试或整个测试类的事务管理，如 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-testing-spring-boot-applications-testing-autoconfigured-jdbc-test">JDBC示例中所示</a>。</p>
<p>如果您希望测试针对真实数据库运行，则可以使用<code>@AutoConfigureTestDatabase</code>注释，方法与<code>DataJpaTest</code>相同。（参见“ <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-testing-spring-boot-applications-testing-autoconfigured-jpa-test">第45.3.12节</a> ” <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-testing-spring-boot-applications-testing-autoconfigured-jpa-test">，“自动配置的数据JPA测试”</a> “。）</p>
<h3 id="45-3-15自动配置的jOOQ测试"><a href="#45-3-15自动配置的jOOQ测试" class="headerlink" title="45.3.15自动配置的jOOQ测试"></a>45.3.15自动配置的jOOQ测试</h3><p>您可以使用与<code>@JdbcTest</code>类似的方式使用<code>@JooqTest</code>，但是可以使用与jOOQ相关的测试。由于jOOQ严重依赖于与数据库模式相对应的基于Java的模式，因此使用现有的<code>DataSource</code>。如果要将其替换为内存数据库，可以使用<code>@AutoConfigureTestDatabase</code>覆盖这些设置。（有关在Spring Boot中使用jOOQ的更多信息，请参阅本章前面的“ <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-jooq">第30.6节</a> ” <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-jooq">，“使用jOOQ”</a>。）常规<code>@Component</code> beans未加载到<code>ApplicationContext</code>。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>可以<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#test-auto-configuration">在附录中找到</a> <code>@JooqTest</code>启用的自动配置列表 。</td>
</tr>
</tbody></table>
<p><code>@JooqTest</code>配置<code>DSLContext</code>。常规<code>@Component</code> beans未加载到<code>ApplicationContext</code>。以下示例显示正在使用的<code>@JooqTest</code>注释：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import org.jooq.DSLContext;</span><br><span class="line">import org.junit.Test;</span><br><span class="line">import org.junit.runner.RunWith;</span><br><span class="line">import org.springframework.boot.test.autoconfigure.jooq.JooqTest;</span><br><span class="line">import org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@JooqTest</span><br><span class="line">public class ExampleJooqTests &#123;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	private DSLContext dslContext;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>JOOQ测试是事务性的，默认情况下在每个测试结束时回滚。如果这不是您想要的，您可以禁用测试或整个测试类的事务管理，如 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-testing-spring-boot-applications-testing-autoconfigured-jdbc-test">JDBC示例中所示</a>。</p>
<h3 id="45-3-16自动配置的数据MongoDB测试"><a href="#45-3-16自动配置的数据MongoDB测试" class="headerlink" title="45.3.16自动配置的数据MongoDB测试"></a>45.3.16自动配置的数据MongoDB测试</h3><p>您可以使用<code>@DataMongoTest</code>来测试MongoDB应用程序。默认情况下，它配置内存中嵌入的MongoDB（如果可用），配置<code>MongoTemplate</code>，扫描<code>@Document</code>类，并配置Spring Data MongoDB存储库。常规<code>@Component</code> beans未加载到<code>ApplicationContext</code>。（有关将MongoDB与Spring Boot一起使用的更多信息，请参阅本章前面的“ <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-mongodb">第31.2节”，“MongoDB”</a>。）</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>可以<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#test-auto-configuration">在附录中找到</a> <code>@DataMongoTest</code>启用的自动配置设置列表 。</td>
</tr>
</tbody></table>
<p>以下类显示正在使用的<code>@DataMongoTest</code>注释：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import org.junit.runner.RunWith;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.boot.test.autoconfigure.data.mongo.DataMongoTest;</span><br><span class="line">import org.springframework.data.mongodb.core.MongoTemplate;</span><br><span class="line">import org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@DataMongoTest</span><br><span class="line">public class ExampleDataMongoTests &#123;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	private MongoTemplate mongoTemplate;</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>内存中嵌入式MongoDB通常适用于测试，因为它速度快，不需要任何开发人员安装。但是，如果您更喜欢对真正的MongoDB服务器运行测试，则应排除嵌入式MongoDB自动配置，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import org.junit.runner.RunWith;</span><br><span class="line"> import org.springframework.boot.autoconfigure.mongo.embedded.EmbeddedMongoAutoConfiguration;</span><br><span class="line">import org.springframework.boot.test.autoconfigure.data.mongo.DataMongoTest;</span><br><span class="line">import org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@DataMongoTest(excludeAutoConfiguration &#x3D; EmbeddedMongoAutoConfiguration.class)</span><br><span class="line">public class ExampleDataMongoNonEmbeddedTests &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="45-3-17自动配置的数据Neo4j测试"><a href="#45-3-17自动配置的数据Neo4j测试" class="headerlink" title="45.3.17自动配置的数据Neo4j测试"></a>45.3.17自动配置的数据Neo4j测试</h3><p>您可以使用<code>@DataNeo4jTest</code>来测试Neo4j应用程序。默认情况下，它使用内存中嵌入式Neo4j（如果嵌入式驱动程序可用），扫描<code>@NodeEntity</code>类，并配置Spring Data Neo4j存储库。常规<code>@Component</code> beans未加载到<code>ApplicationContext</code>。（有关使用带有Spring Boot的Neo4J的更多信息，请参阅本章前面的“ <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-neo4j">第31.3节”，“Neo4j”</a>。）</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>可以<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#test-auto-configuration">在附录中找到</a> <code>@DataNeo4jTest</code>启用的自动配置设置列表 。</td>
</tr>
</tbody></table>
<p>以下示例显示了在Spring Boot中使用Neo4J测试的典型设置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import org.junit.runner.RunWith;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.boot.test.autoconfigure.data.neo4j.DataNeo4jTest;</span><br><span class="line">import org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@DataNeo4jTest</span><br><span class="line">public class ExampleDataNeo4jTests &#123;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	private YourRepository repository;</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>默认情况下，Data Neo4j测试是事务性的，并在每次测试结束时回滚。有关更多详细信息，请参阅Spring框架参考文档中的<a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/testing.html#testcontext-tx-enabling-transactions">相关部分</a>。如果这不是您想要的，您可以禁用测试或整个类的事务管理，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import org.junit.Test;</span><br><span class="line">import org.junit.runner.RunWith;</span><br><span class="line">import org.springframework.boot.test.autoconfigure.data.neo4j.DataNeo4jTest;</span><br><span class="line">import org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line">import org.springframework.transaction.annotation.Propagation;</span><br><span class="line">import org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@DataNeo4jTest</span><br><span class="line">@Transactional(propagation &#x3D; Propagation.NOT_SUPPORTED)</span><br><span class="line">public class ExampleNonTransactionalTests &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="45-3-18自动配置的数据Redis测试"><a href="#45-3-18自动配置的数据Redis测试" class="headerlink" title="45.3.18自动配置的数据Redis测试"></a>45.3.18自动配置的数据Redis测试</h3><p>您可以使用<code>@DataRedisTest</code>来测试Redis应用程序。默认情况下，它会扫描<code>@RedisHash</code>类并配置Spring Data Redis存储库。常规<code>@Component</code> beans未加载到<code>ApplicationContext</code>。（有关将Redis与Spring Boot一起使用的更多信息，请参阅本章前面的“ <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-redis">第31.1节”，“37 /}”</a>。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>可以<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#test-auto-configuration">在附录中找到</a> <code>@DataRedisTest</code>启用的自动配置设置列表 。</td>
</tr>
</tbody></table>
<p>以下示例显示正在使用的<code>@DataRedisTest</code>注释：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import org.junit.runner.RunWith;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.boot.test.autoconfigure.data.redis.DataRedisTest;</span><br><span class="line">import org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@DataRedisTest</span><br><span class="line">public class ExampleDataRedisTests &#123;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	private YourRepository repository;</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="45-3-19自动配置的数据LDAP测试"><a href="#45-3-19自动配置的数据LDAP测试" class="headerlink" title="45.3.19自动配置的数据LDAP测试"></a>45.3.19自动配置的数据LDAP测试</h3><p>您可以使用<code>@DataLdapTest</code>来测试LDAP应用程序。默认情况下，它配置内存中嵌入式LDAP（如果可用），配置<code>LdapTemplate</code>，扫描<code>@Entry</code>类，并配置Spring数据LDAP存储库。常规<code>@Component</code> beans未加载到<code>ApplicationContext</code>。（有关将LDAP与Spring Boot一起使用的更多信息，请参阅本章前面的“ <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-ldap">第31.9节”，“LDAP”</a>。）</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>可以<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#test-auto-configuration">在附录中找到</a> <code>@DataLdapTest</code>启用的自动配置设置列表 。</td>
</tr>
</tbody></table>
<p>以下示例显示正在使用的<code>@DataLdapTest</code>注释：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import org.junit.runner.RunWith;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.boot.test.autoconfigure.data.ldap.DataLdapTest;</span><br><span class="line">import org.springframework.ldap.core.LdapTemplate;</span><br><span class="line">import org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@DataLdapTest</span><br><span class="line">public class ExampleDataLdapTests &#123;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	private LdapTemplate ldapTemplate;</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>内存中嵌入式LDAP通常适用于测试，因为它速度快，不需要任何开发人员安装。但是，如果您希望针对真实LDAP服务器运行测试，则应排除嵌入式LDAP自动配置，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import org.junit.runner.RunWith;</span><br><span class="line">import org.springframework.boot.autoconfigure.ldap.embedded.EmbeddedLdapAutoConfiguration;</span><br><span class="line">import org.springframework.boot.test.autoconfigure.data.ldap.DataLdapTest;</span><br><span class="line">import org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@DataLdapTest(excludeAutoConfiguration &#x3D; EmbeddedLdapAutoConfiguration.class)</span><br><span class="line">public class ExampleDataLdapNonEmbeddedTests &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="45-3-20自动配置的REST客户端"><a href="#45-3-20自动配置的REST客户端" class="headerlink" title="45.3.20自动配置的REST客户端"></a>45.3.20自动配置的REST客户端</h3><p>您可以使用<code>@RestClientTest</code>注释来测试REST客户端。默认情况下，它会自动配置Jackson，GSON和Jsonb支持，配置<code>RestTemplateBuilder</code>，并添加对<code>MockRestServiceServer</code>的支持。常规<code>@Component</code> beans未加载到<code>ApplicationContext</code>。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>可以<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#test-auto-configuration">在附录中找到</a> <code>@RestClientTest</code>启用的自动配置设置列表。</td>
</tr>
</tbody></table>
<p>应使用<code>@RestClientTest</code>的<code>value</code>或<code>components</code>属性指定要测试的特定beans，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@RestClientTest(RemoteVehicleDetailsService.class)</span><br><span class="line">public class ExampleRestClientTest &#123;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	private RemoteVehicleDetailsService service;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	private MockRestServiceServer server;</span><br><span class="line"></span><br><span class="line">	@Test</span><br><span class="line">	public void getVehicleDetailsWhenResultIsSuccessShouldReturnDetails()</span><br><span class="line">			throws Exception &#123;</span><br><span class="line">		this.server.expect(requestTo(&quot;&#x2F;greet&#x2F;details&quot;))</span><br><span class="line">				.andRespond(withSuccess(&quot;hello&quot;, MediaType.TEXT_PLAIN));</span><br><span class="line">		String greeting &#x3D; this.service.callRestService();</span><br><span class="line">		assertThat(greeting).isEqualTo(&quot;hello&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="45-3-21自动配置的Spring-REST文档测试"><a href="#45-3-21自动配置的Spring-REST文档测试" class="headerlink" title="45.3.21自动配置的Spring REST文档测试"></a>45.3.21自动配置的Spring REST文档测试</h3><p>您可以使用<code>@AutoConfigureRestDocs</code>注释在Mock MVC，REST Assured或WebTestClient的测试中使用<a target="_blank" rel="noopener" href="https://projects.spring.io/spring-restdocs/">Spring REST Docs</a>。它消除了对Spring REST Docs中JUnit规则的需求。</p>
<p><code>@AutoConfigureRestDocs</code>可用于覆盖默认输出目录（如果您使用Maven，则为<code>target/generated-snippets</code>;如果您使用Gradle，则为<code>build/generated-snippets</code>）。它还可用于配置出现在任何已记录的URI中的主机，方案和端口。</p>
<h4 id="使用Mock-MVC自动配置Spring-REST文档测试"><a href="#使用Mock-MVC自动配置Spring-REST文档测试" class="headerlink" title="使用Mock MVC自动配置Spring REST文档测试"></a>使用Mock MVC自动配置Spring REST文档测试</h4><p><code>@AutoConfigureRestDocs</code>自定义<code>MockMvc</code> bean以使用Spring REST文档。您可以使用<code>@Autowired</code>注入它并在测试中使用它，就像使用Mock MVC和Spring REST Docs时一样，如下例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">import org.junit.Test;</span><br><span class="line">import org.junit.runner.RunWith;</span><br><span class="line"></span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;</span><br><span class="line">import org.springframework.http.MediaType;</span><br><span class="line">import org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line">import org.springframework.test.web.servlet.MockMvc;</span><br><span class="line"></span><br><span class="line">import static org.springframework.restdocs.mockmvc.MockMvcRestDocumentation.document;</span><br><span class="line">import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;</span><br><span class="line">import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.*;</span><br><span class="line"></span><br><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@WebMvcTest(UserController.class)</span><br><span class="line">@AutoConfigureRestDocs</span><br><span class="line">public class UserDocumentationTests &#123;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	private MockMvc mvc;</span><br><span class="line"></span><br><span class="line">	@Test</span><br><span class="line">	public void listUsers() throws Exception &#123;</span><br><span class="line">		this.mvc.perform(get(&quot;&#x2F;users&quot;).accept(MediaType.TEXT_PLAIN))</span><br><span class="line">				.andExpect(status().isOk())</span><br><span class="line">				.andDo(document(&quot;list-users&quot;));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果您需要对Spring REST Docs配置的更多控制，而不是<code>@AutoConfigureRestDocs</code>属性提供的控制，则可以使用<code>RestDocsMockMvcConfigurationCustomizer</code> bean，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@TestConfiguration</span><br><span class="line">static class CustomizationConfiguration</span><br><span class="line">		implements RestDocsMockMvcConfigurationCustomizer &#123;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public void customize(MockMvcRestDocumentationConfigurer configurer) &#123;</span><br><span class="line">		configurer.snippets().withTemplateFormat(TemplateFormats.markdown());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果要对参数化输出目录使用Spring REST Docs支持，可以创建<code>RestDocumentationResultHandler</code> bean。自动配置使用此结果处理程序调用<code>alwaysDo</code>，从而导致每个<code>MockMvc</code>调用自动生成默认代码段。以下示例显示正在定义的<code>RestDocumentationResultHandler</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@TestConfiguration</span><br><span class="line">static class ResultHandlerConfiguration &#123;</span><br><span class="line"></span><br><span class="line">	@Bean</span><br><span class="line">	public RestDocumentationResultHandler restDocumentation() &#123;</span><br><span class="line">		return MockMvcRestDocumentation.document(&quot;&#123;method-name&#125;&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="使用REST-Assured自动配置Spring-REST文档测试"><a href="#使用REST-Assured自动配置Spring-REST文档测试" class="headerlink" title="使用REST Assured自动配置Spring REST文档测试"></a>使用REST Assured自动配置Spring REST文档测试</h4><p><code>@AutoConfigureRestDocs</code>生成<code>RequestSpecification</code> bean，预先配置为使用Spring REST文档，可用于您的测试。您可以使用<code>@Autowired</code>注入它并在测试中使用它，就像使用REST Assured和Spring REST Docs时一样，如下例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">import io.restassured.specification.RequestSpecification;</span><br><span class="line">import org.junit.Test;</span><br><span class="line">import org.junit.runner.RunWith;</span><br><span class="line"></span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.boot.test.autoconfigure.restdocs.AutoConfigureRestDocs;</span><br><span class="line">import org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line">import org.springframework.boot.test.context.SpringBootTest.WebEnvironment;</span><br><span class="line">import org.springframework.boot.web.server.LocalServerPort;</span><br><span class="line">import org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line">import static io.restassured.RestAssured.given;</span><br><span class="line">import static org.hamcrest.CoreMatchers.is;</span><br><span class="line">import static org.springframework.restdocs.restassured3.RestAssuredRestDocumentation.document;</span><br><span class="line"></span><br><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@SpringBootTest(webEnvironment &#x3D; WebEnvironment.RANDOM_PORT)</span><br><span class="line">@AutoConfigureRestDocs</span><br><span class="line">public class UserDocumentationTests &#123;</span><br><span class="line"></span><br><span class="line">	@LocalServerPort</span><br><span class="line">	private int port;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	private RequestSpecification documentationSpec;</span><br><span class="line"></span><br><span class="line">	@Test</span><br><span class="line">	public void listUsers() &#123;</span><br><span class="line">		given(this.documentationSpec).filter(document(&quot;list-users&quot;)).when()</span><br><span class="line">				.port(this.port).get(&quot;&#x2F;&quot;).then().assertThat().statusCode(is(200));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果您需要对Spring REST Docs配置进行更多控制，而不是<code>@AutoConfigureRestDocs</code>属性提供的控制，则可以使用<code>RestDocsRestAssuredConfigurationCustomizer</code> bean，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@TestConfiguration</span><br><span class="line">public static class CustomizationConfiguration</span><br><span class="line">		implements RestDocsRestAssuredConfigurationCustomizer &#123;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public void customize(RestAssuredRestDocumentationConfigurer configurer) &#123;</span><br><span class="line">		configurer.snippets().withTemplateFormat(TemplateFormats.markdown());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="45-3-22附加自动配置和切片"><a href="#45-3-22附加自动配置和切片" class="headerlink" title="45.3.22附加自动配置和切片"></a>45.3.22附加自动配置和切片</h3><p>每个切片提供一个或多个<code>@AutoConfigure…</code>注释，即定义应作为切片的一部分包括的自动配置。可以通过创建自定义<code>@AutoConfigure…</code>注释或仅通过向测试添加<code>@ImportAutoConfiguration</code>来添加其他自动配置，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@JdbcTest</span><br><span class="line">@ImportAutoConfiguration(IntegrationAutoConfiguration.class)</span><br><span class="line">public class ExampleJdbcTests &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>确保不使用常规<code>@Import</code>注释来导入自动配置，因为Spring Boot以特定方式处理它们。</td>
</tr>
</tbody></table>
<h3 id="45-3-23用户配置和切片"><a href="#45-3-23用户配置和切片" class="headerlink" title="45.3.23用户配置和切片"></a>45.3.23用户配置和切片</h3><p>如果以合理的方式<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-structuring-your-code">构造代码</a>，<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-testing-spring-boot-applications-detecting-config">默认情况下</a>会<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-testing-spring-boot-applications-detecting-config">使用</a> <code>@SpringBootApplication</code>类 作为测试的配置。</p>
<p>然后，重要的是不要使用特定于其功能的特定区域的配置设置来丢弃应用程序的主类。</p>
<p>假设您正在使用Spring Batch，并依赖于它的自动配置。您可以按如下方式定义<code>@SpringBootApplication</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootApplication</span><br><span class="line">@EnableBatchProcessing</span><br><span class="line">public class SampleApplication &#123; ... &#125;</span><br></pre></td></tr></table></figure>

<p>因为此类是测试的源配置，所以任何切片测试实际上都会尝试启动Spring Batch，这绝对不是您想要做的。建议的方法是将特定于区域的配置移动到与应用程序相同级别的单独<code>@Configuration</code>类，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@EnableBatchProcessing</span><br><span class="line">public class BatchConfiguration &#123; ... &#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>根据应用程序的复杂程度，您可能只有一个<code>@Configuration</code>类用于自定义，或者每个域区域有一个类。后一种方法允许您在必要时使用<code>@Import</code>注释在其中一个测试中启用它。</td>
</tr>
</tbody></table>
<p>混淆的另一个原因是类路径扫描。假设您以合理的方式构建代码，则需要扫描其他包。您的应用程序可能类似于以下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootApplication</span><br><span class="line">@ComponentScan(&#123; &quot;com.example.app&quot;, &quot;org.acme.another&quot; &#125;)</span><br><span class="line">public class SampleApplication &#123; ... &#125;</span><br></pre></td></tr></table></figure>

<p>这样做会有效地覆盖默认的组件扫描指令，无论您选择哪个切片，都会扫描这两个包。例如，<code>@DataJpaTest</code>似乎突然扫描应用程序的组件和用户配置。同样，将自定义指令移动到单独的类是解决此问题的好方法。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果这不是您的选项，您可以在测试的层次结构中的某处创建一个<code>@SpringBootConfiguration</code>，以便使用它。或者，您可以为测试指定源，这会禁用查找默认源的行为。</td>
</tr>
</tbody></table>
<h3 id="45-3-24使用Spock测试Spring-Boot应用程序"><a href="#45-3-24使用Spock测试Spring-Boot应用程序" class="headerlink" title="45.3.24使用Spock测试Spring Boot应用程序"></a>45.3.24使用Spock测试Spring Boot应用程序</h3><p>如果您希望使用Spock来测试Spring Boot应用程序，您应该将Spock的<code>spock-spring</code>模块的依赖项添加到您的应用程序的构建中。<code>spock-spring</code>将Spring的测试框架集成到Spock中。建议您使用Spock 1.2或更高版本从Spock的Spring框架和Spring Boot集成的许多改进中受益。有关更多详细信息，请参阅<a target="_blank" rel="noopener" href="http://spockframework.org/spock/docs/1.2/modules.html#_spring_module">Spock的Spring模块的文档</a>。</p>
<h2 id="45-4测试实用程序"><a href="#45-4测试实用程序" class="headerlink" title="45.4测试实用程序"></a>45.4测试实用程序</h2><p>测试应用程序时通常有用的一些测试实用程序类打包为<code>spring-boot</code>的一部分。</p>
<h3 id="45-4-1-ConfigFileApplicationContextInitializer"><a href="#45-4-1-ConfigFileApplicationContextInitializer" class="headerlink" title="45.4.1 ConfigFileApplicationContextInitializer"></a>45.4.1 ConfigFileApplicationContextInitializer</h3><p><code>ConfigFileApplicationContextInitializer</code>是<code>ApplicationContextInitializer</code>，您可以将其应用于测试以加载Spring Boot <code>application.properties</code>个文件。当您不需要<code>@SpringBootTest</code>提供的全部功能时，可以使用它，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@ContextConfiguration(classes &#x3D; Config.class,</span><br><span class="line">	initializers &#x3D; ConfigFileApplicationContextInitializer.class)</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>仅使用<code>ConfigFileApplicationContextInitializer</code>不能为<code>@Value(&quot;$&#123;…&#125;&quot;)</code>注射提供支持。它唯一的工作是确保将<code>application.properties</code>个文件加载到Spring的<code>Environment</code>中。对于<code>@Value</code>支持，您需要另外配置<code>PropertySourcesPlaceholderConfigurer</code>或使用<code>@SpringBootTest</code>，它会为您自动配置一个。</td>
</tr>
</tbody></table>
<h3 id="45-4-2-TestPropertyValues"><a href="#45-4-2-TestPropertyValues" class="headerlink" title="45.4.2 TestPropertyValues"></a>45.4.2 TestPropertyValues</h3><p><code>TestPropertyValues</code>可让您快速向<code>ConfigurableEnvironment</code>或<code>ConfigurableApplicationContext</code>添加属性。您可以使用<code>key=value</code>字符串调用它，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TestPropertyValues.of(&quot;org&#x3D;Spring&quot;, &quot;name&#x3D;Boot&quot;).applyTo(env);</span><br></pre></td></tr></table></figure>

<h3 id="45-4-3-OutputCapture"><a href="#45-4-3-OutputCapture" class="headerlink" title="45.4.3 OutputCapture"></a>45.4.3 OutputCapture</h3><p><code>OutputCapture</code>是一个JUnit <code>Rule</code>，可用于捕获<code>System.out</code>和<code>System.err</code>输出。您可以将捕获声明为<code>@Rule</code>，然后使用<code>toString()</code>进行断言，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import org.junit.Rule;</span><br><span class="line">import org.junit.Test;</span><br><span class="line">import org.springframework.boot.test.rule.OutputCapture;</span><br><span class="line"></span><br><span class="line">import static org.hamcrest.Matchers.*;</span><br><span class="line">import static org.junit.Assert.*;</span><br><span class="line"></span><br><span class="line">public class MyTest &#123;</span><br><span class="line"></span><br><span class="line">	@Rule</span><br><span class="line">	public OutputCapture capture &#x3D; new OutputCapture();</span><br><span class="line"></span><br><span class="line">	@Test</span><br><span class="line">	public void testName() throws Exception &#123;</span><br><span class="line">		System.out.println(&quot;Hello World!&quot;);</span><br><span class="line">		assertThat(capture.toString(), containsString(&quot;World&quot;));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="45-4-4-TestRestTemplate"><a href="#45-4-4-TestRestTemplate" class="headerlink" title="45.4.4 TestRestTemplate"></a>45.4.4 TestRestTemplate</h3><table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>Spring Framework 5.0提供了一个新的<code>WebTestClient</code>，适用于 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-testing-spring-boot-applications-testing-autoconfigured-webflux-tests">WebFlux集成测试</a>以及 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-testing-spring-boot-applications-testing-with-running-server">WebFlux和MVC端到端测试</a>。与<code>TestRestTemplate</code>不同，它为断言提供了流畅的API。</td>
</tr>
</tbody></table>
<p><code>TestRestTemplate</code>是Spring <code>RestTemplate</code>的便利替代品，可用于集成测试。您可以获得一个vanilla模板或一个发送基本HTTP身份验证（使用用户名和密码）的模板。在任何一种情况下，模板都以一种测试友好的方式运行，不会在服务器端错误上抛出异常。建议（但不是强制性的）使用Apache HTTP Client（版本4.3.2或更高版本）。如果您在类路径上有这个，那么<code>TestRestTemplate</code>通过适当地配置客户端来响应。如果您确实使用Apache的HTTP客户端，则启用一些其他测试友好功能：</p>
<ul>
<li>不遵循重定向（因此您可以断言响应位置）。</li>
<li>Cookie被忽略（因此模板是无状态的）。</li>
</ul>
<p><code>TestRestTemplate</code>可以直接在集成测试中实例化，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class MyTest &#123;</span><br><span class="line"></span><br><span class="line">	private TestRestTemplate template &#x3D; new TestRestTemplate();</span><br><span class="line"></span><br><span class="line">	@Test</span><br><span class="line">	public void testRequest() throws Exception &#123;</span><br><span class="line">		HttpHeaders headers &#x3D; this.template.getForEntity(</span><br><span class="line">				&quot;http:&#x2F;&#x2F;myhost.example.com&#x2F;example&quot;, String.class).getHeaders();</span><br><span class="line">		assertThat(headers.getLocation()).hasHost(&quot;other.example.com&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>或者，如果您将<code>@SpringBootTest</code>注释与<code>WebEnvironment.RANDOM_PORT</code>或<code>WebEnvironment.DEFINED_PORT</code>一起使用，则可以注入完全配置的<code>TestRestTemplate</code>并开始使用它。如有必要，可以通过<code>RestTemplateBuilder</code> bean应用其他自定义设置。任何未指定主机和端口的URL都会自动连接到嵌入式服务器，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@SpringBootTest(webEnvironment &#x3D; WebEnvironment.RANDOM_PORT)</span><br><span class="line">public class SampleWebClientTests &#123;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	private TestRestTemplate template;</span><br><span class="line"></span><br><span class="line">	@Test</span><br><span class="line">	public void testRequest() &#123;</span><br><span class="line">		HttpHeaders headers &#x3D; this.template.getForEntity(&quot;&#x2F;example&quot;, String.class)</span><br><span class="line">				.getHeaders();</span><br><span class="line">		assertThat(headers.getLocation()).hasHost(&quot;other.example.com&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@TestConfiguration</span><br><span class="line">	static class Config &#123;</span><br><span class="line"></span><br><span class="line">		@Bean</span><br><span class="line">		public RestTemplateBuilder restTemplateBuilder() &#123;</span><br><span class="line">			return new RestTemplateBuilder().setConnectTimeout(Duration.ofSeconds(1))</span><br><span class="line">					.setReadTimeout(Duration.ofSeconds(1));</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="46-WebSockets"><a href="#46-WebSockets" class="headerlink" title="46. WebSockets"></a>46. WebSockets</h2><p>Spring Boot为嵌入式Tomcat，Jetty和Undertow提供WebSockets自动配置。如果将war文件部署到独立容器，则Spring Boot假定容器负责其WebSocket支持的配置。</p>
<p>Spring Framework 为MVC Web应用程序提供了<a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/web.html#websocket">丰富的WebSocket支持</a>，可以通过<code>spring-boot-starter-websocket</code>模块轻松访问。</p>
<p>WebSocket支持也可用于 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/web-reactive.html#webflux-websocket">响应式Web应用程序，</a>并且需要在<code>spring-boot-starter-webflux</code>旁边包含WebSocket API：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;javax.websocket&lt;&#x2F;groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;javax.websocket-api&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<h2 id="47-网络服务"><a href="#47-网络服务" class="headerlink" title="47.网络服务"></a>47.网络服务</h2><p>Spring Boot提供Web服务自动配置，因此您必须做的就是定义<code>Endpoints</code>。</p>
<p>该<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ws/docs/3.0.4.RELEASE/reference/">Spring Web服务功能，</a>可以与<code>spring-boot-starter-webservices</code>模块可以轻松访问。</p>
<p>可以分别为您的WSDL和XSD自动创建<code>SimpleWsdl11Definition</code>和<code>SimpleXsdSchema</code> beans。为此，请配置其位置，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.webservices.wsdl-locations&#x3D;classpath:&#x2F;wsdl</span><br></pre></td></tr></table></figure>

<h2 id="48-使用WebServiceTemplate调用Web服务"><a href="#48-使用WebServiceTemplate调用Web服务" class="headerlink" title="48.使用WebServiceTemplate调用Web服务"></a>48.使用<code>WebServiceTemplate</code>调用Web服务</h2><p>如果需要从应用程序调用远程Web服务，则可以使用 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ws/docs/3.0.4.RELEASE/reference/#client-web-service-template"><code>WebServiceTemplate</code></a>该类。由于<code>WebServiceTemplate</code>实例在使用之前通常需要进行自定义，因此Spring Boot不提供任何单个自动配置的<code>WebServiceTemplate</code> bean。但是，它会自动配置<code>WebServiceTemplateBuilder</code>，可用于在需要时创建<code>WebServiceTemplate</code>实例。</p>
<p>以下代码显示了一个典型示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@Service</span><br><span class="line">public class MyService &#123;</span><br><span class="line"></span><br><span class="line">	private final WebServiceTemplate webServiceTemplate;</span><br><span class="line"></span><br><span class="line">	public MyService(WebServiceTemplateBuilder webServiceTemplateBuilder) &#123;</span><br><span class="line">		this.webServiceTemplate &#x3D; webServiceTemplateBuilder.build();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public DetailsResp someWsCall(DetailsReq detailsReq) &#123;</span><br><span class="line">		 return (DetailsResp) this.webServiceTemplate.marshalSendAndReceive(detailsReq, new SoapActionCallback(ACTION));</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>默认情况下，<code>WebServiceTemplateBuilder</code>使用类路径上的可用HTTP客户端库检测到合适的基于HTTP的<code>WebServiceMessageSender</code>。您还可以按如下方式自定义读取和连接超时：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">public WebServiceTemplate webServiceTemplate(WebServiceTemplateBuilder builder) &#123;</span><br><span class="line">	return builder.messageSenders(new HttpWebServiceMessageSenderBuilder()</span><br><span class="line">			.setConnectTimeout(5000).setReadTimeout(2000).build()).build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="49-创建自己的自动配置"><a href="#49-创建自己的自动配置" class="headerlink" title="49.创建自己的自动配置"></a>49.创建自己的自动配置</h2><p>如果您在开发共享库的公司工作，或者您在开源或商业库中工作，则可能需要开发自己的自动配置。自动配置类可以捆绑在外部jar中，仍然可以通过Spring Boot获取。</p>
<p>自动配置可以与“启动器”相关联，该启动器提供自动配置代码以及您将使用它的典型库。我们首先介绍了构建自己的自动配置需要了解的内容，然后我们将继续介绍<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-custom-starter">创建自定义启动器所需</a>的 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-custom-starter">典型步骤</a>。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>可以使用<a target="_blank" rel="noopener" href="https://github.com/snicoll-demos/spring-boot-master-auto-configuration">演示项目</a>来展示如何逐步创建启动器。</td>
</tr>
</tbody></table>
<h2 id="49-1了解自动配置Beans"><a href="#49-1了解自动配置Beans" class="headerlink" title="49.1了解自动配置Beans"></a>49.1了解自动配置Beans</h2><p>在引擎盖下，自动配置使用标准<code>@Configuration</code>类实现。额外的<code>@Conditional</code>注释用于约束何时应用自动配置。通常，自动配置类使用<code>@ConditionalOnClass</code>和<code>@ConditionalOnMissingBean</code>注释。这可确保仅在找到相关类时以及未声明自己的<code>@Configuration</code>时才应用自动配置。</p>
<p>您可以浏览源代码<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure"><code>spring-boot-autoconfigure</code></a> 以查看Spring提供的<code>@Configuration</code>类（请参阅 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/resources/META-INF/spring.factories"><code>META-INF/spring.factories</code></a> 文件）。</p>
<h2 id="49-2找到自动配置候选者"><a href="#49-2找到自动配置候选者" class="headerlink" title="49.2找到自动配置候选者"></a>49.2找到自动配置候选者</h2><p>Spring Boot检查已发布jar中是否存在<code>META-INF/spring.factories</code>文件。该文件应在<code>EnableAutoConfiguration</code>键下列出您的配置类，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration&#x3D;\</span><br><span class="line">com.mycorp.libx.autoconfigure.LibXAutoConfiguration,\</span><br><span class="line">com.mycorp.libx.autoconfigure.LibXWebAutoConfiguration</span><br></pre></td></tr></table></figure>

<p>如果需要按特定顺序应用配置，则可以使用 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/AutoConfigureAfter.java"><code>@AutoConfigureAfter</code></a>或 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/AutoConfigureBefore.java"><code>@AutoConfigureBefore</code></a>注释。例如，如果您提供特定于Web的配置，则可能需要在<code>WebMvcAutoConfiguration</code>之后应用您的类。</p>
<p>如果您想订购某些不应该彼此直接了解的自动配置，您也可以使用<code>@AutoConfigureOrder</code>。该注释与常规<code>@Order</code>注释具有相同的语义，但为自动配置类提供了专用顺序。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>自动配置，必须加载这种方式<em>只</em>。确保它们是在特定的包空间中定义的，特别是它们永远不是组件扫描的目标。</td>
</tr>
</tbody></table>
<h2 id="49-3条件Annotations"><a href="#49-3条件Annotations" class="headerlink" title="49.3条件Annotations"></a>49.3条件Annotations</h2><p>您几乎总是希望在自动配置类中包含一个或多个<code>@Conditional</code>注释。<code>@ConditionalOnMissingBean</code>注释是一个常见示例，用于允许开发人员在您的默认值不满意时覆盖自动配置。</p>
<p>Spring Boot包含许多<code>@Conditional</code>注释，您可以通过注释<code>@Configuration</code>类或单独的<code>@Bean</code>方法在您自己的代码中重用这些注释。这些注释包括：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-class-conditions">第49.3.1节“类别条件”</a></li>
<li><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-bean-conditions">第49.3.2节，“Bean条件”</a></li>
<li><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-property-conditions">第49.3.3节，“Property条件”</a></li>
<li><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-resource-conditions">第49.3.4节“资源条件”</a></li>
<li><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-web-application-conditions">第49.3.5节“Web应用程序条件”</a></li>
<li><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-spel-conditions">第49.3.6节“SpEL表达条件”</a></li>
</ul>
<h3 id="49-3-1等级条件"><a href="#49-3-1等级条件" class="headerlink" title="49.3.1等级条件"></a>49.3.1等级条件</h3><p><code>@ConditionalOnClass</code>和<code>@ConditionalOnMissingClass</code>注释允许根据特定类的存在与否来包含配置。由于使用<a target="_blank" rel="noopener" href="http://asm.ow2.org/">ASM</a>解析注释元数据这一事实，您可以使用<code>value</code>属性来引用真实类，即使该类实际上可能不会出现在正在运行的应用程序类路径中。如果您希望使用<code>String</code>值指定类名，也可以使用<code>name</code>属性。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果您使用<code>@ConditionalOnClass</code>或<code>@ConditionalOnMissingClass</code>作为元注释的一部分来编写自己的组合注释，则必须使用<code>name</code>作为引用该类的情况，在这种情况下不会处理。</td>
</tr>
</tbody></table>
<h3 id="49-3-2-Bean条件"><a href="#49-3-2-Bean条件" class="headerlink" title="49.3.2 Bean条件"></a>49.3.2 Bean条件</h3><p><code>@ConditionalOnBean</code>和<code>@ConditionalOnMissingBean</code>注释允许根据特定beans的存在与否来包括bean。您可以使用<code>value</code>属性按类型指定beans，或使用<code>name</code>按名称指定beans。<code>search</code>属性允许您限制搜索beans时应考虑的<code>ApplicationContext</code>层次结构。</p>
<p>置于<code>@Bean</code>方法时，目标类型默认为方法的返回类型，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class MyAutoConfiguration &#123;</span><br><span class="line"></span><br><span class="line">	@Bean</span><br><span class="line">	@ConditionalOnMissingBean</span><br><span class="line">	public MyService myService() &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在前面的示例中，如果<code>ApplicationContext</code>中未包含类型<code>MyService</code>的bean，则将创建<code>myService</code> bean。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>您需要非常小心添加bean定义的顺序，因为这些条件是根据到目前为止已处理的内容进行评估的。因此，我们建议仅对自动配置类使用<code>@ConditionalOnBean</code>和<code>@ConditionalOnMissingBean</code>注释（因为这些注释保证在添加任何用户定义的bean定义后加载）。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td><code>@ConditionalOnBean</code>和<code>@ConditionalOnMissingBean</code>不会阻止创建<code>@Configuration</code>类。在类级别使用这些条件和使用注释标记每个包含<code>@Bean</code>方法的唯一区别是，如果条件不匹配，前者会阻止将<code>@Configuration</code>类注册为bean。</td>
</tr>
</tbody></table>
<h3 id="49-3-3-Property条件"><a href="#49-3-3-Property条件" class="headerlink" title="49.3.3 Property条件"></a>49.3.3 Property条件</h3><p><code>@ConditionalOnProperty</code>注释允许基于Spring Environment属性包含配置。使用<code>prefix</code>和<code>name</code>属性指定应检查的属性。默认情况下，匹配存在且不等于<code>false</code>的任何属性。您还可以使用<code>havingValue</code>和<code>matchIfMissing</code>属性创建更高级的检查。</p>
<h3 id="49-3-4资源条件"><a href="#49-3-4资源条件" class="headerlink" title="49.3.4资源条件"></a>49.3.4资源条件</h3><p><code>@ConditionalOnResource</code>注释仅在存在特定资源时才允许配置。可以使用通常的Spring约定来指定资源，如以下示例所示：<code>file:/home/user/test.dat</code>。</p>
<h3 id="49-3-5-Web应用程序条件"><a href="#49-3-5-Web应用程序条件" class="headerlink" title="49.3.5 Web应用程序条件"></a>49.3.5 Web应用程序条件</h3><p><code>@ConditionalOnWebApplication</code>和<code>@ConditionalOnNotWebApplication</code>注释允许配置，具体取决于应用程序是否为“Web应用程序”。Web应用程序是使用Spring <code>WebApplicationContext</code>，定义<code>session</code>范围或具有<code>StandardServletEnvironment</code>的任何应用程序。</p>
<h3 id="49-3-6-SpEL表达条件"><a href="#49-3-6-SpEL表达条件" class="headerlink" title="49.3.6 SpEL表达条件"></a>49.3.6 SpEL表达条件</h3><p><code>@ConditionalOnExpression</code>注释允许根据<a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/core.html#expressions">SpEL表达式</a>的结果包含配置。</p>
<h2 id="49-4测试自动配置"><a href="#49-4测试自动配置" class="headerlink" title="49.4测试自动配置"></a>49.4测试自动配置</h2><p>自动配置可能受许多因素的影响：用户配置（<code>@Bean</code>定义和<code>Environment</code>自定义），条件评估（存在特定库）等。具体而言，每个测试都应创建一个定义良好的<code>ApplicationContext</code>，它代表这些自定义的组合。<code>ApplicationContextRunner</code>提供了实现这一目标的好方法。</p>
<p><code>ApplicationContextRunner</code>通常被定义为测试类的一个字段，用于收集基本的通用配置。以下示例确保始终调用<code>UserServiceAutoConfiguration</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">private final ApplicationContextRunner contextRunner &#x3D; new ApplicationContextRunner()</span><br><span class="line">		.withConfiguration(AutoConfigurations.of(UserServiceAutoConfiguration.class));</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果必须定义多个自动配置，则无需按照与运行应用程序时完全相同的顺序调用它们的声明。</td>
</tr>
</tbody></table>
<p>每个测试都可以使用运行器来表示特定的用例。例如，下面的示例调用用户配置（<code>UserConfiguration</code>）并检查自动配置是否正确退回。调用<code>run</code>提供了一个可以与<code>Assert4J</code>一起使用的回调上下文。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void defaultServiceBacksOff() &#123;</span><br><span class="line">	this.contextRunner.withUserConfiguration(UserConfiguration.class)</span><br><span class="line">			.run((context) -&gt; &#123;</span><br><span class="line">				assertThat(context).hasSingleBean(UserService.class);</span><br><span class="line">				assertThat(context.getBean(UserService.class)).isSameAs(</span><br><span class="line">						context.getBean(UserConfiguration.class).myUserService());</span><br><span class="line">			&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Configuration</span><br><span class="line">static class UserConfiguration &#123;</span><br><span class="line"></span><br><span class="line">	@Bean</span><br><span class="line">	public UserService myUserService() &#123;</span><br><span class="line">		return new UserService(&quot;mine&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>也可以轻松自定义<code>Environment</code>，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void serviceNameCanBeConfigured() &#123;</span><br><span class="line">	this.contextRunner.withPropertyValues(&quot;user.name&#x3D;test123&quot;).run((context) -&gt; &#123;</span><br><span class="line">		assertThat(context).hasSingleBean(UserService.class);</span><br><span class="line">		assertThat(context.getBean(UserService.class).getName()).isEqualTo(&quot;test123&quot;);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>跑步者也可以用来显示<code>ConditionEvaluationReport</code>。该报告可以<code>INFO</code>或<code>DEBUG</code>级别打印。以下示例显示如何使用<code>ConditionEvaluationReportLoggingListener</code>在自动配置测试中打印报表。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void autoConfigTest &#123;</span><br><span class="line">	ConditionEvaluationReportLoggingListener initializer &#x3D; new ConditionEvaluationReportLoggingListener(</span><br><span class="line">			LogLevel.INFO);</span><br><span class="line">	ApplicationContextRunner contextRunner &#x3D; new ApplicationContextRunner()</span><br><span class="line">			.withInitializer(initializer).run((context) -&gt; &#123;</span><br><span class="line">					&#x2F;&#x2F; Do something...</span><br><span class="line">			&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="49-4-1模拟Web上下文"><a href="#49-4-1模拟Web上下文" class="headerlink" title="49.4.1模拟Web上下文"></a>49.4.1模拟Web上下文</h3><p>如果需要测试仅在Servlet或Reactive Web应用程序上下文中运行的自动配置，请分别使用<code>WebApplicationContextRunner</code>或<code>ReactiveWebApplicationContextRunner</code>。</p>
<h3 id="49-4-2覆盖Classpath"><a href="#49-4-2覆盖Classpath" class="headerlink" title="49.4.2覆盖Classpath"></a>49.4.2覆盖Classpath</h3><p>还可以测试在运行时不存在特定类和/或包时发生的情况。Spring Boot装有<code>FilteredClassLoader</code>，可以很容易地被跑步者使用。在以下示例中，我们声明如果不存在<code>UserService</code>，则会正确禁用自动配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void serviceIsIgnoredIfLibraryIsNotPresent() &#123;</span><br><span class="line">	this.contextRunner.withClassLoader(new FilteredClassLoader(UserService.class))</span><br><span class="line">			.run((context) -&gt; assertThat(context).doesNotHaveBean(&quot;userService&quot;));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="49-5创建自己的初学者"><a href="#49-5创建自己的初学者" class="headerlink" title="49.5创建自己的初学者"></a>49.5创建自己的初学者</h2><p>库的完整Spring Boot启动器可能包含以下组件：</p>
<ul>
<li>包含自动配置代码的<code>autoconfigure</code>模块。</li>
<li><code>starter</code>模块，它提供对<code>autoconfigure</code>模块以及库的依赖关系以及通常有用的任何其他依赖项。简而言之，添加启动器应该提供开始使用该库所需的一切。</li>
</ul>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果您不需要将这两个问题分开，则可以将自动配置代码和依赖关系管理组合在一个模块中。</td>
</tr>
</tbody></table>
<h3 id="49-5-1命名"><a href="#49-5-1命名" class="headerlink" title="49.5.1命名"></a>49.5.1命名</h3><p>您应该确保为您的启动器提供适当的命名空间。即使您使用不同的Maven <code>groupId</code>，也不要使用<code>spring-boot</code>启动模块名称。我们可能会为您将来自动配置的内容提供官方支持。</p>
<p>根据经验，您应该在启动后命名组合模块。例如，假设您正在为“acme”创建启动器，并且您将自动配置模块<code>acme-spring-boot-autoconfigure</code>和启动器<code>acme-spring-boot-starter</code>命名为。如果您只有一个组合两者的模块，请将其命名为<code>acme-spring-boot-starter</code>。</p>
<p>此外，如果您的启动器提供配置密钥，请为它们使用唯一的命名空间。特别是，不要将密钥包含在Spring Boot使用的名称空间中（例如<code>server</code>，<code>management</code>，<code>spring</code>等）。如果您使用相同的命名空间，我们将来可能会以破坏您的模块的方式修改这些命名空间。</p>
<p>确保 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#configuration-metadata-annotation-processor">触发元数据生成，</a>以便为您的密钥提供IDE帮助。您可能需要查看生成的元数据（<code>META-INF/spring-configuration-metadata.json</code>）以确保正确记录您的密钥。</p>
<h3 id="49-5-2-autoconfigure模块"><a href="#49-5-2-autoconfigure模块" class="headerlink" title="49.5.2 autoconfigure模块"></a>49.5.2 <code>autoconfigure</code>模块</h3><p><code>autoconfigure</code>模块包含开始使用库所需的所有内容。它还可能包含配置键定义（例如<code>@ConfigurationProperties</code>）以及可用于进一步自定义组件初始化方式的任何回调接口。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>您应该将库的依赖项标记为可选，以便您可以更轻松地在项目中包含<code>autoconfigure</code>模块。如果您这样做，则不提供库，默认情况下，Spring Boot会退出。</td>
</tr>
</tbody></table>
<p>Spring Boot使用注释处理器来收集元数据文件（<code>META-INF/spring-autoconfigure-metadata.properties</code>）中自动配置的条件。如果该文件存在，则用于热切过滤不匹配的自动配置，这将缩短启动时间。建议在包含自动配置的模块中添加以下依赖项：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-boot-autoconfigure-processor&lt;&#x2F;artifactId&gt;</span><br><span class="line">	&lt;optional&gt;true&lt;&#x2F;optional&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<p>对于Gradle 4.5及更早版本，依赖项应在<code>compileOnly</code>配置中声明，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">	compileOnly &quot;org.springframework.boot:spring-boot-autoconfigure-processor&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对于Gradle 4.6及更高版本，应在<code>annotationProcessor</code>配置中声明依赖项，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">	annotationProcessor &quot;org.springframework.boot:spring-boot-autoconfigure-processor&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="49-5-3启动器模块"><a href="#49-5-3启动器模块" class="headerlink" title="49.5.3启动器模块"></a>49.5.3启动器模块</h3><p>起动器真的是一个空罐子。它的唯一目的是提供必要的依赖项来使用库。您可以将其视为对入门所需内容的一种看法。</p>
<p>不要对添加启动器的项目做出假设。如果您自动配置的库通常需要其他启动器，请同时提及它们。如果可选依赖项的数量很高，则提供一组适当的<em>默认</em>依赖项可能很难，因为您应该避免包含对典型库的使用不必要的依赖项。换句话说，您不应该包含可选的依赖项。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>无论哪种方式，您的启动器必须直接或间接引用核心Spring Boot启动器（<code>spring-boot-starter</code>）（即如果您的启动器依赖于另一个启动器，则无需添加它）。如果仅使用自定义启动程序创建项目，则核心启动程序将支持Spring引导的核心功能。</td>
</tr>
</tbody></table>
<h2 id="50-Kotlin的支持"><a href="#50-Kotlin的支持" class="headerlink" title="50. Kotlin的支持"></a>50. Kotlin的支持</h2><p><a target="_blank" rel="noopener" href="https://kotlinlang.org/">Kotlin</a>是一种针对JVM（和其他平台）的静态类型语言，它允许编写简洁而优雅的代码，同时提供 与Java编写的现有库的<a target="_blank" rel="noopener" href="https://kotlinlang.org/docs/reference/java-interop.html">互操作性</a>。</p>
<p>Spring Boot通过利用Spring框架，Spring数据和反应堆等其他Spring项目的支持，提供Kotlin支持。有关 更多信息，请参阅 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/languages.html#kotlin">Spring Framework Kotlin支持文档</a>。</p>
<p>从Spring Boot和Kotlin开始的最简单方法是遵循 <a target="_blank" rel="noopener" href="https://spring.io/guides/tutorials/spring-boot-kotlin/">这个全面的教程</a>。您可以通过<a target="_blank" rel="noopener" href="https://start.spring.io/#!language=kotlin">start.spring.io</a>创建新的Kotlin项目 。如果您需要支持，请随意加入<a target="_blank" rel="noopener" href="http://slack.kotlinlang.org/">Kotlin Slack</a>的#spring频道或在<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/tagged/spring+kotlin">Stack Overflow</a>上使用<code>spring</code>和<code>kotlin</code>标签提问。</p>
<h2 id="50-1要求"><a href="#50-1要求" class="headerlink" title="50.1要求"></a>50.1要求</h2><p>Spring Boot支持Kotlin 1.2.x. 要使用Kotlin，类路径上必须存在<code>org.jetbrains.kotlin:kotlin-stdlib</code>和<code>org.jetbrains.kotlin:kotlin-reflect</code>。也可以使用<code>kotlin-stdlib</code>变体<code>kotlin-stdlib-jdk7</code>和<code>kotlin-stdlib-jdk8</code>。</p>
<p>由于<a target="_blank" rel="noopener" href="https://discuss.kotlinlang.org/t/classes-final-by-default/166">Kotlin类默认为final</a>，因此您可能需要配置 <a target="_blank" rel="noopener" href="https://kotlinlang.org/docs/reference/compiler-plugins.html#spring-support">kotlin-spring</a> 插件以自动打开Spring - 带注释的类，以便可以代理它们。</p>
<p>在Kotlin中序列化/反序列化JSON数据需要<a target="_blank" rel="noopener" href="https://github.com/FasterXML/jackson-module-kotlin">Jackson的Kotlin模块</a>。在类路径中找到它时会自动注册。如果Jackson和Kotlin存在但Jackson Kotlin模块不存在，则会记录警告消息。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果在<a target="_blank" rel="noopener" href="https://start.spring.io/#!language=kotlin">start.spring.io</a>上引导Kotlin项目，<a target="_blank" rel="noopener" href="https://start.spring.io/#!language=kotlin">则</a>默认提供这些依赖项和插件。</td>
</tr>
</tbody></table>
<h2 id="50-2无安全性"><a href="#50-2无安全性" class="headerlink" title="50.2无安全性"></a>50.2无安全性</h2><p>Kotlin的一个关键特性是<a target="_blank" rel="noopener" href="https://kotlinlang.org/docs/reference/null-safety.html">零安全性</a>。它在编译时处理<code>null</code>值，而不是将问题推迟到运行时并遇到<code>NullPointerException</code>。这有助于消除常见的错误来源，而无需支付<code>Optional</code>等包装器的成本。Kotlin还允许使用具有可空值的功能构造，如本 <a target="_blank" rel="noopener" href="http://www.baeldung.com/kotlin-null-safety">Kotlin中关于零安全性的综合指南中所述</a>。</p>
<p>虽然Java不允许在其类型系统中表示null安全性，但Spring Framework，Spring Data和Reactor现在通过工具友好的注释提供其API的空安全性。默认情况下，Kotlin中使用的Java API类型被识别为 放宽空检查的<a target="_blank" rel="noopener" href="https://kotlinlang.org/docs/reference/java-interop.html#null-safety-and-platform-types">平台类型</a>。 <a target="_blank" rel="noopener" href="https://kotlinlang.org/docs/reference/java-interop.html#jsr-305-support">Kotlin对JSR 305注释的支持</a>与可空性<a target="_blank" rel="noopener" href="https://kotlinlang.org/docs/reference/java-interop.html#jsr-305-support">注释</a>相结合，为Kotlin中相关的Spring API提供了空的安全性。</p>
<p>可以通过使用以下选项添加<code>-Xjsr305</code>编译器标志来配置JSR 305检查：<code>-Xjsr305=&#123;strict|warn|ignore&#125;</code>。默认行为与<code>-Xjsr305=warn</code>相同。<code>strict</code>值需要在从Spring API推断的Kotlin类型中考虑空安全性，但应该使用Spring API可空性声明甚至可以在次要版本和更多检查之间发展的知识可能会在将来添加）。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/warning.png" alt="[警告]"></th>
</tr>
</thead>
<tbody><tr>
<td>尚不支持泛型类型参数，varargs和数组元素可空性。有关最新信息，请参见<a target="_blank" rel="noopener" href="https://jira.spring.io/browse/SPR-15942">SPR-15942</a>。另请注意，Spring Boot自己的API <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/issues/10712">尚未注释</a>。</td>
</tr>
</tbody></table>
<h2 id="50-3-Kotlin-API"><a href="#50-3-Kotlin-API" class="headerlink" title="50.3 Kotlin API"></a>50.3 Kotlin API</h2><h3 id="50-3-1-runApplication"><a href="#50-3-1-runApplication" class="headerlink" title="50.3.1 runApplication"></a>50.3.1 runApplication</h3><p>Spring Boot提供了使用<code>runApplication&lt;MyApplication&gt;(*args)</code>运行应用程序的惯用方法，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication</span><br><span class="line">import org.springframework.boot.runApplication</span><br><span class="line"></span><br><span class="line">@SpringBootApplication</span><br><span class="line">class MyApplication</span><br><span class="line"></span><br><span class="line">fun main(args: Array&lt;String&gt;) &#123;</span><br><span class="line">	runApplication&lt;MyApplication&gt;(*args)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这是<code>SpringApplication.run(MyApplication::class.java, *args)</code>的替代品。它还允许自定义应用程序，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">runApplication&lt;MyApplication&gt;(*args) &#123;</span><br><span class="line">	setBannerMode(OFF)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="50-3-2扩展"><a href="#50-3-2扩展" class="headerlink" title="50.3.2扩展"></a>50.3.2扩展</h3><p>Kotlin <a target="_blank" rel="noopener" href="https://kotlinlang.org/docs/reference/extensions.html">扩展</a>提供了使用附加功能扩展现有类的能力。Spring Boot Kotlin API利用这些扩展为现有API添加新的Kotlin特定便利。</p>
<p><code>TestRestTemplate</code>扩展类似于Spring框架中Caffeine框架Caffeine提供的扩展。除此之外，扩展使得可以利用Kotlin具体类型参数。</p>
<h2 id="50-4依赖管理"><a href="#50-4依赖管理" class="headerlink" title="50.4依赖管理"></a>50.4依赖管理</h2><p>为了避免在类路径上混合使用不同版本的Kotlin依赖项，提供了以下Kotlin依赖项的依赖项管理：</p>
<ul>
<li><code>kotlin-reflect</code></li>
<li><code>kotlin-runtime</code></li>
<li><code>kotlin-stdlib</code></li>
<li><code>kotlin-stdlib-jdk7</code></li>
<li><code>kotlin-stdlib-jdk8</code></li>
<li><code>kotlin-stdlib-jre7</code></li>
<li><code>kotlin-stdlib-jre8</code></li>
</ul>
<p>使用Maven，可以通过<code>kotlin.version</code>属性自定义Kotlin版本，并为<code>kotlin-maven-plugin</code>提供插件管理。使用Gradle，Spring Boot插件会自动将<code>kotlin.version</code>与Kotlin插件的版本对齐。</p>
<h2 id="50-5-ConfigurationProperties"><a href="#50-5-ConfigurationProperties" class="headerlink" title="50.5 @ConfigurationProperties"></a>50.5 <code>@ConfigurationProperties</code></h2><p><code>@ConfigurationProperties</code>目前仅适用于<code>lateinit</code>或可空<code>var</code>属性（建议使用前者），因为<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/issues/8762">尚不支持</a>由构造函数初始化的不可变类。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@ConfigurationProperties(&quot;example.kotlin&quot;)</span><br><span class="line">class KotlinExampleProperties &#123;</span><br><span class="line"></span><br><span class="line">	lateinit var name: String</span><br><span class="line"></span><br><span class="line">	lateinit var description: String</span><br><span class="line"></span><br><span class="line">	val myService &#x3D; MyService()</span><br><span class="line"></span><br><span class="line">	class MyService &#123;</span><br><span class="line"></span><br><span class="line">		lateinit var apiToken: String</span><br><span class="line"></span><br><span class="line">		lateinit var uri: URI</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>要使用注释处理器生成 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#configuration-metadata-annotation-processor">您自己的元数据</a>，<a target="_blank" rel="noopener" href="https://kotlinlang.org/docs/reference/kapt.html"><code>kapt</code>应配置</a> <code>spring-boot-configuration-processor</code>依赖项。</td>
</tr>
</tbody></table>
<h2 id="50-6测试"><a href="#50-6测试" class="headerlink" title="50.6测试"></a>50.6测试</h2><p>虽然可以使用JUnit 4（由<code>spring-boot-starter-test</code>提供的默认值）来测试Kotlin代码，但建议使用JUnit 5。JUnit 5使测试类能够实例化一次并重用于所有类的测试。这使得可以在非静态方法上使用<code>@BeforeAll</code>和<code>@AfterAll</code>注释，这非常适合Kotlin。</p>
<p>要使用JUnit 5，请从<code>spring-boot-starter-test</code>中排除<code>junit:junit</code>依赖项，添加JUnit 5依赖项，并相应地配置Maven或Gradle插件。有关更多详细信息，请参阅 <a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#dependency-metadata-junit-jupiter-samples">JUnit 5文档</a>。您还需要将 <a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-test-instance-lifecycle-changing-default">测试实例生命周期切换为“每个类”</a>。</p>
<h2 id="50-7资源"><a href="#50-7资源" class="headerlink" title="50.7资源"></a>50.7资源</h2><h3 id="50-7-1进一步阅读"><a href="#50-7-1进一步阅读" class="headerlink" title="50.7.1进一步阅读"></a>50.7.1进一步阅读</h3><ul>
<li><a target="_blank" rel="noopener" href="https://kotlinlang.org/docs/reference/">Kotlin语言参考</a></li>
<li><a target="_blank" rel="noopener" href="http://slack.kotlinlang.org/">Kotlin Slack</a>（带有专用的#spring频道）</li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/tagged/spring+kotlin">具有<code>spring</code>和<code>kotlin</code>标记的Stackoverflow</a></li>
<li><a target="_blank" rel="noopener" href="https://try.kotlinlang.org/">在浏览器中尝试Kotlin</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.jetbrains.com/kotlin/">科特林博客</a></li>
<li><a target="_blank" rel="noopener" href="https://kotlin.link/">令人敬畏的Kotlin</a></li>
<li><a target="_blank" rel="noopener" href="https://spring.io/guides/tutorials/spring-boot-kotlin/">教程：使用Spring Boot和Kotlin构建Web应用程序</a></li>
<li><a target="_blank" rel="noopener" href="https://spring.io/blog/2016/02/15/developing-spring-boot-applications-with-kotlin">使用Kotlin开发Spring Boot应用程序</a></li>
<li><a target="_blank" rel="noopener" href="https://spring.io/blog/2016/03/20/a-geospatial-messenger-with-kotlin-spring-boot-and-postgresql">使用Kotlin，Spring Boot和PostgreSQL的地理空间信使</a></li>
<li><a target="_blank" rel="noopener" href="https://spring.io/blog/2017/01/04/introducing-kotlin-support-in-spring-framework-5-0">在Spring Framework 5.0中引入Kotlin支持</a></li>
<li><a target="_blank" rel="noopener" href="https://spring.io/blog/2017/08/01/spring-framework-5-kotlin-apis-the-functional-way">Spring框架5 Kotlin API，功能方式</a></li>
</ul>
<h3 id="50-7-2例子"><a href="#50-7-2例子" class="headerlink" title="50.7.2例子"></a>50.7.2例子</h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/sdeleuze/spring-boot-kotlin-demo">spring-boot-kotlin-demo</a>：常规Spring Boot + Spring Data JPA项目</li>
<li><a target="_blank" rel="noopener" href="https://github.com/mixitconf/mixit">mixit</a>：Spring Boot 2 + WebFlux + Reactive Spring Data MongoDB</li>
<li><a target="_blank" rel="noopener" href="https://github.com/sdeleuze/spring-kotlin-fullstack">spring-kotlin-fullstack</a>：WebFlux Kotlin fullstack示例，其中Kotlin2js用于前端而不是JavaScript或TypeScript</li>
<li><a target="_blank" rel="noopener" href="https://github.com/spring-petclinic/spring-petclinic-kotlin">spring-petclinic-kotlin</a>：Spring PetClinic样本应用程序的Kotlin版本</li>
<li><a target="_blank" rel="noopener" href="https://github.com/sdeleuze/spring-kotlin-deepdive">spring-kotlin-deepdive</a>：将Boot 1.0 + Java逐步迁移到Boot 2.0 + Kotlin</li>
</ul>
<h2 id="51-接下来要阅读的内容"><a href="#51-接下来要阅读的内容" class="headerlink" title="51.接下来要阅读的内容"></a>51.接下来要阅读的内容</h2><p>如果您想了解本节中讨论的任何类的更多信息，可以查看<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api">Spring Boot API文档</a>，也可以<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE">直接</a>浏览 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE">源代码</a>。如果您有具体问题，请查看 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#howto">操作方法</a>部分。</p>
<p>如果您对Spring Boot的核心功能感到满意，可以继续阅读有关<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready">生产就绪功能的内容</a>。</p>
<h1 id="第五部分。Spring-Boot-Actuator：生产就绪功能"><a href="#第五部分。Spring-Boot-Actuator：生产就绪功能" class="headerlink" title="第五部分。Spring Boot Actuator：生产就绪功能"></a>第五部分。Spring Boot Actuator：生产就绪功能</h1><p>Spring Boot包含许多其他功能，可帮助您在将应用程序推送到生产环境时监控和管理应用程序。您可以选择使用HTTP端点或JMX来管理和监视应用程序。审核，运行状况和指标收集也可以自动应用于您的应用程序。</p>
<h2 id="52-启用生产就绪功能"><a href="#52-启用生产就绪功能" class="headerlink" title="52.启用生产就绪功能"></a>52.启用生产就绪功能</h2><p>该<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator"><code>spring-boot-actuator</code></a>模块提供了所有Spring Boot的生产就绪功能。启用这些功能的最简单方法是为<code>spring-boot-starter-actuator</code>‘Starter’添加依赖项。</p>
<p><strong>执行器的定义</strong></p>
<p>致动器是制造术语，指的是用于移动或控制某物的机械装置。执行器可以通过微小的变化产生大量的运动。</p>
<p>要将执行器添加到基于Maven的项目，请添加以下“Starter”依赖项：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">	&lt;dependency&gt;</span><br><span class="line">		&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">		&lt;artifactId&gt;spring-boot-starter-actuator&lt;&#x2F;artifactId&gt;</span><br><span class="line">	&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;&#x2F;dependencies&gt;</span><br></pre></td></tr></table></figure>

<p>对于Gradle，请使用以下声明：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">	compile(&quot;org.springframework.boot:spring-boot-starter-actuator&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="53-终点"><a href="#53-终点" class="headerlink" title="53.终点"></a>53.终点</h2><p>通过执行器端点，您可以监控应用程序并与之交互。Spring Boot包含许多内置端点，允许您添加自己的端点。例如，<code>health</code>端点提供基本的应用程序运行状况信息。</p>
<p>可以<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready-endpoints-enabling-endpoints">启用或禁用</a>每个单独的端点。它控制是否在应用程序上下文中创建端点并且其bean存在。要远程访问，还必须<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready-endpoints-exposing-endpoints">通过JMX或HTTP公开</a>端点 。大多数应用程序选择HTTP，其中端点的ID以及<code>/actuator</code>的前缀映射到URL。例如，默认情况下，<code>health</code>端点映射到<code>/actuator/health</code>。</p>
<p>可以使用以下与技术无关的端点：</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>描述</th>
<th>默认情况下启用</th>
</tr>
</thead>
<tbody><tr>
<td><code>auditevents</code></td>
<td>公开当前应用程序的审核事件信息。</td>
<td>Yes</td>
</tr>
<tr>
<td><code>beans</code></td>
<td>显示应用程序中所有Spring beans的完整列表。</td>
<td>Yes</td>
</tr>
<tr>
<td><code>caches</code></td>
<td>暴露可用的缓存。</td>
<td>Yes</td>
</tr>
<tr>
<td><code>conditions</code></td>
<td>显示在配置和自动配置类上评估的条件以及它们匹配或不匹配的原因。</td>
<td>Yes</td>
</tr>
<tr>
<td><code>configprops</code></td>
<td>显示所有<code>@ConfigurationProperties</code>的整理列表。</td>
<td>Yes</td>
</tr>
<tr>
<td><code>env</code></td>
<td>公开Spring <code>ConfigurableEnvironment</code>的财产。</td>
<td>Yes</td>
</tr>
<tr>
<td><code>flyway</code></td>
<td>显示已应用的任何Flyway数据库迁移。</td>
<td>Yes</td>
</tr>
<tr>
<td><code>health</code></td>
<td>显示应用健康信息。</td>
<td>Yes</td>
</tr>
<tr>
<td><code>httptrace</code></td>
<td>显示HTTP跟踪信息（默认情况下，最后100个HTTP请求 - 响应交换）。</td>
<td>Yes</td>
</tr>
<tr>
<td><code>info</code></td>
<td>显示任意应用信息。</td>
<td>Yes</td>
</tr>
<tr>
<td><code>integrationgraph</code></td>
<td>显示Spring Integration图表。</td>
<td>Yes</td>
</tr>
<tr>
<td><code>loggers</code></td>
<td>显示和修改应用程序中记录器的配置。</td>
<td>Yes</td>
</tr>
<tr>
<td><code>liquibase</code></td>
<td>显示已应用的任何Liquibase数据库迁移。</td>
<td>Yes</td>
</tr>
<tr>
<td><code>metrics</code></td>
<td>显示当前应用程序的“指标”信息。</td>
<td>Yes</td>
</tr>
<tr>
<td><code>mappings</code></td>
<td>显示所有<code>@RequestMapping</code>路径的整理列表。</td>
<td>Yes</td>
</tr>
<tr>
<td><code>scheduledtasks</code></td>
<td>显示应用程序中的计划任务。</td>
<td>Yes</td>
</tr>
<tr>
<td><code>sessions</code></td>
<td>允许从支持Spring Session的会话存储中检索和删除用户会话。使用Spring Session对响应式Web应用程序的支持时不可用。</td>
<td>Yes</td>
</tr>
<tr>
<td><code>shutdown</code></td>
<td>允许应用程序正常关闭。</td>
<td>No</td>
</tr>
<tr>
<td><code>threaddump</code></td>
<td>执行线程转储。</td>
<td>Yes</td>
</tr>
</tbody></table>
<p>如果您的应用程序是Web应用程序（Spring MVC，Spring WebFlux或Jersey），则可以使用以下附加端点：</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>描述</th>
<th>默认情况下启用</th>
</tr>
</thead>
<tbody><tr>
<td><code>heapdump</code></td>
<td>返回<code>hprof</code>堆转储文件。</td>
<td>Yes</td>
</tr>
<tr>
<td><code>jolokia</code></td>
<td>通过HTTP公开JMX beans（当Jolokia在类路径上时，不适用于WebFlux）。</td>
<td>Yes</td>
</tr>
<tr>
<td><code>logfile</code></td>
<td>返回日志文件的内容（如果已设置<code>logging.file</code>或<code>logging.path</code>属性）。支持使用HTTP <code>Range</code>标头来检索部分日志文件的内容。</td>
<td>Yes</td>
</tr>
<tr>
<td><code>prometheus</code></td>
<td>以可由Prometheus服务器抓取的格式公开指标。</td>
<td>Yes</td>
</tr>
</tbody></table>
<p>要了解有关Actuator端点及其请求和响应格式的更多信息，请参阅单独的API文档（<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/actuator-api//html">HTML</a>或 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/actuator-api//pdf/spring-boot-actuator-web-api.pdf">PDF</a>）。</p>
<h2 id="53-1启用端点"><a href="#53-1启用端点" class="headerlink" title="53.1启用端点"></a>53.1启用端点</h2><p>默认情况下，启用除<code>shutdown</code>之外的所有端点。要配置端点的启用，请使用其<code>management.endpoint.&lt;id&gt;.enabled</code>属性。以下示例启用<code>shutdown</code>端点：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.endpoint.shutdown.enabled&#x3D;true</span><br></pre></td></tr></table></figure>

<p>如果您希望端点启用是选择加入而不是选择退出，请将<code>management.endpoints.enabled-by-default</code>属性设置为<code>false</code>并使用单个端点<code>enabled</code>属性重新加入。以下示例启用<code>info</code> endpoint并禁用所有其他端点：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">management.endpoints.enabled-by-default&#x3D;false</span><br><span class="line">management.endpoint.info.enabled&#x3D;true</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>已完全从应用程序上下文中删除已禁用的端点。如果您只想更改端点所暴露的技术，请改用 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready-endpoints-exposing-endpoints"><code>include</code>和<code>exclude</code>属性</a> 。</td>
</tr>
</tbody></table>
<h2 id="53-2公开端点"><a href="#53-2公开端点" class="headerlink" title="53.2公开端点"></a>53.2公开端点</h2><p>由于端点可能包含敏感信息，因此应仔细考虑何时公开它们。下表显示了内置端点的默认曝光：</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>JMX</th>
<th>卷筒纸</th>
</tr>
</thead>
<tbody><tr>
<td><code>auditevents</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>beans</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>caches</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>conditions</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>configprops</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>env</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>flyway</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>health</code></td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td><code>heapdump</code></td>
<td>N/A</td>
<td>No</td>
</tr>
<tr>
<td><code>httptrace</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>info</code></td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td><code>integrationgraph</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>jolokia</code></td>
<td>N/A</td>
<td>No</td>
</tr>
<tr>
<td><code>logfile</code></td>
<td>N/A</td>
<td>No</td>
</tr>
<tr>
<td><code>loggers</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>liquibase</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>metrics</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>mappings</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>prometheus</code></td>
<td>N/A</td>
<td>No</td>
</tr>
<tr>
<td><code>scheduledtasks</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>sessions</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>shutdown</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>threaddump</code></td>
<td>Yes</td>
<td>No</td>
</tr>
</tbody></table>
<p>要更改公开的端点，请使用以下特定于技术的<code>include</code>和<code>exclude</code>属性：</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>默认</th>
</tr>
</thead>
<tbody><tr>
<td><code>management.endpoints.jmx.exposure.exclude</code></td>
<td></td>
</tr>
<tr>
<td><code>management.endpoints.jmx.exposure.include</code></td>
<td><code>*</code></td>
</tr>
<tr>
<td><code>management.endpoints.web.exposure.exclude</code></td>
<td></td>
</tr>
<tr>
<td><code>management.endpoints.web.exposure.include</code></td>
<td><code>info, health</code></td>
</tr>
</tbody></table>
<p><code>include</code>属性列出了公开的端点的ID。<code>exclude</code>属性列出了不应公开的端点的ID。<code>exclude</code>属性优先于<code>include</code>属性。<code>include</code>和<code>exclude</code>属性都可以配置端点ID列表。</p>
<p>例如，要停止通过JMX公开所有端点并仅显示<code>health</code>和<code>info</code>端点，请使用以下属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.endpoints.jmx.exposure.include&#x3D;health,info</span><br></pre></td></tr></table></figure>

<p><code>*</code>可用于选择所有端点。例如，要通过HTTP公开除<code>env</code>和<code>beans</code>端点之外的所有内容，请使用以下属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">management.endpoints.web.exposure.include&#x3D;*</span><br><span class="line">management.endpoints.web.exposure.exclude&#x3D;env,beans</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td><code>*</code>在YAML中具有特殊含义，因此如果要包含（或排除）所有端点，请务必添加引号，如以下示例所示：<code>management:  endpoints:    web:      exposure:        include: &quot;*&quot;</code></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果您的申请是公开的，我们强烈建议您 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready-endpoints-security">保护您的终端</a>。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果您想在暴露端点时实施自己的策略，可以注册<code>EndpointFilter</code> bean。</td>
</tr>
</tbody></table>
<h2 id="53-3保护HTTP端点"><a href="#53-3保护HTTP端点" class="headerlink" title="53.3保护HTTP端点"></a>53.3保护HTTP端点</h2><p>您应该像使用任何其他敏感URL一样注意保护HTTP端点。如果存在Spring安全性，则默认使用Spring安全性内容协商策略来保护端点。例如，如果您希望为HTTP端点配置自定义安全性，仅允许具有特定角色的用户访问它们，Spring Boot提供了一些方便的<code>RequestMatcher</code>对象，可以与Spring安全性结合使用。</p>
<p>典型的Spring安全配置可能类似于以下示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class ActuatorSecurity extends WebSecurityConfigurerAdapter &#123;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	protected void configure(HttpSecurity http) throws Exception &#123;</span><br><span class="line">		http.requestMatcher(EndpointRequest.toAnyEndpoint()).authorizeRequests()</span><br><span class="line">				.anyRequest().hasRole(&quot;ENDPOINT_ADMIN&quot;)</span><br><span class="line">				.and()</span><br><span class="line">			.httpBasic();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的示例使用<code>EndpointRequest.toAnyEndpoint()</code>将请求与任何端点进行匹配，然后确保所有端点都具有<code>ENDPOINT_ADMIN</code>角色。<code>EndpointRequest</code>也提供了其他几种匹配方法。有关详细信息，请参阅API文档（<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/actuator-api//html">HTML</a>或 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/actuator-api//pdf/spring-boot-actuator-web-api.pdf">PDF</a>）。</p>
<p>如果在防火墙后部署应用程序，您可能希望无需身份验证即可访问所有执行器端点。您可以通过更改<code>management.endpoints.web.exposure.include</code>属性来执行此操作，如下所示：</p>
<p><strong>application.properties。</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.endpoints.web.exposure.include&#x3D;*</span><br></pre></td></tr></table></figure>



<p>此外，如果存在Spring安全性，则需要添加自定义安全性配置，以允许对端点进行未经身份验证的访问，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class ActuatorSecurity extends WebSecurityConfigurerAdapter &#123;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	protected void configure(HttpSecurity http) throws Exception &#123;</span><br><span class="line">		http.requestMatcher(EndpointRequest.toAnyEndpoint()).authorizeRequests()</span><br><span class="line">			.anyRequest().permitAll();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="53-4配置端点"><a href="#53-4配置端点" class="headerlink" title="53.4配置端点"></a>53.4配置端点</h2><p>端点自动缓存对不带任何参数的读取操作的响应。要配置端点缓存响应的时间量，请使用其<code>cache.time-to-live</code>属性。以下示例将<code>beans</code>端点缓存的生存时间设置为10秒：</p>
<p><strong>application.properties。</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.endpoint.beans.cache.time-to-live&#x3D;10s</span><br></pre></td></tr></table></figure>



<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>前缀<code>management.endpoint.&lt;name&gt;</code>用于唯一标识正在配置的端点。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>在进行经过身份验证的HTTP请求时，<code>Principal</code>被视为端点的输入，因此不会缓存响应。</td>
</tr>
</tbody></table>
<h2 id="53-5用于执行器Web端点的超媒体"><a href="#53-5用于执行器Web端点的超媒体" class="headerlink" title="53.5用于执行器Web端点的超媒体"></a>53.5用于执行器Web端点的超媒体</h2><p>添加了“发现页面”，其中包含指向所有端点的链接。默认情况下，<code>/actuator</code>上提供了“发现页面”。</p>
<p>配置自定义管理上下文路径后，“发现页面”会自动从<code>/actuator</code>移动到管理上下文的根目录。例如，如果管理上下文路径为<code>/management</code>，则可以从<code>/management</code>获取发现页面。当管理上下文路径设置为<code>/</code>时，将禁用发现页面以防止与其他映射冲突的可能性。</p>
<h2 id="53-6-CORS支持"><a href="#53-6-CORS支持" class="headerlink" title="53.6 CORS支持"></a>53.6 CORS支持</h2><p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Cross-origin_resource_sharing">跨源资源共享</a> （CORS）是一种<a target="_blank" rel="noopener" href="https://www.w3.org/TR/cors/">W3C规范</a>，允许您以灵活的方式指定授权的跨域请求类型。如果您使用Spring MVC或Spring WebFlux，可以配置Actuator的Web端点以支持此类方案。</p>
<p>默认情况下禁用CORS支持，仅在设置了<code>management.endpoints.web.cors.allowed-origins</code>属性后才启用CORS支持。以下配置允许来自<code>example.com</code>域的<code>GET</code>和<code>POST</code>来电：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">management.endpoints.web.cors.allowed-origins&#x3D;http:&#x2F;&#x2F;example.com</span><br><span class="line">management.endpoints.web.cors.allowed-methods&#x3D;GET,POST</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>有关 选项的完整列表，请参阅 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/endpoint/web/CorsEndpointProperties.java">CorsEndpointProperties</a>。</td>
</tr>
</tbody></table>
<h2 id="53-7实现自定义端点"><a href="#53-7实现自定义端点" class="headerlink" title="53.7实现自定义端点"></a>53.7实现自定义端点</h2><p>如果添加注释为<code>@Endpoint</code>的<code>@Bean</code>，则使用<code>@ReadOperation</code>，<code>@WriteOperation</code>或<code>@DeleteOperation</code>注释的任何方法都会通过JMX自动公开，并且在Web应用程序中也会通过HTTP自动公开。可以使用Jersey，Spring MVC或Spring WebFlux通过HTTP公开端点。</p>
<p>您还可以使用<code>@JmxEndpoint</code>或<code>@WebEndpoint</code>编写特定于技术的端点。这些端点仅限于各自的技术。例如，<code>@WebEndpoint</code>仅通过HTTP而不是通过JMX公开。</p>
<p>您可以使用<code>@EndpointWebExtension</code>和<code>@EndpointJmxExtension</code>编写特定于技术的扩展。通过这些注释，您可以提供特定于技术的操作来扩充现有端点。</p>
<p>最后，如果您需要访问特定于Web框架的功能，您可以实现Servlet或Spring <code>@Controller</code>和<code>@RestController</code>端点，但代价是它们无法通过JMX或使用不同的Web框架。</p>
<h3 id="53-7-1接收输入"><a href="#53-7-1接收输入" class="headerlink" title="53.7.1接收输入"></a>53.7.1接收输入</h3><p>端点上的操作通过其参数接收输入。通过Web公开时，这些参数的值取自URL的查询参数和JSON请求体。通过JMX公开时，参数将映射到MBean操作的参数。默认情况下需要参数。可以通过使用<code>@org.springframework.lang.Nullable</code>注释它们来使它们成为可选项。</p>
<p>JSON请求正文中的每个根属性都可以映射到端点的参数。请考虑以下JSON请求正文：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	&quot;name&quot;: &quot;test&quot;,</span><br><span class="line">	&quot;counter&quot;: 42</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这可用于调用带有<code>String name</code>和<code>int counter</code>参数的写操作。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>由于端点与技术无关，因此只能在方法签名中指定简单类型。特别是不支持使用定义<code>name</code>和<code>counter</code>属性的自定义类型声明单个参数。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>要允许输入映射到操作方法的参数，实现端点的Java代码应使用<code>-parameters</code>进行编译，实现端点的Kotlin代码应使用<code>-java-parameters</code>进行编译。如果您使用的是Spring Boot的Gradle插件，或者您使用的是Maven和<code>spring-boot-starter-parent</code>，则会自动执行此操作。</td>
</tr>
</tbody></table>
<h4 id="输入类型转换"><a href="#输入类型转换" class="headerlink" title="输入类型转换"></a>输入类型转换</h4><p>如有必要，传递给端点操作方法的参数将自动转换为所需类型。在调用操作方法之前，通过JMX或HTTP请求接收的输入将使用<code>ApplicationConversionService</code>的实例转换为所需类型。</p>
<h3 id="53-7-2自定义Web端点"><a href="#53-7-2自定义Web端点" class="headerlink" title="53.7.2自定义Web端点"></a>53.7.2自定义Web端点</h3><p><code>@Endpoint</code>，<code>@WebEndpoint</code>或<code>@EndpointWebExtension</code>上的操作将使用Jersey，Spring MVC或Spring WebFlux通过HTTP自动公开。</p>
<h4 id="Web端点请求谓词"><a href="#Web端点请求谓词" class="headerlink" title="Web端点请求谓词"></a>Web端点请求谓词</h4><p>为Web暴露的端点上的每个操作自动生成请求谓词。</p>
<h4 id="路径"><a href="#路径" class="headerlink" title="路径"></a>路径</h4><p>谓词的路径由端点的ID和Web暴露的端点的基本路径确定。默认基本路径为<code>/actuator</code>。例如，ID为<code>sessions</code>的端点将使用<code>/actuator/sessions</code>作为谓词中的路径。</p>
<p>可以通过使用<code>@Selector</code>注释操作方法的一个或多个参数来进一步定制路径。这样的参数作为路径变量添加到路径谓词中。调用端点操作时，将变量的值传递给操作方法。</p>
<h4 id="HTTP方法"><a href="#HTTP方法" class="headerlink" title="HTTP方法"></a>HTTP方法</h4><p>谓词的HTTP方法由操作类型决定，如下表所示：</p>
<table>
<thead>
<tr>
<th>手术</th>
<th>HTTP方法</th>
</tr>
</thead>
<tbody><tr>
<td><code>@ReadOperation</code></td>
<td><code>GET</code></td>
</tr>
<tr>
<td><code>@WriteOperation</code></td>
<td><code>POST</code></td>
</tr>
<tr>
<td><code>@DeleteOperation</code></td>
<td><code>DELETE</code></td>
</tr>
</tbody></table>
<h4 id="消费"><a href="#消费" class="headerlink" title="消费"></a>消费</h4><p>对于使用请求主体的<code>@WriteOperation</code>（HTTP <code>POST</code>），谓词的consumemes子句为<code>application/vnd.spring-boot.actuator.v2+json, application/json</code>。对于所有其他操作，consumemes子句为空。</p>
<h4 id="产生"><a href="#产生" class="headerlink" title="产生"></a>产生</h4><p>谓词的produce子句可以由<code>@DeleteOperation</code>，<code>@ReadOperation</code>和<code>@WriteOperation</code>注释的<code>produces</code>属性确定。该属性是可选的。如果未使用，则自动确定produce子句。</p>
<p>如果操作方法返回<code>void</code>或<code>Void</code>，则produce子句为空。如果操作方法返回<code>org.springframework.core.io.Resource</code>，则produce子句为<code>application/octet-stream</code>。对于所有其他操作，produce子句是<code>application/vnd.spring-boot.actuator.v2+json, application/json</code>。</p>
<h4 id="Web端点响应状态"><a href="#Web端点响应状态" class="headerlink" title="Web端点响应状态"></a>Web端点响应状态</h4><p>端点操作的默认响应状态取决于操作类型（读取，写入或删除）以及操作返回的内容（如果有）。</p>
<p><code>@ReadOperation</code>返回一个值，响应状态为200（OK）。如果它未返回值，则响应状态将为404（未找到）。</p>
<p>如果<code>@WriteOperation</code>或<code>@DeleteOperation</code>返回值，则响应状态将为200（OK）。如果它没有返回值，则响应状态将为204（无内容）。</p>
<p>如果在没有必需参数的情况下调用操作，或者使用无法转换为所需类型的参数，则不会调用操作方法，并且响应状态将为400（错误请求）。</p>
<h4 id="Web端点范围请求"><a href="#Web端点范围请求" class="headerlink" title="Web端点范围请求"></a>Web端点范围请求</h4><p>HTTP范围请求可用于请求HTTP资源的一部分。使用Spring MVC或Spring Web Flux时，返回<code>org.springframework.core.io.Resource</code>的操作会自动支持范围请求。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>使用Jersey时不支持范围请求。</td>
</tr>
</tbody></table>
<h4 id="Web端点安全"><a href="#Web端点安全" class="headerlink" title="Web端点安全"></a>Web端点安全</h4><p>Web端点或特定于Web的端点扩展上的操作可以接收当前<code>java.security.Principal</code>或<code>org.springframework.boot.actuate.endpoint.SecurityContext</code>作为方法参数。前者通常与<code>@Nullable</code>结合使用，为经过身份验证和未经身份验证的用户提供不同的行为。后者通常用于使用<code>isUserInRole(String)</code>方法执行授权检查。</p>
<h3 id="53-7-3-Servlet端点"><a href="#53-7-3-Servlet端点" class="headerlink" title="53.7.3 Servlet端点"></a>53.7.3 Servlet端点</h3><p>通过实现一个注释为<code>@ServletEndpoint</code>且同时实现<code>Supplier&lt;EndpointServlet&gt;</code>的类，可以将<code>Servlet</code>公开为端点。Servlet端点提供与Servlet容器更深层次的集成，但代价是可移植性。它们旨在用于将现有的<code>Servlet</code>作为端点公开。对于新端点，应尽可能优先选择<code>@Endpoint</code>和<code>@WebEndpoint</code>注释。</p>
<h3 id="53-7-4控制器端点"><a href="#53-7-4控制器端点" class="headerlink" title="53.7.4控制器端点"></a>53.7.4控制器端点</h3><p><code>@ControllerEndpoint</code>和<code>@RestControllerEndpoint</code>可用于实现仅由Spring MVC或Spring WebFlux公开的端点。使用Spring MVC和Spring WebFlux的标准注释（例如<code>@RequestMapping</code>和<code>@GetMapping</code>）映射方法，并将端点的ID用作路径的前缀。控制器端点提供与Spring Web框架的更深层次集成，但代价是可移植性。应尽可能优先考虑<code>@Endpoint</code>和<code>@WebEndpoint</code>注释。</p>
<h2 id="53-8健康信息"><a href="#53-8健康信息" class="headerlink" title="53.8健康信息"></a>53.8健康信息</h2><p>您可以使用运行状况信息来检查正在运行的应用程序的状态。监视软件经常使用它来在生产系统出现故障时向某人发出警报。<code>health</code>端点公开的信息取决于<code>management.endpoint.health.show-details</code>属性，该属性可以使用以下值之一进行配置：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>never</code></td>
<td>细节永远不会显示。</td>
</tr>
<tr>
<td><code>when-authorized</code></td>
<td>详细信息仅向授权用户显示。可以使用<code>management.endpoint.health.roles</code>配置授权角色。</td>
</tr>
<tr>
<td><code>always</code></td>
<td>详细信息显示给所有用户。</td>
</tr>
</tbody></table>
<p>默认值为<code>never</code>。当用户处于一个或多个端点的角色时，将被视为已获得授权。如果端点没有配置角色（默认值），则认为所有经过身份验证的用户都已获得授权。可以使用<code>management.endpoint.health.roles</code>属性配置角色。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果您已保护应用程序并希望使用<code>always</code>，则您的安全配置必须允许对经过身份验证和未经身份验证的用户访问运行状况终结点。</td>
</tr>
</tbody></table>
<p>健康信息是从a的内容中收集的 （默认情况下，<code>ApplicationContext</code>中定义的所有 实例。Spring Boot包括一些自动配置的<code>HealthIndicators</code>，您也可以自己编写。默认情况下，最终系统状态由<code>HealthAggregator</code>导出，它根据状态的有序列表对每个<code>HealthIndicator</code>的状态进行排序。排序列表中的第一个状态用作整体健康状态。如果没有<code>HealthIndicator</code>返回<code>HealthAggregator</code>已知的状态，使用<code>UNKNOWN</code>状态。<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/HealthIndicatorRegistry.java"> <code>HealthIndicatorRegistry</code></a><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/HealthIndicator.java"><code>HealthIndicator</code></a></p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td><code>HealthIndicatorRegistry</code>可用于在运行时注册和取消注册健康指示器。</td>
</tr>
</tbody></table>
<h3 id="53-8-1自动配置的HealthIndicators"><a href="#53-8-1自动配置的HealthIndicators" class="headerlink" title="53.8.1自动配置的HealthIndicators"></a>53.8.1自动配置的HealthIndicators</h3><p>适当时，Spring Boot会自动配置以下<code>HealthIndicators</code>：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/cassandra/CassandraHealthIndicator.java"><code>CassandraHealthIndicator</code></a></td>
<td>检查Cassandra数据库是否已启动。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/couchbase/CouchbaseHealthIndicator.java"><code>CouchbaseHealthIndicator</code></a></td>
<td>检查Couchbase群集是否已启动。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/system/DiskSpaceHealthIndicator.java"><code>DiskSpaceHealthIndicator</code></a></td>
<td>检查磁盘空间不足。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/jdbc/DataSourceHealthIndicator.java"><code>DataSourceHealthIndicator</code></a></td>
<td>检查是否可以获得与<code>DataSource</code>的连接。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/elasticsearch/ElasticsearchHealthIndicator.java"><code>ElasticsearchHealthIndicator</code></a></td>
<td>检查Elasticsearch集群是否已启动。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/influx/InfluxDbHealthIndicator.java"><code>InfluxDbHealthIndicator</code></a></td>
<td>检查InfluxDB服务器是否已启动。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/jms/JmsHealthIndicator.java"><code>JmsHealthIndicator</code></a></td>
<td>检查JMS代理是否已启动。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/mail/MailHealthIndicator.java"><code>MailHealthIndicator</code></a></td>
<td>检查邮件服务器是否已启动。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/mongo/MongoHealthIndicator.java"><code>MongoHealthIndicator</code></a></td>
<td>检查Mongo数据库是否已启动。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/neo4j/Neo4jHealthIndicator.java"><code>Neo4jHealthIndicator</code></a></td>
<td>检查Neo4j服务器是否已启动。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/amqp/RabbitHealthIndicator.java"><code>RabbitHealthIndicator</code></a></td>
<td>检查Rabbit服务器是否已启动。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/redis/RedisHealthIndicator.java"><code>RedisHealthIndicator</code></a></td>
<td>检查Redis服务器是否已启动。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/solr/SolrHealthIndicator.java"><code>SolrHealthIndicator</code></a></td>
<td>检查Solr服务器是否已启动。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>您可以通过设置<code>management.health.defaults.enabled</code>属性来禁用它们。</td>
</tr>
</tbody></table>
<h3 id="53-8-2编写自定义HealthIndicators"><a href="#53-8-2编写自定义HealthIndicators" class="headerlink" title="53.8.2编写自定义HealthIndicators"></a>53.8.2编写自定义HealthIndicators</h3><p>要提供自定义健康信息，您可以注册实现该<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/HealthIndicator.java"><code>HealthIndicator</code></a>界面的Spring beans 。您需要提供<code>health()</code>方法的实现并返回<code>Health</code>响应。<code>Health</code>响应应包含状态，并可选择包含要显示的其他详细信息。以下代码显示了一个示例<code>HealthIndicator</code>实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.boot.actuate.health.Health;</span><br><span class="line">import org.springframework.boot.actuate.health.HealthIndicator;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">public class MyHealthIndicator implements HealthIndicator &#123;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public Health health() &#123;</span><br><span class="line">		int errorCode &#x3D; check(); &#x2F;&#x2F; perform some specific health check</span><br><span class="line">		if (errorCode !&#x3D; 0) &#123;</span><br><span class="line">			return Health.down().withDetail(&quot;Error Code&quot;, errorCode).build();</span><br><span class="line">		&#125;</span><br><span class="line">		return Health.up().build();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>给定<code>HealthIndicator</code>的标识符是没有<code>HealthIndicator</code>后缀的bean的名称（如果存在）。在前面的示例中，健康信息在名为<code>my</code>的条目中可用。</td>
</tr>
</tbody></table>
<p>除了Spring Boot的预定义 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/Status.java"><code>Status</code></a>类型之外，<code>Health</code>还可以返回表示新系统状态的自定义<code>Status</code>。在这种情况下，<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/HealthAggregator.java"><code>HealthAggregator</code></a>还需要提供接口的自定义实现 ，或者必须使用<code>management.health.status.order</code>配置属性配置默认实现。</p>
<p>例如，假设在<code>HealthIndicator</code>实现之一中使用了代码为<code>FATAL</code>的新<code>Status</code>。要配置严重性顺序，请将以下属性添加到应用程序属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.health.status.order&#x3D;FATAL, DOWN, OUT_OF_SERVICE, UNKNOWN, UP</span><br></pre></td></tr></table></figure>

<p>响应中的HTTP状态代码反映了整体运行状况（例如，<code>UP</code>映射到200，而<code>OUT_OF_SERVICE</code>和<code>DOWN</code>映射到503）。如果通过HTTP访问运行状况端点，则可能还需要注册自定义状态映射。例如，以下属性将<code>FATAL</code>映射到503（服务不可用）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.health.status.http-mapping.FATAL&#x3D;503</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果您需要更多控制权，可以定义自己的<code>HealthStatusHttpMapper</code> bean。</td>
</tr>
</tbody></table>
<p>下表显示了内置状态的默认状态映射：</p>
<table>
<thead>
<tr>
<th>状态</th>
<th>制图</th>
</tr>
</thead>
<tbody><tr>
<td>DOWN</td>
<td>SERVICE_UNAVAILABLE (503)</td>
</tr>
<tr>
<td>OUT_OF_SERVICE</td>
<td>SERVICE_UNAVAILABLE (503)</td>
</tr>
<tr>
<td>UP</td>
<td>No mapping by default, so http status is 200</td>
</tr>
<tr>
<td>UNKNOWN</td>
<td>No mapping by default, so http status is 200</td>
</tr>
</tbody></table>
<h3 id="53-8-3反应性健康指标"><a href="#53-8-3反应性健康指标" class="headerlink" title="53.8.3反应性健康指标"></a>53.8.3反应性健康指标</h3><p>对于反应性应用程序，例如那些使用Spring WebFlux的应用程序，<code>ReactiveHealthIndicator</code>提供了一个非阻塞的合同来获取应用程序运行状况。与传统的<code>HealthIndicator</code>类似，健康信息是从a的内容中收集的 （默认情况下，在<code>ApplicationContext</code>中定义的所有 和 实例。不检查反应API的常规<code>HealthIndicator</code>是在弹性上执行的调度。<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/ReactiveHealthIndicatorRegistry.java"> <code>ReactiveHealthIndicatorRegistry</code></a><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/HealthIndicator.java"><code>HealthIndicator</code></a><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/ReactiveHealthIndicator.java"> <code>ReactiveHealthIndicator</code></a></p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>在响应式应用程序中，<code>ReactiveHealthIndicatorRegistry</code>可用于在运行时注册和取消注册运行状况指示器。</td>
</tr>
</tbody></table>
<p>要从反应式API提供自定义运行状况信息，您可以注册实现该<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/ReactiveHealthIndicator.java"><code>ReactiveHealthIndicator</code></a> 接口的Spring beans 。以下代码显示了一个示例<code>ReactiveHealthIndicator</code>实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class MyReactiveHealthIndicator implements ReactiveHealthIndicator &#123;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public Mono&lt;Health&gt; health() &#123;</span><br><span class="line">		return doHealthCheck() &#x2F;&#x2F;perform some specific health check that returns a Mono&lt;Health&gt;</span><br><span class="line">			.onErrorResume(ex -&gt; Mono.just(new Health.Builder().down(ex).build())));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>要自动处理错误，请考虑从<code>AbstractReactiveHealthIndicator</code>扩展。</td>
</tr>
</tbody></table>
<h3 id="53-8-4自动配置的ReactiveHealthIndicators"><a href="#53-8-4自动配置的ReactiveHealthIndicators" class="headerlink" title="53.8.4自动配置的ReactiveHealthIndicators"></a>53.8.4自动配置的ReactiveHealthIndicators</h3><p>适当时，Spring Boot会自动配置以下<code>ReactiveHealthIndicators</code>：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/cassandra/CassandraReactiveHealthIndicator.java"><code>CassandraReactiveHealthIndicator</code></a></td>
<td>检查Cassandra数据库是否已启动。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/couchbase/CouchbaseReactiveHealthIndicator.java"><code>CouchbaseReactiveHealthIndicator</code></a></td>
<td>检查Couchbase群集是否已启动。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/mongo/MongoReactiveHealthIndicator.java"><code>MongoReactiveHealthIndicator</code></a></td>
<td>检查Mongo数据库是否已启动。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/redis/RedisReactiveHealthIndicator.java"><code>RedisReactiveHealthIndicator</code></a></td>
<td>检查Redis服务器是否已启动。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>必要时，反应指标取代常规指标。此外，任何未明确处理的<code>HealthIndicator</code>都会自动换行。</td>
</tr>
</tbody></table>
<h2 id="53-9申请信息"><a href="#53-9申请信息" class="headerlink" title="53.9申请信息"></a>53.9申请信息</h2><p>应用程序信息公开了从<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/InfoContributor.java"><code>InfoContributor</code></a><code>ApplicationContext</code>中定义的所有beans 收集的各种信息 。Spring Boot包含一些自动配置的<code>InfoContributor</code> beans，您可以自己编写。</p>
<h3 id="53-9-1自动配置的InfoContributors"><a href="#53-9-1自动配置的InfoContributors" class="headerlink" title="53.9.1自动配置的InfoContributors"></a>53.9.1自动配置的InfoContributors</h3><p>在适当的情况下，Spring Boot会自动配置以下<code>InfoContributor</code> beans：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/EnvironmentInfoContributor.java"><code>EnvironmentInfoContributor</code></a></td>
<td>在<code>info</code>键下显示<code>Environment</code>中的任意键。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/GitInfoContributor.java"><code>GitInfoContributor</code></a></td>
<td>如果<code>git.properties</code>文件可用，则公开git信息。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/BuildInfoContributor.java"><code>BuildInfoContributor</code></a></td>
<td>如果<code>META-INF/build-info.properties</code>文件可用，则公开构建信息。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>可以通过设置<code>management.info.defaults.enabled</code>属性来禁用它们。</td>
</tr>
</tbody></table>
<h3 id="53-9-2自定义应用程序信息"><a href="#53-9-2自定义应用程序信息" class="headerlink" title="53.9.2自定义应用程序信息"></a>53.9.2自定义应用程序信息</h3><p>您可以通过设置<code>info.*</code> Spring属性来自定义<code>info</code>端点公开的数据。<code>info</code>键下的所有<code>Environment</code>属性都会自动显示。例如，您可以将以下设置添加到<code>application.properties</code>文件中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">info.app.encoding&#x3D;UTF-8</span><br><span class="line">info.app.java.source&#x3D;1.8</span><br><span class="line">info.app.java.target&#x3D;1.8</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>您可以<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#howto-automatic-expansion">在构建时扩展信息属性，</a>而不是对这些值进行硬编码 。假设您使用Maven，您可以按如下方式重写前面的示例：<code>info.app.encoding=@project.build.sourceEncoding@ info.app.java.source=@java.version@ info.app.java.target=@java.version@</code></td>
</tr>
</tbody></table>
<h3 id="53-9-3-Git提交信息"><a href="#53-9-3-Git提交信息" class="headerlink" title="53.9.3 Git提交信息"></a>53.9.3 Git提交信息</h3><p><code>info</code>端点的另一个有用功能是它能够在构建项目时发布有关<code>git</code>源代码存储库状态的信息。如果<code>GitProperties</code> bean可用，则会公开<code>git.branch</code>，<code>git.commit.id</code>和<code>git.commit.time</code>属性。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果类路径的根目录中有<code>git.properties</code>文件，则自动配置<code>GitProperties</code> bean。有关更多详细<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#howto-git-info">信息，</a>请参阅“ <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#howto-git-info">生成git信息</a> ”。</td>
</tr>
</tbody></table>
<p>如果要显示完整的git信息（即<code>git.properties</code>的完整内容），请使用<code>management.info.git.mode</code>属性，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.info.git.mode&#x3D;full</span><br></pre></td></tr></table></figure>

<h3 id="53-9-4构建信息"><a href="#53-9-4构建信息" class="headerlink" title="53.9.4构建信息"></a>53.9.4构建信息</h3><p>如果<code>BuildProperties</code> bean可用，<code>info</code>端点也可以发布有关您的构建的信息。如果类路径中有<code>META-INF/build-info.properties</code>文件，则会发生这种情况。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>Maven和Gradle插件都可以生成该文件。有关更多详细<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#howto-build-info">信息，</a>请参阅“ <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#howto-build-info">生成构建信息</a> ”。</td>
</tr>
</tbody></table>
<h3 id="53-9-5编写自定义InfoContributors"><a href="#53-9-5编写自定义InfoContributors" class="headerlink" title="53.9.5编写自定义InfoContributors"></a>53.9.5编写自定义InfoContributors</h3><p>要提供自定义应用程序信息，您可以注册实现该<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/InfoContributor.java"><code>InfoContributor</code></a>接口的Spring beans 。</p>
<p>以下示例使用单个值提供<code>example</code>条目：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import java.util.Collections;</span><br><span class="line"></span><br><span class="line">import org.springframework.boot.actuate.info.Info;</span><br><span class="line">import org.springframework.boot.actuate.info.InfoContributor;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">public class ExampleInfoContributor implements InfoContributor &#123;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public void contribute(Info.Builder builder) &#123;</span><br><span class="line">		builder.withDetail(&quot;example&quot;,</span><br><span class="line">				Collections.singletonMap(&quot;key&quot;, &quot;value&quot;));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果到达<code>info</code>端点，您应该看到包含以下附加条目的响应：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	&quot;example&quot;: &#123;</span><br><span class="line">		&quot;key&quot; : &quot;value&quot;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="54-通过HTTP进行监控和管理"><a href="#54-通过HTTP进行监控和管理" class="headerlink" title="54.通过HTTP进行监控和管理"></a>54.通过HTTP进行监控和管理</h2><p>如果您正在开发Web应用程序，Spring Boot Actuator会自动配置所有已启用的端点以通过HTTP公开。默认约定是使用端点<code>id</code>作为URL路径，前缀为<code>/actuator</code>。例如，<code>health</code>暴露为<code>/actuator/health</code>。提示：Actuator本身支持Spring MVC，Spring WebFlux和Jersey。</p>
<h2 id="54-1自定义管理端点路径"><a href="#54-1自定义管理端点路径" class="headerlink" title="54.1自定义管理端点路径"></a>54.1自定义管理端点路径</h2><p>有时，自定义管理端点的前缀很有用。例如，您的应用程序可能已将<code>/actuator</code>用于其他目的。您可以使用<code>management.endpoints.web.base-path</code>属性更改管理端点的前缀，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.endpoints.web.base-path&#x3D;&#x2F;manage</span><br></pre></td></tr></table></figure>

<p>前面的<code>application.properties</code>示例将端点从<code>/actuator/&#123;id&#125;</code>更改为<code>/manage/&#123;id&#125;</code>（例如，<code>/manage/info</code>）。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>除非已将管理端口配置为<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready-customizing-management-server-port">使用其他HTTP端口公开端点，</a>否则 <code>management.endpoints.web.base-path</code>相对于<code>server.servlet.context-path</code>。如果配置了<code>management.server.port</code>，则<code>management.endpoints.web.base-path</code>相对于<code>management.server.servlet.context-path</code>。</td>
</tr>
</tbody></table>
<p>如果要将端点映射到其他路径，可以使用<code>management.endpoints.web.path-mapping</code>属性。</p>
<p>以下示例将<code>/actuator/health</code>重新映射为<code>/healthcheck</code>：</p>
<p><strong>application.properties。</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">management.endpoints.web.base-path&#x3D;&#x2F;</span><br><span class="line">management.endpoints.web.path-mapping.health&#x3D;healthcheck</span><br></pre></td></tr></table></figure>



<h2 id="54-2自定义Management-Server端口"><a href="#54-2自定义Management-Server端口" class="headerlink" title="54.2自定义Management Server端口"></a>54.2自定义Management Server端口</h2><p>使用默认HTTP端口公开管理端点是基于云的部署的明智选择。但是，如果您的应用程序在您自己的数据中心内运行，您可能更喜欢使用不同的HTTP端口公开端点。</p>
<p>您可以设置<code>management.server.port</code>属性以更改HTTP端口，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.server.port&#x3D;8081</span><br></pre></td></tr></table></figure>

<h2 id="54-3配置管理特定的SSL"><a href="#54-3配置管理特定的SSL" class="headerlink" title="54.3配置管理特定的SSL"></a>54.3配置管理特定的SSL</h2><p>配置为使用自定义端口时，还可以使用各种<code>management.server.ssl.*</code>属性为管理服务器配置自己的SSL。例如，这样做可以让主应用程序使用HTTPS时管理服务器通过HTTP可用，如以下属性设置所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">server.port&#x3D;8443</span><br><span class="line">server.ssl.enabled&#x3D;true</span><br><span class="line">server.ssl.key-store&#x3D;classpath:store.jks</span><br><span class="line">server.ssl.key-password&#x3D;secret</span><br><span class="line">management.server.port&#x3D;8080</span><br><span class="line">management.server.ssl.enabled&#x3D;false</span><br></pre></td></tr></table></figure>

<p>或者，主服务器和管理服务器都可以使用SSL但具有不同的密钥库，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">server.port&#x3D;8443</span><br><span class="line">server.ssl.enabled&#x3D;true</span><br><span class="line">server.ssl.key-store&#x3D;classpath:main.jks</span><br><span class="line">server.ssl.key-password&#x3D;secret</span><br><span class="line">management.server.port&#x3D;8080</span><br><span class="line">management.server.ssl.enabled&#x3D;true</span><br><span class="line">management.server.ssl.key-store&#x3D;classpath:management.jks</span><br><span class="line">management.server.ssl.key-password&#x3D;secret</span><br></pre></td></tr></table></figure>

<h2 id="54-4自定义管理服务器地址"><a href="#54-4自定义管理服务器地址" class="headerlink" title="54.4自定义管理服务器地址"></a>54.4自定义管理服务器地址</h2><p>您可以通过设置<code>management.server.address</code>属性来自定义管理端点可用的地址。如果您只想在内部或面向运行的网络上侦听或仅侦听来自<code>localhost</code>的连接，这样做非常有用。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>仅当端口与主服务器端口不同时，才能侦听不同的地址。</td>
</tr>
</tbody></table>
<p>以下示例<code>application.properties</code>不允许远程管理连接：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">management.server.port&#x3D;8081</span><br><span class="line">management.server.address&#x3D;127.0.0.1</span><br></pre></td></tr></table></figure>

<h2 id="54-5禁用HTTP端点"><a href="#54-5禁用HTTP端点" class="headerlink" title="54.5禁用HTTP端点"></a>54.5禁用HTTP端点</h2><p>如果您不想通过HTTP公开端点，可以将管理端口设置为<code>-1</code>，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.server.port&#x3D;-1</span><br></pre></td></tr></table></figure>

<p>这也可以使用<code>management.endpoints.web.exposure.exclude</code>属性来实现，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.endpoints.web.exposure.exclude&#x3D;*</span><br></pre></td></tr></table></figure>

<h2 id="55-对JMX的监测和管理"><a href="#55-对JMX的监测和管理" class="headerlink" title="55.对JMX的监测和管理"></a>55.对JMX的监测和管理</h2><p>Java Management Extensions（JMX）提供了一种监视和管理应用程序的标准机制。默认情况下，Spring Boot将管理端点公开为<code>org.springframework.boot</code>域下的JMX MBean。</p>
<h2 id="55-1自定义MBean名称"><a href="#55-1自定义MBean名称" class="headerlink" title="55.1自定义MBean名称"></a>55.1自定义MBean名称</h2><p>MBean的名称通常是从端点的<code>id</code>生成的。例如，<code>health</code>端点公开为<code>org.springframework.boot:type=Endpoint,name=Health</code>。</p>
<p>如果您的应用程序包含多个Spring <code>ApplicationContext</code>，您可能会发现名称发生冲突。要解决此问题，可以将<code>spring.jmx.unique-names</code>属性设置为<code>true</code>，以便MBean名称始终是唯一的。</p>
<p>您还可以自定义公开端点的JMX域。以下设置显示了在<code>application.properties</code>中执行此操作的示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.jmx.unique-names&#x3D;true</span><br><span class="line">management.endpoints.jmx.domain&#x3D;com.example.myapp</span><br></pre></td></tr></table></figure>

<h2 id="55-2禁用JMX端点"><a href="#55-2禁用JMX端点" class="headerlink" title="55.2禁用JMX端点"></a>55.2禁用JMX端点</h2><p>如果您不想通过JMX公开端点，可以将<code>management.endpoints.jmx.exposure.exclude</code>属性设置为<code>*</code>，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.endpoints.jmx.exposure.exclude&#x3D;*</span><br></pre></td></tr></table></figure>

<h2 id="55-3通过HTTP使用Jolokia-for-JMX"><a href="#55-3通过HTTP使用Jolokia-for-JMX" class="headerlink" title="55.3通过HTTP使用Jolokia for JMX"></a>55.3通过HTTP使用Jolokia for JMX</h2><p>Jolokia是一个JMX-HTTP桥，它提供了一种访问JMX beans的替代方法。要使用Jolokia，请在<code>org.jolokia:jolokia-core</code>中包含依赖项。例如，使用Maven，您将添加以下依赖项：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.jolokia&lt;&#x2F;groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;jolokia-core&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<p>然后，可以通过向<code>management.endpoints.web.exposure.include</code>属性添加<code>jolokia</code>或<code>*</code>来公开Jolokia端点。然后，您可以在管理HTTP服务器上使用<code>/actuator/jolokia</code>来访问它。</p>
<h3 id="55-3-1自定义Jolokia"><a href="#55-3-1自定义Jolokia" class="headerlink" title="55.3.1自定义Jolokia"></a>55.3.1自定义Jolokia</h3><p>Jolokia有许多设置，您可以通过设置servlet参数来进行传统配置。使用Spring Boot，您可以使用<code>application.properties</code>文件。为此，请在参数前加<code>management.endpoint.jolokia.config.</code>，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.endpoint.jolokia.config.debug&#x3D;true</span><br></pre></td></tr></table></figure>

<h3 id="55-3-2禁用Jolokia"><a href="#55-3-2禁用Jolokia" class="headerlink" title="55.3.2禁用Jolokia"></a>55.3.2禁用Jolokia</h3><p>如果您使用Jolokia但不希望Spring Boot配置它，请将<code>management.endpoint.jolokia.enabled</code>属性设置为<code>false</code>，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.endpoint.jolokia.enabled&#x3D;false</span><br></pre></td></tr></table></figure>

<h2 id="56-记录器"><a href="#56-记录器" class="headerlink" title="56.记录器"></a>56.记录器</h2><p>Spring Boot Actuator包括在运行时查看和配置应用程序日志级别的功能。您可以查看整个列表或单个记录器的配置，该配置由显式配置的日志记录级别以及日志记录框架为其提供的有效日志记录级别组成。这些级别可以是以下之一：</p>
<ul>
<li><code>TRACE</code></li>
<li><code>DEBUG</code></li>
<li><code>INFO</code></li>
<li><code>WARN</code></li>
<li><code>ERROR</code></li>
<li><code>FATAL</code></li>
<li><code>OFF</code></li>
<li><code>null</code></li>
</ul>
<p><code>null</code>表示没有明确的配置。</p>
<h2 id="56-1配置记录器"><a href="#56-1配置记录器" class="headerlink" title="56.1配置记录器"></a>56.1配置记录器</h2><p>要配置给定的记录器，<code>POST</code>是资源URI的部分实体，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	&quot;configuredLevel&quot;: &quot;DEBUG&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>要“重置”记录器的特定级别（并使用默认配置），您可以传递<code>null</code>的值<code>configuredLevel</code>。</td>
</tr>
</tbody></table>
<h2 id="57-度量标准"><a href="#57-度量标准" class="headerlink" title="57.度量标准"></a>57.度量标准</h2><p>Spring Boot Actuator为<a target="_blank" rel="noopener" href="https://micrometer.io/">Micrometer</a>提供依赖关系管理和自动配置， <a target="_blank" rel="noopener" href="https://micrometer.io/">Micrometer</a>是一个支持众多监控系统的应用程序指标外观，包括：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready-metrics-export-appoptics">AppOptics</a></li>
<li><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready-metrics-export-atlas">Atlas</a></li>
<li><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready-metrics-export-datadog">Datadog</a></li>
<li><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready-metrics-export-dynatrace">Dynatrace</a></li>
<li><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready-metrics-export-dynatrace">Elastic</a></li>
<li><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready-metrics-export-ganglia">Ganglia</a></li>
<li><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready-metrics-export-graphite">Graphite</a></li>
<li><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready-metrics-export-humio">Humio</a></li>
<li><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready-metrics-export-influx">Influx</a></li>
<li><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready-metrics-export-jmx">JMX</a></li>
<li><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready-metrics-export-kairos">KairosDB</a></li>
<li><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready-metrics-export-newrelic">New Relic</a></li>
<li><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready-metrics-export-prometheus">Prometheus</a></li>
<li><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready-metrics-export-signalfx">SignalFx</a></li>
<li><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready-metrics-export-simple">简单（内存中）</a></li>
<li><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready-metrics-export-statsd">StatsD</a></li>
<li><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready-metrics-export-wavefront">Wavefront</a></li>
</ul>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>要了解有关Micrometer功能的更多信息，请参阅其 <a target="_blank" rel="noopener" href="https://micrometer.io/docs">参考文档</a>，特别是 <a target="_blank" rel="noopener" href="https://micrometer.io/docs/concepts">概念部分</a>。</td>
</tr>
</tbody></table>
<h2 id="57-1入门"><a href="#57-1入门" class="headerlink" title="57.1入门"></a>57.1入门</h2><p>Spring Boot自动配置组合<code>MeterRegistry</code>，并为组合路径中找到的每个受支持的实现添加一个注册表。在运行时类路径中依赖<code>micrometer-registry-&#123;system&#125;</code>足以使Spring Boot配置注册表。</p>
<p>大多数注册管理机构都有共同点 例如，即使Micrometer注册表实现位于类路径上，您也可以禁用特定的注册表。例如，要禁用Datadog：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.metrics.export.datadog.enabled&#x3D;false</span><br></pre></td></tr></table></figure>

<p>Spring Boot还会将任何自动配置的注册表添加到<code>Metrics</code>类的全局静态复合注册表中，除非您明确告诉它不要：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.metrics.use-global-registry&#x3D;false</span><br></pre></td></tr></table></figure>

<p>在注册表中注册任何仪表之前，您可以注册任意数量的<code>MeterRegistryCustomizer</code> beans以进一步配置注册表，例如应用通用标签：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">MeterRegistryCustomizer&lt;MeterRegistry&gt; metricsCommonTags() &#123;</span><br><span class="line">	return registry -&gt; registry.config().commonTags(&quot;region&quot;, &quot;us-east-1&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>您可以通过更具体地说明泛型类型，将自定义应用于特定的注册表实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">MeterRegistryCustomizer&lt;GraphiteMeterRegistry&gt; graphiteMetricsNamingConvention() &#123;</span><br><span class="line">	return registry -&gt; registry.config().namingConvention(MY_CUSTOM_CONVENTION);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用该设置，您可以在组件中注入<code>MeterRegistry</code>并注册指标：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class SampleBean &#123;</span><br><span class="line"></span><br><span class="line">	private final Counter counter;</span><br><span class="line"></span><br><span class="line">	public SampleBean(MeterRegistry registry) &#123;</span><br><span class="line">		this.counter &#x3D; registry.counter(&quot;received.messages&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public void handleMessage(String message) &#123;</span><br><span class="line">		this.counter.increment();</span><br><span class="line">		&#x2F;&#x2F; handle message implementation</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Spring Boot还<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready-metrics-meter">配置了</a> 可以通过配置或专用注释标记控制的<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready-metrics-meter">内置检测</a>（即<code>MeterBinder</code>实现）。</p>
<h2 id="57-2支持的监控系统"><a href="#57-2支持的监控系统" class="headerlink" title="57.2支持的监控系统"></a>57.2支持的监控系统</h2><h3 id="57-2-1-AppOptics"><a href="#57-2-1-AppOptics" class="headerlink" title="57.2.1 AppOptics"></a>57.2.1 AppOptics</h3><p>默认情况下，AppOptics注册表<a target="_blank" rel="noopener" href="https://api.appoptics.com/v1/measurements">会</a>定期将指标推送到 <a target="_blank" rel="noopener" href="https://api.appoptics.com/v1/measurements">api.appoptics.com/v1/measurements</a>。要将指标导出到SaaS <a target="_blank" rel="noopener" href="http://micrometer.io/docs/registry/appoptics">AppOptics</a>，必须提供您的API令牌：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.metrics.export.appoptics.api-token&#x3D;YOUR_TOKEN</span><br></pre></td></tr></table></figure>

<h3 id="57-2-2-Atlas"><a href="#57-2-2-Atlas" class="headerlink" title="57.2.2 Atlas"></a>57.2.2 Atlas</h3><p>默认情况下，度量标准导出到 本地计算机上运行的<a target="_blank" rel="noopener" href="http://micrometer.io/docs/registry/atlas">Atlas</a>。可以使用以下方式提供要使用的<a target="_blank" rel="noopener" href="https://github.com/Netflix/atlas">Atlas服务器</a>的位置 ：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.metrics.export.atlas.uri&#x3D;http:&#x2F;&#x2F;atlas.example.com:7101&#x2F;api&#x2F;v1&#x2F;publish</span><br></pre></td></tr></table></figure>

<h3 id="57-2-3-Datadog"><a href="#57-2-3-Datadog" class="headerlink" title="57.2.3 Datadog"></a>57.2.3 Datadog</h3><p>Datadog注册表定期将指标推送到<a target="_blank" rel="noopener" href="https://www.datadoghq.com/">datadoghq</a>。要将指标导出到<a target="_blank" rel="noopener" href="http://micrometer.io/docs/registry/datadog">Datadog</a>，必须提供您的API密钥：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.metrics.export.datadog.api-key&#x3D;YOUR_KEY</span><br></pre></td></tr></table></figure>

<p>您还可以更改度量标准发送到Datadog的时间间隔：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.metrics.export.datadog.step&#x3D;30s</span><br></pre></td></tr></table></figure>

<h3 id="57-2-4-Dynatrace"><a href="#57-2-4-Dynatrace" class="headerlink" title="57.2.4 Dynatrace"></a>57.2.4 Dynatrace</h3><p>Dynatrace注册表定期将指标推送到配置的URI。要将指标导出到 <a target="_blank" rel="noopener" href="http://micrometer.io/docs/registry/dynatrace">Dynatrace</a>，必须提供您的API令牌，设备ID和URI：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">management.metrics.export.dynatrace.api-token&#x3D;YOUR_TOKEN</span><br><span class="line">management.metrics.export.dynatrace.device-id&#x3D;YOUR_DEVICE_ID</span><br><span class="line">management.metrics.export.dynatrace.uri&#x3D;YOUR_URI</span><br></pre></td></tr></table></figure>

<p>您还可以更改指标发送到Dynatrace的时间间隔：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.metrics.export.dynatrace.step&#x3D;30s</span><br></pre></td></tr></table></figure>

<h3 id="57-2-5-Elastic"><a href="#57-2-5-Elastic" class="headerlink" title="57.2.5 Elastic"></a>57.2.5 Elastic</h3><p>默认情况下，指标会导出到 本地计算机上运行的<a target="_blank" rel="noopener" href="http://micrometer.io/docs/registry/elastic">Elastic</a>。可以使用以下属性提供要使用的Elastic服务器的位置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.metrics.export.elastic.host&#x3D;http:&#x2F;&#x2F;elastic.example.com:8086</span><br></pre></td></tr></table></figure>

<h3 id="57-2-6-Ganglia"><a href="#57-2-6-Ganglia" class="headerlink" title="57.2.6 Ganglia"></a>57.2.6 Ganglia</h3><p>默认情况下，度量标准将导出到 本地计算机上运行的<a target="_blank" rel="noopener" href="http://micrometer.io/docs/registry/ganglia">Ganglia</a>。可以使用以下命令提供要使用的<a target="_blank" rel="noopener" href="http://ganglia.sourceforge.net/">Ganglia服务器</a>主机和端口：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">management.metrics.export.ganglia.host&#x3D;ganglia.example.com</span><br><span class="line">management.metrics.export.ganglia.port&#x3D;9649</span><br></pre></td></tr></table></figure>

<h3 id="57-2-7-Graphite"><a href="#57-2-7-Graphite" class="headerlink" title="57.2.7 Graphite"></a>57.2.7 Graphite</h3><p>默认情况下，度量标准将导出到 本地计算机上运行的<a target="_blank" rel="noopener" href="http://micrometer.io/docs/registry/graphite">Graphite</a>。可以使用以下命令提供要使用的<a target="_blank" rel="noopener" href="https://graphiteapp.org/">Graphite服务器</a>主机和端口：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">management.metrics.export.graphite.host&#x3D;graphite.example.com</span><br><span class="line">management.metrics.export.graphite.port&#x3D;9004</span><br></pre></td></tr></table></figure>

<p>千分尺提供默认值<code>HierarchicalNameMapper</code>，用于控制尺寸计id如何<a target="_blank" rel="noopener" href="http://micrometer.io/docs/registry/graphite#_hierarchical_name_mapping">映射到平面分层名称</a>。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>要控制此行为，请定义<code>GraphiteMeterRegistry</code>并提供您自己的<code>HierarchicalNameMapper</code>。除非您自己定义，否则会提供自动配置的<code>GraphiteConfig</code>和<code>Clock</code> beans：</td>
</tr>
</tbody></table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">public GraphiteMeterRegistry graphiteMeterRegistry(GraphiteConfig config, Clock clock) &#123;</span><br><span class="line">	return new GraphiteMeterRegistry(config, clock, MY_HIERARCHICAL_MAPPER);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="57-2-8-Humio"><a href="#57-2-8-Humio" class="headerlink" title="57.2.8 Humio"></a>57.2.8 Humio</h3><p>默认情况下，Humio注册表<a target="_blank" rel="noopener" href="https://cloud.humio.com/">会</a>定期将指标推送到<a target="_blank" rel="noopener" href="https://cloud.humio.com/">cloud.humio.com</a>。要将指标导出到SaaS <a target="_blank" rel="noopener" href="http://micrometer.io/docs/registry/humio">Humio</a>，必须提供您的API令牌：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.metrics.export.humio.api-token&#x3D;YOUR_TOKEN</span><br></pre></td></tr></table></figure>

<p>您还应配置一个或多个标记，以标识要推送指标的数据源：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">management.metrics.export.humio.tags.alpha&#x3D;a</span><br><span class="line">management.metrics.export.humio.tags.bravo&#x3D;b</span><br></pre></td></tr></table></figure>

<h3 id="57-2-9-Influx"><a href="#57-2-9-Influx" class="headerlink" title="57.2.9 Influx"></a>57.2.9 Influx</h3><p>默认情况下，度量标准将导出到 本地计算机上运行的<a target="_blank" rel="noopener" href="http://micrometer.io/docs/registry/influx">Influx</a>。可以使用以下方式提供要使用的<a target="_blank" rel="noopener" href="https://www.influxdata.com/">Influx服务器</a>的位置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.metrics.export.influx.uri&#x3D;http:&#x2F;&#x2F;influx.example.com:8086</span><br></pre></td></tr></table></figure>

<h3 id="57-2-10-JMX"><a href="#57-2-10-JMX" class="headerlink" title="57.2.10 JMX"></a>57.2.10 JMX</h3><p>Micrometer提供了与<a target="_blank" rel="noopener" href="http://micrometer.io/docs/registry/jmx">JMX</a>的分层映射 ，主要是作为在本地查看指标的便宜且可移植的方式。默认情况下，度量标准将导出到<code>metrics</code> JMX域。可以使用以下方式提供要使用的域：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.metrics.export.jmx.domain&#x3D;com.example.app.metrics</span><br></pre></td></tr></table></figure>

<p>千分尺提供默认值<code>HierarchicalNameMapper</code>，用于控制尺寸计id如何<a target="_blank" rel="noopener" href="http://micrometer.io/docs/registry/jmx#_hierarchical_name_mapping">映射到平面分层名称</a>。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>要控制此行为，请定义<code>JmxMeterRegistry</code>并提供您自己的<code>HierarchicalNameMapper</code>。除非您自己定义，否则会提供自动配置的<code>JmxConfig</code>和<code>Clock</code> beans：</td>
</tr>
</tbody></table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">public JmxMeterRegistry jmxMeterRegistry(JmxConfig config, Clock clock) &#123;</span><br><span class="line">	return new JmxMeterRegistry(config, clock, MY_HIERARCHICAL_MAPPER);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="57-2-11-KairosDB"><a href="#57-2-11-KairosDB" class="headerlink" title="57.2.11 KairosDB"></a>57.2.11 KairosDB</h3><p>默认情况下，度量标准将导出到 本地计算机上运行的<a target="_blank" rel="noopener" href="http://micrometer.io/docs/registry/kairos">KairosDB</a>。可以使用以下方式提供要使用的<a target="_blank" rel="noopener" href="https://kairosdb.github.io/">KairosDB服务器</a>的位置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.metrics.export.kairos.uri&#x3D;http:&#x2F;&#x2F;kairosdb.example.com:8080&#x2F;api&#x2F;v1&#x2F;datapoints</span><br></pre></td></tr></table></figure>

<h3 id="57-2-12-New-Relic"><a href="#57-2-12-New-Relic" class="headerlink" title="57.2.12 New Relic"></a>57.2.12 New Relic</h3><p>New Relic注册表会定期将指标推送到<a target="_blank" rel="noopener" href="http://micrometer.io/docs/registry/new-relic">New Relic</a>。要将指标导出到<a target="_blank" rel="noopener" href="https://newrelic.com/">New Relic</a>，必须提供您的API密钥和帐户ID：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">management.metrics.export.newrelic.api-key&#x3D;YOUR_KEY</span><br><span class="line">management.metrics.export.newrelic.account-id&#x3D;YOUR_ACCOUNT_ID</span><br></pre></td></tr></table></figure>

<p>您还可以更改指标发送到New Relic的时间间隔：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.metrics.export.newrelic.step&#x3D;30s</span><br></pre></td></tr></table></figure>

<h3 id="57-2-13-Prometheus"><a href="#57-2-13-Prometheus" class="headerlink" title="57.2.13 Prometheus"></a>57.2.13 Prometheus</h3><p><a target="_blank" rel="noopener" href="http://micrometer.io/docs/registry/prometheus">Prometheus</a>期望抓取或轮询各个应用实例以获取指标。Spring Boot提供了<code>/actuator/prometheus</code>处可用的执行器端点，以提供具有适当格式的<a target="_blank" rel="noopener" href="https://prometheus.io/">Prometheus刮擦</a>。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>默认情况下端点不可用，必须公开，请参阅 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready-endpoints-exposing-endpoints">公开端点</a>以获取更多详细信息。</td>
</tr>
</tbody></table>
<p>以下是添加到<code>prometheus.yml</code>的示例<code>scrape_config</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">scrape_configs:</span><br><span class="line">  - job_name: &#39;spring&#39;</span><br><span class="line">	metrics_path: &#39;&#x2F;actuator&#x2F;prometheus&#39;</span><br><span class="line">	static_configs:</span><br><span class="line">	  - targets: [&#39;HOST:PORT&#39;]</span><br></pre></td></tr></table></figure>

<h3 id="57-2-14-SignalFx"><a href="#57-2-14-SignalFx" class="headerlink" title="57.2.14 SignalFx"></a>57.2.14 SignalFx</h3><p>SignalFx注册表 定期将指标推送到<a target="_blank" rel="noopener" href="http://micrometer.io/docs/registry/signalfx">SignalFx</a>。要将指标导出到<a target="_blank" rel="noopener" href="https://signalfx.com/">SignalFx</a>，必须提供您的访问令牌：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.metrics.export.signalfx.access-token&#x3D;YOUR_ACCESS_TOKEN</span><br></pre></td></tr></table></figure>

<p>您还可以更改指标发送到SignalFx的时间间隔：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.metrics.export.signalfx.step&#x3D;30s</span><br></pre></td></tr></table></figure>

<h3 id="57-2-15简单"><a href="#57-2-15简单" class="headerlink" title="57.2.15简单"></a>57.2.15简单</h3><p>Micrometer附带一个简单的内存后端，如果没有配置其他注册表，它将自动用作后备。这使您可以查看度量<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready-metrics-endpoint">标准终结点</a>中收集的<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready-metrics-endpoint">度量标准</a>。</p>
<p>只要您使用任何其他可用后端，内存后端就会自动禁用。您也可以显式禁用它：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.metrics.export.simple.enabled&#x3D;false</span><br></pre></td></tr></table></figure>

<h3 id="57-2-16-StatsD"><a href="#57-2-16-StatsD" class="headerlink" title="57.2.16 StatsD"></a>57.2.16 StatsD</h3><p>StatsD注册表急需将UDP上的指标推送到StatsD代理。默认情况下，度量标准将导出到本地计算机上运行的<a target="_blank" rel="noopener" href="http://micrometer.io/docs/registry/statsd">StatsD</a>代理程序。可以使用以下方式提供要使用的StatsD代理主机和端口：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">management.metrics.export.statsd.host&#x3D;statsd.example.com</span><br><span class="line">management.metrics.export.statsd.port&#x3D;9125</span><br></pre></td></tr></table></figure>

<p>您还可以更改要使用的StatsD行协议（默认为Datadog）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.metrics.export.statsd.flavor&#x3D;etsy</span><br></pre></td></tr></table></figure>

<h3 id="57-2-17-Wavefront"><a href="#57-2-17-Wavefront" class="headerlink" title="57.2.17 Wavefront"></a>57.2.17 Wavefront</h3><p>Wavefront注册表会定期将指标推送到 <a target="_blank" rel="noopener" href="http://micrometer.io/docs/registry/wavefront">Wavefront</a>。如果您要将指标直接导出到<a target="_blank" rel="noopener" href="https://www.wavefront.com/">Wavefront</a>，则必须提供您的API令牌：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.metrics.export.wavefront.api-token&#x3D;YOUR_API_TOKEN</span><br></pre></td></tr></table></figure>

<p>或者，您可以在您的环境中使用Wavefront边车或内部代理设置，将指标数据转发到Wavefront API主机：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.metrics.export.wavefront.uri&#x3D;proxy:&#x2F;&#x2F;localhost:2878</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果将度量标准发布到Wavefront代理（如<a target="_blank" rel="noopener" href="https://docs.wavefront.com/proxies_installing.html">文档</a>中 <a target="_blank" rel="noopener" href="https://docs.wavefront.com/proxies_installing.html">所述</a>），则主机必须采用<code>proxy://HOST:PORT</code>格式。</td>
</tr>
</tbody></table>
<p>您还可以更改指标发送到Wavefront的时间间隔：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.metrics.export.wavefront.step&#x3D;30s</span><br></pre></td></tr></table></figure>

<h2 id="57-3支持的度量标准"><a href="#57-3支持的度量标准" class="headerlink" title="57.3支持的度量标准"></a>57.3支持的度量标准</h2><p>Spring Boot在适用时注册以下核心指标：</p>
<ul>
<li>JVM指标，报告利用率：<ul>
<li>各种内存和缓冲池</li>
<li>与垃圾收集有关的统计</li>
<li>线程利用率</li>
<li>加载/卸载的类数</li>
</ul>
</li>
<li>CPU指标</li>
<li>文件描述符指标</li>
<li>卡夫卡消费者指标</li>
<li>Log4j2指标：记录每个级别记录到Log4j2的事件数</li>
<li>Logback指标：记录每个级别记录到Logback的事件数</li>
<li>正常运行时间指标：报告正常运行时间表和表示应用程序绝对启动时间的固定计量表</li>
<li>Tomcat指标</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-integration/docs/current/reference/html/system-management-chapter.html#micrometer-integration">Spring Integration</a>指标</li>
</ul>
<h3 id="57-3-1-Spring-MVC指标"><a href="#57-3-1-Spring-MVC指标" class="headerlink" title="57.3.1 Spring MVC指标"></a>57.3.1 Spring MVC指标</h3><p>自动配置可以对Spring MVC处理的请求进行检测。当<code>management.metrics.web.server.auto-time-requests</code>为<code>true</code>时，将对所有请求进行此检测。或者，当设置为<code>false</code>时，您可以通过将<code>@Timed</code>添加到请求处理方法来启用检测：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">@Timed </span><br><span class="line">public class MyController &#123;</span><br><span class="line"></span><br><span class="line">	@GetMapping(&quot;&#x2F;api&#x2F;people&quot;)</span><br><span class="line">	@Timed(extraTags &#x3D; &#123; &quot;region&quot;, &quot;us-east-1&quot; &#125;) </span><br><span class="line">	@Timed(value &#x3D; &quot;all.people&quot;, longTask &#x3D; true) </span><br><span class="line">	public List&lt;Person&gt; listPeople() &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#CO1-1"><img src="https://www.springcloud.cc/images/1.png" alt="1"></a></th>
<th>一个控制器类，用于在控制器中的每个请求处理程序上启用计时。</th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#CO1-2"><img src="https://www.springcloud.cc/images/2.png" alt="2"></a></td>
<td>一种启用单个端点的方法。如果您在类上拥有它，则不需要这样做，但可以用于进一步自定义此特定端点的计时器。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#CO1-3"><img src="https://www.springcloud.cc/images/3.png" alt="3"></a></td>
<td>使用<code>longTask = true</code>的方法为该方法启用长任务计时器。长任务计时器需要单独的度量标准名称，并且可以使用短任务计时器进行堆叠。</td>
</tr>
</tbody></table>
<p>默认情况下，使用名称<code>http.server.requests</code>生成指标。可以通过设置<code>management.metrics.web.server.requests-metric-name</code>属性来自定义名称。</p>
<p>默认情况下，Spring与MVC相关的指标标记有以下信息：</p>
<table>
<thead>
<tr>
<th>标签</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>exception</code></td>
<td>处理请求时抛出的任何异常的简单类名。</td>
</tr>
<tr>
<td><code>method</code></td>
<td>请求的方法（例如，<code>GET</code>或<code>POST</code>）</td>
</tr>
<tr>
<td><code>outcome</code></td>
<td>根据响应的状态代码请求结果。1xx是<code>INFORMATIONAL</code>，2xx是<code>SUCCESS</code>，3xx是<code>REDIRECTION</code>，4xx <code>CLIENT_ERROR</code>，5xx是<code>SERVER_ERROR</code></td>
</tr>
<tr>
<td><code>status</code></td>
<td>响应的HTTP状态代码（例如，<code>200</code>或<code>500</code>）</td>
</tr>
<tr>
<td><code>uri</code></td>
<td>如果可能，在变量替换之前请求URI模板（例如，<code>/api/person/&#123;id&#125;</code>）</td>
</tr>
</tbody></table>
<p>要自定义标记，请提供实现<code>WebMvcTagsProvider</code>的<code>@Bean</code>。</p>
<h3 id="57-3-2-Spring-WebFlux度量标准"><a href="#57-3-2-Spring-WebFlux度量标准" class="headerlink" title="57.3.2 Spring WebFlux度量标准"></a>57.3.2 Spring WebFlux度量标准</h3><p>自动配置支持WebFlux控制器和功能处理程序处理的所有请求的检测。</p>
<p>默认情况下，会生成名称为<code>http.server.requests</code>的指标。您可以通过设置<code>management.metrics.web.server.requests-metric-name</code>属性来自定义名称。</p>
<p>默认情况下，与WebFlux相关的指标标记有以下信息：</p>
<table>
<thead>
<tr>
<th>标签</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>exception</code></td>
<td>处理请求时抛出的任何异常的简单类名。</td>
</tr>
<tr>
<td><code>method</code></td>
<td>请求的方法（例如，<code>GET</code>或<code>POST</code>）</td>
</tr>
<tr>
<td><code>outcome</code></td>
<td>根据响应的状态代码请求结果。1xx是<code>INFORMATIONAL</code>，2xx是<code>SUCCESS</code>，3xx是<code>REDIRECTION</code>，4xx <code>CLIENT_ERROR</code>，5xx是<code>SERVER_ERROR</code></td>
</tr>
<tr>
<td><code>status</code></td>
<td>响应的HTTP状态代码（例如，<code>200</code>或<code>500</code>）</td>
</tr>
<tr>
<td><code>uri</code></td>
<td>如果可能，在变量替换之前请求URI模板（例如，<code>/api/person/&#123;id&#125;</code>）</td>
</tr>
</tbody></table>
<p>要自定义标记，请提供实现<code>WebFluxTagsProvider</code>的<code>@Bean</code>。</p>
<h3 id="57-3-3-Jersey服务器度量标准"><a href="#57-3-3-Jersey服务器度量标准" class="headerlink" title="57.3.3 Jersey服务器度量标准"></a>57.3.3 Jersey服务器度量标准</h3><p>自动配置支持对Jersey JAX-RS实现处理的请求进行检测。当<code>management.metrics.web.server.auto-time-requests</code>为<code>true</code>时，此检测将针对所有请求进行。或者，当设置为<code>false</code>时，您可以通过将<code>@Timed</code>添加到请求处理方法来启用检测：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">@Path(&quot;&#x2F;api&#x2F;people&quot;)</span><br><span class="line">@Timed </span><br><span class="line">public class Endpoint &#123;</span><br><span class="line">	@GET</span><br><span class="line">	@Timed(extraTags &#x3D; &#123; &quot;region&quot;, &quot;us-east-1&quot; &#125;) </span><br><span class="line">	@Timed(value &#x3D; &quot;all.people&quot;, longTask &#x3D; true) </span><br><span class="line">	public List&lt;Person&gt; listPeople() &#123; ... &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#CO2-1"><img src="https://www.springcloud.cc/images/1.png" alt="1"></a></th>
<th>在资源类上，为资源中的每个请求处理程序启用计时。</th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#CO2-2"><img src="https://www.springcloud.cc/images/2.png" alt="2"></a></td>
<td>在启用单个端点的方法上。如果您在类上拥有它，则不需要这样做，但可以用于进一步自定义此特定端点的计时器。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#CO2-3"><img src="https://www.springcloud.cc/images/3.png" alt="3"></a></td>
<td>在使用<code>longTask = true</code>的方法上为该方法启用长任务计时器。长任务计时器需要单独的度量标准名称，并且可以使用短任务计时器进行堆叠。</td>
</tr>
</tbody></table>
<p>默认情况下，使用名称<code>http.server.requests</code>生成度量标准。可以通过设置<code>management.metrics.web.server.requests-metric-name</code>属性来自定义名称。</p>
<p>默认情况下，Jersey服务器指标标记有以下信息：</p>
<table>
<thead>
<tr>
<th>标签</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>exception</code></td>
<td>处理请求时抛出的任何异常的简单类名。</td>
</tr>
<tr>
<td><code>method</code></td>
<td>请求的方法（例如，<code>GET</code>或<code>POST</code>）</td>
</tr>
<tr>
<td><code>outcome</code></td>
<td>根据响应的状态代码请求结果。1xx是<code>INFORMATIONAL</code>，2xx是<code>SUCCESS</code>，3xx是<code>REDIRECTION</code>，4xx <code>CLIENT_ERROR</code>，5xx是<code>SERVER_ERROR</code></td>
</tr>
<tr>
<td><code>status</code></td>
<td>响应的HTTP状态代码（例如，<code>200</code>或<code>500</code>）</td>
</tr>
<tr>
<td><code>uri</code></td>
<td>如果可能，在变量替换之前请求URI模板（例如，<code>/api/person/&#123;id&#125;</code>）</td>
</tr>
</tbody></table>
<p>要自定义标记，请提供实现<code>JerseyTagsProvider</code>的<code>@Bean</code>。</p>
<h3 id="57-3-4-HTTP客户端度量标准"><a href="#57-3-4-HTTP客户端度量标准" class="headerlink" title="57.3.4 HTTP客户端度量标准"></a>57.3.4 HTTP客户端度量标准</h3><p>Spring Boot Actuator管理<code>RestTemplate</code>和<code>WebClient</code>的工具。为此，您必须注入一个自动配置的构建器并使用它来创建实例：</p>
<ul>
<li><code>RestTemplateBuilder</code> <code>RestTemplate</code></li>
<li><code>WebClient.Builder</code> <code>WebClient</code></li>
</ul>
<p>也可以手动应用负责此仪器的定制器，即<code>MetricsRestTemplateCustomizer</code>和<code>MetricsWebClientCustomizer</code>。</p>
<p>默认情况下，使用名称<code>http.client.requests</code>生成指标。可以通过设置<code>management.metrics.web.client.requests-metric-name</code>属性来自定义名称。</p>
<p>默认情况下，已检测客户端生成的度量标准使用以下信息进行标记：</p>
<ul>
<li><code>method</code>，请求的方法（例如，<code>GET</code>或<code>POST</code>）。</li>
<li><code>uri</code>，变量替换之前的请求URI模板（如果可能）（例如，<code>/api/person/&#123;id&#125;</code>）。</li>
<li><code>status</code>，响应的HTTP状态代码（例如，<code>200</code>或<code>500</code>）。</li>
<li><code>clientName</code>，URI的主机部分。</li>
</ul>
<p>要自定义标记，并根据您选择的客户端，您可以提供<code>@Bean</code>来实现<code>RestTemplateExchangeTagsProvider</code>或<code>WebClientExchangeTagsProvider</code>。<code>RestTemplateExchangeTags</code>和<code>WebClientExchangeTags</code>中有便利的静态函数。</p>
<h3 id="57-3-5缓存度量标准"><a href="#57-3-5缓存度量标准" class="headerlink" title="57.3.5缓存度量标准"></a>57.3.5缓存度量标准</h3><p>自动配置允许在启动时使用前缀为<code>cache</code>的度量标准检测所有可用的<code>Cache</code>。缓存检测针对一组基本指标进行了标准化。此外，还提供了特定于缓存的指标。</p>
<p>支持以下缓存库：</p>
<ul>
<li>Caffeine</li>
<li>EhCache 2</li>
<li>Hazelcast</li>
<li>任何兼容的JCache（JSR-107）实现</li>
</ul>
<p>度量标准由缓存的名称和从bean名称派生的<code>CacheManager</code>的名称标记。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>只有启动时可用的缓存才会绑定到注册表。对于在启动阶段之后即时或以编程方式创建的缓存，需要显式注册。<code>CacheMetricsRegistrar</code> bean可用于简化此过程。</td>
</tr>
</tbody></table>
<h3 id="57-3-6数据源度量标准"><a href="#57-3-6数据源度量标准" class="headerlink" title="57.3.6数据源度量标准"></a>57.3.6数据源度量标准</h3><p>自动配置使用名为<code>jdbc</code>的度量标准启用所有可用<code>DataSource</code>对象的检测。数据源检测会生成表示池中当前活动，最大允许和最小允许连接的计量器。这些仪表中的每一个都有一个以<code>jdbc</code>为前缀的名称。</p>
<p>度量标准也由基于bean名称计算的<code>DataSource</code>的名称标记。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>默认情况下，Spring Boot为所有支持的数据源提供元数据; 如果您不喜欢自己喜欢的数据源，则可以添加额外的<code>DataSourcePoolMetadataProvider</code> beans。有关示例，请参阅<code>DataSourcePoolMetadataProvidersConfiguration</code>。</td>
</tr>
</tbody></table>
<p>此外，Hikari特定的指标以<code>hikaricp</code>前缀公开。每个度量标准都由池名称标记（可以使用<code>spring.datasource.name</code>控制）。</p>
<h3 id="57-3-7-Hibernate度量标准"><a href="#57-3-7-Hibernate度量标准" class="headerlink" title="57.3.7 Hibernate度量标准"></a>57.3.7 Hibernate度量标准</h3><p>自动配置允许使用名为<code>hibernate</code>的度量标准启用统计信息的所有可用Hibernate <code>EntityManagerFactory</code>实例的检测。</p>
<p>度量标准也由bean名称派生的<code>EntityManagerFactory</code>名称标记。</p>
<p>要启用统计信息，标准JPA属性<code>hibernate.generate_statistics</code>必须设置为<code>true</code>。您可以在自动配置的<code>EntityManagerFactory</code>上启用它，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.jpa.properties.hibernate.generate_statistics&#x3D;true</span><br></pre></td></tr></table></figure>

<h3 id="57-3-8-RabbitMQ指标"><a href="#57-3-8-RabbitMQ指标" class="headerlink" title="57.3.8 RabbitMQ指标"></a>57.3.8 RabbitMQ指标</h3><p>自动配置将使用名为<code>rabbitmq</code>的度量标准启用所有可用RabbitMQ连接工厂的检测。</p>
<h2 id="57-4注册自定义指标"><a href="#57-4注册自定义指标" class="headerlink" title="57.4注册自定义指标"></a>57.4注册自定义指标</h2><p>要注册自定义指标，请将<code>MeterRegistry</code>注入组件，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">class Dictionary &#123;</span><br><span class="line"></span><br><span class="line">	private final List&lt;String&gt; words &#x3D; new CopyOnWriteArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">	Dictionary(MeterRegistry registry) &#123;</span><br><span class="line">		registry.gaugeCollectionSize(&quot;dictionary.size&quot;, Tags.empty(), this.words);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F; …</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果您发现跨组件或应用程序重复检测一套度量标准，则可以将此套件封装在<code>MeterBinder</code>实现中。默认情况下，所有<code>MeterBinder</code> beans的指标都会自动绑定到Spring - 托管<code>MeterRegistry</code>。</p>
<h2 id="57-5自定义各个指标"><a href="#57-5自定义各个指标" class="headerlink" title="57.5自定义各个指标"></a>57.5自定义各个指标</h2><p>如果需要将自定义应用于特定的<code>Meter</code>实例，可以使用<code>io.micrometer.core.instrument.config.MeterFilter</code>接口。默认情况下，所有<code>MeterFilter</code> beans都将自动应用于千分尺<code>MeterRegistry.Config</code>。</p>
<p>例如，如果要将<code>mytag.region</code>标记重命名为<code>mytag.area</code>以查找以<code>com.example</code>开头的所有仪表ID，您可以执行以下操作：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">public MeterFilter renameRegionTagMeterFilter() &#123;</span><br><span class="line">	return MeterFilter.renameTag(&quot;com.example&quot;, &quot;mytag.region&quot;, &quot;mytag.area&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="57-5-1通用标签"><a href="#57-5-1通用标签" class="headerlink" title="57.5.1通用标签"></a>57.5.1通用标签</h3><p>通用标签通常用于操作环境中的维度向下钻取，如主机，实例，区域，堆栈等。共用标签应用于所有仪表，并且可以按以下示例所示进行配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">management.metrics.tags.region&#x3D;us-east-1</span><br><span class="line">management.metrics.tags.stack&#x3D;prod</span><br></pre></td></tr></table></figure>

<p>上面的示例将<code>region</code>和<code>stack</code>标记添加到所有计量表，其值分别为<code>us-east-1</code>和<code>prod</code>。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果您使用Graphite，则常用标记的顺序很重要。由于使用此方法无法保证常用标记的顺序，因此建议Graphite用户定义自定义<code>MeterFilter</code>。</td>
</tr>
</tbody></table>
<h3 id="57-5-2-Per-meter属性"><a href="#57-5-2-Per-meter属性" class="headerlink" title="57.5.2 Per-meter属性"></a>57.5.2 Per-meter属性</h3><p>除了<code>MeterFilter</code> beans之外，还可以使用属性在每米的基础上应用一组有限的自定义。Per-meter自定义适用于以给定名称开头的所有仪表ID。例如，以下内容将禁用任何ID为<code>example.remote</code>的计量表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.metrics.enable.example.remote&#x3D;false</span><br></pre></td></tr></table></figure>

<p>以下属性允许每米定制：</p>
<p><strong>表57.1。Per-meter自定义</strong></p>
<table>
<thead>
<tr>
<th>Property</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>management.metrics.enable</code></td>
<td>是否拒绝米发布任何指标。</td>
</tr>
<tr>
<td><code>management.metrics.distribution.percentiles-histogram</code></td>
<td>是否发布适合于计算可聚合（跨维度）百分位近似的直方图。</td>
</tr>
<tr>
<td><code>management.metrics.distribution.minimum-expected-value</code>, <code>management.metrics.distribution.maximum-expected-value</code></td>
<td>通过限制预期值的范围来发布更少的直方图桶。</td>
</tr>
<tr>
<td><code>management.metrics.distribution.percentiles</code></td>
<td>发布在您的应用程序中计算的百分位数值</td>
</tr>
<tr>
<td><code>management.metrics.distribution.sla</code></td>
<td>使用SLA定义的存储桶发布累积直方图。</td>
</tr>
</tbody></table>
<p>有关<code>percentiles-histogram</code>，<code>percentiles</code>和<code>sla</code>背后概念的更多详细信息，请参阅千分尺文档的<a target="_blank" rel="noopener" href="https://micrometer.io/docs/concepts#_histograms_and_percentiles">“直方图和百分位数”部分</a>。</p>
<h2 id="57-6度量标准端点"><a href="#57-6度量标准端点" class="headerlink" title="57.6度量标准端点"></a>57.6度量标准端点</h2><p>Spring Boot提供了一个<code>metrics</code>端点，可以在诊断上用于检查应用程序收集的指标。默认情况下端点不可用，必须公开，请参阅<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready-endpoints-exposing-endpoints">公开端点</a>以获取更多详细信息。</p>
<p>导航到<code>/actuator/metrics</code>会显示可用的仪表名称列表。您可以深入查看有关特定仪表的信息，方法是将其名称作为选择器，例如<code>/actuator/metrics/jvm.memory.max</code>。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>您在此处使用的名称应与代码中使用的名称相匹配，而不是在命名之后的名称 - 为其运送到的监视系统规范化的约定。换句话说，如果<code>jvm.memory.max</code>由于其蛇案例命名约定在Prometheus中显示为<code>jvm_memory_max</code>，则在检查<code>metrics</code>端点中的仪表时仍应使用<code>jvm.memory.max</code>作为选择器。</td>
</tr>
</tbody></table>
<p>您还可以在URL的末尾添加任意数量的<code>tag=KEY:VALUE</code>查询参数，以便按尺寸向下钻取仪表，例如<code>/actuator/metrics/jvm.memory.max?tag=area:nonheap</code>。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>报告的测量值是与仪表名称和已应用的任何标签匹配的所有仪表的统计数据的<em>总和</em>。因此，在上面的示例中，返回的“Value”统计信息是堆的“Code Cache”，“Compressed Class Space”和“Metaspace”区域的最大内存占用量的总和。如果您只想查看“Metaspace”的最大大小，可以添加额外的<code>tag=id:Metaspace</code>，即<code>/actuator/metrics/jvm.memory.max?tag=area:nonheap&amp;tag=id:Metaspace</code>。</td>
</tr>
</tbody></table>
<h2 id="58-审计"><a href="#58-审计" class="headerlink" title="58.审计"></a>58.审计</h2><p>一旦Spring安全性发挥作用，Spring Boot Actuator具有灵活的审计框架，可以发布事件（默认情况下，“身份验证成功”，“失败”和“访问被拒绝”例外）。此功能对于报告和基于身份验证失败实施锁定策略非常有用。要自定义已发布的安全事件，您可以提供自己的<code>AbstractAuthenticationAuditListener</code>和<code>AbstractAuthorizationAuditListener</code>实现。</p>
<p>您还可以将审计服务用于您自己的业务事件。为此，请将现有的<code>AuditEventRepository</code>注入您自己的组件并直接使用它或使用Spring <code>ApplicationEventPublisher</code>发布<code>AuditApplicationEvent</code>（通过实施<code>ApplicationEventPublisherAware</code>）。</p>
<h2 id="59-HTTP跟踪"><a href="#59-HTTP跟踪" class="headerlink" title="59. HTTP跟踪"></a>59. HTTP跟踪</h2><p>将自动为所有HTTP请求启用跟踪。您可以查看<code>httptrace</code>端点并获取有关最近100次请求 - 响应交换的基本信息。</p>
<h2 id="59-1自定义HTTP跟踪"><a href="#59-1自定义HTTP跟踪" class="headerlink" title="59.1自定义HTTP跟踪"></a>59.1自定义HTTP跟踪</h2><p>要自定义每个跟踪中包含的项目，请使用<code>management.trace.http.include</code>配置属性。要进行高级自定义，请考虑注册您自己的<code>HttpExchangeTracer</code>实现。</p>
<p>默认情况下，使用存储最后100个请求 - 响应交换的跟踪的<code>InMemoryHttpTraceRepository</code>。如果您需要扩展容量，可以定义自己的<code>InMemoryHttpTraceRepository</code> bean实例。您还可以创建自己的替代<code>HttpTraceRepository</code>实现。</p>
<h2 id="60-过程监测"><a href="#60-过程监测" class="headerlink" title="60.过程监测"></a>60.过程监测</h2><p>在<code>spring-boot</code>模块中，您可以找到两个类来创建通常对进程监视有用的文件：</p>
<ul>
<li><code>ApplicationPidFileWriter</code>创建一个包含应用程序PID的文件（默认情况下，在应用程序目录中，文件名为<code>application.pid</code>）。</li>
<li><code>WebServerPortFileWriter</code>创建一个包含正在运行的Web服务器端口的文件（默认情况下，在文件名为<code>application.port</code>的应用程序目录中）。</li>
</ul>
<p>默认情况下，这些编写器未激活，但您可以启用：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready-process-monitoring-configuration">通过扩展配置</a></li>
<li><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready-process-monitoring-programmatically">第60.2节“以编程方式”</a></li>
</ul>
<h2 id="60-1扩展配置"><a href="#60-1扩展配置" class="headerlink" title="60.1扩展配置"></a>60.1扩展配置</h2><p>在<code>META-INF/spring.factories</code>文件中，您可以激活写入PID文件的侦听器，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.context.ApplicationListener&#x3D;\</span><br><span class="line">org.springframework.boot.context.ApplicationPidFileWriter,\</span><br><span class="line">org.springframework.boot.web.context.WebServerPortFileWriter</span><br></pre></td></tr></table></figure>

<h2 id="60-2以编程方式"><a href="#60-2以编程方式" class="headerlink" title="60.2以编程方式"></a>60.2以编程方式</h2><p>您还可以通过调用<code>SpringApplication.addListeners(…)</code>方法并传递相应的<code>Writer</code>对象来激活侦听器。此方法还允许您在<code>Writer</code>构造函数中自定义文件名和路径。</p>
<h2 id="61-Cloud-Foundry支持"><a href="#61-Cloud-Foundry支持" class="headerlink" title="61. Cloud Foundry支持"></a>61. Cloud Foundry支持</h2><p>Spring Boot的执行器模块包括在部署到兼容的Cloud Foundry实例时激活的其他支持。<code>/cloudfoundryapplication</code>路径为所有<code>@Endpoint</code> beans提供了另一条安全路线。</p>
<p>通过扩展支持，可以使用Spring Boot执行器信息扩充Cloud Foundry管理UI（例如可用于查看已部署应用程序的Web应用程序）。例如，应用程序状态页面可以包括完整的健康信息，而不是典型的“运行”或“停止”状态。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>常规用户无法直接访问<code>/cloudfoundryapplication</code>路径。为了使用端点，必须与请求一起传递有效的UAA令牌。</td>
</tr>
</tbody></table>
<h2 id="61-1禁用Extended-Cloud-Foundry-Actuator支持"><a href="#61-1禁用Extended-Cloud-Foundry-Actuator支持" class="headerlink" title="61.1禁用Extended Cloud Foundry Actuator支持"></a>61.1禁用Extended Cloud Foundry Actuator支持</h2><p>如果要完全禁用<code>/cloudfoundryapplication</code>端点，可以将以下设置添加到<code>application.properties</code>文件中：</p>
<p><strong>application.properties。</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.cloudfoundry.enabled&#x3D;false</span><br></pre></td></tr></table></figure>



<h2 id="61-2-Cloud-Foundry自签名证书"><a href="#61-2-Cloud-Foundry自签名证书" class="headerlink" title="61.2 Cloud Foundry自签名证书"></a>61.2 Cloud Foundry自签名证书</h2><p>默认情况下，<code>/cloudfoundryapplication</code>端点的安全验证会对各种Cloud Foundry服务进行SSL调用。如果您的Cloud Foundry UAA或Cloud Controller服务使用自签名证书，则需要设置以下属性：</p>
<p><strong>application.properties。</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.cloudfoundry.skip-ssl-validation&#x3D;true</span><br></pre></td></tr></table></figure>



<h2 id="61-3自定义上下文路径"><a href="#61-3自定义上下文路径" class="headerlink" title="61.3自定义上下文路径"></a>61.3自定义上下文路径</h2><p>如果服务器的上下文路径已配置为<code>/</code>以外的任何其他内容，则Cloud Foundry端点将不会在应用程序的根目录中可用。例如，如果<code>server.servlet.context-path=/app</code>，Cloud Foundry端点将在<code>/app/cloudfoundryapplication/*</code>处可用。</p>
<p>如果您希望Cloud Foundry端点始终在<code>/cloudfoundryapplication/*</code>处可用，则无论服务器的上下文路径如何，您都需要在应用程序中明确配置它。配置将根据使用的Web服务器而有所不同。对于Tomcat，可以添加以下配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">public TomcatServletWebServerFactory servletWebServerFactory() &#123;</span><br><span class="line">	return new TomcatServletWebServerFactory() &#123;</span><br><span class="line"></span><br><span class="line">		@Override</span><br><span class="line">		protected void prepareContext(Host host,</span><br><span class="line">				ServletContextInitializer[] initializers) &#123;</span><br><span class="line">			super.prepareContext(host, initializers);</span><br><span class="line">			StandardContext child &#x3D; new StandardContext();</span><br><span class="line">			child.addLifecycleListener(new Tomcat.FixContextListener());</span><br><span class="line">			child.setPath(&quot;&#x2F;cloudfoundryapplication&quot;);</span><br><span class="line">			ServletContainerInitializer initializer &#x3D; getServletContextInitializer(</span><br><span class="line">					getContextPath());</span><br><span class="line">			child.addServletContainerInitializer(initializer, Collections.emptySet());</span><br><span class="line">			child.setCrossContext(true);</span><br><span class="line">			host.addChild(child);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private ServletContainerInitializer getServletContextInitializer(String contextPath) &#123;</span><br><span class="line">	return (c, context) -&gt; &#123;</span><br><span class="line">		Servlet servlet &#x3D; new GenericServlet() &#123;</span><br><span class="line"></span><br><span class="line">			@Override</span><br><span class="line">			public void service(ServletRequest req, ServletResponse res)</span><br><span class="line">					throws ServletException, IOException &#123;</span><br><span class="line">				ServletContext context &#x3D; req.getServletContext()</span><br><span class="line">						.getContext(contextPath);</span><br><span class="line">				context.getRequestDispatcher(&quot;&#x2F;cloudfoundryapplication&quot;).forward(req,</span><br><span class="line">						res);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		&#125;;</span><br><span class="line">		context.addServlet(&quot;cloudfoundry&quot;, servlet).addMapping(&quot;&#x2F;*&quot;);</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="62-接下来要阅读的内容"><a href="#62-接下来要阅读的内容" class="headerlink" title="62.接下来要阅读的内容"></a>62.接下来要阅读的内容</h2><p>如果您想探索本章中讨论的一些概念，您可以查看执行器<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-samples">示例应用程序</a>。您还可以阅读有关图形工具的信息，例如<a target="_blank" rel="noopener" href="http://graphite.wikidot.com/">Graphite</a>。</p>
<p>否则，您可以继续阅读有关<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#deployment">“部署选项”的信息，</a>或者继续阅读有关Spring Boot *<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#build-tool-plugins">构建工具插件的</a>*一些深入信息 。</p>
<h1 id="第六部分。部署Spring-Boot应用程序"><a href="#第六部分。部署Spring-Boot应用程序" class="headerlink" title="第六部分。部署Spring Boot应用程序"></a>第六部分。部署Spring Boot应用程序</h1><p>在部署应用程序时，Spring Boot灵活的打包选项提供了大量选择。您可以将Spring Boot应用程序部署到各种云平台，容器映像（例如Docker）或虚拟/真实计算机。</p>
<p>本节介绍一些更常见的部署方案。</p>
<h2 id="63-部署到云端"><a href="#63-部署到云端" class="headerlink" title="63.部署到云端"></a>63.部署到云端</h2><p>Spring Boot的可执行jar是现成的，适用于大多数流行的云PaaS（平台即服务）提供商。这些提供商往往要求您“自带容器”。它们管理应用程序进程（而不是Java应用程序），因此它们需要一个中间层，使<em>您的</em>应用程序 适应<em>云的</em>运行过程概念。</p>
<p>两个流行的云提供商Heroku和Cloud Foundry采用“buildpack”方法。buildpack将您部署的代码包装在<em>启动</em>应用程序所需的任何内容中。它可能是JDK和对<code>java</code>的调用，嵌入式Web服务器或完整的应用程序服务器。buildpack是可插拔的，但理想情况下，您应该能够尽可能少地进行自定义。这减少了不受您控制的功能的占用空间。它最大限度地减少了开发和生产环境之间的差异。</p>
<p>理想情况下，您的应用程序（如Spring Boot可执行jar）具有在其中运行打包所需的所有内容。</p>
<p>在本节中，我们将了解如何在“入门”部分中<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#getting-started-first-application">开发</a>并在云中运行的 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#getting-started-first-application">简单应用程序</a>。</p>
<h2 id="63-1-Cloud-Foundry"><a href="#63-1-Cloud-Foundry" class="headerlink" title="63.1 Cloud Foundry"></a>63.1 Cloud Foundry</h2><p>如果未指定其他buildpack，Cloud Foundry将提供默认的构建包。Cloud Foundry <a target="_blank" rel="noopener" href="https://github.com/cloudfoundry/java-buildpack">Java buildpack</a>对Spring应用程序提供了出色的支持，包括Spring Boot。您可以部署独立的可执行jar应用程序以及传统的<code>.war</code>打包应用程序。</p>
<p>构建应用程序（例如，使用<code>mvn clean package</code>）并安装了<code>cf</code>命令行工具后，使用<code>cf push</code>命令部署应用程序，将路径替换为已编译的{12}。 /}。<a target="_blank" rel="noopener" href="https://docs.cloudfoundry.org/cf-cli/install-go-cli.html">安装了<code>cf</code>命令行工具后</a>，使用<code>cf push</code>命令部署应用程序，将路径替换为已编译的{2759} /}。在推送应用程序之前，请务必 <a target="_blank" rel="noopener" href="https://docs.cloudfoundry.org/cf-cli/getting-started.html#login">使用<code>cf</code>命令行客户端登录</a>。以下行显示使用<code>cf push</code>命令部署应用程序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cf push acloudyspringtime -p target&#x2F;demo-0.0.1-SNAPSHOT.jar</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>在前面的示例中，我们将<code>acloudyspringtime</code>替换为您提供的任何值<code>cf</code>作为应用程序的名称。</td>
</tr>
</tbody></table>
<p>有关更多选项，请参阅<a target="_blank" rel="noopener" href="https://docs.cloudfoundry.org/cf-cli/getting-started.html#push"><code>cf push</code>文档</a>。如果<a target="_blank" rel="noopener" href="https://docs.cloudfoundry.org/devguide/deploy-apps/manifest.html"><code>manifest.yml</code></a> 同一目录中存在Cloud Foundry 文件，则会考虑该文件。</p>
<p>此时，<code>cf</code>开始上传您的应用程序，生成类似于以下示例的输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Uploading acloudyspringtime... OK</span><br><span class="line">Preparing to start acloudyspringtime... OK</span><br><span class="line">-----&gt; Downloaded app package (8.9M)</span><br><span class="line">-----&gt; Java Buildpack Version: v3.12 (offline) | https:&#x2F;&#x2F;github.com&#x2F;cloudfoundry&#x2F;java-buildpack.git#6f25b7e</span><br><span class="line">-----&gt; Downloading Open Jdk JRE 1.8.0_121 from https:&#x2F;&#x2F;java-buildpack.cloudfoundry.org&#x2F;openjdk&#x2F;trusty&#x2F;x86_64&#x2F;openjdk-1.8.0_121.tar.gz (found in cache)</span><br><span class="line">       Expanding Open Jdk JRE to .java-buildpack&#x2F;open_jdk_jre (1.6s)</span><br><span class="line">-----&gt; Downloading Open JDK Like Memory Calculator 2.0.2_RELEASE from https:&#x2F;&#x2F;java-buildpack.cloudfoundry.org&#x2F;memory-calculator&#x2F;trusty&#x2F;x86_64&#x2F;memory-calculator-2.0.2_RELEASE.tar.gz (found in cache)</span><br><span class="line">       Memory Settings: -Xss349K -Xmx681574K -XX:MaxMetaspaceSize&#x3D;104857K -Xms681574K -XX:MetaspaceSize&#x3D;104857K</span><br><span class="line">-----&gt; Downloading Container Certificate Trust Store 1.0.0_RELEASE from https:&#x2F;&#x2F;java-buildpack.cloudfoundry.org&#x2F;container-certificate-trust-store&#x2F;container-certificate-trust-store-1.0.0_RELEASE.jar (found in cache)</span><br><span class="line">       Adding certificates to .java-buildpack&#x2F;container_certificate_trust_store&#x2F;truststore.jks (0.6s)</span><br><span class="line">-----&gt; Downloading Spring Auto Reconfiguration 1.10.0_RELEASE from https:&#x2F;&#x2F;java-buildpack.cloudfoundry.org&#x2F;auto-reconfiguration&#x2F;auto-reconfiguration-1.10.0_RELEASE.jar (found in cache)</span><br><span class="line">Checking status of app &#39;acloudyspringtime&#39;...</span><br><span class="line">  0 of 1 instances running (1 starting)</span><br><span class="line">  ...</span><br><span class="line">  0 of 1 instances running (1 starting)</span><br><span class="line">  ...</span><br><span class="line">  0 of 1 instances running (1 starting)</span><br><span class="line">  ...</span><br><span class="line">  1 of 1 instances running (1 running)</span><br><span class="line"></span><br><span class="line">App started</span><br></pre></td></tr></table></figure>

<p>恭喜！该应用程序现已上线！</p>
<p>应用程序运行后，您可以使用<code>cf apps</code>命令验证已部署应用程序的状态，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ cf apps</span><br><span class="line">Getting applications in ...</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">name                 requested state   instances   memory   disk   urls</span><br><span class="line">...</span><br><span class="line">acloudyspringtime    started           1&#x2F;1         512M     1G     acloudyspringtime.cfapps.io</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>一旦Cloud Foundry确认您的应用程序已部署，您应该能够在给定的URI处找到该应用程序。在前面的示例中，您可以在<code>http://acloudyspringtime.cfapps.io/</code>找到它。</p>
<h3 id="63-1-1绑定到服务"><a href="#63-1-1绑定到服务" class="headerlink" title="63.1.1绑定到服务"></a>63.1.1绑定到服务</h3><p>默认情况下，有关正在运行的应用程序的元数据以及服务连接信息将作为环境变量公开给应用程序（例如：<code>$VCAP_SERVICES</code>）。此体系结构决策归功于Cloud Foundry的多语言（任何语言和平台都可以作为buildpack支持）。进程范围的环境变量与语言无关。</p>
<p>环境变量并不总是适用于最简单的API，因此Spring Boot会自动提取它们并将数据展平为可通过Spring的<code>Environment</code>抽象访问的属性，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">class MyBean implements EnvironmentAware &#123;</span><br><span class="line"></span><br><span class="line">	private String instanceId;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public void setEnvironment(Environment environment) &#123;</span><br><span class="line">		this.instanceId &#x3D; environment.getProperty(&quot;vcap.application.instance_id&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F; ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所有Cloud Foundry属性都以<code>vcap</code>为前缀。您可以使用<code>vcap</code>属性来访问应用程序信息（例如应用程序的公共URL）和服务信息（例如数据库凭据）。有关 完整的详细信息，请参阅 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/cloud/CloudFoundryVcapEnvironmentPostProcessor.html">“CloudFoundryVcapEnvironmentPostProcessor”</a> Javadoc。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>该<a target="_blank" rel="noopener" href="https://cloud.spring.io/spring-cloud-connectors/">Spring云连接器</a>项目是任务，如配置数据源更适合。Spring Boot包括自动配置支持和<code>spring-boot-starter-cloud-connectors</code>启动器。</td>
</tr>
</tbody></table>
<h2 id="63-2-Heroku"><a href="#63-2-Heroku" class="headerlink" title="63.2 Heroku"></a>63.2 Heroku</h2><p>Heroku是另一个流行的PaaS平台。要自定义Heroku构建，请提供<code>Procfile</code>，它提供部署应用程序所需的咒语。Heroku为要使用的Java应用程序分配<code>port</code>，然后确保路由到外部URI工作。</p>
<p>您必须将应用程序配置为侦听正确的端口。以下示例显示了我们的入门REST应用程序的<code>Procfile</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">web: java -Dserver.port&#x3D;$PORT -jar target&#x2F;demo-0.0.1-SNAPSHOT.jar</span><br></pre></td></tr></table></figure>

<p>Spring Boot使<code>-D</code>个参数可用作可从Spring <code>Environment</code>实例访问的属性。<code>server.port</code>配置属性被馈送到嵌入式Tomcat，Jetty或Undertow实例，然后在启动时使用该端口。<code>$PORT</code>环境变量由Heroku PaaS分配给我们。</p>
<p>这应该是你需要的一切。Heroku部署最常见的部署工作流程是<code>git push</code>生产代码，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">$ git push heroku master</span><br><span class="line"></span><br><span class="line">Initializing repository, done.</span><br><span class="line">Counting objects: 95, done.</span><br><span class="line">Delta compression using up to 8 threads.</span><br><span class="line">Compressing objects: 100% (78&#x2F;78), done.</span><br><span class="line">Writing objects: 100% (95&#x2F;95), 8.66 MiB | 606.00 KiB&#x2F;s, done.</span><br><span class="line">Total 95 (delta 31), reused 0 (delta 0)</span><br><span class="line"></span><br><span class="line">-----&gt; Java app detected</span><br><span class="line">-----&gt; Installing OpenJDK 1.8... done</span><br><span class="line">-----&gt; Installing Maven 3.3.1... done</span><br><span class="line">-----&gt; Installing settings.xml... done</span><br><span class="line">-----&gt; Executing: mvn -B -DskipTests&#x3D;true clean install</span><br><span class="line"></span><br><span class="line">       [INFO] Scanning for projects...</span><br><span class="line">       Downloading: https:&#x2F;&#x2F;repo.spring.io&#x2F;...</span><br><span class="line">       Downloaded: https:&#x2F;&#x2F;repo.spring.io&#x2F;... (818 B at 1.8 KB&#x2F;sec)</span><br><span class="line">		....</span><br><span class="line">       Downloaded: http:&#x2F;&#x2F;s3pository.heroku.com&#x2F;jvm&#x2F;... (152 KB at 595.3 KB&#x2F;sec)</span><br><span class="line">       [INFO] Installing &#x2F;tmp&#x2F;build_0c35a5d2-a067-4abc-a232-14b1fb7a8229&#x2F;target&#x2F;...</span><br><span class="line">       [INFO] Installing &#x2F;tmp&#x2F;build_0c35a5d2-a067-4abc-a232-14b1fb7a8229&#x2F;pom.xml ...</span><br><span class="line">       [INFO] ------------------------------------------------------------------------</span><br><span class="line">       [INFO] BUILD SUCCESS</span><br><span class="line">       [INFO] ------------------------------------------------------------------------</span><br><span class="line">       [INFO] Total time: 59.358s</span><br><span class="line">       [INFO] Finished at: Fri Mar 07 07:28:25 UTC 2014</span><br><span class="line">       [INFO] Final Memory: 20M&#x2F;493M</span><br><span class="line">       [INFO] ------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">-----&gt; Discovering process types</span><br><span class="line">       Procfile declares types -&gt; web</span><br><span class="line"></span><br><span class="line">-----&gt; Compressing... done, 70.4MB</span><br><span class="line">-----&gt; Launching... done, v6</span><br><span class="line">       http:&#x2F;&#x2F;agile-sierra-1405.herokuapp.com&#x2F; deployed to Heroku</span><br><span class="line"></span><br><span class="line">To git@heroku.com:agile-sierra-1405.git</span><br><span class="line"> * [new branch]      master -&gt; master</span><br></pre></td></tr></table></figure>

<p>您的应用程序现在应该在Heroku上启动并运行。</p>
<h2 id="63-3-OpenShift"><a href="#63-3-OpenShift" class="headerlink" title="63.3 OpenShift"></a>63.3 OpenShift</h2><p><a target="_blank" rel="noopener" href="https://www.openshift.com/">OpenShift</a>是Kubernetes容器编排平台的Red Hat公共（和企业）扩展。与Kubernetes类似，OpenShift有许多选项可用于安装基于Spring Boot的应用程序。</p>
<p>OpenShift有许多资源描述如何部署Spring Boot应用程序，包括：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.openshift.com/using-openshift-enterprise-grade-spring-boot-deployments/">使用S2I构建器</a></li>
<li><a target="_blank" rel="noopener" href="https://access.redhat.com/documentation/en-us/reference_architectures/2017/html-single/spring_boot_microservices_on_red_hat_openshift_container_platform_3/">建筑指南</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.openshift.com/using-spring-boot-on-openshift/">在Wildfly上作为传统Web应用程序运行</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.openshift.com/openshift-commons-briefing-96-cloud-native-applications-spring-rhoar/">OpenShift Commons简报</a></li>
</ul>
<h2 id="63-4亚马逊网络服务（AWS）"><a href="#63-4亚马逊网络服务（AWS）" class="headerlink" title="63.4亚马逊网络服务（AWS）"></a>63.4亚马逊网络服务（AWS）</h2><p>Amazon Web Services提供了多种方法来安装基于Spring Boot的应用程序，可以是传统的Web应用程序（war），也可以是带有嵌入式Web服务器的可执行jar文件。选项包括：</p>
<ul>
<li>AWS Elastic Beanstalk</li>
<li>AWS Code Deploy</li>
<li>AWS OPS Works</li>
<li>AWS Cloud Formation</li>
<li>AWS容器注册表</li>
</ul>
<p>每个都有不同的功能和定价模型。在本文档中，我们仅描述了最简单的选项：AWS Elastic Beanstalk。</p>
<h3 id="63-4-1-AWS-Elastic-Beanstalk"><a href="#63-4-1-AWS-Elastic-Beanstalk" class="headerlink" title="63.4.1 AWS Elastic Beanstalk"></a>63.4.1 AWS Elastic Beanstalk</h3><p>正如官方的 <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_Java.html">Elastic Beanstalk Java指南中所述</a>，部署Java应用程序有两个主要选项。您可以使用“Tomcat平台”或“Java SE平台”。</p>
<h4 id="使用Tomcat平台"><a href="#使用Tomcat平台" class="headerlink" title="使用Tomcat平台"></a>使用Tomcat平台</h4><p>此选项适用于生成war文件的Spring Boot项目。无需特殊配置。您只需遵循官方指南即可。</p>
<h4 id="使用Java-SE平台"><a href="#使用Java-SE平台" class="headerlink" title="使用Java SE平台"></a>使用Java SE平台</h4><p>此选项适用于生成jar文件并运行嵌入式Web容器的Spring Boot项目。Elastic Beanstalk环境在端口80上运行nginx实例以代理在端口5000上运行的实际应用程序。要配置它，请将以下行添加到<code>application.properties</code>文件中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server.port&#x3D;5000</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>默认情况下，Elastic Beanstalk上传源并在AWS中编译它们。但是，最好上传二进制文件。为此，请在<code>.elasticbeanstalk/config.yml</code>文件中添加与以下内容类似的行：<code>deploy: artifact: target/demo-0.0.1-SNAPSHOT.jar</code></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>默认情况下，Elastic Beanstalk环境是负载平衡的。负载平衡器具有显着的成本。要避免此成本，请将环境类型设置为“Single instance”，如 <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/environments-create-wizard.html#environments-create-wizard-capacity">Amazon文档中所述</a>。您还可以使用CLI和以下命令创建单实例环境：<code>eb create -s</code></td>
</tr>
</tbody></table>
<h3 id="63-4-2摘要"><a href="#63-4-2摘要" class="headerlink" title="63.4.2摘要"></a>63.4.2摘要</h3><p>这是访问AWS的最简单方法之一，但还有更多内容需要涉及，例如如何将Elastic Beanstalk集成到任何CI / CD工具中，使用Elastic Beanstalk Maven插件代替CLI和其他人。有一篇 <a target="_blank" rel="noopener" href="https://exampledriven.wordpress.com/2017/01/09/spring-boot-aws-elastic-beanstalk-example/">博文</a>更详细地介绍了这些主题。</p>
<h2 id="63-5-Boxfuse和亚马逊网络服务"><a href="#63-5-Boxfuse和亚马逊网络服务" class="headerlink" title="63.5 Boxfuse和亚马逊网络服务"></a>63.5 Boxfuse和亚马逊网络服务</h2><p><a target="_blank" rel="noopener" href="https://boxfuse.com/">Boxfuse的</a>工作原理是将您的Spring Boot可执行jar或war转换为可以在VirtualBox或AWS上无需部署的最小VM映像。Boxfuse为Spring Boot提供深度集成，并使用Spring Boot配置文件中的信息自动配置端口和运行状况检查URL。Boxfuse利用这些信息来处理它产生的图像以及它提供的所有资源（实例，安全组，弹性负载平衡器等）。</p>
<p>创建<a target="_blank" rel="noopener" href="https://console.boxfuse.com/">Boxfuse帐户后</a>，将其连接到您的AWS账户，安装最新版本的Boxfuse客户端，并确保该应用程序是由Maven或Gradle构建的（例如，使用<code>mvn clean package</code>），您可以使用类似于以下内容的命令将您的Spring Boot应用程序部署到AWS：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ boxfuse run myapp-1.0.jar -env&#x3D;prod</span><br></pre></td></tr></table></figure>

<p>有关更多选项，请参阅<a target="_blank" rel="noopener" href="https://boxfuse.com/docs/commandline/run.html"><code>boxfuse run</code>文档</a>。如果<a target="_blank" rel="noopener" href="https://boxfuse.com/docs/commandline/#configuration"><code>boxfuse.conf</code></a>当前目录中存在文件，则会考虑该文件。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>默认情况下，Boxfuse在启动时激活名为<code>boxfuse</code>的Spring个人资料。如果您的可执行jar或war包含一个 <a target="_blank" rel="noopener" href="https://boxfuse.com/docs/payloads/springboot.html#configuration"><code>application-boxfuse.properties</code></a>文件，Boxfuse将其配置基于它包含的属性。</td>
</tr>
</tbody></table>
<p>此时，<code>boxfuse</code>为您的应用程序创建一个映像，上传它，并在AWS上配置和启动必要的资源，从而产生类似于以下示例的输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Fusing Image for myapp-1.0.jar ...</span><br><span class="line">Image fused in 00:06.838s (53937 K) -&gt; axelfontaine&#x2F;myapp:1.0</span><br><span class="line">Creating axelfontaine&#x2F;myapp ...</span><br><span class="line">Pushing axelfontaine&#x2F;myapp:1.0 ...</span><br><span class="line">Verifying axelfontaine&#x2F;myapp:1.0 ...</span><br><span class="line">Creating Elastic IP ...</span><br><span class="line">Mapping myapp-axelfontaine.boxfuse.io to 52.28.233.167 ...</span><br><span class="line">Waiting for AWS to create an AMI for axelfontaine&#x2F;myapp:1.0 in eu-central-1 (this may take up to 50 seconds) ...</span><br><span class="line">AMI created in 00:23.557s -&gt; ami-d23f38cf</span><br><span class="line">Creating security group boxfuse-sg_axelfontaine&#x2F;myapp:1.0 ...</span><br><span class="line">Launching t2.micro instance of axelfontaine&#x2F;myapp:1.0 (ami-d23f38cf) in eu-central-1 ...</span><br><span class="line">Instance launched in 00:30.306s -&gt; i-92ef9f53</span><br><span class="line">Waiting for AWS to boot Instance i-92ef9f53 and Payload to start at http:&#x2F;&#x2F;52.28.235.61&#x2F; ...</span><br><span class="line">Payload started in 00:29.266s -&gt; http:&#x2F;&#x2F;52.28.235.61&#x2F;</span><br><span class="line">Remapping Elastic IP 52.28.233.167 to i-92ef9f53 ...</span><br><span class="line">Waiting 15s for AWS to complete Elastic IP Zero Downtime transition ...</span><br><span class="line">Deployment completed successfully. axelfontaine&#x2F;myapp:1.0 is up and running at http:&#x2F;&#x2F;myapp-axelfontaine.boxfuse.io&#x2F;</span><br></pre></td></tr></table></figure>

<p>您的应用程序现在应该在AWS上启动并运行。</p>
<p>请参阅有关<a target="_blank" rel="noopener" href="https://boxfuse.com/blog/spring-boot-ec2.html">在EC2</a>上<a target="_blank" rel="noopener" href="https://boxfuse.com/blog/spring-boot-ec2.html">部署Spring Boot应用程序</a>的博客文章以及<a target="_blank" rel="noopener" href="https://boxfuse.com/docs/payloads/springboot.html">Boxfuse Spring启动集成</a>的 <a target="_blank" rel="noopener" href="https://boxfuse.com/docs/payloads/springboot.html">文档，</a>以开始使用Maven构建来运行应用程序。</p>
<h2 id="63-6-Google-Cloud"><a href="#63-6-Google-Cloud" class="headerlink" title="63.6 Google Cloud"></a>63.6 Google Cloud</h2><p>Google Cloud有几个选项可用于启动Spring Boot应用程序。最容易上手的可能是App Engine，但您也可以找到在带有Container Engine的容器中运行Spring Boot或在带有Compute Engine的虚拟机上运行的方法。</p>
<p>要在App Engine中运行，您可以首先在UI中创建项目，该项目为您设置唯一标识符并设置HTTP路由。将Java应用程序添加到项目中并将其留空，然后使用<a target="_blank" rel="noopener" href="https://cloud.google.com/sdk/downloads">Google Cloud SDK</a>将Spring Boot应用程序从命令行或CI构建推送到该插槽。</p>
<p>App Engine Standard要求您使用WAR包装。按照 <a target="_blank" rel="noopener" href="https://github.com/GoogleCloudPlatform/getting-started-java/blob/master/appengine-standard-java8/springboot-appengine-standard/README.md">以下步骤</a> 将App Engine Standard应用程序部署到Google Cloud。</p>
<p>或者，App Engine Flex要求您创建一个<code>app.yaml</code>文件来描述您的应用所需的资源。通常，您将此文件放在<code>src/main/appengine</code>中，它应该类似于以下文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">service: default</span><br><span class="line"></span><br><span class="line">runtime: java</span><br><span class="line">env: flex</span><br><span class="line"></span><br><span class="line">runtime_config:</span><br><span class="line">  jdk: openjdk8</span><br><span class="line"></span><br><span class="line">handlers:</span><br><span class="line">- url: &#x2F;.*</span><br><span class="line">  script: this field is required, but ignored</span><br><span class="line"></span><br><span class="line">manual_scaling:</span><br><span class="line">  instances: 1</span><br><span class="line"></span><br><span class="line">health_check:</span><br><span class="line">  enable_health_check: False</span><br><span class="line"></span><br><span class="line">env_variables:</span><br><span class="line">  ENCRYPT_KEY: your_encryption_key_here</span><br></pre></td></tr></table></figure>

<p>您可以通过将项目ID添加到构建配置来部署应用程序（例如，使用Maven插件），如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;plugin&gt;</span><br><span class="line">	&lt;groupId&gt;com.google.cloud.tools&lt;&#x2F;groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;appengine-maven-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">	&lt;version&gt;1.3.0&lt;&#x2F;version&gt;</span><br><span class="line">	&lt;configuration&gt;</span><br><span class="line">		&lt;project&gt;myproject&lt;&#x2F;project&gt;</span><br><span class="line">	&lt;&#x2F;configuration&gt;</span><br><span class="line">&lt;&#x2F;plugin&gt;</span><br></pre></td></tr></table></figure>

<p>然后使用<code>mvn appengine:deploy</code>进行部署（如果需要先进行身份验证，则构建失败）。</p>
<h2 id="64-安装Spring-Boot应用程序"><a href="#64-安装Spring-Boot应用程序" class="headerlink" title="64.安装Spring Boot应用程序"></a>64.安装Spring Boot应用程序</h2><p>除了使用<code>java -jar</code>运行Spring Boot应用程序之外，还可以为Unix系统创建完全可执行的应用程序。完全可执行的jar可以像任何其他可执行二进制文件一样执行，也可以 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#deployment-service">使用<code>init.d</code>或<code>systemd</code>注册</a>。这使得在常见生产环境中安装和管理Spring Boot应用程序变得非常容易。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/caution.png" alt="[警告]"></th>
<th>警告</th>
</tr>
</thead>
<tbody><tr>
<td>完全可执行的jar通过在文件的前面嵌入额外的脚本来工作。目前，某些工具不接受此格式，因此您可能无法始终使用此技术。例如，<code>jar -xf</code>可能无法提取已完全可执行的jar或战争。建议您只有在打算直接执行jar或war时才能使jar或war完全可执行，而不是使用<code>java -jar</code>运行它或将其部署到servlet容器。</td>
<td></td>
</tr>
</tbody></table>
<p>要使用Maven创建“完全可执行”jar，请使用以下插件配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;plugin&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-boot-maven-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">	&lt;configuration&gt;</span><br><span class="line">		&lt;executable&gt;true&lt;&#x2F;executable&gt;</span><br><span class="line">	&lt;&#x2F;configuration&gt;</span><br><span class="line">&lt;&#x2F;plugin&gt;</span><br></pre></td></tr></table></figure>

<p>以下示例显示了等效的Gradle配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bootJar &#123;</span><br><span class="line">	launchScript()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后，您可以通过键入<code>./my-application.jar</code>（其中<code>my-application</code>是您的工件的名称）来运行您的应用程序。包含jar的目录用作应用程序的工作目录。</p>
<h2 id="64-1支持的操作系统"><a href="#64-1支持的操作系统" class="headerlink" title="64.1支持的操作系统"></a>64.1支持的操作系统</h2><p>默认脚本支持大多数Linux发行版，并在CentOS和Ubuntu上进行测试。其他平台，如OS X和FreeBSD，需要使用自定义<code>embeddedLaunchScript</code>。</p>
<h2 id="64-2-Unix-Linux服务"><a href="#64-2-Unix-Linux服务" class="headerlink" title="64.2 Unix / Linux服务"></a>64.2 Unix / Linux服务</h2><p>Spring Boot应用程序可以使用<code>init.d</code>或<code>systemd</code>轻松启动为Unix / Linux服务。</p>
<h3 id="64-2-1作为init-d服务安装（系统V）"><a href="#64-2-1作为init-d服务安装（系统V）" class="headerlink" title="64.2.1作为init.d服务安装（系统V）"></a>64.2.1作为<code>init.d</code>服务安装（系统V）</h3><p>如果您配置了Spring Boot的Maven或Gradle插件来生成<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#deployment-install">完全可执行的jar</a>，并且您没有使用自定义<code>embeddedLaunchScript</code>，那么您的应用程序可以用作<code>init.d</code>服务。为此，请将jar符号链接到<code>init.d</code>以支持标准<code>start</code>，<code>stop</code>，<code>restart</code>和<code>status</code>命令。</p>
<p>该脚本支持以下功能：</p>
<ul>
<li>以拥有jar文件的用户身份启动服务</li>
<li>使用<code>/var/run/&lt;appname&gt;/&lt;appname&gt;.pid</code>跟踪应用程序的PID</li>
<li>将控制台日志写入<code>/var/log/&lt;appname&gt;.log</code></li>
</ul>
<p>假设您在<code>/var/myapp</code>中安装了Spring Boot应用程序，要将Spring Boot应用程序安装为<code>init.d</code>服务，请创建一个符号链接，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ln -s &#x2F;var&#x2F;myapp&#x2F;myapp.jar &#x2F;etc&#x2F;init.d&#x2F;myapp</span><br></pre></td></tr></table></figure>

<p>安装后，您可以按常规方式启动和停止服务。例如，在基于Debian的系统上，您可以使用以下命令启动它：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ service myapp start</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果您的应用程序无法启动，请检查写入<code>/var/log/&lt;appname&gt;.log</code>的日志文件是否有错误。</td>
</tr>
</tbody></table>
<p>您还可以使用标准操作系统工具标记应用程序以自动启动。例如，在Debian上，您可以使用以下命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ update-rc.d myapp defaults &lt;priority&gt;</span><br></pre></td></tr></table></figure>

<h4 id="保护init-d服务"><a href="#保护init-d服务" class="headerlink" title="保护init.d服务"></a>保护<code>init.d</code>服务</h4><table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>以下是一组有关如何保护作为init.d服务运行的Spring Boot应用程序的指南。它并不是为了强化应用程序及其运行环境而应该做的所有事情的详尽列表。</td>
</tr>
</tbody></table>
<p>当以root身份执行时，就像root用于启动init.d服务的情况一样，默认可执行脚本以拥有jar文件的用户身份运行应用程序。您永远不应该以<code>root</code>运行Spring Boot应用程序，因此您的应用程序的jar文件永远不应该由root拥有。相反，创建一个特定用户来运行您的应用程序并使用<code>chown</code>使其成为jar文件的所有者，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ chown bootapp:bootapp your-app.jar</span><br></pre></td></tr></table></figure>

<p>在这种情况下，默认可执行脚本以<code>bootapp</code>用户身份运行应用程序。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>为了减少应用程序用户帐户遭到入侵的可能性，您应该考虑阻止它使用登录shell。例如，您可以将帐户的shell设置为<code>/usr/sbin/nologin</code>。</td>
</tr>
</tbody></table>
<p>您还应该采取措施来防止修改应用程序的jar文件。首先，配置其权限，使其无法写入，只能由其所有者读取或执行，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ chmod 500 your-app.jar</span><br></pre></td></tr></table></figure>

<p>其次，如果您的应用程序或运行它的帐户受到损害，您还应该采取措施限制损害。如果攻击者确实获得了访问权限，他们可以使jar文件可写并更改其内容。防止这种情况的一种方法是使用<code>chattr</code>使其不可变，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo chattr +i your-app.jar</span><br></pre></td></tr></table></figure>

<p>这将阻止任何用户（包括root）修改jar。</p>
<p>如果root用于控制应用程序的服务，并且您 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#deployment-script-customization-conf-file">使用<code>.conf</code>文件</a>来自定义其启动，则root用户将读取并评估<code>.conf</code>文件。它应该得到相应的保护。使用<code>chmod</code>以便文件只能由所有者读取并使用<code>chown</code>使root成为所有者，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ chmod 400 your-app.conf</span><br><span class="line">$ sudo chown root:root your-app.conf</span><br></pre></td></tr></table></figure>

<h3 id="64-2-2作为systemd服务安装"><a href="#64-2-2作为systemd服务安装" class="headerlink" title="64.2.2作为systemd服务安装"></a>64.2.2作为<code>systemd</code>服务安装</h3><p><code>systemd</code>是System V init系统的后继者，现在被许多现代Linux发行版使用。虽然您可以继续将<code>init.d</code>脚本与<code>systemd</code>一起使用，但也可以使用<code>systemd</code>‘service’脚本启动Spring Boot应用程序。</p>
<p>假设您在<code>/var/myapp</code>中安装了Spring Boot应用程序，要将Spring Boot应用程序安装为<code>systemd</code>服务，请创建名为<code>myapp.service</code>的脚本并将其放在<code>/etc/systemd/system</code>目录中。以下脚本提供了一个示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description&#x3D;myapp</span><br><span class="line">After&#x3D;syslog.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User&#x3D;myapp</span><br><span class="line">ExecStart&#x3D;&#x2F;var&#x2F;myapp&#x2F;myapp.jar</span><br><span class="line">SuccessExitStatus&#x3D;143</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy&#x3D;multi-user.target</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/important.png" alt="[重要]"></th>
<th>重要</th>
</tr>
</thead>
<tbody><tr>
<td>请务必更改应用的<code>Description</code>，<code>User</code>和<code>ExecStart</code>字段。</td>
<td></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td><code>ExecStart</code>字段未声明脚本操作命令，这意味着默认情况下使用<code>run</code>命令。</td>
</tr>
</tbody></table>
<p>请注意，与作为<code>init.d</code>服务运行时不同，运行应用程序的用户，PID文件和控制台日志文件由<code>systemd</code>本身管理，因此必须使用’’中的相应字段进行配置。服务’脚本。有关更多详细信息，请参阅 <a target="_blank" rel="noopener" href="https://www.freedesktop.org/software/systemd/man/systemd.service.html">服务单元配置手册页</a>。</p>
<p>要将应用程序标记为在系统引导时自动启动，请使用以下命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl enable myapp.service</span><br></pre></td></tr></table></figure>

<p>有关详细信息，请参阅<code>man systemctl</code>。</p>
<h3 id="64-2-3自定义启动脚本"><a href="#64-2-3自定义启动脚本" class="headerlink" title="64.2.3自定义启动脚本"></a>64.2.3自定义启动脚本</h3><p>Maven或Gradle插件编写的默认嵌入式启动脚本可以通过多种方式进行自定义。对于大多数人来说，使用默认脚本和一些自定义通常就足够了。如果您发现无法自定义所需内容，请使用<code>embeddedLaunchScript</code>选项完全编写自己的文件。</p>
<h4 id="写入时自定义启动脚本"><a href="#写入时自定义启动脚本" class="headerlink" title="写入时自定义启动脚本"></a>写入时自定义启动脚本</h4><p>在将脚本写入jar文件时自定义启动脚本的元素通常是有意义的。例如，init.d脚本可以提供“描述”。由于您事先了解了描述（并且不需要更改），因此您可以在生成jar时提供它。</p>
<p>要自定义书面元素，请使用Spring Boot Maven插件的<code>embeddedLaunchScriptProperties</code>选项或<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/gradle-plugin/reference/html/#packaging-executable-configuring-launch-script">Spring Boot Gradle插件<code>launchScript</code></a>的 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/gradle-plugin/reference/html/#packaging-executable-configuring-launch-script"><code>properties</code>属性</a>。</p>
<p>默认脚本支持以下属性替换：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>描述</th>
<th>Gradle默认</th>
<th>Maven默认</th>
</tr>
</thead>
<tbody><tr>
<td><code>mode</code></td>
<td>脚本模式。</td>
<td><code>auto</code></td>
<td><code>auto</code></td>
</tr>
<tr>
<td><code>initInfoProvides</code></td>
<td>“INIT INFO”的<code>Provides</code>部分</td>
<td><code>$&#123;task.baseName&#125;</code></td>
<td><code>$&#123;project.artifactId&#125;</code></td>
</tr>
<tr>
<td><code>initInfoRequiredStart</code></td>
<td>{INI INFO“<code>Required-Start</code>部分。</td>
<td><code>$remote_fs $syslog $network</code></td>
<td><code>$remote_fs $syslog $network</code></td>
</tr>
<tr>
<td><code>initInfoRequiredStop</code></td>
<td><code>Required-Stop</code>“INIT INFO”部分。</td>
<td><code>$remote_fs $syslog $network</code></td>
<td><code>$remote_fs $syslog $network</code></td>
</tr>
<tr>
<td><code>initInfoDefaultStart</code></td>
<td>{INI INFO“<code>Default-Start</code>部分。</td>
<td><code>2 3 4 5</code></td>
<td><code>2 3 4 5</code></td>
</tr>
<tr>
<td><code>initInfoDefaultStop</code></td>
<td>“INIT INFO”的<code>Default-Stop</code>部分。</td>
<td><code>0 1 6</code></td>
<td><code>0 1 6</code></td>
</tr>
<tr>
<td><code>initInfoShortDescription</code></td>
<td>{INI INFO“<code>Short-Description</code>部分。</td>
<td>Single-line version of <code>$&#123;project.description&#125;</code> (falling back to <code>$&#123;task.baseName&#125;</code>)</td>
<td><code>$&#123;project.name&#125;</code></td>
</tr>
<tr>
<td><code>initInfoDescription</code></td>
<td>“INIT INFO”的<code>Description</code>部分。</td>
<td><code>$&#123;project.description&#125;</code> (falling back to <code>$&#123;task.baseName&#125;</code>)</td>
<td><code>$&#123;project.description&#125;</code> (falling back to <code>$&#123;project.name&#125;</code>)</td>
</tr>
<tr>
<td><code>initInfoChkconfig</code></td>
<td>{INI INFO“<code>chkconfig</code>部分</td>
<td><code>2345 99 01</code></td>
<td><code>2345 99 01</code></td>
</tr>
<tr>
<td><code>confFolder</code></td>
<td><code>CONF_FOLDER</code>的默认值</td>
<td>Folder containing the jar</td>
<td>Folder containing the jar</td>
</tr>
<tr>
<td><code>inlinedConfScript</code></td>
<td>引用应在默认启动脚本中内联的文件脚本。在加载任何外部配置文件之前，这可用于设置环境变量，例如<code>JAVA_OPTS</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>logFolder</code></td>
<td><code>LOG_FOLDER</code>的默认值。仅适用于<code>init.d</code>服务</td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>logFilename</code></td>
<td><code>LOG_FILENAME</code>的默认值。仅对<code>init.d</code>服务有效</td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>pidFolder</code></td>
<td><code>PID_FOLDER</code>的默认值。仅适用于<code>init.d</code>服务</td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>pidFilename</code></td>
<td><code>PID_FOLDER</code>中PID文件名称的默认值。仅适用于<code>init.d</code>服务</td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>useStartStopDaemon</code></td>
<td><code>start-stop-daemon</code>命令是否可用，应该用于控制进程</td>
<td><code>true</code></td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>stopWaitTime</code></td>
<td><code>STOP_WAIT_TIME</code>的默认值（以秒为单位）。仅对<code>init.d</code>服务有效</td>
<td>60</td>
<td>60</td>
</tr>
</tbody></table>
<h4 id="它运行时自定义脚本"><a href="#它运行时自定义脚本" class="headerlink" title="它运行时自定义脚本"></a>它运行时自定义脚本</h4><p>对于在编写jar <em>后</em>需要自定义的脚本项，可以使用环境变量或<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#deployment-script-customization-conf-file">配置文件</a>。</p>
<p>默认脚本支持以下环境属性：</p>
<table>
<thead>
<tr>
<th>变量</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>MODE</code></td>
<td>操作的“模式”。默认值取决于jar的构建方式，但通常是<code>auto</code>（意味着它通过检查它是否是名为<code>init.d</code>的目录中的符号链接来尝试猜测它是否是init脚本）。如果要在前台运行脚本，可以将`stop</td>
</tr>
<tr>
<td><code>USE_START_STOP_DAEMON</code></td>
<td><code>start-stop-daemon</code>命令是否可用，应该用于控制进程。默认为<code>true</code>。</td>
</tr>
<tr>
<td><code>PID_FOLDER</code></td>
<td>pid文件夹的根名称（默认为<code>/var/run</code>）。</td>
</tr>
<tr>
<td><code>LOG_FOLDER</code></td>
<td>放置日志文件的文件夹的名称（默认为<code>/var/log</code>）。</td>
</tr>
<tr>
<td><code>CONF_FOLDER</code></td>
<td>从中读取.conf文件的文件夹的名称（默认情况下与jar文件相同）。</td>
</tr>
<tr>
<td><code>LOG_FILENAME</code></td>
<td><code>LOG_FOLDER</code>中的日志文件名称（默认为<code>&lt;appname&gt;.log</code>）。</td>
</tr>
<tr>
<td><code>APP_NAME</code></td>
<td>应用程序的名称。如果jar从符号链接运行，则脚本会猜测应用程序名称。如果它不是符号链接或您想要显式设置应用程序名称，这可能很有用。</td>
</tr>
<tr>
<td><code>RUN_ARGS</code></td>
<td>传递给程序的参数（Spring Boot应用程序）。</td>
</tr>
<tr>
<td><code>JAVA_HOME</code></td>
<td>默认情况下使用<code>PATH</code>发现<code>java</code>可执行文件的位置，但如果<code>$JAVA_HOME/bin/java</code>处有可执行文件，则可以显式设置它。</td>
</tr>
<tr>
<td><code>JAVA_OPTS</code></td>
<td>启动时传递给JVM的选项。</td>
</tr>
<tr>
<td><code>JARFILE</code></td>
<td>jar文件的显式位置，以防脚本用于启动实际上未嵌入的jar。</td>
</tr>
<tr>
<td><code>DEBUG</code></td>
<td>如果不为空，则在shell进程上设置<code>-x</code>标志，以便于在脚本中查看逻辑。</td>
</tr>
<tr>
<td><code>STOP_WAIT_TIME</code></td>
<td>在强制关闭之前停止应用程序的等待时间（默认为<code>60</code>）。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td><code>PID_FOLDER</code>，<code>LOG_FOLDER</code>和<code>LOG_FILENAME</code>变量仅对<code>init.d</code>服务有效。对于<code>systemd</code>，使用“service”脚本进行等效的自定义。有关更多详细信息，请参阅 <a target="_blank" rel="noopener" href="https://www.freedesktop.org/software/systemd/man/systemd.service.html">服务单元配置手册页</a>。</td>
</tr>
</tbody></table>
<p>除<code>JARFILE</code>和<code>APP_NAME</code>之外，可以使用<code>.conf</code>文件配置上一节中列出的设置。该文件应该位于jar文件的旁边，并且具有相同的名称，但后缀为<code>.conf</code>而不是<code>.jar</code>。例如，名为<code>/var/myapp/myapp.jar</code>的jar使用名为<code>/var/myapp/myapp.conf</code>的配置文件，如以下示例所示：</p>
<p><strong>myapp.conf。</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">JAVA_OPTS&#x3D;-Xmx1024M</span><br><span class="line">LOG_FOLDER&#x3D;&#x2F;custom&#x2F;log&#x2F;folder</span><br></pre></td></tr></table></figure>



<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果您不喜欢在jar文件旁边有配置文件，可以设置<code>CONF_FOLDER</code>环境变量来自定义配置文件的位置。</td>
</tr>
</tbody></table>
<p>要了解如何正确保护此文件，请参阅 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#deployment-initd-service-securing">保护init.d服务的准则</a>。</p>
<h2 id="64-3-Microsoft-Windows服务"><a href="#64-3-Microsoft-Windows服务" class="headerlink" title="64.3 Microsoft Windows服务"></a>64.3 Microsoft Windows服务</h2><p>可以使用启动Spring Boot应用程序作为Windows服务 <a target="_blank" rel="noopener" href="https://github.com/kohsuke/winsw"><code>winsw</code></a>。</p>
<p>A（<a target="_blank" rel="noopener" href="https://github.com/snicoll-scratches/spring-boot-daemon">单独维护的示例</a>）逐步介绍了如何为Spring Boot应用程序创建Windows服务。</p>
<h2 id="65-接下来要阅读的内容"><a href="#65-接下来要阅读的内容" class="headerlink" title="65.接下来要阅读的内容"></a>65.接下来要阅读的内容</h2><p>查看<a target="_blank" rel="noopener" href="https://www.cloudfoundry.org/">Cloud Foundry</a>， <a target="_blank" rel="noopener" href="https://www.heroku.com/">Heroku</a>，<a target="_blank" rel="noopener" href="https://www.openshift.com/">OpenShift</a>和 <a target="_blank" rel="noopener" href="https://boxfuse.com/">Boxfuse</a>网站，了解有关PaaS可提供的各种功能的更多信息。这些只是四个最受欢迎的Java PaaS提供商。由于Spring Boot非常适合基于云的部署，因此您也可以自由地考虑其他提供商。</p>
<p>接下来的部分将介绍*<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#cli">Spring Boot CLI</a>*，或者您可以继续阅读有关 *<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#build-tool-plugins">构建工具插件的内容</a>*。</p>
<h1 id="第七部分。Spring-Boot-CLI"><a href="#第七部分。Spring-Boot-CLI" class="headerlink" title="第七部分。Spring Boot CLI"></a>第七部分。Spring Boot CLI</h1><p>Spring Boot CLI是一个命令行工具，如果您想快速开发Spring应用程序，可以使用它。它允许您运行Groovy脚本，这意味着您拥有熟悉的类似Java的语法，而没有太多的样板代码。您还可以引导新项目或为其编写自己的命令。</p>
<h2 id="66-安装CLI"><a href="#66-安装CLI" class="headerlink" title="66.安装CLI"></a>66.安装CLI</h2><p>可以使用SDKMAN手动安装Spring Boot CLI（命令行界面）！（SDK Manager）或使用Homebrew或MacPorts（如果您是OSX用户）。有关全面的安装说明*<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#getting-started-installing-the-cli">，</a><em>请参见 “入门”一</em><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#getting-started-installing-the-cli">节中的第10.2节“安装Spring Boot CLI”</a>*。</p>
<h2 id="67-使用CLI"><a href="#67-使用CLI" class="headerlink" title="67.使用CLI"></a>67.使用CLI</h2><p>安装CLI后，可以通过键入<code>spring</code>并在命令行按Enter键来运行它。如果在没有任何参数的情况下运行<code>spring</code>，将显示一个简单的帮助屏幕，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ spring</span><br><span class="line">usage: spring [--help] [--version]</span><br><span class="line">       &lt;command&gt; [&lt;args&gt;]</span><br><span class="line"></span><br><span class="line">Available commands are:</span><br><span class="line"></span><br><span class="line">  run [options] &lt;files&gt; [--] [args]</span><br><span class="line">    Run a spring groovy script</span><br><span class="line"></span><br><span class="line">  ... more command help is shown here</span><br></pre></td></tr></table></figure>

<p>您可以键入<code>spring help</code>以获取有关任何支持的命令的更多详细信息，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ spring help run</span><br><span class="line">spring run - Run a spring groovy script</span><br><span class="line"></span><br><span class="line">usage: spring run [options] &lt;files&gt; [--] [args]</span><br><span class="line"></span><br><span class="line">Option                     Description</span><br><span class="line">------                     -----------</span><br><span class="line">--autoconfigure [Boolean]  Add autoconfigure compiler</span><br><span class="line">                             transformations (default: true)</span><br><span class="line">--classpath, -cp           Additional classpath entries</span><br><span class="line">-e, --edit                 Open the file with the default system</span><br><span class="line">                             editor</span><br><span class="line">--no-guess-dependencies    Do not attempt to guess dependencies</span><br><span class="line">--no-guess-imports         Do not attempt to guess imports</span><br><span class="line">-q, --quiet                Quiet logging</span><br><span class="line">-v, --verbose              Verbose logging of dependency</span><br><span class="line">                             resolution</span><br><span class="line">--watch                    Watch the specified file for changes</span><br></pre></td></tr></table></figure>

<p><code>version</code>命令提供了一种快速检查您正在使用的Spring Boot版本的方法，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ spring version</span><br><span class="line">Spring CLI v2.1.1.RELEASE</span><br></pre></td></tr></table></figure>

<h2 id="67-1使用CLI运行应用程序"><a href="#67-1使用CLI运行应用程序" class="headerlink" title="67.1使用CLI运行应用程序"></a>67.1使用CLI运行应用程序</h2><p>您可以使用<code>run</code>命令编译和运行Groovy源代码。Spring Boot CLI是完全独立的，因此您不需要任何外部Groovy安装。</p>
<p>以下示例显示了使用Groovy编写的“hello world”Web应用程序：</p>
<p><strong>hello.groovy。</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">class WebApplication &#123;</span><br><span class="line"></span><br><span class="line">	@RequestMapping(&quot;&#x2F;&quot;)</span><br><span class="line">	String home() &#123;</span><br><span class="line">		&quot;Hello World!&quot;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>要编译并运行该应用程序，请键入以下命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ spring run hello.groovy</span><br></pre></td></tr></table></figure>

<p>要将命令行参数传递给应用程序，请使用<code>--</code>将命令与“spring”命令参数分开，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ spring run hello.groovy -- --server.port&#x3D;9000</span><br></pre></td></tr></table></figure>

<p>要设置JVM命令行参数，可以使用<code>JAVA_OPTS</code>环境变量，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ JAVA_OPTS&#x3D;-Xmx1024m spring run hello.groovy</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>在Microsoft Windows上设置<code>JAVA_OPTS</code>时，请确保引用整个指令，例如<code>set &quot;JAVA_OPTS=-Xms256m -Xmx2048m&quot;</code>。这样做可确保将值正确传递给流程。</td>
</tr>
</tbody></table>
<h3 id="67-1-1扣除“抓住”依赖关系"><a href="#67-1-1扣除“抓住”依赖关系" class="headerlink" title="67.1.1扣除“抓住”依赖关系"></a>67.1.1扣除“抓住”依赖关系</h3><p>标准Groovy包含一个<code>@Grab</code>注释，它允许您声明对第三方库的依赖性。这个有用的技术让Groovy以与Maven或Gradle相同的方式下载jar，但不需要你使用构建工具。</p>
<p>Spring Boot进一步扩展了这种技术，并尝试根据您的代码推断出“抓取”哪些库。例如，由于前面显示的<code>WebApplication</code>代码使用<code>@RestController</code>注释，Spring Boot获取“Tomcat”和“Spring MVC”。</p>
<p>以下项目用作“抓取提示”：</p>
<table>
<thead>
<tr>
<th>项目</th>
<th>抓斗</th>
</tr>
</thead>
<tbody><tr>
<td><code>JdbcTemplate</code>, <code>NamedParameterJdbcTemplate</code>, <code>DataSource</code></td>
<td>JDBC Application.</td>
</tr>
<tr>
<td><code>@EnableJms</code></td>
<td>JMS Application.</td>
</tr>
<tr>
<td><code>@EnableCaching</code></td>
<td>Caching abstraction.</td>
</tr>
<tr>
<td><code>@Test</code></td>
<td>JUnit.</td>
</tr>
<tr>
<td><code>@EnableRabbit</code></td>
<td>RabbitMQ.</td>
</tr>
<tr>
<td>extends <code>Specification</code></td>
<td>Spock test.</td>
</tr>
<tr>
<td><code>@EnableBatchProcessing</code></td>
<td>Spring Batch.</td>
</tr>
<tr>
<td><code>@MessageEndpoint</code> <code>@EnableIntegration</code></td>
<td>Spring Integration.</td>
</tr>
<tr>
<td><code>@Controller</code> <code>@RestController</code> <code>@EnableWebMvc</code></td>
<td>Spring MVC + Embedded Tomcat.</td>
</tr>
<tr>
<td><code>@EnableWebSecurity</code></td>
<td>Spring Security.</td>
</tr>
<tr>
<td><code>@EnableTransactionManagement</code></td>
<td>Spring Transaction Management.</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>请参阅<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-cli/src/main/java/org/springframework/boot/cli/compiler/CompilerAutoConfiguration.java"><code>CompilerAutoConfiguration</code></a> Spring Boot CLI源代码中的子类， 以准确了解自定义的应用方式。</td>
</tr>
</tbody></table>
<h3 id="67-1-2扣除“抓住”坐标"><a href="#67-1-2扣除“抓住”坐标" class="headerlink" title="67.1.2扣除“抓住”坐标"></a>67.1.2扣除“抓住”坐标</h3><p>Spring Boot通过允许您指定没有组或版本的依赖项（例如，<code>@Grab(&#39;freemarker&#39;)</code>）来扩展Groovy的标准<code>@Grab</code>支持。这样做可以参考Spring Boot的默认依赖关系元数据来推断工件的组和版本。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>默认元数据与您使用的CLI版本相关联。只有当您移动到新版本的CLI时，它才会更改，让您可以控制依赖项版本何时更改。可以在<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#appendix-dependency-versions">附录中</a>找到显示默认元数据中包含的依赖关系及其版本的表。</td>
</tr>
</tbody></table>
<h3 id="67-1-3默认导入语句"><a href="#67-1-3默认导入语句" class="headerlink" title="67.1.3默认导入语句"></a>67.1.3默认导入语句</h3><p>为了帮助减小Groovy代码的大小，自动包含多个<code>import</code>语句。请注意前面的示例如何引用<code>@Component</code>，<code>@RestController</code>和<code>@RequestMapping</code>，而无需使用完全限定名称或<code>import</code>语句。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>许多Spring注释在不使用<code>import</code>语句的情况下工作。尝试运行应用程序以在添加导入之前查看失败的内容。</td>
</tr>
</tbody></table>
<h3 id="67-1-4自动主方法"><a href="#67-1-4自动主方法" class="headerlink" title="67.1.4自动主方法"></a>67.1.4自动主方法</h3><p>与等效的Java应用程序不同，您不需要在<code>Groovy</code>脚本中包含<code>public static void main(String[] args)</code>方法。自动创建<code>SpringApplication</code>，编译的代码充当<code>source</code>。</p>
<h3 id="67-1-5自定义依赖关系管理"><a href="#67-1-5自定义依赖关系管理" class="headerlink" title="67.1.5自定义依赖关系管理"></a>67.1.5自定义依赖关系管理</h3><p>默认情况下，CLI在解析<code>@Grab</code>依赖项时使用<code>spring-boot-dependencies</code>中声明的依赖关系管理。可以使用<code>@DependencyManagementBom</code>注释配置覆盖默认依赖关系管理的其他依赖关系管理。注释的值应指定一个或多个Maven BOM的坐标（<code>groupId:artifactId:version</code>）。</p>
<p>例如，请考虑以下声明：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@DependencyManagementBom(&quot;com.example.custom-bom:1.0.0&quot;)</span><br></pre></td></tr></table></figure>

<p>前面的声明在<code>com/example/custom-versions/1.0.0/</code>下的Maven存储库中获取<code>custom-bom-1.0.0.pom</code>。</p>
<p>指定多个BOM时，它们将按您声明的顺序应用，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@DependencyManagementBom([&quot;com.example.custom-bom:1.0.0&quot;,</span><br><span class="line">		&quot;com.example.another-bom:1.0.0&quot;])</span><br></pre></td></tr></table></figure>

<p>上面的示例表明<code>another-bom</code>中的依赖关系管理会覆盖<code>custom-bom</code>中的依赖关系管理。</p>
<p>您可以在任何可以使用<code>@Grab</code>的地方使用<code>@DependencyManagementBom</code>。但是，为了确保依赖关系管理的一致排序，您最多可以在应用程序中使用<code>@DependencyManagementBom</code>。一个有用的依赖关系管理源（它是Spring Boot的依赖关系管理的超集）是 <a target="_blank" rel="noopener" href="https://platform.spring.io/">Spring IO平台</a>，您可以在其中包含以下行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@DependencyManagementBom(&#39;io.spring.platform:platform-bom:1.1.2.RELEASE&#39;)</span><br></pre></td></tr></table></figure>

<h2 id="67-2具有多个源文件的应用程序"><a href="#67-2具有多个源文件的应用程序" class="headerlink" title="67.2具有多个源文件的应用程序"></a>67.2具有多个源文件的应用程序</h2><p>您可以对所有接受文件输入的命令使用“shell globbing”。这样做可以让您使用单个目录中的多个文件，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ spring run *.groovy</span><br></pre></td></tr></table></figure>

<h2 id="67-3打包您的应用程序"><a href="#67-3打包您的应用程序" class="headerlink" title="67.3打包您的应用程序"></a>67.3打包您的应用程序</h2><p>您可以使用<code>jar</code>命令将应用程序打包到一个自包含的可执行jar文件中，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ spring jar my-app.jar *.groovy</span><br></pre></td></tr></table></figure>

<p>生成的jar包含通过编译应用程序和所有应用程序的依赖项生成的类，以便可以使用<code>java -jar</code>运行它。jar文件还包含应用程序类路径中的条目。您可以使用<code>--include</code>和<code>--exclude</code>添加和删除jar的显式路径。两者都以逗号分隔，并且都以“+”和“ - ”的形式接受前缀，以表示它们应该从默认值中删除。默认包括如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public&#x2F;**, resources&#x2F;**, static&#x2F;**, templates&#x2F;**, META-INF&#x2F;**, *</span><br></pre></td></tr></table></figure>

<p>默认排除如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.*, repository&#x2F;**, build&#x2F;**, target&#x2F;**, **&#x2F;*.jar, **&#x2F;*.groovy</span><br></pre></td></tr></table></figure>

<p>在命令行上键入<code>spring help jar</code>以获取更多信息。</p>
<h2 id="67-4初始化新项目"><a href="#67-4初始化新项目" class="headerlink" title="67.4初始化新项目"></a>67.4初始化新项目</h2><p><code>init</code>命令允许您在不离开shell的情况下使用<a target="_blank" rel="noopener" href="https://start.spring.io/">start.spring.io</a>创建新项目，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ spring init --dependencies&#x3D;web,data-jpa my-project</span><br><span class="line">Using service at https:&#x2F;&#x2F;start.spring.io</span><br><span class="line">Project extracted to &#39;&#x2F;Users&#x2F;developer&#x2F;example&#x2F;my-project&#39;</span><br></pre></td></tr></table></figure>

<p>上面的示例创建了一个<code>my-project</code>目录，其中包含基于Maven的项目，该项目使用<code>spring-boot-starter-web</code>和<code>spring-boot-starter-data-jpa</code>。您可以使用<code>--list</code>标志列出服务的功能，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ spring init --list</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Capabilities of https:&#x2F;&#x2F;start.spring.io</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">Available dependencies:</span><br><span class="line">-----------------------</span><br><span class="line">actuator - Actuator: Production ready features to help you monitor and manage your application</span><br><span class="line">...</span><br><span class="line">web - Web: Support for full-stack web development, including Tomcat and spring-webmvc</span><br><span class="line">websocket - Websocket: Support for WebSocket development</span><br><span class="line">ws - WS: Support for Spring Web Services</span><br><span class="line"></span><br><span class="line">Available project types:</span><br><span class="line">------------------------</span><br><span class="line">gradle-build -  Gradle Config [format:build, build:gradle]</span><br><span class="line">gradle-project -  Gradle Project [format:project, build:gradle]</span><br><span class="line">maven-build -  Maven POM [format:build, build:maven]</span><br><span class="line">maven-project -  Maven Project [format:project, build:maven] (default)</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p><code>init</code>命令支持许多选项。有关详细信息，请参阅<code>help</code>输出。例如，以下命令创建一个使用Java 8和<code>war</code>打包的Gradle项目：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ spring init --build&#x3D;gradle --java-version&#x3D;1.8 --dependencies&#x3D;websocket --packaging&#x3D;war sample-app.zip</span><br><span class="line">Using service at https:&#x2F;&#x2F;start.spring.io</span><br><span class="line">Content saved to &#39;sample-app.zip&#39;</span><br></pre></td></tr></table></figure>

<h2 id="67-5使用嵌入式Shell"><a href="#67-5使用嵌入式Shell" class="headerlink" title="67.5使用嵌入式Shell"></a>67.5使用嵌入式Shell</h2><p>Spring Boot包括BASH和zsh shell的命令行完成脚本。如果您不使用这些shell中的任何一个（可能是Windows用户），则可以使用<code>shell</code>命令启动集成shell，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ spring shell</span><br><span class="line">Spring Boot (v2.1.1.RELEASE)</span><br><span class="line">Hit TAB to complete. Type \&#39;help&#39; and hit RETURN for help, and \&#39;exit&#39; to quit.</span><br></pre></td></tr></table></figure>

<p>在嵌入式shell中，您可以直接运行其他命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ version</span><br><span class="line">Spring CLI v2.1.1.RELEASE</span><br></pre></td></tr></table></figure>

<p>嵌入式shell支持ANSI颜色输出以及<code>tab</code>完成。如果需要运行本机命令，可以使用<code>!</code>前缀。要退出嵌入式shell，请按<code>ctrl-c</code>。</p>
<h2 id="67-6在CLI中添加扩展"><a href="#67-6在CLI中添加扩展" class="headerlink" title="67.6在CLI中添加扩展"></a>67.6在CLI中添加扩展</h2><p>您可以使用<code>install</code>命令向CLI添加扩展。该命令采用<code>group:artifact:version</code>格式的一组或多组工件坐标，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ spring install com.example:spring-boot-cli-extension:1.0.0.RELEASE</span><br></pre></td></tr></table></figure>

<p>除了安装由您提供的坐标标识的工件外，还会安装所有工件的依赖项。</p>
<p>要卸载依赖项，请使用<code>uninstall</code>命令。与<code>install</code>命令一样，它采用<code>group:artifact:version</code>格式的一组或多组工件坐标，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ spring uninstall com.example:spring-boot-cli-extension:1.0.0.RELEASE</span><br></pre></td></tr></table></figure>

<p>它会卸载由您提供的坐标及其依赖项标识的工件。</p>
<p>要卸载所有其他依赖项，可以使用<code>--all</code>选项，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ spring uninstall --all</span><br></pre></td></tr></table></figure>

<h2 id="68-使用Groovy-Beans-DSL开发应用程序"><a href="#68-使用Groovy-Beans-DSL开发应用程序" class="headerlink" title="68.使用Groovy Beans DSL开发应用程序"></a>68.使用Groovy Beans DSL开发应用程序</h2><p>Spring Framework 4.0本身支持<code>beans&#123;&#125;</code>“DSL”（从<a target="_blank" rel="noopener" href="http://grails.org/">Grails</a>借用 ），您可以使用相同的格式在您的Groovy应用程序脚本中嵌入bean定义。这有时是包含中间件声明等外部功能的好方法，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">class Application implements CommandLineRunner &#123;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	SharedService service</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	void run(String... args) &#123;</span><br><span class="line">		println service.message</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">import my.company.SharedService</span><br><span class="line"></span><br><span class="line">beans &#123;</span><br><span class="line">	service(SharedService) &#123;</span><br><span class="line">		message &#x3D; &quot;Hello World&quot;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>您可以将类声明与<code>beans&#123;&#125;</code>混合在同一个文件中，只要它们保持在顶层，或者，如果您愿意，可以将beans DSL放在单独的文件中。</p>
<h2 id="69-使用settings-xml配置CLI"><a href="#69-使用settings-xml配置CLI" class="headerlink" title="69.使用settings.xml配置CLI"></a>69.使用<code>settings.xml</code>配置CLI</h2><p>Spring Boot CLI使用Aether，Maven的依赖性解析引擎来解析依赖关系。CLI使用<code>~/.m2/settings.xml</code>中的Maven配置来配置Aether。CLI支持以下配置设置：</p>
<ul>
<li>离线</li>
<li>镜子</li>
<li>服务器</li>
<li>代理</li>
<li>简介<ul>
<li>激活</li>
<li>库</li>
</ul>
</li>
<li>活动档案</li>
</ul>
<p>有关详细信息，请参阅<a target="_blank" rel="noopener" href="https://maven.apache.org/settings.html">Maven的设置文档</a>。</p>
<h2 id="70-接下来要阅读的内容"><a href="#70-接下来要阅读的内容" class="headerlink" title="70.接下来要阅读的内容"></a>70.接下来要阅读的内容</h2><p>GitHub存储库中提供了一些<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-cli/samples">示例groovy脚本</a>，您可以使用它们来尝试Spring Boot CLI。整个<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-cli/src/main/java/org/springframework/boot/cli">源代码中</a>还有广泛的Javadoc 。</p>
<p>如果您发现自己达到了CLI工具的限制，那么您可能希望将应用程序转换为完整的Gradle或Maven构建的“Groovy项目”。下一节将介绍Spring Boot的“ <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#build-tool-plugins">构建工具插件</a> ”，您可以将其与Gradle或Maven一起使用。</p>
<h1 id="第八部分。构建工具插件"><a href="#第八部分。构建工具插件" class="headerlink" title="第八部分。构建工具插件"></a>第八部分。构建工具插件</h1><p>Spring Boot为Maven和Gradle提供构建工具插件。这些插件提供了各种功能，包括可执行jar的包装。本节提供了有关这两个插件的更多详细信息，以及在需要扩展不受支持的构建系统时的一些帮助。如果您刚刚开始，可能需要先阅读“ <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-build-systems">第</a><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot">III部分</a> ”中的“ <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-build-systems">第13章，</a><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-build-systems"><em>构建系统</em></a> ”，然后再<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot">使用Spring Boot“</a> ”部分。</p>
<h2 id="71-Spring-Boot-Maven插件"><a href="#71-Spring-Boot-Maven插件" class="headerlink" title="71. Spring Boot Maven插件"></a>71. Spring Boot Maven插件</h2><p>该<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/maven-plugin">Spring Boot Maven插件</a>提供了Maven，让你打包可执行的JAR或战争档案和运行“就地”的应用程序Spring Boot支持。要使用它，您必须使用Maven 3.2（或更高版本）。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>有关完整的插件文档，请参阅<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/maven-plugin">Spring Boot Maven插件站点</a>。</td>
</tr>
</tbody></table>
<h2 id="71-1包括插件"><a href="#71-1包括插件" class="headerlink" title="71.1包括插件"></a>71.1包括插件</h2><p>要使用Spring Boot Maven插件，请在<code>pom.xml</code>的<code>plugins</code>部分中包含相应的XML，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot; xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">	xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">	&lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">	&lt;!-- ... --&gt;</span><br><span class="line">	&lt;build&gt;</span><br><span class="line">		&lt;plugins&gt;</span><br><span class="line">			&lt;plugin&gt;</span><br><span class="line">				&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">				&lt;artifactId&gt;spring-boot-maven-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">				&lt;version&gt;2.1.1.RELEASE&lt;&#x2F;version&gt;</span><br><span class="line">				&lt;executions&gt;</span><br><span class="line">					&lt;execution&gt;</span><br><span class="line">						&lt;goals&gt;</span><br><span class="line">							&lt;goal&gt;repackage&lt;&#x2F;goal&gt;</span><br><span class="line">						&lt;&#x2F;goals&gt;</span><br><span class="line">					&lt;&#x2F;execution&gt;</span><br><span class="line">				&lt;&#x2F;executions&gt;</span><br><span class="line">			&lt;&#x2F;plugin&gt;</span><br><span class="line">		&lt;&#x2F;plugins&gt;</span><br><span class="line">	&lt;&#x2F;build&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<p>上述配置重新打包在Maven生命周期的<code>package</code>阶段构建的jar或war。以下示例显示了重新打包的jar以及<code>target</code>目录中的原始jar：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ mvn package</span><br><span class="line">$ ls target&#x2F;*.jar</span><br><span class="line">target&#x2F;myproject-1.0.0.jar target&#x2F;myproject-1.0.0.jar.original</span><br></pre></td></tr></table></figure>

<p>如果您不包含<code>&lt;execution/&gt;</code>配置，如前面的示例所示，您可以单独运行插件（但仅在使用包目标时），如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ mvn package spring-boot:repackage</span><br><span class="line">$ ls target&#x2F;*.jar</span><br><span class="line">target&#x2F;myproject-1.0.0.jar target&#x2F;myproject-1.0.0.jar.original</span><br></pre></td></tr></table></figure>

<p>如果您使用里程碑或快照版本，则还需要添加相应的<code>pluginRepository</code>元素，如下面的清单所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;pluginRepositories&gt;</span><br><span class="line">	&lt;pluginRepository&gt;</span><br><span class="line">		&lt;id&gt;spring-snapshots&lt;&#x2F;id&gt;</span><br><span class="line">		&lt;url&gt;https:&#x2F;&#x2F;repo.spring.io&#x2F;snapshot&lt;&#x2F;url&gt;</span><br><span class="line">	&lt;&#x2F;pluginRepository&gt;</span><br><span class="line">	&lt;pluginRepository&gt;</span><br><span class="line">		&lt;id&gt;spring-milestones&lt;&#x2F;id&gt;</span><br><span class="line">		&lt;url&gt;https:&#x2F;&#x2F;repo.spring.io&#x2F;milestone&lt;&#x2F;url&gt;</span><br><span class="line">	&lt;&#x2F;pluginRepository&gt;</span><br><span class="line">&lt;&#x2F;pluginRepositories&gt;</span><br></pre></td></tr></table></figure>

<h2 id="71-2打包可执行文件夹和War文件"><a href="#71-2打包可执行文件夹和War文件" class="headerlink" title="71.2打包可执行文件夹和War文件"></a>71.2打包可执行文件夹和War文件</h2><p>一旦<code>pom.xml</code>中包含<code>spring-boot-maven-plugin</code>，它就会自动尝试使用<code>spring-boot:repackage</code>目标重写存档以使其可执行。您应该使用通常的<code>packaging</code>元素将项目配置为构建jar或war（视情况而定），如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot; xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">	xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">	&lt;!-- ... --&gt;</span><br><span class="line">	&lt;packaging&gt;jar&lt;&#x2F;packaging&gt;</span><br><span class="line">	&lt;!-- ... --&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<p>在<code>package</code>阶段，Spring Boot增强了您现有的存档。您可以通过使用配置选项或通过以常规方式向清单添加<code>Main-Class</code>属性来指定要启动的主类。如果未指定主类，则插件将使用<code>public static void main(String[] args)</code>方法搜索类。</p>
<p>要构建和运行项目工件，可以键入以下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ mvn package</span><br><span class="line">$ java -jar target&#x2F;mymodule-0.0.1-SNAPSHOT.jar</span><br></pre></td></tr></table></figure>

<p>要构建可执行且可部署到外部容器的war文件，需要将嵌入式容器依赖项标记为“已提供”，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot; xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">	xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">	&lt;!-- ... --&gt;</span><br><span class="line">	&lt;packaging&gt;war&lt;&#x2F;packaging&gt;</span><br><span class="line">	&lt;!-- ... --&gt;</span><br><span class="line">	&lt;dependencies&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-boot-starter-web&lt;&#x2F;artifactId&gt;</span><br><span class="line">		&lt;&#x2F;dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-boot-starter-tomcat&lt;&#x2F;artifactId&gt;</span><br><span class="line">			&lt;scope&gt;provided&lt;&#x2F;scope&gt;</span><br><span class="line">		&lt;&#x2F;dependency&gt;</span><br><span class="line">		&lt;!-- ... --&gt;</span><br><span class="line">	&lt;&#x2F;dependencies&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>有关如何创建可部署的war文件的更多详细信息，请参阅“ <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#howto-create-a-deployable-war-file">第92.1节</a> ” <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#howto-create-a-deployable-war-file">，“创建可部署的War文件</a> ”部分。</td>
</tr>
</tbody></table>
<p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/maven-plugin">插件信息页面</a>中提供了高级配置选项和示例 。</p>
<h2 id="72-Spring-Boot-Gradle插件"><a href="#72-Spring-Boot-Gradle插件" class="headerlink" title="72. Spring Boot Gradle插件"></a>72. Spring Boot Gradle插件</h2><p>Spring Boot Gradle插件在Gradle中提供Spring Boot支持，允许您打包可执行jar或war档案，运行Spring Boot应用程序，并使用<code>spring-boot-dependencies</code>提供的依赖关系管理。它需要Gradle 4.4或更高版本。请参阅插件的文档以了解更多信息：</p>
<ul>
<li>参考（<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/gradle-plugin/reference/html">HTML</a>和 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/gradle-plugin/reference/pdf/spring-boot-gradle-plugin-reference.pdf">PDF</a>）</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/gradle-plugin/api">API</a></li>
</ul>
<h2 id="73-Spring-Boot-AntLib模块"><a href="#73-Spring-Boot-AntLib模块" class="headerlink" title="73. Spring Boot AntLib模块"></a>73. Spring Boot AntLib模块</h2><p>Spring Boot AntLib模块为Apache Ant提供基本的Spring Boot支持。您可以使用该模块创建可执行jar。要使用该模块，您需要在<code>build.xml</code>中声明一个额外的<code>spring-boot</code>命名空间，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;project xmlns:ivy&#x3D;&quot;antlib:org.apache.ivy.ant&quot;</span><br><span class="line">	xmlns:spring-boot&#x3D;&quot;antlib:org.springframework.boot.ant&quot;</span><br><span class="line">	name&#x3D;&quot;myapp&quot; default&#x3D;&quot;build&quot;&gt;</span><br><span class="line">	...</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<p>您需要记住使用<code>-lib</code>选项启动Ant，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ant -lib &lt;folder containing spring-boot-antlib-2.1.1.RELEASE.jar&gt;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>“使用Spring Boot”部分包含<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-ant">使用Apache Ant和<code>spring-boot-antlib</code></a>的更完整示例 。</td>
</tr>
</tbody></table>
<h2 id="73-1-Spring-Boot-Ant任务"><a href="#73-1-Spring-Boot-Ant任务" class="headerlink" title="73.1 Spring Boot Ant任务"></a>73.1 Spring Boot Ant任务</h2><p>声明<code>spring-boot-antlib</code>命名空间后，可以使用以下附加任务：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#spring-boot-ant-exejar">第73.1.1节，“<code>spring-boot:exejar</code>”</a></li>
<li><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#spring-boot-ant-findmainclass">第73.2节，“<code>spring-boot:findmainclass</code>”</a></li>
</ul>
<h3 id="73-1-1-spring-boot-exejar"><a href="#73-1-1-spring-boot-exejar" class="headerlink" title="73.1.1 spring-boot:exejar"></a>73.1.1 <code>spring-boot:exejar</code></h3><p>您可以使用<code>exejar</code>任务创建一个Spring Boot可执行jar。任务支持以下属性：</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>描述</th>
<th>需要</th>
</tr>
</thead>
<tbody><tr>
<td><code>destfile</code></td>
<td>要创建的目标jar文件</td>
<td>Yes</td>
</tr>
<tr>
<td><code>classes</code></td>
<td>Java类文件的根目录</td>
<td>Yes</td>
</tr>
<tr>
<td><code>start-class</code></td>
<td>要运行的主要应用程序类</td>
<td>No <em>(the default is the first class found that declares a <code>main</code> method)</em></td>
</tr>
</tbody></table>
<p>以下嵌套元素可与任务一起使用：</p>
<table>
<thead>
<tr>
<th>元件</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>resources</code></td>
<td>一个或多个<a target="_blank" rel="noopener" href="https://ant.apache.org/manual/Types/resources.html#collection">资源集合，</a>描述应添加到创建的jar文件内容中的一组<a target="_blank" rel="noopener" href="https://ant.apache.org/manual/Types/resources.html">资源</a>。</td>
</tr>
<tr>
<td><code>lib</code></td>
<td>应该添加到构成应用程序的运行时依赖性类路径的jar库集的一个或多个<a target="_blank" rel="noopener" href="https://ant.apache.org/manual/Types/resources.html#collection">资源集合</a>。</td>
</tr>
</tbody></table>
<h3 id="73-1-2例子"><a href="#73-1-2例子" class="headerlink" title="73.1.2例子"></a>73.1.2例子</h3><p>本节显示了Ant任务的两个示例。</p>
<p><strong>指定start-class。</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;spring-boot:exejar destfile&#x3D;&quot;target&#x2F;my-application.jar&quot;</span><br><span class="line">		classes&#x3D;&quot;target&#x2F;classes&quot; start-class&#x3D;&quot;com.example.MyApplication&quot;&gt;</span><br><span class="line">	&lt;resources&gt;</span><br><span class="line">		&lt;fileset dir&#x3D;&quot;src&#x2F;main&#x2F;resources&quot; &#x2F;&gt;</span><br><span class="line">	&lt;&#x2F;resources&gt;</span><br><span class="line">	&lt;lib&gt;</span><br><span class="line">		&lt;fileset dir&#x3D;&quot;lib&quot; &#x2F;&gt;</span><br><span class="line">	&lt;&#x2F;lib&gt;</span><br><span class="line">&lt;&#x2F;spring-boot:exejar&gt;</span><br></pre></td></tr></table></figure>



<p><strong>检测开始级别。</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;exejar destfile&#x3D;&quot;target&#x2F;my-application.jar&quot; classes&#x3D;&quot;target&#x2F;classes&quot;&gt;</span><br><span class="line">	&lt;lib&gt;</span><br><span class="line">		&lt;fileset dir&#x3D;&quot;lib&quot; &#x2F;&gt;</span><br><span class="line">	&lt;&#x2F;lib&gt;</span><br><span class="line">&lt;&#x2F;exejar&gt;</span><br></pre></td></tr></table></figure>



<h2 id="73-2-spring-boot-findmainclass"><a href="#73-2-spring-boot-findmainclass" class="headerlink" title="73.2 spring-boot:findmainclass"></a>73.2 <code>spring-boot:findmainclass</code></h2><p><code>exejar</code>内部使用<code>findmainclass</code>任务来查找声明<code>main</code>的类。如有必要，您还可以直接在构建中使用此任务。支持以下属性：</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>描述</th>
<th>需要</th>
</tr>
</thead>
<tbody><tr>
<td><code>classesroot</code></td>
<td>Java类文件的根目录</td>
<td>Yes <em>(unless <code>mainclass</code> is specified)</em></td>
</tr>
<tr>
<td><code>mainclass</code></td>
<td>可用于短路<code>main</code>类搜索</td>
<td>No</td>
</tr>
<tr>
<td><code>property</code></td>
<td>应该使用结果设置的Ant属性</td>
<td>No <em>(result will be logged if unspecified)</em></td>
</tr>
</tbody></table>
<h3 id="73-2-1例子"><a href="#73-2-1例子" class="headerlink" title="73.2.1例子"></a>73.2.1例子</h3><p>本节包含使用<code>findmainclass</code>的三个示例。</p>
<p><strong>查找并记录。</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;findmainclass classesroot&#x3D;&quot;target&#x2F;classes&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure>



<p><strong>查找并设置。</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;findmainclass classesroot&#x3D;&quot;target&#x2F;classes&quot; property&#x3D;&quot;main-class&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure>



<p><strong>覆盖并设置。</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;findmainclass mainclass&#x3D;&quot;com.example.MainClass&quot; property&#x3D;&quot;main-class&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure>



<h2 id="74-支持其他构建系统"><a href="#74-支持其他构建系统" class="headerlink" title="74.支持其他构建系统"></a>74.支持其他构建系统</h2><p>如果您想使用Maven，Gradle或Ant以外的构建工具，则可能需要开发自己的插件。可执行jar需要遵循特定的格式，并且某些条目需要以未压缩的形式编写（有关详细信息，请参阅附录中的“ <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#executable-jar">可执行jar格式</a> ”部分）。</p>
<p>Spring Boot Maven和Gradle插件都使用<code>spring-boot-loader-tools</code>来实际生成jar。如果需要，您可以直接使用此库。</p>
<h2 id="74-1重新包装档案"><a href="#74-1重新包装档案" class="headerlink" title="74.1重新包装档案"></a>74.1重新包装档案</h2><p>要重新打包现有存档以使其成为自包含的可执行存档，请使用<code>org.springframework.boot.loader.tools.Repackager</code>。<code>Repackager</code>类采用一个构造函数参数，该参数引用现有的jar或war存档。使用两种可用的<code>repackage()</code>方法之一替换原始文件或写入新目标。在重新打包程序运行之前，还可以配置各种设置。</p>
<h2 id="74-2嵌套库"><a href="#74-2嵌套库" class="headerlink" title="74.2嵌套库"></a>74.2嵌套库</h2><p>重新打包存档时，可以使用<code>org.springframework.boot.loader.tools.Libraries</code>接口包含对依赖项文件的引用。我们在这里没有提供<code>Libraries</code>的任何具体实现，因为它们通常是特定于构建系统的。</p>
<p>如果您的存档已包含库，则可以使用<code>Libraries.NONE</code>。</p>
<h2 id="74-3寻找主要类别"><a href="#74-3寻找主要类别" class="headerlink" title="74.3寻找主要类别"></a>74.3寻找主要类别</h2><p>如果不使用<code>Repackager.setMainClass()</code>指定主类，则重新打包程序使用<a target="_blank" rel="noopener" href="http://asm.ow2.org/">ASM</a>读取类文件并尝试使用<code>public static void main(String[] args)</code>方法查找合适的类。如果找到多个候选项，则抛出异常。</p>
<h2 id="74-4重新包装实施示例"><a href="#74-4重新包装实施示例" class="headerlink" title="74.4重新包装实施示例"></a>74.4重新包装实施示例</h2><p>以下示例显示了典型的重新打包实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Repackager repackager &#x3D; new Repackager(sourceJarFile);</span><br><span class="line">repackager.setBackupSource(false);</span><br><span class="line">repackager.repackage(new Libraries() &#123;</span><br><span class="line">			@Override</span><br><span class="line">			public void doWithLibraries(LibraryCallback callback) throws IOException &#123;</span><br><span class="line">				&#x2F;&#x2F; Build system specific implementation, callback for each dependency</span><br><span class="line">				&#x2F;&#x2F; callback.library(new Library(nestedFile, LibraryScope.COMPILE));</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="75-接下来要阅读的内容"><a href="#75-接下来要阅读的内容" class="headerlink" title="75.接下来要阅读的内容"></a>75.接下来要阅读的内容</h2><p>如果您对构建工具插件的工作方式感兴趣，可以<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-tools"><code>spring-boot-tools</code></a> 在GitHub上查看该模块。<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#executable-jar">附录</a>中介绍了可执行jar格式的更多技术细节 。</p>
<p>如果您有与构建相关的特定问题，可以查看“操作<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#howto">方法</a> ”指南。</p>
<h1 id="第九部分。’如何’指南"><a href="#第九部分。’如何’指南" class="headerlink" title="第九部分。’如何’指南"></a>第九部分。’如何’指南</h1><p>本节提供了使用Spring Boot时经常出现的一些常见’我该怎么做……’的问题的答案。它的报道并不详尽，但确实涵盖了很多。</p>
<p>如果您遇到我们未在此处讨论的特定问题，您可能需要查看 <a target="_blank" rel="noopener" href="https://stackoverflow.com/tags/spring-boot">stackoverflow.com</a>以查看是否有人已提供答案。这也是提出新问题的好地方（请使用<code>spring-boot</code>标签）。</p>
<p>我们也非常乐意扩展这一部分。如果您想添加“操作方法”，请向我们发送<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE">拉取请求</a>。</p>
<h2 id="76-Spring-Boot申请"><a href="#76-Spring-Boot申请" class="headerlink" title="76. Spring Boot申请"></a>76. Spring Boot申请</h2><p>本节包括与Spring Boot应用程序直接相关的主题。</p>
<h2 id="76-1创建自己的失败分析器"><a href="#76-1创建自己的失败分析器" class="headerlink" title="76.1创建自己的失败分析器"></a>76.1创建自己的失败分析器</h2><p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/diagnostics/FailureAnalyzer.html"><code>FailureAnalyzer</code></a>是一种在启动时拦截异常并将其转换为人类可读消息的好方法，包含在<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/diagnostics/FailureAnalysis.html"><code>FailureAnalysis</code></a>。Spring Boot为应用程序上下文相关异常，JSR-303验证等提供了这样的分析器。您也可以创建自己的。</p>
<p><code>AbstractFailureAnalyzer</code>是<code>FailureAnalyzer</code>的方便扩展，用于检查要处理的异常中是否存在指定的异常类型。您可以从中进行扩展，以便您的实现只有在实际存在时才有机会处理异常。如果由于某种原因，您无法处理异常，请返回<code>null</code>以使另一个实现有机会处理异常。</p>
<p><code>FailureAnalyzer</code>实施必须在<code>META-INF/spring.factories</code>中注册。以下示例注册<code>ProjectConstraintViolationFailureAnalyzer</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.boot.diagnostics.FailureAnalyzer&#x3D;\</span><br><span class="line">com.example.ProjectConstraintViolationFailureAnalyzer</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果您需要访问<code>BeanFactory</code>或<code>Environment</code>，则您的<code>FailureAnalyzer</code>可以分别实现<code>BeanFactoryAware</code>或<code>EnvironmentAware</code>。</td>
</tr>
</tbody></table>
<h2 id="76-2自动配置故障排除"><a href="#76-2自动配置故障排除" class="headerlink" title="76.2自动配置故障排除"></a>76.2自动配置故障排除</h2><p>Spring Boot自动配置尽力“做正确的事”，但有时事情会失败，而且很难说清楚原因。</p>
<p>任何Spring Boot <code>ApplicationContext</code>都有一个非常有用的<code>ConditionEvaluationReport</code>。如果启用<code>DEBUG</code>日志记录输出，则可以看到它。如果使用<code>spring-boot-actuator</code>（参见<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#">Actuator章节</a>），还有一个<code>conditions</code>端点以JSON格式呈现报表。使用该端点调试应用程序，并在运行时查看Spring Boot添加了哪些功能（以及哪些尚未添加）。</p>
<p>通过查看源代码和Javadoc可以回答更多问题。阅读代码时，请记住以下经验法则：</p>
<ul>
<li>查找名为<code>*AutoConfiguration</code>的类并阅读其来源。请特别注意<code>@Conditional*</code>注释，以了解它们启用哪些功能以及何时启用。将<code>--debug</code>添加到命令行或系统属性<code>-Ddebug</code>，以在控制台上记录应用程序中所做的所有自动配置决策。在正在运行的Actuator应用程序中，查看<code>conditions</code>端点（<code>/actuator/conditions</code>或JMX等效物）以获取相同的信息。</li>
<li>查找<code>@ConfigurationProperties</code>（例如<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/ServerProperties.java"><code>ServerProperties</code></a>）的类， 并从那里读取可用的外部配置选项。<code>@ConfigurationProperties</code>注释具有<code>name</code>属性，该属性充当外部属性的前缀。因此，<code>ServerProperties</code>具有<code>prefix=&quot;server&quot;</code>，其配置属性为<code>server.port</code>，<code>server.address</code>等。在正在运行的Actuator应用程序中，查看<code>configprops</code>端点。</li>
<li>查看<code>Binder</code>上<code>bind</code>方法的使用，以轻松的方式从<code>Environment</code>中明确地提取配置值。它通常与前缀一起使用。</li>
<li>查找直接绑定到<code>Environment</code>的<code>@Value</code>注释。</li>
<li>查找用于响应SpEL表达式打开和关闭功能的<code>@ConditionalOnExpression</code>注释，通常使用从<code>Environment</code>解析的占位符进行评估。</li>
</ul>
<h2 id="76-3在开始之前自定义环境或ApplicationContext"><a href="#76-3在开始之前自定义环境或ApplicationContext" class="headerlink" title="76.3在开始之前自定义环境或ApplicationContext"></a>76.3在开始之前自定义环境或ApplicationContext</h2><p><code>SpringApplication</code>具有<code>ApplicationListeners</code>和<code>ApplicationContextInitializers</code>，用于将自定义应用于上下文或环境。Spring Boot加载了许多此类自定义项，以便在<code>META-INF/spring.factories</code>内部使用。注册其他自定义项的方法不止一种：</p>
<ul>
<li>按程序编程，在运行之前调用<code>SpringApplication</code>上的<code>addListeners</code>和<code>addInitializers</code>方法。</li>
<li>声明地，根据应用程序，通过设置<code>context.initializer.classes</code>或<code>context.listener.classes</code>属性。</li>
<li>声明性地，对于所有应用程序，通过添加<code>META-INF/spring.factories</code>并打包应用程序全部用作库的jar文件。</li>
</ul>
<p><code>SpringApplication</code>向侦听器发送一些特殊的<code>ApplicationEvents</code>（有些甚至在创建上下文之前），然后为<code>ApplicationContext</code>发布的事件注册侦听器。有关完整列表<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-application-events-and-listeners">，</a>请参阅“ Spring Boot功能”部分中的“ <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-application-events-and-listeners">第23.5节”“应用程序事件和监听器”</a>。</p>
<p>在使用<code>EnvironmentPostProcessor</code>刷新应用程序上下文之前，还可以自定义<code>Environment</code>。每个实现都应在<code>META-INF/spring.factories</code>中注册，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.boot.env.EnvironmentPostProcessor&#x3D;com.example.YourEnvironmentPostProcessor</span><br></pre></td></tr></table></figure>

<p>该实现可以加载任意文件并将它们添加到<code>Environment</code>。例如，以下示例从类路径加载YAML配置文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">public class EnvironmentPostProcessorExample implements EnvironmentPostProcessor &#123;</span><br><span class="line"></span><br><span class="line">	private final YamlPropertySourceLoader loader &#x3D; new YamlPropertySourceLoader();</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public void postProcessEnvironment(ConfigurableEnvironment environment,</span><br><span class="line">			SpringApplication application) &#123;</span><br><span class="line">		Resource path &#x3D; new ClassPathResource(&quot;com&#x2F;example&#x2F;myapp&#x2F;config.yml&quot;);</span><br><span class="line">		PropertySource&lt;?&gt; propertySource &#x3D; loadYaml(path);</span><br><span class="line">		environment.getPropertySources().addLast(propertySource);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	private PropertySource&lt;?&gt; loadYaml(Resource path) &#123;</span><br><span class="line">		if (!path.exists()) &#123;</span><br><span class="line">			throw new IllegalArgumentException(&quot;Resource &quot; + path + &quot; does not exist&quot;);</span><br><span class="line">		&#125;</span><br><span class="line">		try &#123;</span><br><span class="line">			return this.loader.load(&quot;custom-resource&quot;, path).get(0);</span><br><span class="line">		&#125;</span><br><span class="line">		catch (IOException ex) &#123;</span><br><span class="line">			throw new IllegalStateException(</span><br><span class="line">					&quot;Failed to load yaml configuration from &quot; + path, ex);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td><code>Environment</code>已经准备好了Spring Boot默认加载的所有常用属性源。因此，可以从环境中获取文件的位置。前面的示例在列表末尾添加了<code>custom-resource</code>属性源，以便在任何其他常用位置中定义的键优先。自定义实现可以定义另一个订单。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/caution.png" alt="[警告]"></th>
<th>警告</th>
</tr>
</thead>
<tbody><tr>
<td>虽然在<code>@SpringBootApplication</code>上使用<code>@PropertySource</code>似乎是在<code>Environment</code>中加载自定义资源的一种方便而简单的方法，但我们不建议这样做，因为Spring Boot准备了<code>Environment</code>在刷新<code>ApplicationContext</code>之前。使用<code>@PropertySource</code>定义的任何键加载太晚，不会对自动配置产生任何影响。</td>
<td></td>
</tr>
</tbody></table>
<h2 id="76-4构建ApplicationContext层次结构（添加父或根上下文）"><a href="#76-4构建ApplicationContext层次结构（添加父或根上下文）" class="headerlink" title="76.4构建ApplicationContext层次结构（添加父或根上下文）"></a>76.4构建ApplicationContext层次结构（添加父或根上下文）</h2><p>您可以使用<code>ApplicationBuilder</code>类创建父/子<code>ApplicationContext</code>层次结构。有关详细信息，请参阅“ Spring Boot功能”部分中的“ <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-fluent-builder-api">第23.4节</a> ” <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-fluent-builder-api">，“Fluent Builder API”</a>。</p>
<h2 id="76-5创建非Web应用程序"><a href="#76-5创建非Web应用程序" class="headerlink" title="76.5创建非Web应用程序"></a>76.5创建非Web应用程序</h2><p>并非所有Spring应用程序都必须是Web应用程序（或Web服务）。如果要在<code>main</code>方法中执行某些代码，而且还要引导Spring应用程序来设置要使用的基础结构，则可以使用Spring Boot的<code>SpringApplication</code>功能。<code>SpringApplication</code>更改其<code>ApplicationContext</code>类，具体取决于它是否认为它需要Web应用程序。您可以做的第一件事就是将与服务器相关的依赖项（例如servlet API）从类路径中删除。如果您不能这样做（例如，您从相同的代码库运行两个应用程序），那么您可以在<code>SpringApplication</code>实例上显式调用<code>setWebApplicationType(WebApplicationType.NONE)</code>或设置<code>applicationContextClass</code>属性（通过Java API或与外部属性）。您希望作为业务逻辑运行的应用程序代码可以实现为<code>CommandLineRunner</code>并作为<code>@Bean</code>定义放入上下文中。</p>
<h2 id="77-属性和配置"><a href="#77-属性和配置" class="headerlink" title="77.属性和配置"></a>77.属性和配置</h2><p>本节包括有关设置和读取属性和配置设置及其与Spring Boot应用程序交互的主题。</p>
<h2 id="77-1在构建时自动展开属性"><a href="#77-1在构建时自动展开属性" class="headerlink" title="77.1在构建时自动展开属性"></a>77.1在构建时自动展开属性</h2><p>您可以使用现有的构建配置自动扩展它们，而不是硬编码在项目的构建配置中也指定的某些属性。Maven和Gradle都可以实现这一点。</p>
<h3 id="77-1-1使用Maven自动Property扩展"><a href="#77-1-1使用Maven自动Property扩展" class="headerlink" title="77.1.1使用Maven自动Property扩展"></a>77.1.1使用Maven自动Property扩展</h3><p>您可以使用资源过滤自动从Maven项目扩展属性。如果您使用<code>spring-boot-starter-parent</code>，则可以使用<code>@..@</code>占位符引用Maven’项目属性’，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">app.encoding&#x3D;@project.build.sourceEncoding@</span><br><span class="line">app.java.version&#x3D;@java.version@</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>只有生产配置以这种方式过滤（换句话说，在<code>src/test/resources</code>上不应用过滤）。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果启用<code>addResources</code>标志，则<code>spring-boot:run</code>目标可以将<code>src/main/resources</code>直接添加到类路径（用于热重新加载）。这样做可以绕过资源过滤和此功能。相反，您可以使用<code>exec:java</code>目标或自定义插件的配置。有关详细信息，请参阅 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/maven-plugin/usage.html">插件使用情况页面</a>。</td>
</tr>
</tbody></table>
<p>如果您不使用starter父级，则需要在<code>pom.xml</code>的<code>&lt;build/&gt;</code>元素中包含以下元素：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;resources&gt;</span><br><span class="line">	&lt;resource&gt;</span><br><span class="line">		&lt;directory&gt;src&#x2F;main&#x2F;resources&lt;&#x2F;directory&gt;</span><br><span class="line">		&lt;filtering&gt;true&lt;&#x2F;filtering&gt;</span><br><span class="line">	&lt;&#x2F;resource&gt;</span><br><span class="line">&lt;&#x2F;resources&gt;</span><br></pre></td></tr></table></figure>

<p>您还需要在<code>&lt;plugins/&gt;</code>中包含以下元素：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;plugin&gt;</span><br><span class="line">	&lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;maven-resources-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">	&lt;version&gt;2.7&lt;&#x2F;version&gt;</span><br><span class="line">	&lt;configuration&gt;</span><br><span class="line">		&lt;delimiters&gt;</span><br><span class="line">			&lt;delimiter&gt;@&lt;&#x2F;delimiter&gt;</span><br><span class="line">		&lt;&#x2F;delimiters&gt;</span><br><span class="line">		&lt;useDefaultDelimiters&gt;false&lt;&#x2F;useDefaultDelimiters&gt;</span><br><span class="line">	&lt;&#x2F;configuration&gt;</span><br><span class="line">&lt;&#x2F;plugin&gt;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果在配置中使用标准Spring占位符（例如<code>$&#123;placeholder&#125;</code>），则<code>useDefaultDelimiters</code>属性非常重要。如果该属性未设置为<code>false</code>，则可以通过构建扩展这些属性。</td>
</tr>
</tbody></table>
<h3 id="77-1-2使用Gradle自动Property扩展"><a href="#77-1-2使用Gradle自动Property扩展" class="headerlink" title="77.1.2使用Gradle自动Property扩展"></a>77.1.2使用Gradle自动Property扩展</h3><p>您可以通过配置Java插件的<code>processResources</code>任务来自动扩展Gradle项目中的属性，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">processResources &#123;</span><br><span class="line">	expand(project.properties)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后，您可以使用占位符来引用您的Gradle项目的属性，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">app.name&#x3D;$&#123;name&#125;</span><br><span class="line">app.description&#x3D;$&#123;description&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>Gradle的<code>expand</code>方法使用Groovy的<code>SimpleTemplateEngine</code>，它会转换<code>$&#123;..&#125;</code>令牌。<code>$&#123;..&#125;</code>样式与Spring自己的属性占位符机制冲突。要将Spring属性占位符与自动扩展一起使用，请按如下方式转义Spring属性占位符：<code>\$&#123;..&#125;</code>。</td>
</tr>
</tbody></table>
<h2 id="77-2外部化SpringApplication的配置"><a href="#77-2外部化SpringApplication的配置" class="headerlink" title="77.2外部化SpringApplication的配置"></a>77.2外部化<code>SpringApplication</code>的配置</h2><p><code>SpringApplication</code>具有bean属性（主要是setter），因此您可以在创建应用程序时使用其Java API来修改其行为。或者，您可以通过在<code>spring.main.*</code>中设置属性来外部化配置。例如，在<code>application.properties</code>中，您可能具有以下设置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.main.web-application-type&#x3D;none</span><br><span class="line">spring.main.banner-mode&#x3D;off</span><br></pre></td></tr></table></figure>

<p>然后在启动时不打印Spring Boot横幅，并且应用程序未启动嵌入式Web服务器。</p>
<p>外部配置中定义的属性会覆盖使用Java API指定的值，但用于创建<code>ApplicationContext</code>的源的明显例外。考虑以下应用程序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">new SpringApplicationBuilder()</span><br><span class="line">	.bannerMode(Banner.Mode.OFF)</span><br><span class="line">	.sources(demo.MyApp.class)</span><br><span class="line">	.run(args);</span><br></pre></td></tr></table></figure>

<p>现在考虑以下配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.main.sources&#x3D;com.acme.Config,com.acme.ExtraConfig</span><br><span class="line">spring.main.banner-mode&#x3D;console</span><br></pre></td></tr></table></figure>

<p>实际应用程序<em>现在</em>显示横幅（由配置覆盖）并使用<code>ApplicationContext</code>的三个来源（按以下顺序）：<code>demo.MyApp</code>，<code>com.acme.Config</code>和<code>com.acme.ExtraConfig</code>。</p>
<h2 id="77-3更改应用程序外部属性的位置"><a href="#77-3更改应用程序外部属性的位置" class="headerlink" title="77.3更改应用程序外部属性的位置"></a>77.3更改应用程序外部属性的位置</h2><p>默认情况下，来自不同来源的属性会按照定义的顺序添加到Spring <code>Environment</code>（有关确切的顺序<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-external-config">，</a>请参阅“ Spring Boot功能”部分中的“ <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-external-config">第24章，</a><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-external-config"><em>外部化配置</em></a> ”）。</p>
<p>增加和修改此排序的一种好方法是向应用程序源添加<code>@PropertySource</code>注释。传递给<code>SpringApplication</code>静态便捷方法的类和使用<code>setSources()</code>添加的类将被检查以查看它们是否具有<code>@PropertySources</code>。如果他们这样做，那么这些属性会尽早添加到<code>Environment</code>，以便在<code>ApplicationContext</code>生命周期的所有阶段中使用。以这种方式添加的属性的优先级低于使用默认位置（例如<code>application.properties</code>），系统属性，环境变量或命令行添加的属性。</p>
<p>您还可以提供以下系统属性（或环境变量）来更改行为：</p>
<ul>
<li><code>spring.config.name</code>（<code>SPRING_CONFIG_NAME</code>）：默认为<code>application</code>作为文件名的根。</li>
<li><code>spring.config.location</code>（<code>SPRING_CONFIG_LOCATION</code>）：要加载的文件（例如类路径资源或URL）。为此文档设置了单独的<code>Environment</code>属性源，它可以被系统属性，环境变量或命令行覆盖。</li>
</ul>
<p>无论您在环境中设置什么，Spring Boot总是如上所述加载<code>application.properties</code>。默认情况下，如果使用YAML，则扩展名为“.yml”的文件也会添加到列表中。</p>
<p>Spring Boot记录在<code>DEBUG</code>级别加载的配置文件以及在<code>TRACE</code>级别找不到的候选项。</p>
<p>有关<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/context/config/ConfigFileApplicationListener.java"><code>ConfigFileApplicationListener</code></a> 详细信息，请参阅</p>
<h2 id="77-4使用“短”命令行参数"><a href="#77-4使用“短”命令行参数" class="headerlink" title="77.4使用“短”命令行参数"></a>77.4使用“短”命令行参数</h2><p>有些人喜欢使用（例如）<code>--port=9000</code>而不是<code>--server.port=9000</code>来在命令行上设置配置属性。您可以使用<code>application.properties</code>中的占位符启用此行为，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server.port&#x3D;$&#123;port:8080&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果您从<code>spring-boot-starter-parent</code> POM继承，则<code>maven-resources-plugins</code>的默认过滤器令牌已从<code>$&#123;*&#125;</code>更改为<code>@</code>（即<code>@maven.token@</code>而不是<code>$&#123;maven.token&#125;</code>）防止与Spring样式占位符发生冲突。如果您已直接为<code>application.properties</code>启用Maven过滤，则可能还需要更改默认过滤器令牌以使用 <a target="_blank" rel="noopener" href="https://maven.apache.org/plugins/maven-resources-plugin/resources-mojo.html#delimiters">其他分隔符</a>。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>在这种特定情况下，端口绑定可在Paoku环境（如Heroku或Cloud Foundry）中运行。在这两个平台中，<code>PORT</code>环境变量自动设置，Spring可以绑定到<code>Environment</code>属性的大写同义词。</td>
</tr>
</tbody></table>
<h2 id="77-5将YAML用于外部属性"><a href="#77-5将YAML用于外部属性" class="headerlink" title="77.5将YAML用于外部属性"></a>77.5将YAML用于外部属性</h2><p>YAML是JSON的超集，因此，它是以分层格式存储外部属性的便捷语法，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">	application:</span><br><span class="line">		name: cruncher</span><br><span class="line">	datasource:</span><br><span class="line">		driverClassName: com.mysql.jdbc.Driver</span><br><span class="line">		url: jdbc:mysql:&#x2F;&#x2F;localhost&#x2F;test</span><br><span class="line">server:</span><br><span class="line">	port: 9000</span><br></pre></td></tr></table></figure>

<p>创建一个名为<code>application.yml</code>的文件并将其放在类路径的根目录中。然后将<code>snakeyaml</code>添加到您的依赖项（Maven坐标<code>org.yaml:snakeyaml</code>，如果您使用<code>spring-boot-starter</code>，则已包含在内。将YAML文件解析为Java <code>Map&lt;String,Object&gt;</code>（类似于JSON对象），并且Spring Boot将地图展平，使其深度为一级并具有句点分隔的键，因为很多人习惯使用{11 Java中的/}文件。</p>
<p>上面的示例YAML对应于以下<code>application.properties</code>文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">spring.application.name&#x3D;cruncher</span><br><span class="line">spring.datasource.driverClassName&#x3D;com.mysql.jdbc.Driver</span><br><span class="line">spring.datasource.url&#x3D;jdbc:mysql:&#x2F;&#x2F;localhost&#x2F;test</span><br><span class="line">server.port&#x3D;9000</span><br></pre></td></tr></table></figure>

<p>有关<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-external-config-yaml">YAML</a>的更多信息<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-external-config-yaml">，</a>请参见“ Spring Boot功能”部分中的“ <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-external-config-yaml">第24.7节</a> ” <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-external-config-yaml">，“使用YAML而不是属性”</a>。</p>
<h2 id="77-6设置活动Spring-Profiles"><a href="#77-6设置活动Spring-Profiles" class="headerlink" title="77.6设置活动Spring Profiles"></a>77.6设置活动Spring Profiles</h2><p>Spring <code>Environment</code>有一个API，但您通常会设置一个System属性（<code>spring.profiles.active</code>）或一个OS环境变量（<code>SPRING_PROFILES_ACTIVE</code>）。此外，您可以使用<code>-D</code>参数启动应用程序（请记住将其放在主类或jar存档之前），如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar -Dspring.profiles.active&#x3D;production demo-0.0.1-SNAPSHOT.jar</span><br></pre></td></tr></table></figure>

<p>在Spring Boot中，您还可以在<code>application.properties</code>中设置活动配置文件，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.profiles.active&#x3D;production</span><br></pre></td></tr></table></figure>

<p>以这种方式设置的值将由System属性或环境变量设置替换，但不会由<code>SpringApplicationBuilder.profiles()</code>方法替换。因此，后一个Java API可用于扩充配置文件而不更改默认值。</p>
<p>有关详细<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-profiles"><em>信息</em></a><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-profiles">，</a>请参阅“ Spring Boot功能”部分中的“ <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-profiles">第25章，</a><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-profiles"><em>配置文件</em></a> ”。</p>
<h2 id="77-7根据环境更改配置"><a href="#77-7根据环境更改配置" class="headerlink" title="77.7根据环境更改配置"></a>77.7根据环境更改配置</h2><p>YAML文件实际上是由<code>---</code>行分隔的文档序列，每个文档分别解析为展平的地图。</p>
<p>如果YAML文档包含<code>spring.profiles</code>键，则配置文件值（以逗号分隔的配置文件列表）将输入Spring <code>Environment.acceptsProfiles()</code>方法。如果这些配置文件中的任何一个处于活动状态，那么该文档将包含在最终合并中（否则，它不会），如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">	port: 9000</span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">spring:</span><br><span class="line">	profiles: development</span><br><span class="line">server:</span><br><span class="line">	port: 9001</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">spring:</span><br><span class="line">	profiles: production</span><br><span class="line">server:</span><br><span class="line">	port: 0</span><br></pre></td></tr></table></figure>

<p>在前面的示例中，默认端口为9000.但是，如果名为“development”的Spring配置文件处于活动状态，则端口为9001.如果“production”处于活动状态，则端口为0。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>YAML文档按它们遇到的顺序合并。以后的值会覆盖以前的值。</td>
</tr>
</tbody></table>
<p>要对属性文件执行相同操作，可以使用<code>application-$&#123;profile&#125;.properties</code>指定特定于配置文件的值。</p>
<h2 id="77-8发现外部属性的内置选项"><a href="#77-8发现外部属性的内置选项" class="headerlink" title="77.8发现外部属性的内置选项"></a>77.8发现外部属性的内置选项</h2><p>Spring Boot在运行时将<code>application.properties</code>（或<code>.yml</code>文件和其他位置）的外部属性绑定到应用程序中。没有（并且在技术上不可能）单个位置中所有受支持属性的详尽列表，因为贡献可以来自类路径上的其他jar文件。</p>
<p>具有Actuator功能的正在运行的应用程序具有<code>configprops</code>端点，该端点显示通过<code>@ConfigurationProperties</code>可用的所有绑定和可绑定属性。</p>
<p>附录中包含一个<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#common-application-properties"><code>application.properties</code></a>示例，其中列出了Spring Boot支持的最常见属性。最终列表来自于搜索<code>@ConfigurationProperties</code>和<code>@Value</code>注释的源代码以及偶尔使用<code>Binder</code>。有关加载属性的确切顺序的更多信息，请参见“ <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-external-config">第24章，<em>外部化配置</em></a> ”。</p>
<h2 id="78-嵌入式Web服务器"><a href="#78-嵌入式Web服务器" class="headerlink" title="78.嵌入式Web服务器"></a>78.嵌入式Web服务器</h2><p>每个Spring Boot Web应用程序都包含一个嵌入式Web服务器。此功能会导致许多操作方法问题，包括如何更改嵌入式服务器以及如何配置嵌入式服务器。本节回答了这些问题。</p>
<h2 id="78-1使用其他Web服务器"><a href="#78-1使用其他Web服务器" class="headerlink" title="78.1使用其他Web服务器"></a>78.1使用其他Web服务器</h2><p>许多Spring Boot启动器包括默认嵌入式容器。</p>
<ul>
<li>对于servlet堆栈应用程序，<code>spring-boot-starter-web</code>包括<code>spring-boot-starter-tomcat</code>包含Tomcat，但您可以使用<code>spring-boot-starter-jetty</code>或<code>spring-boot-starter-undertow</code>。</li>
<li>对于反应堆栈应用程序，<code>spring-boot-starter-webflux</code>包括<code>spring-boot-starter-reactor-netty</code>包含Reactor Netty，但您可以使用<code>spring-boot-starter-tomcat</code>，<code>spring-boot-starter-jetty</code>或<code>spring-boot-starter-undertow</code>。</li>
</ul>
<p>切换到其他HTTP服务器时，除了包含所需的依赖项外，还需要排除默认依赖项。Spring Boot为HTTP服务器提供单独的启动程序，以帮助使此过程尽可能简单。</p>
<p>以下Maven示例显示了如何排除Tomcat并为Spring MVC包含Jetty：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;properties&gt;</span><br><span class="line">	&lt;servlet-api.version&gt;3.1.0&lt;&#x2F;servlet-api.version&gt;</span><br><span class="line">&lt;&#x2F;properties&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-boot-starter-web&lt;&#x2F;artifactId&gt;</span><br><span class="line">	&lt;exclusions&gt;</span><br><span class="line">		&lt;!-- Exclude the Tomcat dependency --&gt;</span><br><span class="line">		&lt;exclusion&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-boot-starter-tomcat&lt;&#x2F;artifactId&gt;</span><br><span class="line">		&lt;&#x2F;exclusion&gt;</span><br><span class="line">	&lt;&#x2F;exclusions&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;!-- Use Jetty instead --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-boot-starter-jetty&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>Servlet API的版本已被覆盖，与Tomcat 9和Undertow 2.0不同，Jetty 9.4不支持Servlet 4.0。</td>
</tr>
</tbody></table>
<p>以下Gradle示例显示了如何排除Netty并为Spring WebFlux包含Undertow：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">configurations &#123;</span><br><span class="line">	&#x2F;&#x2F; exclude Reactor Netty</span><br><span class="line">	compile.exclude module: &#39;spring-boot-starter-reactor-netty&#39;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">	compile &#39;org.springframework.boot:spring-boot-starter-webflux&#39;</span><br><span class="line">	&#x2F;&#x2F; Use Undertow instead</span><br><span class="line">	compile &#39;org.springframework.boot:spring-boot-starter-undertow&#39;</span><br><span class="line">	&#x2F;&#x2F; ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>使用<code>WebClient</code>类需要<code>spring-boot-starter-reactor-netty</code>，因此即使需要包含不同的HTTP服务器，也可能需要依赖Netty。</td>
</tr>
</tbody></table>
<h2 id="78-2禁用Web服务器"><a href="#78-2禁用Web服务器" class="headerlink" title="78.2禁用Web服务器"></a>78.2禁用Web服务器</h2><p>如果您的类路径包含启动Web服务器所需的位，Spring Boot将自动启动它。要禁用此行为，请在<code>application.properties</code>中配置<code>WebApplicationType</code>，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.main.web-application-type&#x3D;none</span><br></pre></td></tr></table></figure>

<h2 id="78-3更改HTTP端口"><a href="#78-3更改HTTP端口" class="headerlink" title="78.3更改HTTP端口"></a>78.3更改HTTP端口</h2><p>在独立应用程序中，主HTTP端口默认为<code>8080</code>，但可以使用<code>server.port</code>设置（例如，在<code>application.properties</code>或作为系统属性）。由于轻松绑定<code>Environment</code>值，您还可以使用<code>SERVER_PORT</code>（例如，作为OS环境变量）。</p>
<p>要完全关闭HTTP端点但仍然创建<code>WebApplicationContext</code>，请使用<code>server.port=-1</code>。（这样做有时对测试很有用。）</p>
<p>有关更多详细信息，请参阅“ Spring Boot功能”部分中的“ <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-customizing-embedded-containers">第28.4.4节</a> ” <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-customizing-embedded-containers">，“自定义嵌入式Servlet容器”</a>或 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/ServerProperties.java"><code>ServerProperties</code></a>源代码。</p>
<h2 id="78-4使用随机未分配的HTTP端口"><a href="#78-4使用随机未分配的HTTP端口" class="headerlink" title="78.4使用随机未分配的HTTP端口"></a>78.4使用随机未分配的HTTP端口</h2><p>要扫描空闲端口（使用OS本机来防止冲突），请使用<code>server.port=0</code>。</p>
<h2 id="78-5在运行时发现HTTP端口"><a href="#78-5在运行时发现HTTP端口" class="headerlink" title="78.5在运行时发现HTTP端口"></a>78.5在运行时发现HTTP端口</h2><p>您可以从日志输出或<code>ServletWebServerApplicationContext</code>到<code>WebServer</code>访问服务器运行的端口。获得它并确保它已被初始化的最佳方法是添加<code>@Bean</code>类型<code>ApplicationListener&lt;ServletWebServerInitializedEvent&gt;</code>并在发布时将容器拉出事件。</p>
<p>使用<code>@SpringBootTest(webEnvironment=WebEnvironment.RANDOM_PORT)</code>的测试也可以使用<code>@LocalServerPort</code>注释将实际端口注入字段，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(SpringJUnit4ClassRunner.class)</span><br><span class="line">@SpringBootTest(webEnvironment&#x3D;WebEnvironment.RANDOM_PORT)</span><br><span class="line">public class MyWebIntegrationTests &#123;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	ServletWebServerApplicationContext server;</span><br><span class="line"></span><br><span class="line">	@LocalServerPort</span><br><span class="line">	int port;</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F; ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td><code>@LocalServerPort</code>是<code>@Value(&quot;$&#123;local.server.port&#125;&quot;)</code>的元注释。不要尝试在常规应用程序中注入端口。正如我们刚刚看到的那样，只有在容器初始化之后才设置该值。与测试相反，应用程序代码回调会尽早处理（在值实际可用之前）。</td>
</tr>
</tbody></table>
<h2 id="78-6启用HTTP响应压缩"><a href="#78-6启用HTTP响应压缩" class="headerlink" title="78.6启用HTTP响应压缩"></a>78.6启用HTTP响应压缩</h2><p>Jetty，Tomcat和Undertow支持HTTP响应压缩。它可以在<code>application.properties</code>中启用，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server.compression.enabled&#x3D;true</span><br></pre></td></tr></table></figure>

<p>默认情况下，响应必须至少为2048字节，才能执行压缩。您可以通过设置<code>server.compression.min-response-size</code>属性来配置此行为。</p>
<p>默认情况下，只有在内容类型为以下内容之一时才会压缩响应：</p>
<ul>
<li><code>text/html</code></li>
<li><code>text/xml</code></li>
<li><code>text/plain</code></li>
<li><code>text/css</code></li>
<li><code>text/javascript</code></li>
<li><code>application/javascript</code></li>
<li><code>application/json</code></li>
<li><code>application/xml</code></li>
</ul>
<p>您可以通过设置<code>server.compression.mime-types</code>属性来配置此行为。</p>
<h2 id="78-7配置SSL"><a href="#78-7配置SSL" class="headerlink" title="78.7配置SSL"></a>78.7配置SSL</h2><p>可以通过设置各种<code>server.ssl.*</code>属性以声明方式配置SSL，通常在<code>application.properties</code>或<code>application.yml</code>。以下示例显示了在<code>application.properties</code>中设置SSL属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">server.port&#x3D;8443</span><br><span class="line">server.ssl.key-store&#x3D;classpath:keystore.jks</span><br><span class="line">server.ssl.key-store-password&#x3D;secret</span><br><span class="line">server.ssl.key-password&#x3D;another-secret</span><br></pre></td></tr></table></figure>

<p>有关<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/web/server/Ssl.java"><code>Ssl</code></a>所有支持的属性的详细信息，请参阅。</p>
<p>使用上述示例之类的配置意味着应用程序不再支持端口8080上的普通HTTP连接器。Spring Boot不支持通过<code>application.properties</code>配置HTTP连接器和HTTPS连接器。如果要同时使用这两者，则需要以编程方式配置其中一个。我们建议使用<code>application.properties</code>配置HTTPS，因为HTTP连接器更容易以编程方式配置。有关<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-samples/spring-boot-sample-tomcat-multi-connectors"><code>spring-boot-sample-tomcat-multi-connectors</code></a> 示例，请参阅 示例项目。</p>
<h2 id="78-8配置HTTP-2"><a href="#78-8配置HTTP-2" class="headerlink" title="78.8配置HTTP / 2"></a>78.8配置HTTP / 2</h2><p>您可以使用<code>server.http2.enabled</code>配置属性在Spring Boot应用程序中启用HTTP / 2支持。此支持取决于所选的Web服务器和应用程序环境，因为JDK8不支持该协议。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>Spring Boot不支持<code>h2c</code>，即HTTP / 2协议的明文版本。因此，您必须先<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#howto-configure-ssl">配置SSL</a>。</td>
</tr>
</tbody></table>
<h3 id="78-8-1带有Undertow的HTTP-2"><a href="#78-8-1带有Undertow的HTTP-2" class="headerlink" title="78.8.1带有Undertow的HTTP / 2"></a>78.8.1带有Undertow的HTTP / 2</h3><p>从Undertow 1.4.0+开始，支持HTTP / 2，对JDK8没有任何额外要求。</p>
<h3 id="78-8-2带Jetty的HTTP-2"><a href="#78-8-2带Jetty的HTTP-2" class="headerlink" title="78.8.2带Jetty的HTTP / 2"></a>78.8.2带Jetty的HTTP / 2</h3><p>从Jetty 9.4.8开始，<a target="_blank" rel="noopener" href="https://www.conscrypt.org/">Conscrypt库</a>也支持HTTP / 2 。要启用该支持，您的应用程序需要有两个额外的依赖项：<code>org.eclipse.jetty:jetty-alpn-conscrypt-server</code>和<code>org.eclipse.jetty.http2:http2-server</code>。</p>
<h3 id="78-8-3使用Tomcat的HTTP-2"><a href="#78-8-3使用Tomcat的HTTP-2" class="headerlink" title="78.8.3使用Tomcat的HTTP / 2"></a>78.8.3使用Tomcat的HTTP / 2</h3><p>Spring Boot默认使用Tomcat 9.0.x，它在使用JDK 9或更高版本时支持HTTP / 2开箱即用。或者，如果在主机操作系统上安装了<code>libtcnative</code>库及其依赖项，则可以在JDK 8上使用HTTP / 2。</p>
<p>必须使库文件夹（如果尚未可用）到JVM库路径。您可以使用<code>-Djava.library.path=/usr/local/opt/tomcat-native/lib</code>等JVM参数执行此操作。有关<a target="_blank" rel="noopener" href="https://tomcat.apache.org/tomcat-9.0-doc/apr.html">Tomcat官方文档的</a>更多 <a target="_blank" rel="noopener" href="https://tomcat.apache.org/tomcat-9.0-doc/apr.html">信息</a>。</p>
<p>在没有该本机支持的情况下在JDK 8上启动Tomcat 9.0.x会记录以下错误：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR 8787 --- [           main] o.a.coyote.http11.Http11NioProtocol      : The upgrade handler [org.apache.coyote.http2.Http2Protocol] for [h2] only supports upgrade via ALPN but has been configured for the [&quot;https-jsse-nio-8443&quot;] connector that does not support ALPN.</span><br></pre></td></tr></table></figure>

<p>此错误不是致命的，应用程序仍然以HTTP / 1.1 SSL支持启动。</p>
<h3 id="78-8-4带有Reactor-Netty的HTTP-2"><a href="#78-8-4带有Reactor-Netty的HTTP-2" class="headerlink" title="78.8.4带有Reactor Netty的HTTP / 2"></a>78.8.4带有Reactor Netty的HTTP / 2</h3><p><code>spring-boot-webflux-starter</code>默认使用Reactor Netty作为服务器。可以使用JDK 9或更高版本的JDK支持为Reactor Netty配置HTTP / 2。对于JDK 8环境或最佳运行时性能，此服务器还支持具有本机库的HTTP / 2。要启用它，您的应用程序需要具有其他依赖项。</p>
<p>Spring Boot管理<code>io.netty:netty-tcnative-boringssl-static</code>“超级jar”的版本，包含所有平台的本机库。开发人员可以选择使用分类器仅导入所需的依赖项（请参阅<a target="_blank" rel="noopener" href="http://netty.io/wiki/forked-tomcat-native.html">Netty官方文档</a>）。</p>
<h2 id="78-9配置Web服务器"><a href="#78-9配置Web服务器" class="headerlink" title="78.9配置Web服务器"></a>78.9配置Web服务器</h2><p>通常，您应首先考虑使用众多可用配置键中的一个，并通过在<code>application.properties</code>（或<code>application.yml</code>或环境等）中添加新条目来自定义您的Web服务器。请参阅“ <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#howto-discover-build-in-options-for-external-properties">第77.8节”，“发现内置”在外部属性选项中“</a> ”）。<code>server.*</code>命名空间在这里非常有用，它包括<code>server.tomcat.*</code>，<code>server.jetty.*</code>等名称空间，用于特定于服务器的功能。请参阅<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#common-application-properties">附录A，<em>常见应用程序属性</em></a>列表。</p>
<p>前面的部分涵盖了许多常见用例，例如压缩，SSL或HTTP / 2。但是，如果您的用例不存在配置密钥，则应该查看 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/web/server/WebServerFactoryCustomizer.html"><code>WebServerFactoryCustomizer</code></a>。您可以声明这样的组件并获得与您选择的服务器工厂相关的访问权限：您应该为所选服务器（Tomcat，Jetty，Reactor Netty，Undertow）和所选Web堆栈（Servlet或Reactive）选择变体。</p>
<p>以下示例适用于具有<code>spring-boot-starter-web</code>（Servlet堆栈）的Tomcat：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class MyTomcatWebServerCustomizer</span><br><span class="line">		implements WebServerFactoryCustomizer&lt;TomcatServletWebServerFactory&gt; &#123;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public void customize(TomcatServletWebServerFactory factory) &#123;</span><br><span class="line">		&#x2F;&#x2F; customize the factory here</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此外，Spring Boot提供：</p>
<table>
<thead>
<tr>
<th>服务器</th>
<th>Servlet堆栈</th>
<th>反应堆栈</th>
</tr>
</thead>
<tbody><tr>
<td>Tomcat</td>
<td><code>TomcatServletWebServerFactory</code></td>
<td><code>TomcatReactiveWebServerFactory</code></td>
</tr>
<tr>
<td>Jetty</td>
<td><code>JettyServletWebServerFactory</code></td>
<td><code>JettyReactiveWebServerFactory</code></td>
</tr>
<tr>
<td>Undertow</td>
<td><code>UndertowServletWebServerFactory</code></td>
<td><code>UndertowReactiveWebServerFactory</code></td>
</tr>
<tr>
<td>Reactor</td>
<td>N/A</td>
<td><code>NettyReactiveWebServerFactory</code></td>
</tr>
</tbody></table>
<p>一旦您有权访问<code>WebServerFactory</code>，您通常可以向其添加定制器以配置特定部件，例如连接器，服务器资源或服务器本身 - 所有这些都使用特定于服务器的API。</p>
<p>作为最后的手段，您还可以声明自己的<code>WebServerFactory</code>组件，该组件将覆盖Spring Boot提供的组件。在这种情况下，您不能再依赖<code>server</code>命名空间中的配置属性。</p>
<h2 id="78-10向应用程序添加Servlet，过滤器或监听器"><a href="#78-10向应用程序添加Servlet，过滤器或监听器" class="headerlink" title="78.10向应用程序添加Servlet，过滤器或监听器"></a>78.10向应用程序添加Servlet，过滤器或监听器</h2><p>在servlet堆栈应用程序中，即使用<code>spring-boot-starter-web</code>，有两种方法可以将<code>Servlet</code>，<code>Filter</code>，<code>ServletContextListener</code>以及Servlet API支持的其他侦听器添加到应用程序中：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#howto-add-a-servlet-filter-or-listener-as-spring-bean">第78.10.1节“使用Spring Bean添加Servlet，过滤器或监听器”</a></li>
<li><a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#howto-add-a-servlet-filter-or-listener-using-scanning">部分78.10.2，“使用类路径扫描添加Servlet，过滤器和监听器”</a></li>
</ul>
<h3 id="78-10-1使用Spring-Bean添加Servlet，过滤器或监听器"><a href="#78-10-1使用Spring-Bean添加Servlet，过滤器或监听器" class="headerlink" title="78.10.1使用Spring Bean添加Servlet，过滤器或监听器"></a>78.10.1使用Spring Bean添加Servlet，过滤器或监听器</h3><p>要使用Spring bean添加<code>Servlet</code>，<code>Filter</code>或Servlet <code>*Listener</code>，您必须为其提供<code>@Bean</code>定义。当您想要注入配置或依赖项时，这样做非常有用。但是，您必须非常小心，它们不会导致太多其他beans的初始化，因为它们必须在应用程序生命周期的早期安装在容器中。（例如，让它们依赖于您的<code>DataSource</code>或JPA配置并不是一个好主意。）您可以通过在首次使用而不是初始化时懒惰地初始化beans来解决此类限制。</p>
<p>对于<code>Filters</code>和<code>Servlets</code>，您还可以通过添加<code>FilterRegistrationBean</code>或<code>ServletRegistrationBean</code>来代替或添加基础组件来添加映射和初始化参数。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果在过滤器注册中未指定<code>dispatcherType</code>，则使用<code>REQUEST</code>。这与Servlet规范的默认调度程序类型一致。</td>
</tr>
</tbody></table>
<p>与任何其他Spring bean一样，您可以定义Servlet过滤器beans的顺序; 请务必查看“ <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-embedded-container-servlets-filters-listeners-beans">名为”注册Servlet，过滤器和监听器的部分为Spring Beans“</a> ”部分。</p>
<h4 id="禁用Servlet或过滤器的注册"><a href="#禁用Servlet或过滤器的注册" class="headerlink" title="禁用Servlet或过滤器的注册"></a>禁用Servlet或过滤器的注册</h4><p>正如<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#howto-add-a-servlet-filter-or-listener-as-spring-bean">前面所述</a>，任何<code>Servlet</code>或<code>Filter</code> beans与自动servlet容器登记。要禁用特定<code>Filter</code>或<code>Servlet</code> bean的注册，请为其创建注册bean并将其标记为已禁用，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">public FilterRegistrationBean registration(MyFilter filter) &#123;</span><br><span class="line">	FilterRegistrationBean registration &#x3D; new FilterRegistrationBean(filter);</span><br><span class="line">	registration.setEnabled(false);</span><br><span class="line">	return registration;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="78-10-2使用类路径扫描添加Servlet，过滤器和监听器"><a href="#78-10-2使用类路径扫描添加Servlet，过滤器和监听器" class="headerlink" title="78.10.2使用类路径扫描添加Servlet，过滤器和监听器"></a>78.10.2使用类路径扫描添加Servlet，过滤器和监听器</h3><p>通过使用<code>@ServletComponentScan</code>注释<code>@Configuration</code>类并指定包含组件的包，可以使用嵌入式servlet容器自动注册<code>@WebServlet</code>，<code>@WebFilter</code>和<code>@WebListener</code>带注释的类你想注册。默认情况下，<code>@ServletComponentScan</code>从带注释的类的包中进行扫描。</p>
<h2 id="78-11配置访问日志记录"><a href="#78-11配置访问日志记录" class="headerlink" title="78.11配置访问日志记录"></a>78.11配置访问日志记录</h2><p>可以通过各自的命名空间为Tomcat，Undertow和Jetty配置访问日志。</p>
<p>例如，以下设置使用<a target="_blank" rel="noopener" href="https://tomcat.apache.org/tomcat-8.5-doc/config/valve.html#Access_Logging">自定义模式</a>在Tomcat上记录访问权限 。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">server.tomcat.basedir&#x3D;my-tomcat</span><br><span class="line">server.tomcat.accesslog.enabled&#x3D;true</span><br><span class="line">server.tomcat.accesslog.pattern&#x3D;%t %a &quot;%r&quot; %s (%D ms)</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>日志的默认位置是相对于Tomcat基目录的<code>logs</code>目录。默认情况下，<code>logs</code>目录是临时目录，因此您可能希望修复Tomcat的基目录或使用日志的绝对路径。在前面的示例中，日志在<code>my-tomcat/logs</code>中相对于应用程序的工作目录可用。</td>
</tr>
</tbody></table>
<p>可以以类似的方式配置Undertow的访问日志记录，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">server.undertow.accesslog.enabled&#x3D;true</span><br><span class="line">server.undertow.accesslog.pattern&#x3D;%t %a &quot;%r&quot; %s (%D ms)</span><br></pre></td></tr></table></figure>

<p>日志存储在相对于应用程序工作目录的<code>logs</code>目录中。您可以通过设置<code>server.undertow.accesslog.directory</code>属性来自定义此位置。</p>
<p>最后，Jetty的访问日志记录也可以配置如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">server.jetty.accesslog.enabled&#x3D;true</span><br><span class="line">server.jetty.accesslog.filename&#x3D;&#x2F;var&#x2F;log&#x2F;jetty-access.log</span><br></pre></td></tr></table></figure>

<p>默认情况下，日志会重定向到<code>System.err</code>。有关更多详细信息，请参阅 <a target="_blank" rel="noopener" href="https://www.eclipse.org/jetty/documentation/9.4.x/configuring-jetty-request-logs.html">Jetty文档</a>。</p>
<h2 id="78-12在前端代理服务器后面运行"><a href="#78-12在前端代理服务器后面运行" class="headerlink" title="78.12在前端代理服务器后面运行"></a>78.12在前端代理服务器后面运行</h2><p>您的应用程序可能需要发送<code>302</code>重定向或使用绝对链接将内容呈现回自身。在代理后面运行时，调用者需要指向代理的链接，而不是托管应用程序的计算机的物理地址。通常，这种情况是通过与代理的合同来处理的，代理会添加标题以告诉后端如何构建自身链接。</p>
<p>如果代理添加了传统的<code>X-Forwarded-For</code>和<code>X-Forwarded-Proto</code>标头（大多数代理服务器都这样做），则应该正确呈现绝对链接，前提是<code>application.properties</code>中的<code>server.use-forward-headers</code>设置为<code>application.properties</code>。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果您的应用程序在Cloud Foundry或Heroku中运行，则<code>server.use-forward-headers</code>属性默认为<code>true</code>。在所有其他情况下，默认为<code>false</code>。</td>
</tr>
</tbody></table>
<h3 id="78-12-1自定义Tomcat的代理配置"><a href="#78-12-1自定义Tomcat的代理配置" class="headerlink" title="78.12.1自定义Tomcat的代理配置"></a>78.12.1自定义Tomcat的代理配置</h3><p>如果使用Tomcat，还可以配置用于携带“转发”信息的标头名称，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">server.tomcat.remote-ip-header&#x3D;x-your-remote-ip-header</span><br><span class="line">server.tomcat.protocol-header&#x3D;x-your-protocol-header</span><br></pre></td></tr></table></figure>

<p>Tomcat还配置了一个默认正则表达式，该表达式匹配要信任的内部代理。默认情况下，<code>10/8</code>，<code>192.168/16</code>，<code>169.254/16</code>和<code>127/8</code>中的IP地址是可信的。您可以通过向<code>application.properties</code>添加条目来自定义阀门的配置，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server.tomcat.internal-proxies&#x3D;192\\.168\\.\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>仅当使用属性文件进行配置时才需要双反斜杠。如果使用YAML，则单个反斜杠就足够了，并且与前面示例中显示的值相等的值为<code>192\.168\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;</code>。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>您可以通过将<code>internal-proxies</code>设置为空（但在生产中不这样做）来信任所有代理。</td>
</tr>
</tbody></table>
<p>您可以通过关闭自动关闭（为此，设置<code>server.use-forward-headers=false</code>）并在<code>TomcatServletWebServerFactory</code> bean中添加新的阀门实例来完全控制Tomcat <code>RemoteIpValve</code>的配置。</p>
<h2 id="78-13使用Tomcat启用多个连接器"><a href="#78-13使用Tomcat启用多个连接器" class="headerlink" title="78.13使用Tomcat启用多个连接器"></a>78.13使用Tomcat启用多个连接器</h2><p>您可以将<code>org.apache.catalina.connector.Connector</code>添加到<code>TomcatServletWebServerFactory</code>，这可以允许多个连接器，包括HTTP和HTTPS连接器，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">public ServletWebServerFactory servletContainer() &#123;</span><br><span class="line">	TomcatServletWebServerFactory tomcat &#x3D; new TomcatServletWebServerFactory();</span><br><span class="line">	tomcat.addAdditionalTomcatConnectors(createSslConnector());</span><br><span class="line">	return tomcat;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private Connector createSslConnector() &#123;</span><br><span class="line">	Connector connector &#x3D; new Connector(&quot;org.apache.coyote.http11.Http11NioProtocol&quot;);</span><br><span class="line">	Http11NioProtocol protocol &#x3D; (Http11NioProtocol) connector.getProtocolHandler();</span><br><span class="line">	try &#123;</span><br><span class="line">		File keystore &#x3D; new ClassPathResource(&quot;keystore&quot;).getFile();</span><br><span class="line">		File truststore &#x3D; new ClassPathResource(&quot;keystore&quot;).getFile();</span><br><span class="line">		connector.setScheme(&quot;https&quot;);</span><br><span class="line">		connector.setSecure(true);</span><br><span class="line">		connector.setPort(8443);</span><br><span class="line">		protocol.setSSLEnabled(true);</span><br><span class="line">		protocol.setKeystoreFile(keystore.getAbsolutePath());</span><br><span class="line">		protocol.setKeystorePass(&quot;changeit&quot;);</span><br><span class="line">		protocol.setTruststoreFile(truststore.getAbsolutePath());</span><br><span class="line">		protocol.setTruststorePass(&quot;changeit&quot;);</span><br><span class="line">		protocol.setKeyAlias(&quot;apitester&quot;);</span><br><span class="line">		return connector;</span><br><span class="line">	&#125;</span><br><span class="line">	catch (IOException ex) &#123;</span><br><span class="line">		throw new IllegalStateException(&quot;can&#39;t access keystore: [&quot; + &quot;keystore&quot;</span><br><span class="line">				+ &quot;] or truststore: [&quot; + &quot;keystore&quot; + &quot;]&quot;, ex);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="78-14使用Tomcat的LegacyCookieProcessor"><a href="#78-14使用Tomcat的LegacyCookieProcessor" class="headerlink" title="78.14使用Tomcat的LegacyCookieProcessor"></a>78.14使用Tomcat的LegacyCookieProcessor</h2><p>默认情况下，Spring Boot使用的嵌入式Tomcat不支持Cookie格式的“Version 0”，因此您可能会看到以下错误：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.lang.IllegalArgumentException: An invalid character [32] was present in the Cookie value</span><br></pre></td></tr></table></figure>

<p>如果可能的话，您应该考虑将代码更新为仅存储符合以后Cookie规范的值。但是，如果您无法更改cookie的编写方式，则可以将Tomcat配置为使用<code>LegacyCookieProcessor</code>。要切换到<code>LegacyCookieProcessor</code>，请使用添加<code>TomcatContextCustomizer</code>的<code>WebServerFactoryCustomizer</code> bean，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">public WebServerFactoryCustomizer&lt;TomcatServletWebServerFactory&gt; cookieProcessorCustomizer() &#123;</span><br><span class="line">	return (factory) -&gt; factory.addContextCustomizers(</span><br><span class="line">			(context) -&gt; context.setCookieProcessor(new LegacyCookieProcessor()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="78-15使用Undertow启用多个侦听器"><a href="#78-15使用Undertow启用多个侦听器" class="headerlink" title="78.15使用Undertow启用多个侦听器"></a>78.15使用Undertow启用多个侦听器</h2><p>将<code>UndertowBuilderCustomizer</code>添加到<code>UndertowServletWebServerFactory</code>并向<code>Builder</code>添加一个侦听器，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">public UndertowServletWebServerFactory servletWebServerFactory() &#123;</span><br><span class="line">	UndertowServletWebServerFactory factory &#x3D; new UndertowServletWebServerFactory();</span><br><span class="line">	factory.addBuilderCustomizers(new UndertowBuilderCustomizer() &#123;</span><br><span class="line"></span><br><span class="line">		@Override</span><br><span class="line">		public void customize(Builder builder) &#123;</span><br><span class="line">			builder.addHttpListener(8080, &quot;0.0.0.0&quot;);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;);</span><br><span class="line">	return factory;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="78-16使用-ServerEndpoint创建WebSocket端点"><a href="#78-16使用-ServerEndpoint创建WebSocket端点" class="headerlink" title="78.16使用@ServerEndpoint创建WebSocket端点"></a>78.16使用@ServerEndpoint创建WebSocket端点</h2><p>如果要在使用嵌入式容器的Spring Boot应用程序中使用<code>@ServerEndpoint</code>，则必须声明单个<code>ServerEndpointExporter</code> <code>@Bean</code>，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">public ServerEndpointExporter serverEndpointExporter() &#123;</span><br><span class="line">	return new ServerEndpointExporter();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>前面示例中显示的bean使用基础WebSocket容器注册任何<code>@ServerEndpoint</code>带注释的beans。当部署到独立的servlet容器时，此角色由servlet容器初始化程序执行，而不需要<code>ServerEndpointExporter</code> bean。</p>
<h2 id="79-Spring-MVC"><a href="#79-Spring-MVC" class="headerlink" title="79. Spring MVC"></a>79. Spring MVC</h2><p>Spring Boot有许多包括Spring MVC的先发球员。请注意，某些启动器包含对Spring MVC的依赖，而不是直接包含它。本节回答有关Spring MVC和Spring Boot的常见问题。</p>
<h2 id="79-1编写JSON-REST服务"><a href="#79-1编写JSON-REST服务" class="headerlink" title="79.1编写JSON REST服务"></a>79.1编写JSON REST服务</h2><p>只要Jackson2在类路径中，Spring Boot应用程序中的任何Spring <code>@RestController</code>都应默认呈现JSON响应，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">public class MyController &#123;</span><br><span class="line"></span><br><span class="line">	@RequestMapping(&quot;&#x2F;thing&quot;)</span><br><span class="line">	public MyThing thing() &#123;</span><br><span class="line">			return new MyThing();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>只要<code>MyThing</code>可以被Jackson2序列化（对于普通的POJO或Groovy对象来说是真的），那么<code>localhost:8080/thing</code>默认为它提供JSON表示。请注意，在浏览器中，您有时可能会看到XML响应，因为浏览器倾向于发送更喜欢XML的接受标头。</p>
<h2 id="79-2编写XML-REST服务"><a href="#79-2编写XML-REST服务" class="headerlink" title="79.2编写XML REST服务"></a>79.2编写XML REST服务</h2><p>如果类路径上有Jackson XML扩展（<code>jackson-dataformat-xml</code>），则可以使用它来呈现XML响应。我们用于JSON的前一个示例可以使用。要使用Jackson XML渲染器，请将以下依赖项添加到项目中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;com.fasterxml.jackson.dataformat&lt;&#x2F;groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;jackson-dataformat-xml&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<p>如果Jackson的XML扩展不可用，则使用JAXB（默认情况下在JDK中提供），并附加要求将<code>MyThing</code>注释为<code>@XmlRootElement</code>，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@XmlRootElement</span><br><span class="line">public class MyThing &#123;</span><br><span class="line">	private String name;</span><br><span class="line">	&#x2F;&#x2F; .. getters and setters</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>要使服务器呈现XML而不是JSON，您可能必须发送<code>Accept: text/xml</code>标头（或使用浏览器）。</p>
<h2 id="79-3自定义Jackson-ObjectMapper"><a href="#79-3自定义Jackson-ObjectMapper" class="headerlink" title="79.3自定义Jackson ObjectMapper"></a>79.3自定义Jackson ObjectMapper</h2><p>Spring MVC（客户端和服务器端）使用<code>HttpMessageConverters</code>协商HTTP交换中的内容转换。如果Jackson在类路径上，则您已获得<code>Jackson2ObjectMapperBuilder</code>提供的默认转换器，其实例将自动为您配置。</p>
<p><code>ObjectMapper</code>（或Jackson XML转换器的<code>XmlMapper</code>）实例（默认创建）具有以下自定义属性：</p>
<ul>
<li><code>MapperFeature.DEFAULT_VIEW_INCLUSION</code>已停用</li>
<li><code>DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES</code>已停用</li>
<li><code>SerializationFeature.WRITE_DATES_AS_TIMESTAMPS</code>已停用</li>
</ul>
<p>Spring Boot还具有一些功能，可以更轻松地自定义此行为。</p>
<p>您可以使用环境配置<code>ObjectMapper</code>和<code>XmlMapper</code>实例。Jackson提供了一套广泛的简单开/关功能，可用于配置其处理的各个方面。这些功能在六个枚举中描述（在Jackson中），映射到环境中的属性：</p>
<table>
<thead>
<tr>
<th>枚举</th>
<th>Property</th>
<th>值</th>
</tr>
</thead>
<tbody><tr>
<td><code>com.fasterxml.jackson.databind.DeserializationFeature</code></td>
<td><code>spring.jackson.deserialization.&lt;feature_name&gt;</code></td>
<td><code>true</code>, <code>false</code></td>
</tr>
<tr>
<td><code>com.fasterxml.jackson.core.JsonGenerator.Feature</code></td>
<td><code>spring.jackson.generator.&lt;feature_name&gt;</code></td>
<td><code>true</code>, <code>false</code></td>
</tr>
<tr>
<td><code>com.fasterxml.jackson.databind.MapperFeature</code></td>
<td><code>spring.jackson.mapper.&lt;feature_name&gt;</code></td>
<td><code>true</code>, <code>false</code></td>
</tr>
<tr>
<td><code>com.fasterxml.jackson.core.JsonParser.Feature</code></td>
<td><code>spring.jackson.parser.&lt;feature_name&gt;</code></td>
<td><code>true</code>, <code>false</code></td>
</tr>
<tr>
<td><code>com.fasterxml.jackson.databind.SerializationFeature</code></td>
<td><code>spring.jackson.serialization.&lt;feature_name&gt;</code></td>
<td><code>true</code>, <code>false</code></td>
</tr>
<tr>
<td><code>com.fasterxml.jackson.annotation.JsonInclude.Include</code></td>
<td><code>spring.jackson.default-property-inclusion</code></td>
<td><code>always</code>, <code>non_null</code>, <code>non_absent</code>, <code>non_default</code>, <code>non_empty</code></td>
</tr>
</tbody></table>
<p>例如，要启用漂亮打印，请设置<code>spring.jackson.serialization.indent_output=true</code>。注意，由于使用了<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-external-config-relaxed-binding">松弛绑定</a>，<code>indent_output</code>的情况不必与相应的枚举常量（<code>INDENT_OUTPUT</code>}的情况相匹配。</p>
<p>此基于环境的配置应用于自动配置的<code>Jackson2ObjectMapperBuilder</code> bean，并应用于使用构建器创建的任何映射器，包括自动配置的<code>ObjectMapper</code> bean。</p>
<p>上下文的<code>Jackson2ObjectMapperBuilder</code>可以通过一个或多个<code>Jackson2ObjectMapperBuilderCustomizer</code> beans进行自定义。可以订购这样的定制器beans（Boot自己的定制器的顺序为0），允许在Boot定制之前和之后应用其他定制。</p>
<p>任何beans类型<code>com.fasterxml.jackson.databind.Module</code>都会自动注册自动配置的<code>Jackson2ObjectMapperBuilder</code>，并应用于它创建的任何<code>ObjectMapper</code>个实例。这为您在应用程序中添加新功能时提供了一种全局机制，用于提供自定义模块。</p>
<p>如果要完全替换默认的<code>ObjectMapper</code>，请定义该类型的<code>@Bean</code>并将其标记为<code>@Primary</code>，或者，如果您更喜欢基于构建器的方法，请定义<code>Jackson2ObjectMapperBuilder</code> <code>@Bean</code>。请注意，在任何一种情况下，这样做都会禁用<code>ObjectMapper</code>的所有自动配置。</p>
<p>如果您提供<code>MappingJackson2HttpMessageConverter</code>类型的任何<code>@Beans</code>，它们将替换MVC配置中的默认值。此外，还提供了<code>HttpMessageConverters</code>类型的便利bean（如果使用默认的MVC配置，则始终可用）。它有一些有用的方法来访问默认和用户增强的消息转换器。</p>
<p>有关详细信息，请参阅“ <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#howto-customize-the-responsebody-rendering">第79.4节</a> ” <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#howto-customize-the-responsebody-rendering">，“自定义@ResponseBody渲染</a> ”部分和 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/servlet/WebMvcAutoConfiguration.java"><code>WebMvcAutoConfiguration</code></a> 源代码。</p>
<h2 id="79-4自定义-ResponseBody渲染"><a href="#79-4自定义-ResponseBody渲染" class="headerlink" title="79.4自定义@ResponseBody渲染"></a>79.4自定义@ResponseBody渲染</h2><p>Spring使用<code>HttpMessageConverters</code>渲染<code>@ResponseBody</code>（或来自<code>@RestController</code>的回复）。您可以通过在Spring Boot上下文中添加适当类型的beans来提供其他转换器。如果你添加的bean是默认包含的类型（例如<code>MappingJackson2HttpMessageConverter</code>用于JSON转换），它将替换默认值。提供了<code>HttpMessageConverters</code>类型的便利bean，如果您使用默认的MVC配置，它始终可用。它有一些有用的方法来访问默认和用户增强的消息转换器（例如，如果要将它们手动注入自定义<code>RestTemplate</code>，它会很有用）。</p>
<p>与正常的MVC使用情况一样，您提供的任何<code>WebMvcConfigurer</code> beans也可以通过覆盖<code>configureMessageConverters</code>方法来提供转换器。但是，与普通的MVC不同，您只能提供所需的其他转换器（因为Spring Boot使用相同的机制来提供其默认值）。最后，如果您通过提供自己的<code>@EnableWebMvc</code>配置选择退出Spring Boot默认MVC配置，则可以完全控制并使用<code>WebMvcConfigurationSupport</code>中的<code>getMessageConverters</code>手动完成所有操作。</p>
<p>有关<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/servlet/WebMvcAutoConfiguration.java"><code>WebMvcAutoConfiguration</code></a> 更多详细信息，请参阅 源代码。</p>
<h2 id="79-5处理多部分文件上载"><a href="#79-5处理多部分文件上载" class="headerlink" title="79.5处理多部分文件上载"></a>79.5处理多部分文件上载</h2><p>Spring Boot包含Servlet 3 <code>javax.servlet.http.Part</code> API以支持上传文件。默认情况下，Spring Boot配置Spring MVC，每个文件的最大大小为1MB，单个请求中的文件数据最大为10MB。您可以覆盖这些值，中间数据的存储位置（例如，到<code>/tmp</code>目录），以及使用<code>MultipartProperties</code>类中公开的属性将数据刷新到磁盘的阈值。例如，如果要指定文件不受限制，请将<code>spring.servlet.multipart.max-file-size</code>属性设置为<code>-1</code>。</p>
<p>当您希望在Spring MVC控制器处理程序方法中接收多部分编码文件数据作为<code>@RequestParam</code> - 带注释的<code>MultipartFile</code>类参数时，多部分支持非常有用。</p>
<p>有关<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/servlet/MultipartAutoConfiguration.java"><code>MultipartAutoConfiguration</code></a> 详细信息，请参阅 源代码。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>建议使用容器的内置支持进行分段上传，而不是引入其他依赖项，例如Apache Commons File Upload。</td>
</tr>
</tbody></table>
<h2 id="79-6关闭Spring-MVC-DispatcherServlet"><a href="#79-6关闭Spring-MVC-DispatcherServlet" class="headerlink" title="79.6关闭Spring MVC DispatcherServlet"></a>79.6关闭Spring MVC DispatcherServlet</h2><p>默认情况下，所有内容都是从应用程序的根目录（<code>/</code>）提供的。如果您希望映射到其他路径，可以按如下方式配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.mvc.servlet.path&#x3D;&#x2F;acme</span><br></pre></td></tr></table></figure>

<p>如果你有额外的servlet，你可以声明<code>@Bean</code>类型为<code>Servlet</code>或<code>ServletRegistrationBean</code>，Spring Boot将透明地注册到容器。因为servlet是以这种方式注册的，所以可以将它们映射到<code>DispatcherServlet</code>的子上下文而不调用它。</p>
<p>自己配置<code>DispatcherServlet</code>是不寻常的，但如果你真的需要这样做，还必须提供<code>DispatcherServletPath</code>类型<code>DispatcherServletPath</code>，以提供自定义<code>DispatcherServlet</code>的路径。</p>
<h2 id="79-7关闭默认MVC配置"><a href="#79-7关闭默认MVC配置" class="headerlink" title="79.7关闭默认MVC配置"></a>79.7关闭默认MVC配置</h2><p>完全控制MVC配置的最简单方法是为您自己的<code>@Configuration</code>提供<code>@EnableWebMvc</code>注释。这样做会将所有MVC配置留在您的手中。</p>
<h2 id="79-8自定义ViewResolvers"><a href="#79-8自定义ViewResolvers" class="headerlink" title="79.8自定义ViewResolvers"></a>79.8自定义ViewResolvers</h2><p><code>ViewResolver</code>是Spring MVC的核心组件，将<code>@Controller</code>中的视图名称转换为实际的<code>View</code>实现。请注意，<code>ViewResolvers</code>主要用于UI应用程序，而不是REST样式的服务（<code>View</code>不用于呈现<code>@ResponseBody</code>）。<code>ViewResolver</code>有很多实现可供选择，而Spring本身并不反对你应该使用哪些。另一方面，Spring Boot为您安装一个或两个，具体取决于它在类路径和应用程序上下文中找到的内容。<code>DispatcherServlet</code>使用它在应用程序上下文中找到的所有解析器，依次尝试每个解析器直到得到结果，因此，如果你添加自己的解析器，你必须知道顺序以及你的解析器在哪个位置添加。</p>
<p><code>WebMvcAutoConfiguration</code>在您的上下文中添加以下<code>ViewResolvers</code>：</p>
<ul>
<li><code>InternalResourceViewResolver</code>名为’defaultViewResolver’。这个可以通过使用<code>DefaultServlet</code>（包括静态资源和JSP页面，如果您使用它们）来查找可以呈现的物理资源。它将前缀和后缀应用于视图名称，然后在servlet上下文中查找具有该路径的物理资源（默认值为空，但可通过<code>spring.mvc.view.prefix</code>和<code>spring.mvc.view.suffix</code>进行外部配置）。您可以通过提供相同类型的bean来覆盖它。</li>
<li>一个名为’beanNameViewResolver’的<code>BeanNameViewResolver</code>。这是视图解析器链中一个有用的成员，并选择与正在解析的<code>View</code>同名的任何beans。不必覆盖或替换它。</li>
<li>A <code>ContentNegotiatingViewResolver</code>名为’的ViewResolver’只如果有添加<strong>是</strong> 实际上beans类型的<code>View</code>本。这是一个“主”解析器，委托给所有其他人，并尝试找到与客户端发送的“Accept”HTTP头匹配的内容。有一个<a target="_blank" rel="noopener" href="https://spring.io/blog/2013/06/03/content-negotiation-using-views">关于<code>ContentNegotiatingViewResolver</code></a>的有用 <a target="_blank" rel="noopener" href="https://spring.io/blog/2013/06/03/content-negotiation-using-views">博客</a>，您可能希望学习以了解更多信息，您也可以查看源代码以获取详细信息。您可以通过定义名为“viewResolver”的bean来关闭自动配置的<code>ContentNegotiatingViewResolver</code>。</li>
<li>如果您使用Thymeleaf，您还有<code>ThymeleafViewResolver</code>名为’thymeleafViewResolver’。它通过使用前缀和后缀包围视图名称来查找资源。前缀为<code>spring.thymeleaf.prefix</code>，后缀为<code>spring.thymeleaf.suffix</code>。前缀和后缀的值分别默认为“classpath：/ templates /”和“.html”。您可以通过提供相同名称的bean来覆盖<code>ThymeleafViewResolver</code>。</li>
<li>如果您使用FreeMarker，您还有<code>FreeMarkerViewResolver</code>名为’freeMarkerViewResolver’。它通过用前缀和后缀包围视图名称来查找加载器路径中的资源（外部化为<code>spring.freemarker.templateLoaderPath</code>并且默认值为’classpath：/ templates /‘）。前缀外部化为<code>spring.freemarker.prefix</code>，后缀外部化为<code>spring.freemarker.suffix</code>。前缀和后缀的默认值分别为空和“.ftl”。您可以通过提供相同名称的bean来覆盖<code>FreeMarkerViewResolver</code>。</li>
<li>如果您使用Groovy模板（实际上，如果<code>groovy-templates</code>在您的类路径上），您还有<code>GroovyMarkupViewResolver</code>名为’groovyMarkupViewResolver’。它通过用前缀和后缀（外部化为<code>spring.groovy.template.prefix</code>和<code>spring.groovy.template.suffix</code>）包围视图名称来查找加载器路径中的资源。前缀和后缀分别具有“classpath：/ templates /”和“.tpl”的默认值。您可以通过提供相同名称的bean来覆盖<code>GroovyMarkupViewResolver</code>。</li>
</ul>
<p>有关更多详细信息，请参阅以下部分：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/servlet/WebMvcAutoConfiguration.java"><code>WebMvcAutoConfiguration</code></a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/thymeleaf/ThymeleafAutoConfiguration.java"><code>ThymeleafAutoConfiguration</code></a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/freemarker/FreeMarkerAutoConfiguration.java"><code>FreeMarkerAutoConfiguration</code></a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/groovy/template/GroovyTemplateAutoConfiguration.java"><code>GroovyTemplateAutoConfiguration</code></a></li>
</ul>
<h2 id="80-使用Spring安全性进行测试"><a href="#80-使用Spring安全性进行测试" class="headerlink" title="80.使用Spring安全性进行测试"></a>80.使用Spring安全性进行测试</h2><p>Spring安全性支持以特定用户身份运行测试。例如，下面代码段中的测试将使用具有<code>ADMIN</code>角色的经过身份验证的用户运行。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">@WithMockUser(roles&#x3D;&quot;ADMIN&quot;)</span><br><span class="line">public void requestProtectedUrlWithUser() throws Exception &#123;</span><br><span class="line">	mvc</span><br><span class="line">		.perform(get(&quot;&#x2F;&quot;))</span><br><span class="line">		...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Spring安全性提供与Spring MVC测试的全面集成，这也可以在使用<code>@WebMvcTest</code>切片和<code>MockMvc</code>测试控制器时使用。</p>
<p>有关Spring安全性测试支持的其他详细信息，请参阅Spring安全性 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-security/site/docs/current/reference/htmlsingle/#test">参考文档</a>）。</p>
<h2 id="81-Jersey"><a href="#81-Jersey" class="headerlink" title="81. Jersey"></a>81. Jersey</h2><h2 id="81-1使用Spring安全性保护Jersey端点"><a href="#81-1使用Spring安全性保护Jersey端点" class="headerlink" title="81.1使用Spring安全性保护Jersey端点"></a>81.1使用Spring安全性保护Jersey端点</h2><p>Spring安全性可用于保护基于Jersey的Web应用程序，其方式与用于保护基于Spring MVC的Web应用程序的方式非常相似。但是，如果要将Spring安全性的方法级安全性与Jersey一起使用，则必须将Jersey配置为使用<code>setStatus(int)</code>而不是<code>sendError(int)</code>。这可以防止Jersey在Spring安全性有机会向客户端报告身份验证或授权失败之前提交响应。</p>
<p><code>jersey.config.server.response.setStatusOverSendError</code>属性必须在应用程序的<code>ResourceConfig</code> bean上设置为<code>true</code>，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class JerseyConfig extends ResourceConfig &#123;</span><br><span class="line"></span><br><span class="line">	public JerseyConfig() &#123;</span><br><span class="line">		register(Endpoint.class);</span><br><span class="line">		setProperties(Collections.singletonMap(</span><br><span class="line">				&quot;jersey.config.server.response.setStatusOverSendError&quot;, true));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="82-HTTP客户端"><a href="#82-HTTP客户端" class="headerlink" title="82. HTTP客户端"></a>82. HTTP客户端</h2><p>Spring Boot提供了许多与HTTP客户端配合使用的启动器。本节回答与使用它们相关的问题。</p>
<h2 id="82-1配置RestTemplate以使用代理"><a href="#82-1配置RestTemplate以使用代理" class="headerlink" title="82.1配置RestTemplate以使用代理"></a>82.1配置RestTemplate以使用代理</h2><p>如<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-resttemplate-customization">第34.1节“RestTemplate Customization”中所述</a>，您可以使用<code>RestTemplateCustomizer</code>和<code>RestTemplateBuilder</code>来构建自定义的<code>RestTemplate</code>。这是创建配置为使用代理的<code>RestTemplate</code>的推荐方法。</p>
<p>代理配置的确切详细信息取决于正在使用的基础客户端请求工厂。以下示例使用<code>HttpClient</code>配置<code>HttpComponentsClientRequestFactory</code>，该代理使用除<code>192.168.0.5</code>以外的所有主机的代理：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">static class ProxyCustomizer implements RestTemplateCustomizer &#123;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public void customize(RestTemplate restTemplate) &#123;</span><br><span class="line">		HttpHost proxy &#x3D; new HttpHost(&quot;proxy.example.com&quot;);</span><br><span class="line">		HttpClient httpClient &#x3D; HttpClientBuilder.create()</span><br><span class="line">				.setRoutePlanner(new DefaultProxyRoutePlanner(proxy) &#123;</span><br><span class="line"></span><br><span class="line">					@Override</span><br><span class="line">					public HttpHost determineProxy(HttpHost target,</span><br><span class="line">							HttpRequest request, HttpContext context)</span><br><span class="line">							throws HttpException &#123;</span><br><span class="line">						if (target.getHostName().equals(&quot;192.168.0.5&quot;)) &#123;</span><br><span class="line">							return null;</span><br><span class="line">						&#125;</span><br><span class="line">						return super.determineProxy(target, request, context);</span><br><span class="line">					&#125;</span><br><span class="line"></span><br><span class="line">				&#125;).build();</span><br><span class="line">		restTemplate.setRequestFactory(</span><br><span class="line">				new HttpComponentsClientHttpRequestFactory(httpClient));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="83-记录"><a href="#83-记录" class="headerlink" title="83.记录"></a>83.记录</h2><p>Spring Boot没有强制日志记录依赖，但Commons Logging API除外，它通常由Spring Framework的<code>spring-jcl</code>模块提供。要使用 <a target="_blank" rel="noopener" href="http://logback.qos.ch/">Logback</a>，您需要在类路径中包含它和<code>spring-jcl</code>。最简单的方法是通过首发，这些都取决于<code>spring-boot-starter-logging</code>。对于Web应用程序，您只需要<code>spring-boot-starter-web</code>，因为它依赖于日志记录启动器。如果您使用Maven，则以下依赖项会为您添加日志记录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-boot-starter-web&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<p>Spring Boot具有<code>LoggingSystem</code>抽象，尝试根据类路径的内容配置日志记录。如果Logback可用，则它是第一选择。</p>
<p>如果您需要对日志记录进行的唯一更改是设置各种记录器的级别，则可以使用“logging.level”前缀在<code>application.properties</code>中执行此操作，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">logging.level.org.springframework.web&#x3D;DEBUG</span><br><span class="line">logging.level.org.hibernate&#x3D;ERROR</span><br></pre></td></tr></table></figure>

<p>您还可以使用“logging.file”设置要写入日志的文件的位置（除控制台外）。</p>
<p>要配置日志记录系统的更细粒度设置，您需要使用相关<code>LoggingSystem</code>支持的本机配置格式。默认情况下，Spring Boot从系统的默认位置（例如用于Logback的<code>classpath:logback.xml</code>）中选择本机配置，但您可以使用“logging.config”属性设置配置文件的位置。</p>
<h2 id="83-1配置日志记录的日志记录"><a href="#83-1配置日志记录的日志记录" class="headerlink" title="83.1配置日志记录的日志记录"></a>83.1配置日志记录的日志记录</h2><p>如果在类路径的根目录中放置<code>logback.xml</code>，则从那里（或从<code>logback-spring.xml</code>中选取它）以利用Boot提供的模板功能。Spring Boot提供了一个默认的基本配置，如果要设置级别，可以包括该配置，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">	&lt;include resource&#x3D;&quot;org&#x2F;springframework&#x2F;boot&#x2F;logging&#x2F;logback&#x2F;base.xml&quot;&#x2F;&gt;</span><br><span class="line">	&lt;logger name&#x3D;&quot;org.springframework.web&quot; level&#x3D;&quot;DEBUG&quot;&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;configuration&gt;</span><br></pre></td></tr></table></figure>

<p>如果你看看spring-boot jar中的<code>base.xml</code>，你可以看到它使用<code>LoggingSystem</code>为你创建的一些有用的系统属性：</p>
<ul>
<li><code>$&#123;PID&#125;</code>：当前进程ID。</li>
<li><code>$&#123;LOG_FILE&#125;</code>：是否在Boot的外部配置中设置了<code>logging.file</code>。</li>
<li><code>$&#123;LOG_PATH&#125;</code>：是否在引导的外部配置中设置了<code>logging.path</code>（表示日志文件所在的目录）。</li>
<li><code>$&#123;LOG_EXCEPTION_CONVERSION_WORD&#125;</code>：是否在Boot的外部配置中设置了<code>logging.exception-conversion-word</code>。</li>
</ul>
<p>Spring Boot还通过使用自定义Logback转换器在控制台上（但不在日志文件中）提供了一些漂亮的ANSI颜色终端输出。有关详细信息，请参阅默认的<code>base.xml</code>配置。</p>
<p>如果Groovy在类路径上，您应该能够使用<code>logback.groovy</code>配置Logback。如果存在，则优先考虑此设置。</p>
<h3 id="83-1-1配置仅文件输出的回溯"><a href="#83-1-1配置仅文件输出的回溯" class="headerlink" title="83.1.1配置仅文件输出的回溯"></a>83.1.1配置仅文件输出的回溯</h3><p>如果要禁用控制台日志记录并仅将输出写入文件，则需要导入<code>file-appender.xml</code>而不是<code>console-appender.xml</code>的自定义<code>logback-spring.xml</code>，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">	&lt;include resource&#x3D;&quot;org&#x2F;springframework&#x2F;boot&#x2F;logging&#x2F;logback&#x2F;defaults.xml&quot; &#x2F;&gt;</span><br><span class="line">	&lt;property name&#x3D;&quot;LOG_FILE&quot; value&#x3D;&quot;$&#123;LOG_FILE:-$&#123;LOG_PATH:-$&#123;LOG_TEMP:-$&#123;java.io.tmpdir:-&#x2F;tmp&#125;&#125;&#x2F;&#125;spring.log&#125;&quot;&#x2F;&gt;</span><br><span class="line">	&lt;include resource&#x3D;&quot;org&#x2F;springframework&#x2F;boot&#x2F;logging&#x2F;logback&#x2F;file-appender.xml&quot; &#x2F;&gt;</span><br><span class="line">	&lt;root level&#x3D;&quot;INFO&quot;&gt;</span><br><span class="line">		&lt;appender-ref ref&#x3D;&quot;FILE&quot; &#x2F;&gt;</span><br><span class="line">	&lt;&#x2F;root&gt;</span><br><span class="line">&lt;&#x2F;configuration&gt;</span><br></pre></td></tr></table></figure>

<p>您还需要将<code>logging.file</code>添加到<code>application.properties</code>，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logging.file&#x3D;myapplication.log</span><br></pre></td></tr></table></figure>

<h2 id="83-2配置Log4j进行日志记录"><a href="#83-2配置Log4j进行日志记录" class="headerlink" title="83.2配置Log4j进行日志记录"></a>83.2配置Log4j进行日志记录</h2><p>Spring Boot支持<a target="_blank" rel="noopener" href="https://logging.apache.org/log4j/2.x">Log4j 2</a>进行日志记录配置（如果它在类路径上）。如果使用启动器来组装依赖项，则必须排除Logback，然后包含log4j 2。如果您不使用启动器，除了Log4j 2之外，您还需要提供（至少）<code>spring-jcl</code>。</p>
<p>最简单的路径可能是通过初学者，即使它需要一些与排除的摇晃。以下示例显示如何在Maven中设置启动器：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-boot-starter-web&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-boot-starter&lt;&#x2F;artifactId&gt;</span><br><span class="line">	&lt;exclusions&gt;</span><br><span class="line">		&lt;exclusion&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-boot-starter-logging&lt;&#x2F;artifactId&gt;</span><br><span class="line">		&lt;&#x2F;exclusion&gt;</span><br><span class="line">	&lt;&#x2F;exclusions&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-boot-starter-log4j2&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<p>以下示例显示了在Gradle中设置启动器的一种方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">	compile &#39;org.springframework.boot:spring-boot-starter-web&#39;</span><br><span class="line">	compile &#39;org.springframework.boot:spring-boot-starter-log4j2&#39;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">configurations &#123;</span><br><span class="line">	all &#123;</span><br><span class="line">		exclude group: &#39;org.springframework.boot&#39;, module: &#39;spring-boot-starter-logging&#39;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>Log4j启动器将常见日志记录要求的依赖关系聚集在一起（例如让Tomcat使用<code>java.util.logging</code>但使用Log4j 2配置输出）。有关 详细信息，请参阅 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-samples/spring-boot-sample-actuator-log4j2">Actuator Log4j 2</a>样品并查看其实际操作。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>要确保使用<code>java.util.logging</code>执行的调试日志记录路由到Log4j 2，请通过将<code>java.util.logging.manager</code>系统属性设置为<code>org.apache.logging.log4j.jul.LogManager</code>来配置其<a target="_blank" rel="noopener" href="https://logging.apache.org/log4j/2.0/log4j-jul/index.html">JDK日志记录适配器</a>。</td>
</tr>
</tbody></table>
<h3 id="83-2-1使用YAML或JSON配置Log4j-2"><a href="#83-2-1使用YAML或JSON配置Log4j-2" class="headerlink" title="83.2.1使用YAML或JSON配置Log4j 2"></a>83.2.1使用YAML或JSON配置Log4j 2</h3><p>除了默认的XML配置格式外，Log4j 2还支持YAML和JSON配置文件。要将Log4j 2配置为使用备用配置文件格式，请将相应的依赖项添加到类路径，并将配置文件命名为与所选文件格式匹配，如以下示例所示：</p>
<table>
<thead>
<tr>
<th>格式</th>
<th>依赖</th>
<th>文件名</th>
</tr>
</thead>
<tbody><tr>
<td>YAML</td>
<td><code>com.fasterxml.jackson.core:jackson-databind</code> <code>com.fasterxml.jackson.dataformat:jackson-dataformat-yaml</code></td>
<td><code>log4j2.yaml</code> <code>log4j2.yml</code></td>
</tr>
<tr>
<td>JSON</td>
<td><code>com.fasterxml.jackson.core:jackson-databind</code></td>
<td><code>log4j2.json</code> <code>log4j2.jsn</code></td>
</tr>
</tbody></table>
<h2 id="84-数据访问"><a href="#84-数据访问" class="headerlink" title="84.数据访问"></a>84.数据访问</h2><p>Spring Boot包括一些处理数据源的初学者。本节回答与此相关的问题。</p>
<h2 id="84-1配置自定义数据源"><a href="#84-1配置自定义数据源" class="headerlink" title="84.1配置自定义数据源"></a>84.1配置自定义数据源</h2><p>要配置您自己的<code>DataSource</code>，请在配置中定义该类型的<code>@Bean</code>。Spring Boot在任何需要的地方重用<code>DataSource</code>，包括数据库初始化。如果需要外部化某些设置，可以将<code>DataSource</code>绑定到环境中（请参阅“ <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-external-config-3rd-party-configuration">第24.8.1节”“第三方配置</a> ”）。</p>
<p>以下示例显示如何在bean中定义数据源：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">@ConfigurationProperties(prefix&#x3D;&quot;app.datasource&quot;)</span><br><span class="line">public DataSource dataSource() &#123;</span><br><span class="line">	return new FancyDataSource();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以下示例显示如何通过设置属性来定义数据源：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.datasource.url&#x3D;jdbc:h2:mem:mydb</span><br><span class="line">app.datasource.username&#x3D;sa</span><br><span class="line">app.datasource.pool-size&#x3D;30</span><br></pre></td></tr></table></figure>

<p>假设您的<code>FancyDataSource</code>具有URL的常规JavaBean属性，用户名和池大小，这些设置在<code>DataSource</code>可用于其他组件之前自动绑定。也会发生常规 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#howto-initialize-a-database-using-spring-jdbc">数据库初始化</a>（因此<code>spring.datasource.*</code>的相关子集仍可用于您的自定义配置）。</p>
<p>Spring Boot还提供了一个名为<code>DataSourceBuilder</code>的实用程序构建器类，可用于创建其中一个标准数据源（如果它位于类路径中）。构建器可以根据类路径上的可用内容检测要使用的那个。它还会根据JDBC URL自动检测驱动程序。</p>
<p>以下示例显示如何使用<code>DataSourceBuilder</code>创建数据源：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">@ConfigurationProperties(&quot;app.datasource&quot;)</span><br><span class="line">public DataSource dataSource() &#123;</span><br><span class="line">	return DataSourceBuilder.create().build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>要使用<code>DataSource</code>运行应用程序，您只需要连接信息。还可以提供特定于池的设置。检查将在运行时使用的实现以获取更多详细信息。</p>
<p>以下示例说明如何通过设置属性来定义JDBC数据源：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.datasource.url&#x3D;jdbc:mysql:&#x2F;&#x2F;localhost&#x2F;test</span><br><span class="line">app.datasource.username&#x3D;dbuser</span><br><span class="line">app.datasource.password&#x3D;dbpass</span><br><span class="line">app.datasource.pool-size&#x3D;30</span><br></pre></td></tr></table></figure>

<p>然而，有一个问题。由于未公开连接池的实际类型，因此您的自定义<code>DataSource</code>的元数据中不会生成任何键，并且IDE中没有可用的完成（因为<code>DataSource</code>接口不公开任何属性）。此外，如果你碰巧在类路径上有Hikari，这个基本设置不起作用，因为Hikari没有<code>url</code>属性（但确实有<code>jdbcUrl</code>属性）。在这种情况下，您必须按如下方式重写配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.datasource.jdbc-url&#x3D;jdbc:mysql:&#x2F;&#x2F;localhost&#x2F;test</span><br><span class="line">app.datasource.username&#x3D;dbuser</span><br><span class="line">app.datasource.password&#x3D;dbpass</span><br><span class="line">app.datasource.maximum-pool-size&#x3D;30</span><br></pre></td></tr></table></figure>

<p>您可以通过强制连接池使用并返回专用实现而不是<code>DataSource</code>来解决此问题。您无法在运行时更改实现，但选项列表将是显式的。</p>
<p>以下示例显示如何使用<code>DataSourceBuilder</code>创建<code>HikariDataSource</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">@ConfigurationProperties(&quot;app.datasource&quot;)</span><br><span class="line">public HikariDataSource dataSource() &#123;</span><br><span class="line">	return DataSourceBuilder.create().type(HikariDataSource.class).build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>您甚至可以通过利用<code>DataSourceProperties</code>为您做的事情来进一步发展 - 也就是说，如果没有提供URL，则通过提供具有合理用户名和密码的默认嵌入式数据库。您可以从任何<code>DataSourceProperties</code>对象的状态轻松初始化<code>DataSourceBuilder</code>，因此您还可以注入Spring Boot自动创建的DataSource。但是，这会将您的配置拆分为两个名称空间：<code>spring.datasource</code>上的<code>url</code>，<code>username</code>，<code>password</code>，<code>type</code>和<code>driver</code>以及您自定义名称空间上的其余名称空间（<code>app.datasource</code>）。为避免这种情况，您可以在自定义命名空间上重新定义自定义<code>DataSourceProperties</code>，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">@Primary</span><br><span class="line">@ConfigurationProperties(&quot;app.datasource&quot;)</span><br><span class="line">public DataSourceProperties dataSourceProperties() &#123;</span><br><span class="line">	return new DataSourceProperties();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Bean</span><br><span class="line">@ConfigurationProperties(&quot;app.datasource.configuration&quot;)</span><br><span class="line">public HikariDataSource dataSource(DataSourceProperties properties) &#123;</span><br><span class="line">	return properties.initializeDataSourceBuilder().type(HikariDataSource.class)</span><br><span class="line">			.build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>默认情况下，此设置使您与Spring Boot为您执行的操作保持<em>同步</em>，除了选择了专用连接池（在代码中）并且其设置在<code>app.datasource.configuration</code>子命名空间中公开。因为<code>DataSourceProperties</code>正在为您处理<code>url</code> / <code>jdbcUrl</code>翻译，您可以按如下方式对其进行配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.datasource.url&#x3D;jdbc:mysql:&#x2F;&#x2F;localhost&#x2F;test</span><br><span class="line">app.datasource.username&#x3D;dbuser</span><br><span class="line">app.datasource.password&#x3D;dbpass</span><br><span class="line">app.datasource.configuration.maximum-pool-size&#x3D;30</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>Spring Boot会将Hikari特定的设置暴露给<code>spring.datasource.hikari</code>。此示例使用更通用的<code>configuration</code>子命名空间，因为该示例不支持多个数据源实现。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>由于您的自定义配置选择使用Hikari，<code>app.datasource.type</code>无效。在实践中，构建器初始化为您可能在那里设置的任何值，然后通过调用<code>.type()</code>覆盖。</td>
</tr>
</tbody></table>
<p>有关 更多详细信息<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-configure-datasource">，</a>请参阅“ Spring Boot功能”部分中的“ <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-configure-datasource">部分30.1，”配置数据源“</a> ”和 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jdbc/DataSourceAutoConfiguration.java"><code>DataSourceAutoConfiguration</code></a>类。</p>
<h2 id="84-2配置两个数据源"><a href="#84-2配置两个数据源" class="headerlink" title="84.2配置两个数据源"></a>84.2配置两个数据源</h2><p>如果需要配置多个数据源，可以应用上一节中描述的相同技巧。但是，您必须将<code>DataSource</code>个实例中的一个标记为<code>@Primary</code>，因为随后的各种自动配置希望能够按类型获得。</p>
<p>如果您创建自己的<code>DataSource</code>，则自动配置会退回。在下面的例子中，我们提供的<em>确切</em>相同的功能集自动配置提供主数据源：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">@Primary</span><br><span class="line">@ConfigurationProperties(&quot;app.datasource.first&quot;)</span><br><span class="line">public DataSourceProperties firstDataSourceProperties() &#123;</span><br><span class="line">	return new DataSourceProperties();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Bean</span><br><span class="line">@Primary</span><br><span class="line">@ConfigurationProperties(&quot;app.datasource.first.configuration&quot;)</span><br><span class="line">public HikariDataSource firstDataSource() &#123;</span><br><span class="line">	return firstDataSourceProperties().initializeDataSourceBuilder()</span><br><span class="line">			.type(HikariDataSource.class).build();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Bean</span><br><span class="line">@ConfigurationProperties(&quot;app.datasource.second&quot;)</span><br><span class="line">public BasicDataSource secondDataSource() &#123;</span><br><span class="line">	return DataSourceBuilder.create().type(BasicDataSource.class).build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td><code>firstDataSourceProperties</code>必须标记为<code>@Primary</code>，以便数据库初始化程序功能使用您的副本（如果您使用初始化程序）。</td>
</tr>
</tbody></table>
<p>这两个数据源也绑定了高级自定义。例如，您可以按如下方式配置它们：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">app.datasource.first.url&#x3D;jdbc:mysql:&#x2F;&#x2F;localhost&#x2F;first</span><br><span class="line">app.datasource.first.username&#x3D;dbuser</span><br><span class="line">app.datasource.first.password&#x3D;dbpass</span><br><span class="line">app.datasource.first.configuration.maximum-pool-size&#x3D;30</span><br><span class="line"></span><br><span class="line">app.datasource.second.url&#x3D;jdbc:mysql:&#x2F;&#x2F;localhost&#x2F;second</span><br><span class="line">app.datasource.second.username&#x3D;dbuser</span><br><span class="line">app.datasource.second.password&#x3D;dbpass</span><br><span class="line">app.datasource.second.max-total&#x3D;30</span><br></pre></td></tr></table></figure>

<p>您也可以将相同的概念应用于辅助<code>DataSource</code>，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">@Primary</span><br><span class="line">@ConfigurationProperties(&quot;app.datasource.first&quot;)</span><br><span class="line">public DataSourceProperties firstDataSourceProperties() &#123;</span><br><span class="line">	return new DataSourceProperties();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Bean</span><br><span class="line">@Primary</span><br><span class="line">@ConfigurationProperties(&quot;app.datasource.first.configuration&quot;)</span><br><span class="line">public HikariDataSource firstDataSource() &#123;</span><br><span class="line">	return firstDataSourceProperties().initializeDataSourceBuilder()</span><br><span class="line">			.type(HikariDataSource.class).build();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Bean</span><br><span class="line">@ConfigurationProperties(&quot;app.datasource.second&quot;)</span><br><span class="line">public DataSourceProperties secondDataSourceProperties() &#123;</span><br><span class="line">	return new DataSourceProperties();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Bean</span><br><span class="line">@ConfigurationProperties(&quot;app.datasource.second.configuration&quot;)</span><br><span class="line">public BasicDataSource secondDataSource() &#123;</span><br><span class="line">	return secondDataSourceProperties().initializeDataSourceBuilder()</span><br><span class="line">			.type(BasicDataSource.class).build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的示例使用与自动配置中使用的Spring Boot相同的逻辑在自定义命名空间上配置两个数据源。请注意，每个<code>configuration</code>子命名空间都根据所选实现提供高级设置。</p>
<h2 id="84-3使用Spring数据存储库"><a href="#84-3使用Spring数据存储库" class="headerlink" title="84.3使用Spring数据存储库"></a>84.3使用Spring数据存储库</h2><p>Spring数据可以创建各种风格的<code>@Repository</code>接口的实现。只要那些<code>@Repositories</code>包含在<code>@EnableAutoConfiguration</code>类的同一个包（或子包）中，Spring Boot就会处理所有这些内容。</p>
<p>对于许多应用程序，您只需要在类路径上放置正确的Spring数据依赖项（JPA有<code>spring-boot-starter-data-jpa</code>，Mongodb有<code>spring-boot-starter-data-mongodb</code>）并创建一些存储库接口来处理您的<code>@Entity</code>对象。例子在 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-samples/spring-boot-sample-data-jpa">JPA样本</a>和 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-samples/spring-boot-sample-data-mongodb">Mongodb样本中</a>。</p>
<p>Spring Boot根据找到的<code>@EnableAutoConfiguration</code>尝试猜测<code>@Repository</code>定义的位置。要获得更多控制，请使用<code>@EnableJpaRepositories</code>注释（来自Spring Data JPA）。</p>
<p>有关Spring数据的更多信息，请参阅<a target="_blank" rel="noopener" href="https://projects.spring.io/spring-data/">Spring数据项目页面</a>。</p>
<h2 id="84-4从Spring配置中分离-Entity定义"><a href="#84-4从Spring配置中分离-Entity定义" class="headerlink" title="84.4从Spring配置中分离@Entity定义"></a>84.4从Spring配置中分离@Entity定义</h2><p>Spring Boot根据找到的<code>@EnableAutoConfiguration</code>尝试猜测<code>@Entity</code>定义的位置。要获得更多控制，可以使用<code>@EntityScan</code>注释，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@EnableAutoConfiguration</span><br><span class="line">@EntityScan(basePackageClasses&#x3D;City.class)</span><br><span class="line">public class Application &#123;</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F;...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="84-5配置JPA属性"><a href="#84-5配置JPA属性" class="headerlink" title="84.5配置JPA属性"></a>84.5配置JPA属性</h2><p>Spring数据JPA已经提供了一些独立于供应商的配置选项（例如用于SQL日志记录的配置选项），Spring Boot公开了这些选项以及Hibernate的一些选项作为外部配置属性。根据上下文自动检测其中一些，因此您不必设置它们。</p>
<p><code>spring.jpa.hibernate.ddl-auto</code>是一种特殊情况，因为根据运行时条件，它具有不同的默认值。如果使用嵌入式数据库且没有架构管理器（例如Liquibase或Flyway）正在处理<code>DataSource</code>，则默认为<code>create-drop</code>。在所有其他情况下，默认为<code>none</code>。</p>
<p>使用的方言也会根据当前<code>DataSource</code>自动检测，但如果您想要明确并且在启动时绕过该检查，您可以自己设置<code>spring.jpa.database</code>。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>指定<code>database</code>会导致配置明确定义的Hibernate方言。有几个数据库有多个<code>Dialect</code>，这可能不适合您的需求。在这种情况下，您可以将<code>spring.jpa.database</code>设置为<code>default</code>以让Hibernate解决问题或通过设置<code>spring.jpa.database-platform</code>属性来设置方言。</td>
</tr>
</tbody></table>
<p>以下示例中显示了最常用的设置选项：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.jpa.hibernate.naming.physical-strategy&#x3D;com.example.MyPhysicalNamingStrategy</span><br><span class="line">spring.jpa.show-sql&#x3D;true</span><br></pre></td></tr></table></figure>

<p>此外，<code>spring.jpa.properties.*</code>中的所有属性在创建本地<code>EntityManagerFactory</code>时作为普通JPA属性（带有前缀剥离）传递。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果您需要对Hibernate属性应用高级自定义，请考虑注册将在创建<code>EntityManagerFactory</code>之前调用的<code>HibernatePropertiesCustomizer</code> bean。这优先于自动配置应用的任何内容。</td>
</tr>
</tbody></table>
<h2 id="84-6配置Hibernate命名策略"><a href="#84-6配置Hibernate命名策略" class="headerlink" title="84.6配置Hibernate命名策略"></a>84.6配置Hibernate命名策略</h2><p>Hibernate使用<a target="_blank" rel="noopener" href="https://docs.jboss.org/hibernate/orm/5.3/userguide/html_single/Hibernate_User_Guide.html#naming">两种不同的命名策略</a>将名称从对象模型映射到相应的数据库名称。可以通过分别设置<code>spring.jpa.hibernate.naming.physical-strategy</code>和<code>spring.jpa.hibernate.naming.implicit-strategy</code>属性来配置物理策略实现和隐式策略实现的完全限定类名。或者，如果应用程序上下文中有<code>ImplicitNamingStrategy</code>或<code>PhysicalNamingStrategy</code> beans，则Hibernate将自动配置为使用它们。</p>
<p>默认情况下，Spring Boot使用<code>SpringPhysicalNamingStrategy</code>配置物理命名策略。这个实现提供了与Hibernate 4相同的表结构：所有点都被下划线替换，并且驼峰外壳也被下划线替换。默认情况下，所有表名都以小写形式生成，但如果您的架构需要，则可以覆盖该标志。</p>
<p>例如，<code>TelephoneNumber</code>实体映射到<code>telephone_number</code>表。</p>
<p>如果您更喜欢使用Hibernate 5的默认设置，请设置以下属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.jpa.hibernate.naming.physical-strategy&#x3D;org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl</span><br></pre></td></tr></table></figure>

<p>或者，您可以配置以下bean：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">public PhysicalNamingStrategy physicalNamingStrategy() &#123;</span><br><span class="line">	return new PhysicalNamingStrategyStandardImpl();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>见<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/orm/jpa/HibernateJpaAutoConfiguration.java"><code>HibernateJpaAutoConfiguration</code></a> 和<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/orm/jpa/JpaBaseConfiguration.java"><code>JpaBaseConfiguration</code></a> 更多的细节。</p>
<h2 id="84-7配置Hibernate二级缓存"><a href="#84-7配置Hibernate二级缓存" class="headerlink" title="84.7配置Hibernate二级缓存"></a>84.7配置Hibernate二级缓存</h2><p>可以为一系列缓存提供程序配置Hibernate <a target="_blank" rel="noopener" href="https://docs.jboss.org/hibernate/orm/5.3/userguide/html_single/Hibernate_User_Guide.html#caching">二级</a>缓存。不是将Hibernate配置为再次查找缓存提供程序，最好尽可能提供上下文中可用的那个。</p>
<p>如果你正在使用JCache，这很容易。首先，确保类路径上有<code>org.hibernate:hibernate-jcache</code>可用。然后，添加<code>HibernatePropertiesCustomizer</code> bean，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class HibernateSecondLevelCacheExample &#123;</span><br><span class="line"></span><br><span class="line">	@Bean</span><br><span class="line">	public HibernatePropertiesCustomizer hibernateSecondLevelCacheCustomizer(</span><br><span class="line">			JCacheCacheManager cacheManager) &#123;</span><br><span class="line">		return (properties) -&gt; properties.put(ConfigSettings.CACHE_MANAGER,</span><br><span class="line">				cacheManager.getCacheManager());</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此自定义程序将配置Hibernate使用与应用程序使用的<code>CacheManager</code>相同的<code>CacheManager</code>。也可以使用单独的<code>CacheManager</code>实例。有关详细信息，请参阅<a target="_blank" rel="noopener" href="https://docs.jboss.org/hibernate/orm/5.3/userguide/html_single/Hibernate_User_Guide.html#caching-provider-jcache">Hibernate用户指南</a>。</p>
<h2 id="84-8在Hibernate组件中使用依赖注入"><a href="#84-8在Hibernate组件中使用依赖注入" class="headerlink" title="84.8在Hibernate组件中使用依赖注入"></a>84.8在Hibernate组件中使用依赖注入</h2><p>默认情况下，Spring Boot注册使用<code>BeanFactory</code>的<code>BeanContainer</code>实现，以便转换器和实体侦听器可以使用常规依赖项注入。</p>
<p>您可以通过注册删除或更改<code>hibernate.resource.beans.container</code>属性的<code>HibernatePropertiesCustomizer</code>来禁用或调整此行为。</p>
<h2 id="84-9使用自定义EntityManagerFactory"><a href="#84-9使用自定义EntityManagerFactory" class="headerlink" title="84.9使用自定义EntityManagerFactory"></a>84.9使用自定义EntityManagerFactory</h2><p>要完全控制<code>EntityManagerFactory</code>的配置，您需要添加名为’entityManagerFactory’的<code>@Bean</code>。Spring Boot auto-configuration在存在bean类型的情况下关闭其实体管理器。</p>
<h2 id="84-10使用两个EntityManagers"><a href="#84-10使用两个EntityManagers" class="headerlink" title="84.10使用两个EntityManagers"></a>84.10使用两个EntityManagers</h2><p>即使默认<code>EntityManagerFactory</code>工作正常，您也需要定义一个新的。否则，该类型的第二个bean的存在将关闭默认值。为方便起见，您可以使用Spring Boot提供的方便<code>EntityManagerBuilder</code>。或者，您可以直接从Spring ORM获取<code>LocalContainerEntityManagerFactoryBean</code>，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; add two data sources configured as above</span><br><span class="line"></span><br><span class="line">@Bean</span><br><span class="line">public LocalContainerEntityManagerFactoryBean customerEntityManagerFactory(</span><br><span class="line">		EntityManagerFactoryBuilder builder) &#123;</span><br><span class="line">	return builder</span><br><span class="line">			.dataSource(customerDataSource())</span><br><span class="line">			.packages(Customer.class)</span><br><span class="line">			.persistenceUnit(&quot;customers&quot;)</span><br><span class="line">			.build();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Bean</span><br><span class="line">public LocalContainerEntityManagerFactoryBean orderEntityManagerFactory(</span><br><span class="line">		EntityManagerFactoryBuilder builder) &#123;</span><br><span class="line">	return builder</span><br><span class="line">			.dataSource(orderDataSource())</span><br><span class="line">			.packages(Order.class)</span><br><span class="line">			.persistenceUnit(&quot;orders&quot;)</span><br><span class="line">			.build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的配置几乎可以单独使用。要完成图片，您还需要为两个<code>EntityManagers</code>配置<code>TransactionManagers</code>。如果您将其中一个标记为<code>@Primary</code>，则可以通过Spring Boot中的默认<code>JpaTransactionManager</code>来获取它。另一个必须明确地注入新实例。或者，您可以使用跨越两者的JTA事务管理器。</p>
<p>如果您使用Spring数据，则需要相应地配置<code>@EnableJpaRepositories</code>，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@EnableJpaRepositories(basePackageClasses &#x3D; Customer.class,</span><br><span class="line">		entityManagerFactoryRef &#x3D; &quot;customerEntityManagerFactory&quot;)</span><br><span class="line">public class CustomerConfiguration &#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Configuration</span><br><span class="line">@EnableJpaRepositories(basePackageClasses &#x3D; Order.class,</span><br><span class="line">		entityManagerFactoryRef &#x3D; &quot;orderEntityManagerFactory&quot;)</span><br><span class="line">public class OrderConfiguration &#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="84-11使用繁体persistence-xml文件"><a href="#84-11使用繁体persistence-xml文件" class="headerlink" title="84.11使用繁体persistence.xml文件"></a>84.11使用繁体<code>persistence.xml</code>文件</h2><p>Spring Boot默认情况下不会搜索或使用<code>META-INF/persistence.xml</code>。如果您更喜欢使用传统的<code>persistence.xml</code>，则需要定义自己的<code>LocalEntityManagerFactoryBean</code>类型<code>LocalEntityManagerFactoryBean</code>（ID为“entityManagerFactory”）并在其中设置持久性单元名称。</p>
<p>请参阅 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/orm/jpa/JpaBaseConfiguration.java"><code>JpaBaseConfiguration</code></a> 默认设置。</p>
<h2 id="84-12使用Spring数据JPA和Mongo存储库"><a href="#84-12使用Spring数据JPA和Mongo存储库" class="headerlink" title="84.12使用Spring数据JPA和Mongo存储库"></a>84.12使用Spring数据JPA和Mongo存储库</h2><p>Spring数据JPA和Spring Data Mongo都可以自动为您创建<code>Repository</code>实现。如果它们都存在于类路径中，则可能需要执行一些额外配置以告知Spring Boot要创建哪些存储库。最明确的方法是使用标准的Spring数据<code>@EnableJpaRepositories</code>和<code>@EnableMongoRepositories</code>注释，并提供<code>Repository</code>接口的位置。</p>
<p>还有标志（<code>spring.data.*.repositories.enabled</code>和<code>spring.data.*.repositories.type</code>）可用于在外部配置中打开和关闭自动配置的存储库。这样做很有用，例如，如果您想关闭Mongo存储库并仍然使用自动配置的<code>MongoTemplate</code>。</p>
<p>其他自动配置的Spring数据存储库类型（Elasticsearch，Solr等）存在相同的障碍和相同的功能。要使用它们，请相应地更改注释和标志的名称。</p>
<h2 id="84-13自定义Spring数据的Web支持"><a href="#84-13自定义Spring数据的Web支持" class="headerlink" title="84.13自定义Spring数据的Web支持"></a>84.13自定义Spring数据的Web支持</h2><p>Spring数据提供Web支持，简化了Web应用程序中Spring数据存储库的使用。Spring Boot提供<code>spring.data.web</code>命名空间中的属性以自定义其配置。请注意，如果您使用的是Spring Data REST，则必须使用<code>spring.data.rest</code>命名空间中的属性。</p>
<h2 id="84-14将Spring数据存储库公开为REST端点"><a href="#84-14将Spring数据存储库公开为REST端点" class="headerlink" title="84.14将Spring数据存储库公开为REST端点"></a>84.14将Spring数据存储库公开为REST端点</h2><p>Spring数据REST可以为您提供<code>Repository</code>实现作为REST端点，前提是已为应用程序启用了Spring MVC。</p>
<p>Spring Boot公开了一组自定义的有用属性（来自<code>spring.data.rest</code>命名空间） <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-data/rest/docs/current/api/org/springframework/data/rest/core/config/RepositoryRestConfiguration.html"><code>RepositoryRestConfiguration</code></a>。如果您需要提供其他自定义，则应使用 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-data/rest/docs/current/api/org/springframework/data/rest/webmvc/config/RepositoryRestConfigurer.html"><code>RepositoryRestConfigurer</code></a> bean。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果您未在自定义<code>RepositoryRestConfigurer</code>上指定任何订单，则会在内部使用Spring Boot之后运行。如果需要指定订单，请确保订单高于0。</td>
</tr>
</tbody></table>
<h2 id="84-15配置JPA使用的组件"><a href="#84-15配置JPA使用的组件" class="headerlink" title="84.15配置JPA使用的组件"></a>84.15配置JPA使用的组件</h2><p>如果要配置JPA使用的组件，则需要确保在JPA之前初始化组件。组件自动配置后，Spring Boot会为您处理此问题。例如，当Flyway自动配置时，Hibernate配置为依赖Flyway，以便Flyway有机会在Hibernate尝试使用它之前初始化数据库。</p>
<p>如果您自己配置组件，则可以使用<code>EntityManagerFactoryDependsOnPostProcessor</code>子类作为设置必要依赖项的便捷方法。例如，如果您将Hibernate Search与Elasticsearch一起用作其索引管理器，则必须将任何<code>EntityManagerFactory</code> beans配置为依赖于<code>elasticsearchClient</code> bean，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * &#123;@link EntityManagerFactoryDependsOnPostProcessor&#125; that ensures that</span><br><span class="line"> * &#123;@link EntityManagerFactory&#125; beans depend on the &#123;@code elasticsearchClient&#125; bean.</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Configuration</span><br><span class="line">static class ElasticsearchJpaDependencyConfiguration</span><br><span class="line">		extends EntityManagerFactoryDependsOnPostProcessor &#123;</span><br><span class="line"></span><br><span class="line">	ElasticsearchJpaDependencyConfiguration() &#123;</span><br><span class="line">		super(&quot;elasticsearchClient&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="84-16使用两个DataSource配置jOOQ"><a href="#84-16使用两个DataSource配置jOOQ" class="headerlink" title="84.16使用两个DataSource配置jOOQ"></a>84.16使用两个DataSource配置jOOQ</h2><p>如果您需要将jOOQ用于多个数据源，则应为每个数据源创建自己的<code>DSLContext</code>。 有关更多详细信息，请参阅 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jooq/JooqAutoConfiguration.java">JooqAutoConfiguration</a>。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>特别是，<code>JooqExceptionTranslator</code>和<code>SpringTransactionProvider</code>可以重复使用，以提供与单个<code>DataSource</code>自动配置相似的功能。</td>
</tr>
</tbody></table>
<h2 id="85-数据库初始化"><a href="#85-数据库初始化" class="headerlink" title="85.数据库初始化"></a>85.数据库初始化</h2><p>可以使用不同的方式初始化SQL数据库，具体取决于堆栈的内容。当然，如果数据库是一个单独的进程，您也可以手动执行此操作。</p>
<h2 id="85-1使用JPA初始化数据库"><a href="#85-1使用JPA初始化数据库" class="headerlink" title="85.1使用JPA初始化数据库"></a>85.1使用JPA初始化数据库</h2><p>JPA具有DDL生成功能，可以将这些功能设置为在数据库启动时运行。这是通过两个外部属性控制的：</p>
<ul>
<li><code>spring.jpa.generate-ddl</code>（布尔值）打开和关闭该功能，与供应商无关。</li>
<li><code>spring.jpa.hibernate.ddl-auto</code>（枚举）是一种Hibernate功能，它以更细粒度的方式控制行为。本指南后面将详细介绍此功能。</li>
</ul>
<h2 id="85-2使用Hibernate初始化数据库"><a href="#85-2使用Hibernate初始化数据库" class="headerlink" title="85.2使用Hibernate初始化数据库"></a>85.2使用Hibernate初始化数据库</h2><p>您可以显式设置<code>spring.jpa.hibernate.ddl-auto</code>，标准Hibernate属性值为<code>none</code>，<code>validate</code>，<code>update</code>，<code>create</code>和<code>create-drop</code>。Spring Boot根据是否认为您的数据库是嵌入式的，为您选择默认值。如果未检测到架构管理器，则默认为<code>create-drop</code>;在所有其他情况下，默认为<code>none</code>。通过查看<code>Connection</code>类型来检测嵌入式数据库。<code>hsqldb</code>，<code>h2</code>和<code>derby</code>是嵌入的，而其他则不是。从内存切换到“真实”数据库时要小心，不要假设新平台中存在表和数据。您必须显式设置<code>ddl-auto</code>或使用其他机制之一来初始化数据库。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>您可以通过启用<code>org.hibernate.SQL</code>记录器来输出架构创建。如果启用<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-logging-console-output">调试模式</a>，则会自动完成此 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-logging-console-output">操作</a>。</td>
</tr>
</tbody></table>
<p>此外，如果Hibernate从头开始创建模式（即，如果<code>ddl-auto</code>属性设置为<code>create</code>或<code>create-drop</code>，则会在启动时执行类路径根目录中名为<code>import.sql</code>的文件）。这对于演示和测试很有用，如果你小心，但可能不是你想要在生产中的类路径上。它是一个Hibernate功能（与Spring无关）。</p>
<h2 id="85-3初始化数据库"><a href="#85-3初始化数据库" class="headerlink" title="85.3初始化数据库"></a>85.3初始化数据库</h2><p>Spring Boot可以自动创建<code>DataSource</code>的模式（DDL脚本）并初始化它（DML脚本）。它从标准根类路径位置加载SQL：<code>schema.sql</code>和<code>data.sql</code>。此外，Spring Boot处理<code>schema-$&#123;platform&#125;.sql</code>和<code>data-$&#123;platform&#125;.sql</code>文件（如果存在），其中<code>platform</code>是<code>spring.datasource.platform</code>的值。这允许您在必要时切换到特定于数据库的脚本。例如，您可以选择将其设置为数据库的供应商名称（<code>hsqldb</code>，<code>h2</code>，<code>oracle</code>，<code>mysql</code>，<code>postgresql</code>等等）。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>Spring Boot自动创建嵌入式<code>DataSource</code>的架构。可以使用<code>spring.datasource.initialization-mode</code>属性自定义此行为。例如，如果您想要始终初始化<code>DataSource</code>，无论其类型如何：<code>spring.datasource.initialization-mode=always</code></td>
</tr>
</tbody></table>
<p>默认情况下，Spring Boot启用Spring JDBC初始化程序的快速失败功能。这意味着，如果脚本导致异常，则应用程序无法启动。您可以通过设置<code>spring.datasource.continue-on-error</code>来调整该行为。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>在基于JPA的应用程序中，您可以选择让Hibernate创建架构或使用<code>schema.sql</code>，但您不能同时执行这两项操作。如果您使用<code>schema.sql</code>，请务必禁用<code>spring.jpa.hibernate.ddl-auto</code>。</td>
</tr>
</tbody></table>
<h2 id="85-4初始化Spring批处理数据库"><a href="#85-4初始化Spring批处理数据库" class="headerlink" title="85.4初始化Spring批处理数据库"></a>85.4初始化Spring批处理数据库</h2><p>如果您使用Spring Batch，它会预先打包用于大多数流行数据库平台的SQL初始化脚本。Spring Boot可以检测您的数据库类型并在启动时执行这些脚本。如果使用嵌入式数据库，默认情况下会发生这种情况。您还可以为任何数据库类型启用它，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.batch.initialize-schema&#x3D;always</span><br></pre></td></tr></table></figure>

<p>您还可以通过设置<code>spring.batch.initialize-schema=never</code>显式关闭初始化。</p>
<h2 id="85-5使用更高级别的数据库迁移工具"><a href="#85-5使用更高级别的数据库迁移工具" class="headerlink" title="85.5使用更高级别的数据库迁移工具"></a>85.5使用更高级别的数据库迁移工具</h2><p>Spring Boot支持两种更高级别的迁移工具：<a target="_blank" rel="noopener" href="https://flywaydb.org/">迁飞</a> 和<a target="_blank" rel="noopener" href="http://www.liquibase.org/">Liquibase</a>。</p>
<h3 id="85-5-1在启动时执行Flyway数据库迁移"><a href="#85-5-1在启动时执行Flyway数据库迁移" class="headerlink" title="85.5.1在启动时执行Flyway数据库迁移"></a>85.5.1在启动时执行Flyway数据库迁移</h3><p>要在启动时自动运行Flyway数据库迁移，请将<code>org.flywaydb:flyway-core</code>添加到类路径中。</p>
<p>迁移是<code>V&lt;VERSION&gt;__&lt;NAME&gt;.sql</code>形式的脚本（<code>&lt;VERSION&gt;</code>是下划线分隔的版本，例如’1’或’2_1’）。默认情况下，它们位于名为<code>classpath:db/migration</code>的文件夹中，但您可以通过设置<code>spring.flyway.locations</code>来修改该位置。这是一个以逗号分隔的列表，其中包含一个或多个<code>classpath:</code>或<code>filesystem:</code>位置。例如，以下配置将在默认类路径位置和<code>/opt/migration</code>目录中搜索脚本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.flyway.locations&#x3D;classpath:db&#x2F;migration,filesystem:&#x2F;opt&#x2F;migration</span><br></pre></td></tr></table></figure>

<p>您还可以添加特殊的<code>&#123;vendor&#125;</code>占位符以使用特定于供应商的脚本。假设如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.flyway.locations&#x3D;classpath:db&#x2F;migration&#x2F;&#123;vendor&#125;</span><br></pre></td></tr></table></figure>

<p>前面的配置不是使用<code>db/migration</code>，而是根据数据库的类型设置要使用的文件夹（例如MySQL的<code>db/migration/mysql</code>）。支持的数据库列表可在以下位置找到 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/jdbc/DatabaseDriver.java"><code>DatabaseDriver</code></a>。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/flyway/FlywayProperties.java"><code>FlywayProperties</code></a> 提供大部分Flyway的设置和一小组其他属性，可用于禁用迁移或关闭位置检查。如果您需要更多控制配置，请考虑注册<code>FlywayConfigurationCustomizer</code> bean。</p>
<p>Spring Boot调用<code>Flyway.migrate()</code>来执行数据库迁移。如果您想要更多控制权，请提供实施的<code>@Bean</code> <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/flyway/FlywayMigrationStrategy.java"><code>FlywayMigrationStrategy</code></a>。</p>
<p>Flyway支持SQL和Java <a target="_blank" rel="noopener" href="https://flywaydb.org/documentation/callbacks.html">回调</a>。要使用基于SQL的回调，请将回调脚本放在<code>classpath:db/migration</code>文件夹中。要使用基于Java的回调，请创建一个或多个实现<code>Callback</code>的beans。任何此类beans都会自动注册<code>Flyway</code>。可以使用<code>@Order</code>或实施<code>Ordered</code>订购。也可以检测到实现已弃用的<code>FlywayCallback</code>接口的Beans，但它们不能与<code>Callback</code> beans一起使用。</p>
<p>默认情况下，Flyway会在您的上下文中自动装配（<code>@Primary</code>）<code>DataSource</code>并将其用于迁移。如果您想使用其他<code>DataSource</code>，则可以创建一个<code>@Bean</code>并将其标记为<code>@FlywayDataSource</code>。如果您这样做并想要两个数据源，请记住创建另一个数据源并将其标记为<code>@Primary</code>。或者，您可以通过在外部属性中设置<code>spring.flyway.[url,user,password]</code>来使用Flyway的原生<code>DataSource</code>。设置<code>spring.flyway.url</code>或<code>spring.flyway.user</code>足以使Flyway使用自己的<code>DataSource</code>。如果未设置三个属性中的任何一个，将使用其等效<code>spring.datasource</code>属性的值。</p>
<p>有一个<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-samples/spring-boot-sample-flyway">Flyway示例</a>，您可以看到如何设置。</p>
<p>您还可以使用Flyway为特定方案提供数据。例如，您可以在<code>src/test/resources</code>中放置特定于测试的迁移，并且只有在应用程序启动测试时才会运行它们。此外，您可以使用特定于配置文件的配置来自定义<code>spring.flyway.locations</code>，以便某些迁移仅在特定配置文件处于活动状态时运行。例如，在<code>application-dev.properties</code>中，您可以指定以下设置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.flyway.locations&#x3D;classpath:&#x2F;db&#x2F;migration,classpath:&#x2F;dev&#x2F;db&#x2F;migration</span><br></pre></td></tr></table></figure>

<p>使用该设置，<code>dev/db/migration</code>中的迁移仅在<code>dev</code>配置文件处于活动状态时运行。</p>
<h3 id="85-5-2在启动时执行Liquibase数据库迁移"><a href="#85-5-2在启动时执行Liquibase数据库迁移" class="headerlink" title="85.5.2在启动时执行Liquibase数据库迁移"></a>85.5.2在启动时执行Liquibase数据库迁移</h3><p>要在启动时自动运行Liquibase数据库迁移，请将<code>org.liquibase:liquibase-core</code>添加到类路径中。</p>
<p>默认情况下，主更改日志是从<code>db/changelog/db.changelog-master.yaml</code>读取的，但您可以通过设置<code>spring.liquibase.change-log</code>来更改位置。除了YAML，Liquibase还支持JSON，XML和SQL更改日志格式。</p>
<p>默认情况下，Liquibase会在您的上下文中自动装配（<code>@Primary</code>）<code>DataSource</code>并将其用于迁移。如果您需要使用其他<code>DataSource</code>，则可以创建一个<code>@Bean</code>并将其标记为<code>@LiquibaseDataSource</code>。如果您这样做并且想要两个数据源，请记住创建另一个数据源并将其标记为<code>@Primary</code>。或者，您可以通过在外部属性中设置<code>spring.liquibase.[url,user,password]</code>来使用Liquibase的本机<code>DataSource</code>。设置<code>spring.liquibase.url</code>或<code>spring.liquibase.user</code>足以使Liquibase使用自己的<code>DataSource</code>。如果未设置三个属性中的任何一个，将使用其等效<code>spring.datasource</code>属性的值。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/liquibase/LiquibaseProperties.java"><code>LiquibaseProperties</code></a> 有关可用设置的详细信息，请参阅 上下文，默认架构等。</p>
<p>有一个<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-samples/spring-boot-sample-liquibase">Liquibase样本，</a>以便您可以看到如何设置。</p>
<h2 id="86-消息传递"><a href="#86-消息传递" class="headerlink" title="86.消息传递"></a>86.消息传递</h2><p>Spring Boot提供了许多包含消息传递的初学者。本节回答使用Spring Boot消息传递产生的问题。</p>
<h2 id="86-1禁用事务处理的JMS会话"><a href="#86-1禁用事务处理的JMS会话" class="headerlink" title="86.1禁用事务处理的JMS会话"></a>86.1禁用事务处理的JMS会话</h2><p>如果您的JMS代理不支持事务会话，则必须完全禁用事务支持。如果您创建自己的<code>JmsListenerContainerFactory</code>，则无需执行任何操作，因为默认情况下无法进行交易。如果要使用<code>DefaultJmsListenerContainerFactoryConfigurer</code>重用Spring Boot的默认值，可以禁用事务处理会话，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">public DefaultJmsListenerContainerFactory jmsListenerContainerFactory(</span><br><span class="line">		ConnectionFactory connectionFactory,</span><br><span class="line">		DefaultJmsListenerContainerFactoryConfigurer configurer) &#123;</span><br><span class="line">	DefaultJmsListenerContainerFactory listenerFactory &#x3D;</span><br><span class="line">			new DefaultJmsListenerContainerFactory();</span><br><span class="line">	configurer.configure(listenerFactory, connectionFactory);</span><br><span class="line">	listenerFactory.setTransactionManager(null);</span><br><span class="line">	listenerFactory.setSessionTransacted(false);</span><br><span class="line">	return listenerFactory;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的示例将覆盖默认工厂，并且应该应用于应用程序定义的任何其他工厂（如果有）。</p>
<h2 id="87-批量申请"><a href="#87-批量申请" class="headerlink" title="87.批量申请"></a>87.批量申请</h2><p>本节回答了使用Spring批处理Spring Boot时出现的问题。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>默认情况下，批处理应用程序需要<code>DataSource</code>来存储作业详细信息。如果你想偏离它，你需要实现<code>BatchConfigurer</code>。有关详细信息，请参阅 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-batch/apidocs/org/springframework/batch/core/configuration/annotation/EnableBatchProcessing.html"><code>@EnableBatchProcessing</code>的Javadoc</a>。</td>
</tr>
</tbody></table>
<p>有关Spring Batch的更多信息，请参阅<a target="_blank" rel="noopener" href="https://projects.spring.io/spring-batch/">Spring批处理项目页面</a>。</p>
<h2 id="87-1在启动时执行Spring批处理作业"><a href="#87-1在启动时执行Spring批处理作业" class="headerlink" title="87.1在启动时执行Spring批处理作业"></a>87.1在启动时执行Spring批处理作业</h2><p>Spring通过在上下文中的某处添加<code>@EnableBatchProcessing</code>（来自Spring批处理）来启用批量自动配置。</p>
<p>默认情况下，它在启动时在应用程序上下文中执行<strong>所有</strong> <code>Jobs</code>（ 有关详细信息，请参阅 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/batch/JobLauncherCommandLineRunner.java">JobLauncherCommandLineRunner</a>）。您可以通过指定<code>spring.batch.job.names</code>（以逗号分隔的作业名称模式列表）缩小到特定作业或作业的范围。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>与<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-external-config-command-line-args">在<code>Environment</code></a>中<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-external-config-command-line-args">设置属性的</a>命令行选项参数 （即以<code>--</code>开头，例如<code>--my-property=value</code>）不同，必须在命令行上指定作业参数而不使用破折号（例如<code>jobParam=value</code> ）。</td>
</tr>
</tbody></table>
<p>如果应用程序上下文包含<code>JobRegistry</code>，则<code>spring.batch.job.names</code>中的作业将在注册表中查找，而不是从上下文中自动装配。这是一个具有更复杂系统的常见模式，其中多个作业在子上下文中定义并集中注册。</p>
<p>有关 更多详细信息，请参阅 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/batch/BatchAutoConfiguration.java">BatchAutoConfiguration</a> 和 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-batch/blob/master/spring-batch-core/src/main/java/org/springframework/batch/core/configuration/annotation/EnableBatchProcessing.java">@EnableBatchProcessing</a>。</p>
<h2 id="88-执行器"><a href="#88-执行器" class="headerlink" title="88.执行器"></a>88.执行器</h2><p>Spring Boot包括Spring Boot Actuator。本节回答了其使用中经常出现的问题。</p>
<h2 id="88-1更改执行器端点的HTTP端口或地址"><a href="#88-1更改执行器端点的HTTP端口或地址" class="headerlink" title="88.1更改执行器端点的HTTP端口或地址"></a>88.1更改执行器端点的HTTP端口或地址</h2><p>在独立应用程序中，Actuator HTTP端口默认与主HTTP端口相同。要使应用程序侦听其他端口，请设置外部属性：<code>management.server.port</code>。要侦听完全不同的网络地址（例如，当您有用于管理的内部网络和用于用户应用程序的外部网络时），您还可以将<code>management.server.address</code>设置为服务器能够绑定的有效IP地址。</p>
<p>有关更多详细信息，请参阅“生产就绪功能”部分中的 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/web/server/ManagementServerProperties.java"><code>ManagementServerProperties</code></a> 源代码和“ <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready-customizing-management-server-port">第54.2节</a> ” <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#production-ready-customizing-management-server-port">，“自定义管理服务器端口”</a> “。</p>
<h2 id="88-2自定义’whitelabel’错误页面"><a href="#88-2自定义’whitelabel’错误页面" class="headerlink" title="88.2自定义’whitelabel’错误页面"></a>88.2自定义’whitelabel’错误页面</h2><p>Spring Boot如果您遇到服务器错误，则会在浏览器客户端中安装“whitelabel”错误页面（使用JSON和其他媒体类型的计算机客户端应该看到具有正确错误代码的合理响应）。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>设置<code>server.error.whitelabel.enabled=false</code>以关闭默认错误页面。这样做会恢复您正在使用的servlet容器的默认值。请注意，Spring Boot仍尝试解决错误视图，因此您应该添加自己的错误页面，而不是完全禁用它。</td>
</tr>
</tbody></table>
<p>使用您自己的错误页面覆盖错误页面取决于您使用的模板技术。例如，如果您使用Thymeleaf，则可以添加<code>error.html</code>模板。如果您使用FreeMarker，则可以添加<code>error.ftl</code>模板。通常，您需要<code>View</code>，其名称为<code>error</code>或<code>@Controller</code>处理<code>/error</code>路径。除非您替换了某些默认配置，否则您应该在<code>ApplicationContext</code>中找到<code>BeanNameViewResolver</code>，因此名为<code>error</code>的<code>@Bean</code>将是一种简单的方法。有关<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/servlet/error/ErrorMvcAutoConfiguration.java"><code>ErrorMvcAutoConfiguration</code></a> 更多选项，请参阅</p>
<p>有关如何在servlet容器中注册处理程序的详细信息，另请参阅“ <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-error-handling">错误处理</a> ” 一节。</p>
<h2 id="88-3消除敏感价值"><a href="#88-3消除敏感价值" class="headerlink" title="88.3消除敏感价值"></a>88.3消除敏感价值</h2><p><code>env</code>和<code>configprops</code>端点返回的信息可能有些敏感，因此默认情况下将匹配特定模式的密钥进行清理（即它们的值由<code>******</code>替换）。</p>
<p>Spring Boot使用这些密钥的合理默认值：例如，任何以“password”，“secret”，“key”或“token”结尾的密钥都将被清理。也可以使用正则表达式，例如<code>*credentials.*</code>来清理任何将单词<code>credentials</code>作为键的一部分的键。</p>
<p>可以使用<code>management.endpoint.env.keys-to-sanitize</code>和<code>management.endpoint.configprops.keys-to-sanitize</code>分别自定义要使用的模式。</p>
<h2 id="89-安全"><a href="#89-安全" class="headerlink" title="89.安全"></a>89.安全</h2><p>本节介绍使用Spring Boot时有关安全性的问题，包括使用Spring安全性Spring Boot时出现的问题。</p>
<p>有关Spring安全性的更多信息，请参阅<a target="_blank" rel="noopener" href="https://projects.spring.io/spring-security/">Spring安全项目页面</a>。</p>
<h2 id="89-1关闭Spring-Boot安全配置"><a href="#89-1关闭Spring-Boot安全配置" class="headerlink" title="89.1关闭Spring Boot安全配置"></a>89.1关闭Spring Boot安全配置</h2><p>如果您在应用程序中使用<code>WebSecurityConfigurerAdapter</code>定义<code>@Configuration</code>，则会关闭Spring Boot中的默认Webapp安全设置。</p>
<h2 id="89-2更改UserDetailsService和添加用户帐户"><a href="#89-2更改UserDetailsService和添加用户帐户" class="headerlink" title="89.2更改UserDetailsService和添加用户帐户"></a>89.2更改UserDetailsService和添加用户帐户</h2><p>如果您提供的<code>@Bean</code>类型为<code>AuthenticationManager</code>，<code>AuthenticationProvider</code>或<code>UserDetailsService</code>，则不会创建<code>InMemoryUserDetailsManager</code>的默认<code>@Bean</code>，因此您拥有{的完整功能集15 /}安全可用（例如各种身份验证选项）。<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-security/site/docs/current/reference/htmlsingle/#jc-authentication">各种身份验证选项</a>）。</p>
<p>添加用户帐户的最简单方法是提供您自己的<code>UserDetailsService</code> bean。</p>
<h2 id="89-3在代理服务器后面运行时启用HTTPS"><a href="#89-3在代理服务器后面运行时启用HTTPS" class="headerlink" title="89.3在代理服务器后面运行时启用HTTPS"></a>89.3在代理服务器后面运行时启用HTTPS</h2><p>确保所有主要端点仅通过HTTPS可用是任何应用程序的重要工作。如果你使用Tomcat作为servlet容器，那么Spring Boot会自动添加Tomcat自己的<code>RemoteIpValve</code>，如果它检测到一些环境设置，你应该能够依靠<code>HttpServletRequest</code>来报告它是否安全（甚至是处理真正SSL终止的代理服务器的下游）。标准行为取决于某些请求标头（<code>x-forwarded-for</code>和<code>x-forwarded-proto</code>）的存在与否，其名称是常规的，因此它应该适用于大多数前端代理。您可以通过向<code>application.properties</code>添加一些条目来打开阀门，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">server.tomcat.remote-ip-header&#x3D;x-forwarded-for</span><br><span class="line">server.tomcat.protocol-header&#x3D;x-forwarded-proto</span><br></pre></td></tr></table></figure>

<p>（这些属性中的任何一个的存在都会打开阀门。或者，您可以通过添加<code>TomcatServletWebServerFactory</code> bean来添加<code>RemoteIpValve</code>。）</p>
<p>要将Spring安全性配置为要求所有（或某些）请求的安全通道，请考虑添加自己的<code>WebSecurityConfigurerAdapter</code>，以添加以下<code>HttpSecurity</code>配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class SslWebSecurityConfigurerAdapter extends WebSecurityConfigurerAdapter &#123;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	protected void configure(HttpSecurity http) throws Exception &#123;</span><br><span class="line">		&#x2F;&#x2F; Customize the application security</span><br><span class="line">		http.requiresChannel().anyRequest().requiresSecure();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="90-热插拔"><a href="#90-热插拔" class="headerlink" title="90.热插拔"></a>90.热插拔</h2><p>Spring Boot支持热交换。本节回答有关其工作原理的问题。</p>
<h2 id="90-1重新加载静态内容"><a href="#90-1重新加载静态内容" class="headerlink" title="90.1重新加载静态内容"></a>90.1重新加载静态内容</h2><p>热重新加载有几种选择。推荐的方法是使用 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-devtools"><code>spring-boot-devtools</code></a>，因为它提供了额外的开发时间功能，例如支持快速应用程序重启和LiveReload以及合理的开发时配置（例如模板缓存）。Devtools通过监视类路径进行更改来工作。这意味着必须“构建”静态资源更改才能使更改生效。默认情况下，当您保存更改时，这会在Eclipse中自动发生。在IntelliJ IDEA中，Make Project命令会触发必要的构建。由于 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-devtools-restart-exclude">默认的重新启动排除</a>，对静态资源的更改不会触发应用程序的重新启动。但是，它们会触发实时重新加载。</p>
<p>或者，在IDE中运行（特别是在调试时）是进行开发的好方法（所有现代IDE都允许重新加载静态资源，并且通常还允许热插拔Java类更改）。</p>
<p>最后，可以配置<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#build-tool-plugins">Maven和Gradle插件</a>（请参阅<code>addResources</code>属性）以支持从命令行运行，并直接从源重新加载静态文件。如果您使用更高级别的工具编写该代码，则可以将其与外部css / js编译器进程一起使用。</p>
<h2 id="90-2重新加载模板而不重新启动容器"><a href="#90-2重新加载模板而不重新启动容器" class="headerlink" title="90.2重新加载模板而不重新启动容器"></a>90.2重新加载模板而不重新启动容器</h2><p>Spring Boot支持的大多数模板技术都包括禁用缓存的配置选项（本文档后面会介绍）。如果使用<code>spring-boot-devtools</code>模块， 则会在开发时<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-devtools-property-defaults">自动</a>为您<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-devtools-property-defaults">配置</a>这些属性 。</p>
<h3 id="90-2-1-Thymeleaf模板"><a href="#90-2-1-Thymeleaf模板" class="headerlink" title="90.2.1 Thymeleaf模板"></a>90.2.1 Thymeleaf模板</h3><p>如果您使用Thymeleaf，请将<code>spring.thymeleaf.cache</code>设置为<code>false</code>。查看 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/thymeleaf/ThymeleafAutoConfiguration.java"><code>ThymeleafAutoConfiguration</code></a> 其他Thymeleaf自定义选项。</p>
<h3 id="90-2-2-FreeMarker模板"><a href="#90-2-2-FreeMarker模板" class="headerlink" title="90.2.2 FreeMarker模板"></a>90.2.2 FreeMarker模板</h3><p>如果您使用FreeMarker，请将<code>spring.freemarker.cache</code>设置为<code>false</code>。有关<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/freemarker/FreeMarkerAutoConfiguration.java"><code>FreeMarkerAutoConfiguration</code></a> 其他FreeMarker自定义选项，请参阅 。</p>
<h3 id="90-2-3-Groovy模板"><a href="#90-2-3-Groovy模板" class="headerlink" title="90.2.3 Groovy模板"></a>90.2.3 Groovy模板</h3><p>如果您使用Groovy模板，请将<code>spring.groovy.template.cache</code>设置为<code>false</code>。请参阅 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/groovy/template/GroovyTemplateAutoConfiguration.java"><code>GroovyTemplateAutoConfiguration</code></a> 其他Groovy自定义选项。</p>
<h2 id="90-3快速应用程序重新启动"><a href="#90-3快速应用程序重新启动" class="headerlink" title="90.3快速应用程序重新启动"></a>90.3快速应用程序重新启动</h2><p><code>spring-boot-devtools</code>模块包括对自动应用程序重启的支持。虽然没有像<a target="_blank" rel="noopener" href="http://zeroturnaround.com/software/jrebel/">JRebel</a>这样的技术那么快， 但它通常比“冷启动”快得多。在调查本文档后面讨论的一些更复杂的重载选项之前，您应该尝试一下。</p>
<p>有关更多详细信息，请参阅<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#using-boot-devtools">第20章“ <em>开发人员工具”</em></a>部分。</p>
<h2 id="90-4重新加载Java类而不重新启动容器"><a href="#90-4重新加载Java类而不重新启动容器" class="headerlink" title="90.4重新加载Java类而不重新启动容器"></a>90.4重新加载Java类而不重新启动容器</h2><p>许多现代IDE（Eclipse，IDEA和其他）支持字节码的热交换。因此，如果您进行的更改不会影响类或方法签名，则应该干净地重新加载，不会产生任何副作用。</p>
<h2 id="91-建立"><a href="#91-建立" class="headerlink" title="91.建立"></a>91.建立</h2><p>Spring Boot包括Maven和Gradle的构建插件。本节回答有关这些插件的常见问题。</p>
<h2 id="91-1生成构建信息"><a href="#91-1生成构建信息" class="headerlink" title="91.1生成构建信息"></a>91.1生成构建信息</h2><p>Maven插件和Gradle插件都允许生成包含项目的坐标，名称和版本的构建信息。插件还可以配置为通过配置添加其他属性。当存在这样的文件时，Spring Boot会自动配置<code>BuildProperties</code> bean。</p>
<p>要使用Maven生成构建信息，请为<code>build-info</code>目标添加执行，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">	&lt;plugins&gt;</span><br><span class="line">		&lt;plugin&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-boot-maven-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">			&lt;version&gt;2.1.1.RELEASE&lt;&#x2F;version&gt;</span><br><span class="line">			&lt;executions&gt;</span><br><span class="line">				&lt;execution&gt;</span><br><span class="line">					&lt;goals&gt;</span><br><span class="line">						&lt;goal&gt;build-info&lt;&#x2F;goal&gt;</span><br><span class="line">					&lt;&#x2F;goals&gt;</span><br><span class="line">				&lt;&#x2F;execution&gt;</span><br><span class="line">			&lt;&#x2F;executions&gt;</span><br><span class="line">		&lt;&#x2F;plugin&gt;</span><br><span class="line">	&lt;&#x2F;plugins&gt;</span><br><span class="line">&lt;&#x2F;build&gt;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>有关详细信息，请参阅<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/maven-plugin">Spring Boot Maven插件文档</a> 。</td>
</tr>
</tbody></table>
<p>以下示例对Gradle执行相同的操作：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">springBoot &#123;</span><br><span class="line">	buildInfo()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>有关详细信息，请参阅 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/gradle-plugin/reference/html/#integrating-with-actuator-build-info">Spring Boot Gradle插件文档</a>。</td>
</tr>
</tbody></table>
<h2 id="91-2生成Git信息"><a href="#91-2生成Git信息" class="headerlink" title="91.2生成Git信息"></a>91.2生成Git信息</h2><p>Maven和Gradle都允许生成<code>git.properties</code>文件，其中包含有关项目构建时<code>git</code>源代码存储库状态的信息。</p>
<p>对于Maven用户，<code>spring-boot-starter-parent</code> POM包含一个预先配置的插件，用于生成<code>git.properties</code>文件。要使用它，请将以下声明添加到POM：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">	&lt;plugins&gt;</span><br><span class="line">		&lt;plugin&gt;</span><br><span class="line">			&lt;groupId&gt;pl.project13.maven&lt;&#x2F;groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;git-commit-id-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">		&lt;&#x2F;plugin&gt;</span><br><span class="line">	&lt;&#x2F;plugins&gt;</span><br><span class="line">&lt;&#x2F;build&gt;</span><br></pre></td></tr></table></figure>

<p>Gradle用户可以通过使用<a target="_blank" rel="noopener" href="https://plugins.gradle.org/plugin/com.gorylenko.gradle-git-properties"><code>gradle-git-properties</code></a> 插件获得相同的结果 ，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">plugins &#123;</span><br><span class="line">	id &quot;com.gorylenko.gradle-git-properties&quot; version &quot;1.5.1&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td><code>git.properties</code>中的提交时间应符合以下格式：<code>yyyy-MM-dd’T’HH:mm:ssZ</code>。这是上面列出的两个插件的默认格式。使用此格式可以将时间解析为<code>Date</code>及其格式，在序列化为JSON时，由Jackson的日期序列化配置设置控制。</td>
</tr>
</tbody></table>
<h2 id="91-3自定义依赖版本"><a href="#91-3自定义依赖版本" class="headerlink" title="91.3自定义依赖版本"></a>91.3自定义依赖版本</h2><p>如果您使用直接或间接从<code>spring-boot-dependencies</code>继承的Maven版本（例如，<code>spring-boot-starter-parent</code>）但您想要覆盖特定的第三方依赖项，则可以添加适当的<code>&lt;properties&gt;</code>元素。浏览 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-dependencies/pom.xml"><code>spring-boot-dependencies</code></a> POM以获取完整的属性列表。例如，要选择不同的<code>slf4j</code>版本，您需要添加以下属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;properties&gt;</span><br><span class="line">	&lt;slf4j.version&gt;1.7.5&lt;slf4j.version&gt;</span><br><span class="line">&lt;&#x2F;properties&gt;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>这样做只适用于Maven项目（直接或间接）从<code>spring-boot-dependencies</code>继承的情况。如果您使用<code>&lt;scope&gt;import&lt;/scope&gt;</code>在自己的<code>dependencyManagement</code>部分添加了<code>spring-boot-dependencies</code>，则必须自行重新定义工件，而不是覆盖该属性。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/warning.png" alt="[警告]"></th>
</tr>
</thead>
<tbody><tr>
<td>每个Spring Boot版本都是针对这组特定的第三方依赖项进行设计和测试的。覆盖版本可能会导致兼容性问题。</td>
</tr>
</tbody></table>
<p>要覆盖Gradle中的依赖项版本，请参阅 Gradle插件文档的<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/gradle-plugin/reference/html/#managing-dependencies-customizing">此部分</a>。</p>
<h2 id="91-4使用Maven创建可执行JAR"><a href="#91-4使用Maven创建可执行JAR" class="headerlink" title="91.4使用Maven创建可执行JAR"></a>91.4使用Maven创建可执行JAR</h2><p><code>spring-boot-maven-plugin</code>可用于创建可执行的“胖”JAR。如果你使用<code>spring-boot-starter-parent</code> POM，你可以声明插件，你的罐子重新包装如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">	&lt;plugins&gt;</span><br><span class="line">		&lt;plugin&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-boot-maven-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">		&lt;&#x2F;plugin&gt;</span><br><span class="line">	&lt;&#x2F;plugins&gt;</span><br><span class="line">&lt;&#x2F;build&gt;</span><br></pre></td></tr></table></figure>

<p>如果您不使用父POM，您仍然可以使用该插件。但是，您必须另外添加<code>&lt;executions&gt;</code>部分，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">	&lt;plugins&gt;</span><br><span class="line">		&lt;plugin&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-boot-maven-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">			&lt;version&gt;2.1.1.RELEASE&lt;&#x2F;version&gt;</span><br><span class="line">			&lt;executions&gt;</span><br><span class="line">				&lt;execution&gt;</span><br><span class="line">					&lt;goals&gt;</span><br><span class="line">						&lt;goal&gt;repackage&lt;&#x2F;goal&gt;</span><br><span class="line">					&lt;&#x2F;goals&gt;</span><br><span class="line">				&lt;&#x2F;execution&gt;</span><br><span class="line">			&lt;&#x2F;executions&gt;</span><br><span class="line">		&lt;&#x2F;plugin&gt;</span><br><span class="line">	&lt;&#x2F;plugins&gt;</span><br><span class="line">&lt;&#x2F;build&gt;</span><br></pre></td></tr></table></figure>

<p>有关完整的使用详细信息，请参阅<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/maven-plugin/usage.html">插件文档</a>。</p>
<h2 id="91-5使用Spring-Boot应用程序作为依赖关系"><a href="#91-5使用Spring-Boot应用程序作为依赖关系" class="headerlink" title="91.5使用Spring Boot应用程序作为依赖关系"></a>91.5使用Spring Boot应用程序作为依赖关系</h2><p>与war文件一样，Spring Boot应用程序不能用作依赖项。如果您的应用程序包含要与其他项目共享的类，则建议的方法是将该代码移动到单独的模块中。然后，您的应用程序和其他项目可以依赖单独的模块。</p>
<p>如果您无法按照上面的建议重新安排代码，则必须配置Spring Boot的Maven和Gradle插件以生成适合用作依赖项的单独工件。可执行存档不能用作依赖项，因为 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#executable-jar-jar-file-structure">可执行jar格式</a>在<code>BOOT-INF/classes</code>中打包应用程序类。这意味着当可执行jar用作依赖项时，无法找到它们。</p>
<p>要生成两个可以用作依赖项的工件和一个可执行的工件，必须指定一个分类器。此分类器应用于可执行归档的名称，保留默认归档以用作依赖项。</p>
<p>要在Maven中配置<code>exec</code>的分类器，您可以使用以下配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">	&lt;plugins&gt;</span><br><span class="line">		&lt;plugin&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-boot-maven-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">			&lt;configuration&gt;</span><br><span class="line">				&lt;classifier&gt;exec&lt;&#x2F;classifier&gt;</span><br><span class="line">			&lt;&#x2F;configuration&gt;</span><br><span class="line">		&lt;&#x2F;plugin&gt;</span><br><span class="line">	&lt;&#x2F;plugins&gt;</span><br><span class="line">&lt;&#x2F;build&gt;</span><br></pre></td></tr></table></figure>

<h2 id="91-6可执行jar运行时提取特定库"><a href="#91-6可执行jar运行时提取特定库" class="headerlink" title="91.6可执行jar运行时提取特定库"></a>91.6可执行jar运行时提取特定库</h2><p>可执行jar中的大多数嵌套库不需要解压缩才能运行。但是，某些库可能存在问题。例如，JRuby包含自己的嵌套jar支持，它假设<code>jruby-complete.jar</code>总是直接作为文件直接使用。</p>
<p>要处理任何有问题的库，您可以标记在可执行jar首次运行时应该自动解压缩特定的嵌套jar。这些嵌套的jar被写在<code>java.io.tmpdir</code>系统属性标识的临时目录下。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/warning.png" alt="[警告]"></th>
</tr>
</thead>
<tbody><tr>
<td>应注意确保您的操作系统已配置，以便在应用程序仍在运行时不会删除已解压缩到临时目录的jar。</td>
</tr>
</tbody></table>
<p>例如，要指示应使用Maven插件标记JRuby以进行解包，您将添加以下配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">	&lt;plugins&gt;</span><br><span class="line">		&lt;plugin&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-boot-maven-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">			&lt;configuration&gt;</span><br><span class="line">				&lt;requiresUnpack&gt;</span><br><span class="line">					&lt;dependency&gt;</span><br><span class="line">						&lt;groupId&gt;org.jruby&lt;&#x2F;groupId&gt;</span><br><span class="line">						&lt;artifactId&gt;jruby-complete&lt;&#x2F;artifactId&gt;</span><br><span class="line">					&lt;&#x2F;dependency&gt;</span><br><span class="line">				&lt;&#x2F;requiresUnpack&gt;</span><br><span class="line">			&lt;&#x2F;configuration&gt;</span><br><span class="line">		&lt;&#x2F;plugin&gt;</span><br><span class="line">	&lt;&#x2F;plugins&gt;</span><br><span class="line">&lt;&#x2F;build&gt;</span><br></pre></td></tr></table></figure>

<h2 id="91-7使用排除项创建不可执行的JAR"><a href="#91-7使用排除项创建不可执行的JAR" class="headerlink" title="91.7使用排除项创建不可执行的JAR"></a>91.7使用排除项创建不可执行的JAR</h2><p>通常，如果您将可执行文件和非可执行jar作为两个单独的构建产品，则可执行版本具有库jar中不需要的其他配置文件。例如，<code>application.yml</code>配置文件可能会从非可执行JAR中排除。</p>
<p>在Maven中，可执行jar必须是主工件，您可以为库添加一个分类jar，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">	&lt;plugins&gt;</span><br><span class="line">		&lt;plugin&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-boot-maven-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">		&lt;&#x2F;plugin&gt;</span><br><span class="line">		&lt;plugin&gt;</span><br><span class="line">			&lt;artifactId&gt;maven-jar-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">			&lt;executions&gt;</span><br><span class="line">				&lt;execution&gt;</span><br><span class="line">					&lt;id&gt;lib&lt;&#x2F;id&gt;</span><br><span class="line">					&lt;phase&gt;package&lt;&#x2F;phase&gt;</span><br><span class="line">					&lt;goals&gt;</span><br><span class="line">						&lt;goal&gt;jar&lt;&#x2F;goal&gt;</span><br><span class="line">					&lt;&#x2F;goals&gt;</span><br><span class="line">					&lt;configuration&gt;</span><br><span class="line">						&lt;classifier&gt;lib&lt;&#x2F;classifier&gt;</span><br><span class="line">						&lt;excludes&gt;</span><br><span class="line">							&lt;exclude&gt;application.yml&lt;&#x2F;exclude&gt;</span><br><span class="line">						&lt;&#x2F;excludes&gt;</span><br><span class="line">					&lt;&#x2F;configuration&gt;</span><br><span class="line">				&lt;&#x2F;execution&gt;</span><br><span class="line">			&lt;&#x2F;executions&gt;</span><br><span class="line">		&lt;&#x2F;plugin&gt;</span><br><span class="line">	&lt;&#x2F;plugins&gt;</span><br><span class="line">&lt;&#x2F;build&gt;</span><br></pre></td></tr></table></figure>

<h2 id="91-8远程调试Spring-Boot应用程序以Maven开头"><a href="#91-8远程调试Spring-Boot应用程序以Maven开头" class="headerlink" title="91.8远程调试Spring Boot应用程序以Maven开头"></a>91.8远程调试Spring Boot应用程序以Maven开头</h2><p>要将远程调试器附加到以Maven启动的Spring Boot应用程序，您可以使用<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/maven-plugin">maven插件</a>的<code>jvmArguments</code>属性。</p>
<p>有关详细信息，请参阅<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/maven-plugin/examples/run-debug.html">此示例</a>。</p>
<h2 id="91-9从Ant构建可执行文件而不使用spring-boot-antlib"><a href="#91-9从Ant构建可执行文件而不使用spring-boot-antlib" class="headerlink" title="91.9从Ant构建可执行文件而不使用spring-boot-antlib"></a>91.9从Ant构建可执行文件而不使用<code>spring-boot-antlib</code></h2><p>要使用Ant构建，您需要获取依赖项，编译，然后创建jar或war存档。要使其可执行，您可以使用<code>spring-boot-antlib</code>模块，也可以按照以下说明操作：</p>
<ol>
<li>如果要构建jar，请将应用程序的类和资源打包到嵌套的<code>BOOT-INF/classes</code>目录中。如果要构建war，请像往常一样将应用程序的类打包在嵌套的<code>WEB-INF/classes</code>目录中。</li>
<li>在jar的嵌套<code>BOOT-INF/lib</code>目录中添加运行时依赖项，或在战争中添加<code>WEB-INF/lib</code>。切记<strong>不要</strong>压缩存档中的条目。</li>
<li>将<code>provided</code>（嵌入式容器）依赖项添加到jar的嵌套<code>BOOT-INF/lib</code>目录或战争的<code>WEB-INF/lib-provided</code>。切记<strong>不要</strong>压缩存档中的条目。</li>
<li>在归档的根目录中添加<code>spring-boot-loader</code>类（以便<code>Main-Class</code>可用）。</li>
<li>使用适当的启动程序（例如<code>JarLauncher</code>作为jar文件）作为清单中的<code>Main-Class</code>属性，并指定其作为清单条目所需的其他属性 - 主要是通过设置<code>Start-Class</code>属性。</li>
</ol>
<p>以下示例显示如何使用Ant构建可执行存档：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;target name&#x3D;&quot;build&quot; depends&#x3D;&quot;compile&quot;&gt;</span><br><span class="line">	&lt;jar destfile&#x3D;&quot;target&#x2F;$&#123;ant.project.name&#125;-$&#123;spring-boot.version&#125;.jar&quot; compress&#x3D;&quot;false&quot;&gt;</span><br><span class="line">		&lt;mappedresources&gt;</span><br><span class="line">			&lt;fileset dir&#x3D;&quot;target&#x2F;classes&quot; &#x2F;&gt;</span><br><span class="line">			&lt;globmapper from&#x3D;&quot;*&quot; to&#x3D;&quot;BOOT-INF&#x2F;classes&#x2F;*&quot;&#x2F;&gt;</span><br><span class="line">		&lt;&#x2F;mappedresources&gt;</span><br><span class="line">		&lt;mappedresources&gt;</span><br><span class="line">			&lt;fileset dir&#x3D;&quot;src&#x2F;main&#x2F;resources&quot; erroronmissingdir&#x3D;&quot;false&quot;&#x2F;&gt;</span><br><span class="line">			&lt;globmapper from&#x3D;&quot;*&quot; to&#x3D;&quot;BOOT-INF&#x2F;classes&#x2F;*&quot;&#x2F;&gt;</span><br><span class="line">		&lt;&#x2F;mappedresources&gt;</span><br><span class="line">		&lt;mappedresources&gt;</span><br><span class="line">			&lt;fileset dir&#x3D;&quot;$&#123;lib.dir&#125;&#x2F;runtime&quot; &#x2F;&gt;</span><br><span class="line">			&lt;globmapper from&#x3D;&quot;*&quot; to&#x3D;&quot;BOOT-INF&#x2F;lib&#x2F;*&quot;&#x2F;&gt;</span><br><span class="line">		&lt;&#x2F;mappedresources&gt;</span><br><span class="line">		&lt;zipfileset src&#x3D;&quot;$&#123;lib.dir&#125;&#x2F;loader&#x2F;spring-boot-loader-jar-$&#123;spring-boot.version&#125;.jar&quot; &#x2F;&gt;</span><br><span class="line">		&lt;manifest&gt;</span><br><span class="line">			&lt;attribute name&#x3D;&quot;Main-Class&quot; value&#x3D;&quot;org.springframework.boot.loader.JarLauncher&quot; &#x2F;&gt;</span><br><span class="line">			&lt;attribute name&#x3D;&quot;Start-Class&quot; value&#x3D;&quot;$&#123;start-class&#125;&quot; &#x2F;&gt;</span><br><span class="line">		&lt;&#x2F;manifest&gt;</span><br><span class="line">	&lt;&#x2F;jar&gt;</span><br><span class="line">&lt;&#x2F;target&gt;</span><br></pre></td></tr></table></figure>

<p>该<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-samples/spring-boot-sample-ant">Ant样品</a>具有<code>build.xml</code>用<code>manual</code>任务，如果你用下面的命令运行它应该工作文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ant -lib &lt;folder containing ivy-2.2.jar&gt; clean manual</span><br></pre></td></tr></table></figure>

<p>然后，您可以使用以下命令运行该应用程序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar target&#x2F;*.jar</span><br></pre></td></tr></table></figure>

<h2 id="92-传统部署"><a href="#92-传统部署" class="headerlink" title="92.传统部署"></a>92.传统部署</h2><p>Spring Boot支持传统部署以及更现代的部署形式。本节回答有关传统部署的常见问题。</p>
<h2 id="92-1创建可部署的War文件"><a href="#92-1创建可部署的War文件" class="headerlink" title="92.1创建可部署的War文件"></a>92.1创建可部署的War文件</h2><table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/warning.png" alt="[警告]"></th>
</tr>
</thead>
<tbody><tr>
<td>因为Spring WebFlux并不严格依赖于Servlet API，并且默认情况下在嵌入式Reactor Netty服务器上部署了应用程序，所以WebFlux应用程序不支持War部署。</td>
</tr>
</tbody></table>
<p>生成可部署war文件的第一步是提供<code>SpringBootServletInitializer</code>子类并覆盖其<code>configure</code>方法。这样做可以利用Spring Framework的Servlet 3.0支持，并允许您在servlet容器启动时配置应用程序。通常，您应该更新应用程序的主类以扩展<code>SpringBootServletInitializer</code>，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootApplication</span><br><span class="line">public class Application extends SpringBootServletInitializer &#123;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	protected SpringApplicationBuilder configure(SpringApplicationBuilder application) &#123;</span><br><span class="line">		return application.sources(Application.class);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) throws Exception &#123;</span><br><span class="line">		SpringApplication.run(Application.class, args);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下一步是更新构建配置，以便项目生成war文件而不是jar文件。如果您使用Maven和<code>spring-boot-starter-parent</code>（为您配置Maven的war插件），您需要做的就是修改<code>pom.xml</code>以将包装更改为war，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;packaging&gt;war&lt;&#x2F;packaging&gt;</span><br></pre></td></tr></table></figure>

<p>如果您使用Gradle，则需要修改<code>build.gradle</code>以将war插件应用于项目，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: &#39;war&#39;</span><br></pre></td></tr></table></figure>

<p>该过程的最后一步是确保嵌入式servlet容器不会干扰部署war文件的servlet容器。为此，您需要将嵌入式servlet容器依赖项标记为已提供。</p>
<p>如果使用Maven，则以下示例将servlet容器（在本例中为Tomcat）标记为提供：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">	&lt;!-- … --&gt;</span><br><span class="line">	&lt;dependency&gt;</span><br><span class="line">		&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">		&lt;artifactId&gt;spring-boot-starter-tomcat&lt;&#x2F;artifactId&gt;</span><br><span class="line">		&lt;scope&gt;provided&lt;&#x2F;scope&gt;</span><br><span class="line">	&lt;&#x2F;dependency&gt;</span><br><span class="line">	&lt;!-- … --&gt;</span><br><span class="line">&lt;&#x2F;dependencies&gt;</span><br></pre></td></tr></table></figure>

<p>如果使用Gradle，则以下示例将servlet容器（在本例中为Tomcat）标记为提供：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">	&#x2F;&#x2F; …</span><br><span class="line">	providedRuntime &#39;org.springframework.boot:spring-boot-starter-tomcat&#39;</span><br><span class="line">	&#x2F;&#x2F; …</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td><code>providedRuntime</code>优于Gradle的<code>compileOnly</code>配置。除了其他限制之外，<code>compileOnly</code>依赖关系不在测试类路径上，因此任何基于Web的集成测试都会失败。</td>
</tr>
</tbody></table>
<p>如果使用<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#build-tool-plugins">Spring Boot构建工具</a>，则标记所提供的嵌入式servlet容器依赖项会生成一个可执行的war文件，其中提供的依赖项打包在<code>lib-provided</code>目录中。这意味着，除了可部署到servlet容器之外，还可以在命令行上使用<code>java -jar</code>运行应用程序。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>查看Spring Boot的示例应用程序，了解基于 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-samples/spring-boot-sample-traditional/pom.xml">Maven</a>的先前描述的配置<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-samples/spring-boot-sample-traditional/pom.xml">示例</a>。</td>
</tr>
</tbody></table>
<h2 id="92-2将现有应用程序转换为Spring-Boot"><a href="#92-2将现有应用程序转换为Spring-Boot" class="headerlink" title="92.2将现有应用程序转换为Spring Boot"></a>92.2将现有应用程序转换为Spring Boot</h2><p>对于非Web应用程序，应该很容易将现有的Spring应用程序转换为Spring Boot应用程序。为此，请丢弃创建<code>ApplicationContext</code>的代码，并将其替换为<code>SpringApplication</code>或<code>SpringApplicationBuilder</code>。Spring MVC Web应用程序通常可以首先创建可部署的war应用程序，然后再将其迁移到可执行的war或jar。请参阅<a target="_blank" rel="noopener" href="https://spring.io/guides/gs/convert-jar-to-war/">将jar转换为战争的入门指南</a>。</p>
<p>要通过扩展<code>SpringBootServletInitializer</code>（例如，在名为<code>Application</code>的类中）并添加Spring Boot <code>@SpringBootApplication</code>注释来创建可部署的战争，请使用类似于以下示例中所示的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootApplication</span><br><span class="line">public class Application extends SpringBootServletInitializer &#123;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	protected SpringApplicationBuilder configure(SpringApplicationBuilder application) &#123;</span><br><span class="line">		&#x2F;&#x2F; Customize the application or call application.sources(...) to add sources</span><br><span class="line">		&#x2F;&#x2F; Since our example is itself a @Configuration class (via @SpringBootApplication)</span><br><span class="line">		&#x2F;&#x2F; we actually don&#39;t need to override this method.</span><br><span class="line">		return application;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>请记住，无论你在<code>sources</code>中放置的是Spring <code>ApplicationContext</code>。通常，任何已经有效的东西都应该在这里工作。可能有一些beans你可以在以后删除，让Spring Boot为它们提供自己的默认值，但应该可以在你需要之前获得一些工作。</p>
<p>静态资源可以移动到类路径根目录中的<code>/public</code>（或<code>/static</code>或<code>/resources</code>或<code>/META-INF/resources</code>）。这同样适用于<code>messages.properties</code>（Spring Boot在类路径的根中自动检测到）。</p>
<p>使用Spring <code>DispatcherServlet</code>和Spring安全性的香草应该不需要进一步更改。如果应用程序中有其他功能（例如，使用其他servlet或过滤器），则可能需要在<code>Application</code>上下文中添加一些配置，方法是将这些元素替换为<code>web.xml</code>，如下所示：</p>
<ul>
<li><code>Servlet</code>类型<code>Servlet</code>或<code>ServletRegistrationBean</code>将bean安装在容器中，就好像它是<code>&lt;servlet/&gt;</code>和<code>web.xml</code> <code>web.xml</code>一样。</li>
<li>类型为<code>Filter</code>或<code>FilterRegistrationBean</code>的<code>@Bean</code>表现相似（作为<code>&lt;filter/&gt;</code>和<code>&lt;filter-mapping/&gt;</code>）。</li>
<li>可以通过<code>Application</code>中的<code>@ImportResource</code>添加XML文件中的<code>ApplicationContext</code>。或者，已经大量使用注释配置的简单情况可以作为<code>@Bean</code>定义在几行中重新创建。</li>
</ul>
<p>一旦war文件正常工作，您可以通过向<code>Application</code>添加<code>main</code>方法使其可执行，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">	SpringApplication.run(Application.class, args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果您打算将应用程序作为战争或可执行应用程序启动，则需要以<code>SpringBootServletInitializer</code>回调和类中的<code>main</code>方法可用的方法共享构建器的自定义项。类似如下：<code>*@SpringBootApplication* public class Application extends SpringBootServletInitializer &#123;     *@Override* protected SpringApplicationBuilder configure(SpringApplicationBuilder builder) &#123;     return configureApplication(builder); &#125;     public static void main(String[] args) &#123;     configureApplication(new SpringApplicationBuilder()).run(args); &#125;     private static SpringApplicationBuilder configureApplication(SpringApplicationBuilder builder) &#123;     return builder.sources(Application.class).bannerMode(Banner.Mode.OFF); &#125; &#125;</code></td>
</tr>
</tbody></table>
<p>应用程序可以分为多个类别：</p>
<ul>
<li>没有<code>web.xml</code>的Servlet 3.0+应用程序。</li>
<li><code>web.xml</code>的应用程序。</li>
<li>具有上下文层次结构的应用</li>
<li>没有上下文层次结构的应用</li>
</ul>
<p>所有这些都应该适合翻译，但每种都可能需要稍微不同的技术。</p>
<p>如果Servlet 3.0+应用程序已经使用Spring Servlet 3.0+初始化程序支持类，则它们可能很容易翻译。通常，现有<code>WebApplicationInitializer</code>中的所有代码都可以移动到<code>SpringBootServletInitializer</code>。如果您的现有应用程序有多个<code>ApplicationContext</code>（例如，如果它使用<code>AbstractDispatcherServletInitializer</code>），那么您可以将所有上下文源合并为一个<code>SpringApplication</code>。您可能遇到的主要复杂问题是，如果组合不起作用，您需要维护上下文层次结构。有关示例，请参阅<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#howto-build-an-application-context-hierarchy">构建层次结构</a>的 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#howto-build-an-application-context-hierarchy">条目</a>。通常需要拆分包含特定于Web的功能的现有父上下文，以便所有<code>ServletContextAware</code>组件都在子上下文中。</p>
<p>尚未Spring应用程序的应用程序可以转换为Spring启动应用程序，前面提到的指南可能有所帮助。但是，您可能会遇到问题。在这种情况下，我们建议 <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/tagged/spring-boot">使用标签<code>spring-boot</code>向Stack Overflow提问</a>。</p>
<h2 id="92-3将WAR部署到WebLogic"><a href="#92-3将WAR部署到WebLogic" class="headerlink" title="92.3将WAR部署到WebLogic"></a>92.3将WAR部署到WebLogic</h2><p>要将Spring Boot应用程序部署到WebLogic，必须确保servlet初始化程序<strong>直接</strong>实现<code>WebApplicationInitializer</code>（即使从已经实现它的基类扩展）。</p>
<p>WebLogic的典型初始化程序应类似于以下示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line">import org.springframework.boot.web.servlet.support.SpringBootServletInitializer;</span><br><span class="line">import org.springframework.web.WebApplicationInitializer;</span><br><span class="line"></span><br><span class="line">@SpringBootApplication</span><br><span class="line">public class MyApplication extends SpringBootServletInitializer implements WebApplicationInitializer &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果使用Logback，则还需要告知WebLogic更喜欢打包版本而不是预先安装在服务器上的版本。您可以通过添加包含以下内容的<code>WEB-INF/weblogic.xml</code>文件来执行此操作：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;wls:weblogic-web-app</span><br><span class="line">	xmlns:wls&#x3D;&quot;http:&#x2F;&#x2F;xmlns.oracle.com&#x2F;weblogic&#x2F;weblogic-web-app&quot;</span><br><span class="line">	xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">	xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;java.sun.com&#x2F;xml&#x2F;ns&#x2F;javaee</span><br><span class="line">		http:&#x2F;&#x2F;java.sun.com&#x2F;xml&#x2F;ns&#x2F;javaee&#x2F;ejb-jar_3_0.xsd</span><br><span class="line">		http:&#x2F;&#x2F;xmlns.oracle.com&#x2F;weblogic&#x2F;weblogic-web-app</span><br><span class="line">		http:&#x2F;&#x2F;xmlns.oracle.com&#x2F;weblogic&#x2F;weblogic-web-app&#x2F;1.4&#x2F;weblogic-web-app.xsd&quot;&gt;</span><br><span class="line">	&lt;wls:container-descriptor&gt;</span><br><span class="line">		&lt;wls:prefer-application-packages&gt;</span><br><span class="line">			&lt;wls:package-name&gt;org.slf4j&lt;&#x2F;wls:package-name&gt;</span><br><span class="line">		&lt;&#x2F;wls:prefer-application-packages&gt;</span><br><span class="line">	&lt;&#x2F;wls:container-descriptor&gt;</span><br><span class="line">&lt;&#x2F;wls:weblogic-web-app&gt;</span><br></pre></td></tr></table></figure>

<h2 id="92-4使用Jedis代替Lettuce"><a href="#92-4使用Jedis代替Lettuce" class="headerlink" title="92.4使用Jedis代替Lettuce"></a>92.4使用Jedis代替Lettuce</h2><p>默认情况下，Spring Boot启动器（<code>spring-boot-starter-data-redis</code>）使用 <a target="_blank" rel="noopener" href="https://github.com/lettuce-io/lettuce-core/">Lettuce</a>。您需要排除该依赖项并改为包含<a target="_blank" rel="noopener" href="https://github.com/xetorthio/jedis/">Jedis</a>。Spring Boot管理这些依赖项，以帮助使这个过程尽可能简单。</p>
<p>以下示例显示了如何在Maven中执行此操作：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-boot-starter-data-redis&lt;&#x2F;artifactId&gt;</span><br><span class="line">	&lt;exclusions&gt;</span><br><span class="line">		&lt;exclusion&gt;</span><br><span class="line">			&lt;groupId&gt;io.lettuce&lt;&#x2F;groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;lettuce-core&lt;&#x2F;artifactId&gt;</span><br><span class="line">		&lt;&#x2F;exclusion&gt;</span><br><span class="line">	&lt;&#x2F;exclusions&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;redis.clients&lt;&#x2F;groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;jedis&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<p>以下示例显示了如何在Gradle中执行此操作：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">configurations &#123;</span><br><span class="line">	compile.exclude module: &quot;lettuce&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">	compile(&quot;redis.clients:jedis&quot;)</span><br><span class="line">	&#x2F;&#x2F; ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="第十部分附录"><a href="#第十部分附录" class="headerlink" title="第十部分附录"></a>第十部分附录</h1><h2 id="附录A-常用应用程序属性"><a href="#附录A-常用应用程序属性" class="headerlink" title="附录A.常用应用程序属性"></a>附录A.常用应用程序属性</h2><p>可以在<code>application.properties</code>文件内，<code>application.yml</code>文件内或命令行开关中指定各种属性。本附录提供了常用Spring Boot属性的列表以及对使用它们的基础类的引用。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>Spring Boot提供了各种具有高级值格式的转换机制，请务必查看<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-external-config-conversion">属性转换部分</a>。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>Property贡献可以来自类路径上的其他jar文件，因此您不应将此视为详尽的列表。此外，您可以定义自己的属性。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/warning.png" alt="[警告]"></th>
</tr>
</thead>
<tbody><tr>
<td>此示例文件仅供参考。千万<strong>不能</strong>复制和粘贴的全部内容到应用程序中。相反，只选择您需要的属性。</td>
</tr>
</tbody></table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br><span class="line">1233</span><br><span class="line">1234</span><br><span class="line">1235</span><br><span class="line">1236</span><br><span class="line">1237</span><br><span class="line">1238</span><br><span class="line">1239</span><br><span class="line">1240</span><br><span class="line">1241</span><br><span class="line">1242</span><br><span class="line">1243</span><br><span class="line">1244</span><br><span class="line">1245</span><br><span class="line">1246</span><br><span class="line">1247</span><br><span class="line">1248</span><br><span class="line">1249</span><br><span class="line">1250</span><br><span class="line">1251</span><br><span class="line">1252</span><br><span class="line">1253</span><br><span class="line">1254</span><br><span class="line">1255</span><br><span class="line">1256</span><br><span class="line">1257</span><br><span class="line">1258</span><br><span class="line">1259</span><br><span class="line">1260</span><br><span class="line">1261</span><br><span class="line">1262</span><br><span class="line">1263</span><br><span class="line">1264</span><br><span class="line">1265</span><br><span class="line">1266</span><br><span class="line">1267</span><br><span class="line">1268</span><br><span class="line">1269</span><br><span class="line">1270</span><br><span class="line">1271</span><br><span class="line">1272</span><br><span class="line">1273</span><br><span class="line">1274</span><br><span class="line">1275</span><br><span class="line">1276</span><br><span class="line">1277</span><br><span class="line">1278</span><br><span class="line">1279</span><br><span class="line">1280</span><br><span class="line">1281</span><br><span class="line">1282</span><br><span class="line">1283</span><br><span class="line">1284</span><br><span class="line">1285</span><br><span class="line">1286</span><br><span class="line">1287</span><br><span class="line">1288</span><br><span class="line">1289</span><br><span class="line">1290</span><br><span class="line">1291</span><br><span class="line">1292</span><br><span class="line">1293</span><br><span class="line">1294</span><br><span class="line">1295</span><br><span class="line">1296</span><br><span class="line">1297</span><br><span class="line">1298</span><br><span class="line">1299</span><br><span class="line">1300</span><br><span class="line">1301</span><br><span class="line">1302</span><br><span class="line">1303</span><br><span class="line">1304</span><br><span class="line">1305</span><br><span class="line">1306</span><br><span class="line">1307</span><br><span class="line">1308</span><br><span class="line">1309</span><br><span class="line">1310</span><br><span class="line">1311</span><br><span class="line">1312</span><br><span class="line">1313</span><br><span class="line">1314</span><br><span class="line">1315</span><br><span class="line">1316</span><br><span class="line">1317</span><br><span class="line">1318</span><br><span class="line">1319</span><br><span class="line">1320</span><br><span class="line">1321</span><br><span class="line">1322</span><br><span class="line">1323</span><br><span class="line">1324</span><br><span class="line">1325</span><br><span class="line">1326</span><br><span class="line">1327</span><br><span class="line">1328</span><br><span class="line">1329</span><br><span class="line">1330</span><br><span class="line">1331</span><br><span class="line">1332</span><br><span class="line">1333</span><br><span class="line">1334</span><br><span class="line">1335</span><br><span class="line">1336</span><br><span class="line">1337</span><br><span class="line">1338</span><br><span class="line">1339</span><br><span class="line">1340</span><br><span class="line">1341</span><br><span class="line">1342</span><br><span class="line">1343</span><br><span class="line">1344</span><br><span class="line">1345</span><br><span class="line">1346</span><br><span class="line">1347</span><br><span class="line">1348</span><br><span class="line">1349</span><br><span class="line">1350</span><br><span class="line">1351</span><br><span class="line">1352</span><br><span class="line">1353</span><br><span class="line">1354</span><br><span class="line">1355</span><br><span class="line">1356</span><br><span class="line">1357</span><br><span class="line">1358</span><br><span class="line">1359</span><br><span class="line">1360</span><br><span class="line">1361</span><br><span class="line">1362</span><br><span class="line">1363</span><br><span class="line">1364</span><br><span class="line">1365</span><br><span class="line">1366</span><br><span class="line">1367</span><br><span class="line">1368</span><br><span class="line">1369</span><br><span class="line">1370</span><br><span class="line">1371</span><br><span class="line">1372</span><br><span class="line">1373</span><br><span class="line">1374</span><br><span class="line">1375</span><br><span class="line">1376</span><br><span class="line">1377</span><br><span class="line">1378</span><br><span class="line">1379</span><br><span class="line">1380</span><br><span class="line">1381</span><br><span class="line">1382</span><br><span class="line">1383</span><br><span class="line">1384</span><br><span class="line">1385</span><br><span class="line">1386</span><br><span class="line">1387</span><br><span class="line">1388</span><br><span class="line">1389</span><br><span class="line">1390</span><br><span class="line">1391</span><br><span class="line">1392</span><br><span class="line">1393</span><br><span class="line">1394</span><br><span class="line">1395</span><br><span class="line">1396</span><br><span class="line">1397</span><br><span class="line">1398</span><br><span class="line">1399</span><br><span class="line">1400</span><br><span class="line">1401</span><br><span class="line">1402</span><br><span class="line">1403</span><br><span class="line">1404</span><br><span class="line">1405</span><br><span class="line">1406</span><br><span class="line">1407</span><br><span class="line">1408</span><br><span class="line">1409</span><br><span class="line">1410</span><br><span class="line">1411</span><br><span class="line">1412</span><br><span class="line">1413</span><br><span class="line">1414</span><br><span class="line">1415</span><br><span class="line">1416</span><br><span class="line">1417</span><br><span class="line">1418</span><br><span class="line">1419</span><br><span class="line">1420</span><br><span class="line">1421</span><br><span class="line">1422</span><br><span class="line">1423</span><br><span class="line">1424</span><br><span class="line">1425</span><br><span class="line">1426</span><br><span class="line">1427</span><br><span class="line">1428</span><br><span class="line">1429</span><br><span class="line">1430</span><br><span class="line">1431</span><br><span class="line">1432</span><br><span class="line">1433</span><br><span class="line">1434</span><br><span class="line">1435</span><br><span class="line">1436</span><br><span class="line">1437</span><br><span class="line">1438</span><br><span class="line">1439</span><br><span class="line">1440</span><br><span class="line">1441</span><br><span class="line">1442</span><br><span class="line">1443</span><br><span class="line">1444</span><br><span class="line">1445</span><br><span class="line">1446</span><br><span class="line">1447</span><br><span class="line">1448</span><br><span class="line">1449</span><br><span class="line">1450</span><br><span class="line">1451</span><br><span class="line">1452</span><br><span class="line">1453</span><br><span class="line">1454</span><br><span class="line">1455</span><br><span class="line">1456</span><br><span class="line">1457</span><br><span class="line">1458</span><br><span class="line">1459</span><br><span class="line">1460</span><br><span class="line">1461</span><br><span class="line">1462</span><br><span class="line">1463</span><br><span class="line">1464</span><br><span class="line">1465</span><br><span class="line">1466</span><br><span class="line">1467</span><br><span class="line">1468</span><br><span class="line">1469</span><br><span class="line">1470</span><br><span class="line">1471</span><br><span class="line">1472</span><br><span class="line">1473</span><br><span class="line">1474</span><br><span class="line">1475</span><br><span class="line">1476</span><br><span class="line">1477</span><br><span class="line">1478</span><br><span class="line">1479</span><br><span class="line">1480</span><br><span class="line">1481</span><br><span class="line">1482</span><br><span class="line">1483</span><br><span class="line">1484</span><br><span class="line">1485</span><br><span class="line">1486</span><br><span class="line">1487</span><br><span class="line">1488</span><br><span class="line">1489</span><br><span class="line">1490</span><br><span class="line">1491</span><br><span class="line">1492</span><br><span class="line">1493</span><br><span class="line">1494</span><br><span class="line">1495</span><br><span class="line">1496</span><br><span class="line">1497</span><br><span class="line">1498</span><br><span class="line">1499</span><br><span class="line">1500</span><br><span class="line">1501</span><br><span class="line">1502</span><br><span class="line">1503</span><br><span class="line">1504</span><br><span class="line">1505</span><br><span class="line">1506</span><br><span class="line">1507</span><br><span class="line">1508</span><br><span class="line">1509</span><br><span class="line">1510</span><br><span class="line">1511</span><br><span class="line">1512</span><br><span class="line">1513</span><br><span class="line">1514</span><br><span class="line">1515</span><br><span class="line">1516</span><br><span class="line">1517</span><br><span class="line">1518</span><br><span class="line">1519</span><br><span class="line">1520</span><br><span class="line">1521</span><br><span class="line">1522</span><br><span class="line">1523</span><br><span class="line">1524</span><br><span class="line">1525</span><br><span class="line">1526</span><br><span class="line">1527</span><br><span class="line">1528</span><br><span class="line">1529</span><br><span class="line">1530</span><br><span class="line">1531</span><br><span class="line">1532</span><br><span class="line">1533</span><br><span class="line">1534</span><br><span class="line">1535</span><br><span class="line">1536</span><br><span class="line">1537</span><br><span class="line">1538</span><br><span class="line">1539</span><br><span class="line">1540</span><br><span class="line">1541</span><br><span class="line">1542</span><br><span class="line">1543</span><br><span class="line">1544</span><br><span class="line">1545</span><br><span class="line">1546</span><br><span class="line">1547</span><br><span class="line">1548</span><br><span class="line">1549</span><br><span class="line">1550</span><br><span class="line">1551</span><br><span class="line">1552</span><br><span class="line">1553</span><br><span class="line">1554</span><br><span class="line">1555</span><br><span class="line">1556</span><br><span class="line">1557</span><br><span class="line">1558</span><br><span class="line">1559</span><br><span class="line">1560</span><br><span class="line">1561</span><br><span class="line">1562</span><br><span class="line">1563</span><br><span class="line">1564</span><br></pre></td><td class="code"><pre><span class="line"># &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"># COMMON SPRING BOOT PROPERTIES</span><br><span class="line">#</span><br><span class="line"># This sample file is provided as a guideline. Do NOT copy it in its</span><br><span class="line"># entirety to your own application.               ^^^</span><br><span class="line"># &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ----------------------------------------</span><br><span class="line"># CORE PROPERTIES</span><br><span class="line"># ----------------------------------------</span><br><span class="line">debug&#x3D;false # Enable debug logs.</span><br><span class="line">trace&#x3D;false # Enable trace logs.</span><br><span class="line"></span><br><span class="line"># LOGGING</span><br><span class="line">logging.config&#x3D; # Location of the logging configuration file. For instance, &#96;classpath:logback.xml&#96; for Logback.</span><br><span class="line">logging.exception-conversion-word&#x3D;%wEx # Conversion word used when logging exceptions.</span><br><span class="line">logging.file&#x3D; # Log file name (for instance, &#96;myapp.log&#96;). Names can be an exact location or relative to the current directory.</span><br><span class="line">logging.file.max-history&#x3D;0 # Maximum of archive log files to keep. Only supported with the default logback setup.</span><br><span class="line">logging.file.max-size&#x3D;10MB # Maximum log file size. Only supported with the default logback setup.</span><br><span class="line">logging.group.*&#x3D; # Log groups to quickly change multiple loggers at the same time. For instance, &#96;logging.level.db&#x3D;org.hibernate,org.springframework.jdbc&#96;.</span><br><span class="line">logging.level.*&#x3D; # Log levels severity mapping. For instance, &#96;logging.level.org.springframework&#x3D;DEBUG&#96;.</span><br><span class="line">logging.path&#x3D; # Location of the log file. For instance, &#96;&#x2F;var&#x2F;log&#96;.</span><br><span class="line">logging.pattern.console&#x3D; # Appender pattern for output to the console. Supported only with the default Logback setup.</span><br><span class="line">logging.pattern.dateformat&#x3D;yyyy-MM-dd HH:mm:ss.SSS # Appender pattern for log date format. Supported only with the default Logback setup.</span><br><span class="line">logging.pattern.file&#x3D; # Appender pattern for output to a file. Supported only with the default Logback setup.</span><br><span class="line">logging.pattern.level&#x3D;%5p # Appender pattern for log level. Supported only with the default Logback setup.</span><br><span class="line">logging.register-shutdown-hook&#x3D;false # Register a shutdown hook for the logging system when it is initialized.</span><br><span class="line"></span><br><span class="line"># AOP</span><br><span class="line">spring.aop.auto&#x3D;true # Add @EnableAspectJAutoProxy.</span><br><span class="line">spring.aop.proxy-target-class&#x3D;true # Whether subclass-based (CGLIB) proxies are to be created (true), as opposed to standard Java interface-based proxies (false).</span><br><span class="line"></span><br><span class="line"># IDENTITY (ContextIdApplicationContextInitializer)</span><br><span class="line">spring.application.name&#x3D; # Application name.</span><br><span class="line"></span><br><span class="line"># ADMIN (SpringApplicationAdminJmxAutoConfiguration)</span><br><span class="line">spring.application.admin.enabled&#x3D;false # Whether to enable admin features for the application.</span><br><span class="line">spring.application.admin.jmx-name&#x3D;org.springframework.boot:type&#x3D;Admin,name&#x3D;SpringApplication # JMX name of the application admin MBean.</span><br><span class="line"></span><br><span class="line"># AUTO-CONFIGURATION</span><br><span class="line">spring.autoconfigure.exclude&#x3D; # Auto-configuration classes to exclude.</span><br><span class="line"></span><br><span class="line"># BANNER</span><br><span class="line">spring.banner.charset&#x3D;UTF-8 # Banner file encoding.</span><br><span class="line">spring.banner.location&#x3D;classpath:banner.txt # Banner text resource location.</span><br><span class="line">spring.banner.image.location&#x3D;classpath:banner.gif # Banner image file location (jpg or png can also be used).</span><br><span class="line">spring.banner.image.width&#x3D;76 # Width of the banner image in chars.</span><br><span class="line">spring.banner.image.height&#x3D; # Height of the banner image in chars (default based on image height).</span><br><span class="line">spring.banner.image.margin&#x3D;2 # Left hand image margin in chars.</span><br><span class="line">spring.banner.image.invert&#x3D;false # Whether images should be inverted for dark terminal themes.</span><br><span class="line"></span><br><span class="line"># SPRING CORE</span><br><span class="line">spring.beaninfo.ignore&#x3D;true # Whether to skip search of BeanInfo classes.</span><br><span class="line"></span><br><span class="line"># SPRING CACHE (CacheProperties)</span><br><span class="line">spring.cache.cache-names&#x3D; # Comma-separated list of cache names to create if supported by the underlying cache manager.</span><br><span class="line">spring.cache.caffeine.spec&#x3D; # The spec to use to create caches. See CaffeineSpec for more details on the spec format.</span><br><span class="line">spring.cache.couchbase.expiration&#x3D; # Entry expiration. By default the entries never expire. Note that this value is ultimately converted to seconds.</span><br><span class="line">spring.cache.ehcache.config&#x3D; # The location of the configuration file to use to initialize EhCache.</span><br><span class="line">spring.cache.infinispan.config&#x3D; # The location of the configuration file to use to initialize Infinispan.</span><br><span class="line">spring.cache.jcache.config&#x3D; # The location of the configuration file to use to initialize the cache manager.</span><br><span class="line">spring.cache.jcache.provider&#x3D; # Fully qualified name of the CachingProvider implementation to use to retrieve the JSR-107 compliant cache manager. Needed only if more than one JSR-107 implementation is available on the classpath.</span><br><span class="line">spring.cache.redis.cache-null-values&#x3D;true # Allow caching null values.</span><br><span class="line">spring.cache.redis.key-prefix&#x3D; # Key prefix.</span><br><span class="line">spring.cache.redis.time-to-live&#x3D; # Entry expiration. By default the entries never expire.</span><br><span class="line">spring.cache.redis.use-key-prefix&#x3D;true # Whether to use the key prefix when writing to Redis.</span><br><span class="line">spring.cache.type&#x3D; # Cache type. By default, auto-detected according to the environment.</span><br><span class="line"></span><br><span class="line"># SPRING CONFIG - using environment property only (ConfigFileApplicationListener)</span><br><span class="line">spring.config.additional-location&#x3D; # Config file locations used in addition to the defaults.</span><br><span class="line">spring.config.location&#x3D; # Config file locations that replace the defaults.</span><br><span class="line">spring.config.name&#x3D;application # Config file name.</span><br><span class="line"></span><br><span class="line"># HAZELCAST (HazelcastProperties)</span><br><span class="line">spring.hazelcast.config&#x3D; # The location of the configuration file to use to initialize Hazelcast.</span><br><span class="line"></span><br><span class="line"># PROJECT INFORMATION (ProjectInfoProperties)</span><br><span class="line">spring.info.build.encoding&#x3D;UTF-8 # File encoding.</span><br><span class="line">spring.info.build.location&#x3D;classpath:META-INF&#x2F;build-info.properties # Location of the generated build-info.properties file.</span><br><span class="line">spring.info.git.encoding&#x3D;UTF-8 # File encoding.</span><br><span class="line">spring.info.git.location&#x3D;classpath:git.properties # Location of the generated git.properties file.</span><br><span class="line"></span><br><span class="line"># JMX</span><br><span class="line">spring.jmx.default-domain&#x3D; # JMX domain name.</span><br><span class="line">spring.jmx.enabled&#x3D;true # Expose management beans to the JMX domain.</span><br><span class="line">spring.jmx.server&#x3D;mbeanServer # MBeanServer bean name.</span><br><span class="line">spring.jmx.unique-names&#x3D;false # Whether unique runtime object names should be ensured.</span><br><span class="line"></span><br><span class="line"># Email (MailProperties)</span><br><span class="line">spring.mail.default-encoding&#x3D;UTF-8 # Default MimeMessage encoding.</span><br><span class="line">spring.mail.host&#x3D; # SMTP server host. For instance, &#96;smtp.example.com&#96;.</span><br><span class="line">spring.mail.jndi-name&#x3D; # Session JNDI name. When set, takes precedence over other Session settings.</span><br><span class="line">spring.mail.password&#x3D; # Login password of the SMTP server.</span><br><span class="line">spring.mail.port&#x3D; # SMTP server port.</span><br><span class="line">spring.mail.properties.*&#x3D; # Additional JavaMail Session properties.</span><br><span class="line">spring.mail.protocol&#x3D;smtp # Protocol used by the SMTP server.</span><br><span class="line">spring.mail.test-connection&#x3D;false # Whether to test that the mail server is available on startup.</span><br><span class="line">spring.mail.username&#x3D; # Login user of the SMTP server.</span><br><span class="line"></span><br><span class="line"># APPLICATION SETTINGS (SpringApplication)</span><br><span class="line">spring.main.allow-bean-definition-overriding&#x3D;false # Whether bean definition overriding, by registering a definition with the same name as an existing definition, is allowed.</span><br><span class="line">spring.main.banner-mode&#x3D;console # Mode used to display the banner when the application runs.</span><br><span class="line">spring.main.sources&#x3D; # Sources (class names, package names, or XML resource locations) to include in the ApplicationContext.</span><br><span class="line">spring.main.web-application-type&#x3D; # Flag to explicitly request a specific type of web application. If not set, auto-detected based on the classpath.</span><br><span class="line"></span><br><span class="line"># FILE ENCODING (FileEncodingApplicationListener)</span><br><span class="line">spring.mandatory-file-encoding&#x3D; # Expected character encoding the application must use.</span><br><span class="line"></span><br><span class="line"># INTERNATIONALIZATION (MessageSourceProperties)</span><br><span class="line">spring.messages.always-use-message-format&#x3D;false # Whether to always apply the MessageFormat rules, parsing even messages without arguments.</span><br><span class="line">spring.messages.basename&#x3D;messages # Comma-separated list of basenames (essentially a fully-qualified classpath location), each following the ResourceBundle convention with relaxed support for slash based locations.</span><br><span class="line">spring.messages.cache-duration&#x3D; # Loaded resource bundle files cache duration. When not set, bundles are cached forever. If a duration suffix is not specified, seconds will be used.</span><br><span class="line">spring.messages.encoding&#x3D;UTF-8 # Message bundles encoding.</span><br><span class="line">spring.messages.fallback-to-system-locale&#x3D;true # Whether to fall back to the system Locale if no files for a specific Locale have been found.</span><br><span class="line">spring.messages.use-code-as-default-message&#x3D;false # Whether to use the message code as the default message instead of throwing a &quot;NoSuchMessageException&quot;. Recommended during development only.</span><br><span class="line"></span><br><span class="line"># OUTPUT</span><br><span class="line">spring.output.ansi.enabled&#x3D;detect # Configures the ANSI output.</span><br><span class="line"></span><br><span class="line"># PID FILE (ApplicationPidFileWriter)</span><br><span class="line">spring.pid.fail-on-write-error&#x3D; # Fails if ApplicationPidFileWriter is used but it cannot write the PID file.</span><br><span class="line">spring.pid.file&#x3D; # Location of the PID file to write (if ApplicationPidFileWriter is used).</span><br><span class="line"></span><br><span class="line"># PROFILES</span><br><span class="line">spring.profiles.active&#x3D; # Comma-separated list of active profiles. Can be overridden by a command line switch.</span><br><span class="line">spring.profiles.include&#x3D; # Unconditionally activate the specified comma-separated list of profiles (or list of profiles if using YAML).</span><br><span class="line"></span><br><span class="line"># QUARTZ SCHEDULER (QuartzProperties)</span><br><span class="line">spring.quartz.auto-startup&#x3D;true # Whether to automatically start the scheduler after initialization.</span><br><span class="line">spring.quartz.jdbc.comment-prefix&#x3D;-- # Prefix for single-line comments in SQL initialization scripts.</span><br><span class="line">spring.quartz.jdbc.initialize-schema&#x3D;embedded # Database schema initialization mode.</span><br><span class="line">spring.quartz.jdbc.schema&#x3D;classpath:org&#x2F;quartz&#x2F;impl&#x2F;jdbcjobstore&#x2F;tables_@@platform@@.sql # Path to the SQL file to use to initialize the database schema.</span><br><span class="line">spring.quartz.job-store-type&#x3D;memory # Quartz job store type.</span><br><span class="line">spring.quartz.overwrite-existing-jobs&#x3D;false # Whether configured jobs should overwrite existing job definitions.</span><br><span class="line">spring.quartz.properties.*&#x3D; # Additional Quartz Scheduler properties.</span><br><span class="line">spring.quartz.scheduler-name&#x3D;quartzScheduler # Name of the scheduler.</span><br><span class="line">spring.quartz.startup-delay&#x3D;0s # Delay after which the scheduler is started once initialization completes.</span><br><span class="line">spring.quartz.wait-for-jobs-to-complete-on-shutdown&#x3D;false # Whether to wait for running jobs to complete on shutdown.</span><br><span class="line"></span><br><span class="line"># REACTOR (ReactorCoreProperties)</span><br><span class="line">spring.reactor.stacktrace-mode.enabled&#x3D;false # Whether Reactor should collect stacktrace information at runtime.</span><br><span class="line"></span><br><span class="line"># SENDGRID (SendGridAutoConfiguration)</span><br><span class="line">spring.sendgrid.api-key&#x3D; # SendGrid API key.</span><br><span class="line">spring.sendgrid.proxy.host&#x3D; # SendGrid proxy host.</span><br><span class="line">spring.sendgrid.proxy.port&#x3D; # SendGrid proxy port.</span><br><span class="line"></span><br><span class="line"># TASK EXECUTION  (TaskExecutionProperties)</span><br><span class="line">spring.task.execution.pool.allow-core-thread-timeout&#x3D;true # Whether core threads are allowed to time out. This enables dynamic growing and shrinking of the pool.</span><br><span class="line">spring.task.execution.pool.core-size&#x3D;8 # Core number of threads.</span><br><span class="line">spring.task.execution.pool.keep-alive&#x3D;60s # Time limit for which threads may remain idle before being terminated.</span><br><span class="line">spring.task.execution.pool.max-size&#x3D; # Maximum allowed number of threads. If tasks are filling up the queue, the pool can expand up to that size to accommodate the load. Ignored if the queue is unbounded.</span><br><span class="line">spring.task.execution.pool.queue-capacity&#x3D; # Queue capacity. An unbounded capacity does not increase the pool and therefore ignores the &quot;max-size&quot; property.</span><br><span class="line">spring.task.execution.thread-name-prefix&#x3D;task- # Prefix to use for the names of newly created threads.</span><br><span class="line"></span><br><span class="line"># TASK SCHEDULING  (TaskSchedulingProperties)</span><br><span class="line">spring.task.scheduling.pool.size&#x3D;1 # Maximum allowed number of threads.</span><br><span class="line">spring.task.scheduling.thread-name-prefix&#x3D;scheduling- # Prefix to use for the names of newly created threads.</span><br><span class="line"></span><br><span class="line"># ----------------------------------------</span><br><span class="line"># WEB PROPERTIES</span><br><span class="line"># ----------------------------------------</span><br><span class="line"></span><br><span class="line"># EMBEDDED SERVER CONFIGURATION (ServerProperties)</span><br><span class="line">server.address&#x3D; # Network address to which the server should bind.</span><br><span class="line">server.compression.enabled&#x3D;false # Whether response compression is enabled.</span><br><span class="line">server.compression.excluded-user-agents&#x3D; # Comma-separated list of user agents for which responses should not be compressed.</span><br><span class="line">server.compression.mime-types&#x3D;text&#x2F;html,text&#x2F;xml,text&#x2F;plain,text&#x2F;css,text&#x2F;javascript,application&#x2F;javascript,application&#x2F;json,application&#x2F;xml # Comma-separated list of MIME types that should be compressed.</span><br><span class="line">server.compression.min-response-size&#x3D;2KB # Minimum &quot;Content-Length&quot; value that is required for compression to be performed.</span><br><span class="line">server.connection-timeout&#x3D; # Time that connectors wait for another HTTP request before closing the connection. When not set, the connector&#39;s container-specific default is used. Use a value of -1 to indicate no (that is, an infinite) timeout.</span><br><span class="line">server.error.include-exception&#x3D;false # Include the &quot;exception&quot; attribute.</span><br><span class="line">server.error.include-stacktrace&#x3D;never # When to include a &quot;stacktrace&quot; attribute.</span><br><span class="line">server.error.path&#x3D;&#x2F;error # Path of the error controller.</span><br><span class="line">server.error.whitelabel.enabled&#x3D;true # Whether to enable the default error page displayed in browsers in case of a server error.</span><br><span class="line">server.http2.enabled&#x3D;false # Whether to enable HTTP&#x2F;2 support, if the current environment supports it.</span><br><span class="line">server.jetty.acceptors&#x3D;-1 # Number of acceptor threads to use. When the value is -1, the default, the number of acceptors is derived from the operating environment.</span><br><span class="line">server.jetty.accesslog.append&#x3D;false # Append to log.</span><br><span class="line">server.jetty.accesslog.date-format&#x3D;dd&#x2F;MMM&#x2F;yyyy:HH:mm:ss Z # Timestamp format of the request log.</span><br><span class="line">server.jetty.accesslog.enabled&#x3D;false # Enable access log.</span><br><span class="line">server.jetty.accesslog.extended-format&#x3D;false # Enable extended NCSA format.</span><br><span class="line">server.jetty.accesslog.file-date-format&#x3D; # Date format to place in log file name.</span><br><span class="line">server.jetty.accesslog.filename&#x3D; # Log filename. If not specified, logs redirect to &quot;System.err&quot;.</span><br><span class="line">server.jetty.accesslog.locale&#x3D; # Locale of the request log.</span><br><span class="line">server.jetty.accesslog.log-cookies&#x3D;false # Enable logging of the request cookies.</span><br><span class="line">server.jetty.accesslog.log-latency&#x3D;false # Enable logging of request processing time.</span><br><span class="line">server.jetty.accesslog.log-server&#x3D;false # Enable logging of the request hostname.</span><br><span class="line">server.jetty.accesslog.retention-period&#x3D;31 # Number of days before rotated log files are deleted.</span><br><span class="line">server.jetty.accesslog.time-zone&#x3D;GMT # Timezone of the request log.</span><br><span class="line">server.jetty.max-http-post-size&#x3D;200000B # Maximum size of the HTTP post or put content.</span><br><span class="line">server.jetty.selectors&#x3D;-1 # Number of selector threads to use. When the value is -1, the default, the number of selectors is derived from the operating environment.</span><br><span class="line">server.max-http-header-size&#x3D;8KB # Maximum size of the HTTP message header.</span><br><span class="line">server.port&#x3D;8080 # Server HTTP port.</span><br><span class="line">server.server-header&#x3D; # Value to use for the Server response header (if empty, no header is sent).</span><br><span class="line">server.use-forward-headers&#x3D; # Whether X-Forwarded-* headers should be applied to the HttpRequest.</span><br><span class="line">server.servlet.context-parameters.*&#x3D; # Servlet context init parameters.</span><br><span class="line">server.servlet.context-path&#x3D; # Context path of the application.</span><br><span class="line">server.servlet.application-display-name&#x3D;application # Display name of the application.</span><br><span class="line">server.servlet.jsp.class-name&#x3D;org.apache.jasper.servlet.JspServlet # Class name of the servlet to use for JSPs.</span><br><span class="line">server.servlet.jsp.init-parameters.*&#x3D; # Init parameters used to configure the JSP servlet.</span><br><span class="line">server.servlet.jsp.registered&#x3D;true # Whether the JSP servlet is registered.</span><br><span class="line">server.servlet.session.cookie.comment&#x3D; # Comment for the session cookie.</span><br><span class="line">server.servlet.session.cookie.domain&#x3D; # Domain for the session cookie.</span><br><span class="line">server.servlet.session.cookie.http-only&#x3D; # Whether to use &quot;HttpOnly&quot; cookies for session cookies.</span><br><span class="line">server.servlet.session.cookie.max-age&#x3D; # Maximum age of the session cookie. If a duration suffix is not specified, seconds will be used.</span><br><span class="line">server.servlet.session.cookie.name&#x3D; # Session cookie name.</span><br><span class="line">server.servlet.session.cookie.path&#x3D; # Path of the session cookie.</span><br><span class="line">server.servlet.session.cookie.secure&#x3D; # Whether to always mark the session cookie as secure.</span><br><span class="line">server.servlet.session.persistent&#x3D;false # Whether to persist session data between restarts.</span><br><span class="line">server.servlet.session.store-dir&#x3D; # Directory used to store session data.</span><br><span class="line">server.servlet.session.timeout&#x3D;30m # Session timeout. If a duration suffix is not specified, seconds will be used.</span><br><span class="line">server.servlet.session.tracking-modes&#x3D; # Session tracking modes.</span><br><span class="line">server.ssl.ciphers&#x3D; # Supported SSL ciphers.</span><br><span class="line">server.ssl.client-auth&#x3D; # Client authentication mode.</span><br><span class="line">server.ssl.enabled&#x3D;true # Whether to enable SSL support.</span><br><span class="line">server.ssl.enabled-protocols&#x3D; # Enabled SSL protocols.</span><br><span class="line">server.ssl.key-alias&#x3D; # Alias that identifies the key in the key store.</span><br><span class="line">server.ssl.key-password&#x3D; # Password used to access the key in the key store.</span><br><span class="line">server.ssl.key-store&#x3D; # Path to the key store that holds the SSL certificate (typically a jks file).</span><br><span class="line">server.ssl.key-store-password&#x3D; # Password used to access the key store.</span><br><span class="line">server.ssl.key-store-provider&#x3D; # Provider for the key store.</span><br><span class="line">server.ssl.key-store-type&#x3D; # Type of the key store.</span><br><span class="line">server.ssl.protocol&#x3D;TLS # SSL protocol to use.</span><br><span class="line">server.ssl.trust-store&#x3D; # Trust store that holds SSL certificates.</span><br><span class="line">server.ssl.trust-store-password&#x3D; # Password used to access the trust store.</span><br><span class="line">server.ssl.trust-store-provider&#x3D; # Provider for the trust store.</span><br><span class="line">server.ssl.trust-store-type&#x3D; # Type of the trust store.</span><br><span class="line">server.tomcat.accept-count&#x3D;100 # Maximum queue length for incoming connection requests when all possible request processing threads are in use.</span><br><span class="line">server.tomcat.accesslog.buffered&#x3D;true # Whether to buffer output such that it is flushed only periodically.</span><br><span class="line">server.tomcat.accesslog.directory&#x3D;logs # Directory in which log files are created. Can be absolute or relative to the Tomcat base dir.</span><br><span class="line">server.tomcat.accesslog.enabled&#x3D;false # Enable access log.</span><br><span class="line">server.tomcat.accesslog.file-date-format&#x3D;.yyyy-MM-dd # Date format to place in the log file name.</span><br><span class="line">server.tomcat.accesslog.pattern&#x3D;common # Format pattern for access logs.</span><br><span class="line">server.tomcat.accesslog.prefix&#x3D;access_log # Log file name prefix.</span><br><span class="line">server.tomcat.accesslog.rename-on-rotate&#x3D;false # Whether to defer inclusion of the date stamp in the file name until rotate time.</span><br><span class="line">server.tomcat.accesslog.request-attributes-enabled&#x3D;false # Set request attributes for the IP address, Hostname, protocol, and port used for the request.</span><br><span class="line">server.tomcat.accesslog.rotate&#x3D;true # Whether to enable access log rotation.</span><br><span class="line">server.tomcat.accesslog.suffix&#x3D;.log # Log file name suffix.</span><br><span class="line">server.tomcat.additional-tld-skip-patterns&#x3D; # Comma-separated list of additional patterns that match jars to ignore for TLD scanning.</span><br><span class="line">server.tomcat.background-processor-delay&#x3D;10s # Delay between the invocation of backgroundProcess methods. If a duration suffix is not specified, seconds will be used.</span><br><span class="line">server.tomcat.basedir&#x3D; # Tomcat base directory. If not specified, a temporary directory is used.</span><br><span class="line">server.tomcat.internal-proxies&#x3D;10\\.\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;|\\</span><br><span class="line">		192\\.168\\.\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;|\\</span><br><span class="line">		169\\.254\\.\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;|\\</span><br><span class="line">		127\\.\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;|\\</span><br><span class="line">		172\\.1[6-9]&#123;1&#125;\\.\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;|\\</span><br><span class="line">		172\\.2[0-9]&#123;1&#125;\\.\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;|\\</span><br><span class="line">		172\\.3[0-1]&#123;1&#125;\\.\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;\\</span><br><span class="line">		0:0:0:0:0:0:0:1\\</span><br><span class="line">		::1 # Regular expression that matches proxies that are to be trusted.</span><br><span class="line">server.tomcat.max-connections&#x3D;10000 # Maximum number of connections that the server accepts and processes at any given time.</span><br><span class="line">server.tomcat.max-http-post-size&#x3D;2MB # Maximum size of the HTTP post content.</span><br><span class="line">server.tomcat.max-swallow-size&#x3D;2MB # Maximum amount of request body to swallow.</span><br><span class="line">server.tomcat.max-threads&#x3D;200 # Maximum amount of worker threads.</span><br><span class="line">server.tomcat.min-spare-threads&#x3D;10 # Minimum amount of worker threads.</span><br><span class="line">server.tomcat.port-header&#x3D;X-Forwarded-Port # Name of the HTTP header used to override the original port value.</span><br><span class="line">server.tomcat.protocol-header&#x3D; # Header that holds the incoming protocol, usually named &quot;X-Forwarded-Proto&quot;.</span><br><span class="line">server.tomcat.protocol-header-https-value&#x3D;https # Value of the protocol header indicating whether the incoming request uses SSL.</span><br><span class="line">server.tomcat.redirect-context-root&#x3D;true # Whether requests to the context root should be redirected by appending a &#x2F; to the path.</span><br><span class="line">server.tomcat.remote-ip-header&#x3D; # Name of the HTTP header from which the remote IP is extracted. For instance, &#96;X-FORWARDED-FOR&#96;.</span><br><span class="line">server.tomcat.resource.allow-caching&#x3D;true # Whether static resource caching is permitted for this web application.</span><br><span class="line">server.tomcat.resource.cache-ttl&#x3D; # Time-to-live of the static resource cache.</span><br><span class="line">server.tomcat.uri-encoding&#x3D;UTF-8 # Character encoding to use to decode the URI.</span><br><span class="line">server.tomcat.use-relative-redirects&#x3D; # Whether HTTP 1.1 and later location headers generated by a call to sendRedirect will use relative or absolute redirects.</span><br><span class="line">server.undertow.accesslog.dir&#x3D; # Undertow access log directory.</span><br><span class="line">server.undertow.accesslog.enabled&#x3D;false # Whether to enable the access log.</span><br><span class="line">server.undertow.accesslog.pattern&#x3D;common # Format pattern for access logs.</span><br><span class="line">server.undertow.accesslog.prefix&#x3D;access_log. # Log file name prefix.</span><br><span class="line">server.undertow.accesslog.rotate&#x3D;true # Whether to enable access log rotation.</span><br><span class="line">server.undertow.accesslog.suffix&#x3D;log # Log file name suffix.</span><br><span class="line">server.undertow.buffer-size&#x3D; # Size of each buffer.</span><br><span class="line">server.undertow.direct-buffers&#x3D; # Whether to allocate buffers outside the Java heap. The default is derived from the maximum amount of memory that is available to the JVM.</span><br><span class="line">server.undertow.eager-filter-init&#x3D;true # Whether servlet filters should be initialized on startup.</span><br><span class="line">server.undertow.io-threads&#x3D; # Number of I&#x2F;O threads to create for the worker. The default is derived from the number of available processors.</span><br><span class="line">server.undertow.max-http-post-size&#x3D;-1B # Maximum size of the HTTP post content. When the value is -1, the default, the size is unlimited.</span><br><span class="line">server.undertow.worker-threads&#x3D; # Number of worker threads. The default is 8 times the number of I&#x2F;O threads.</span><br><span class="line"></span><br><span class="line"># FREEMARKER (FreeMarkerProperties)</span><br><span class="line">spring.freemarker.allow-request-override&#x3D;false # Whether HttpServletRequest attributes are allowed to override (hide) controller generated model attributes of the same name.</span><br><span class="line">spring.freemarker.allow-session-override&#x3D;false # Whether HttpSession attributes are allowed to override (hide) controller generated model attributes of the same name.</span><br><span class="line">spring.freemarker.cache&#x3D;false # Whether to enable template caching.</span><br><span class="line">spring.freemarker.charset&#x3D;UTF-8 # Template encoding.</span><br><span class="line">spring.freemarker.check-template-location&#x3D;true # Whether to check that the templates location exists.</span><br><span class="line">spring.freemarker.content-type&#x3D;text&#x2F;html # Content-Type value.</span><br><span class="line">spring.freemarker.enabled&#x3D;true # Whether to enable MVC view resolution for this technology.</span><br><span class="line">spring.freemarker.expose-request-attributes&#x3D;false # Whether all request attributes should be added to the model prior to merging with the template.</span><br><span class="line">spring.freemarker.expose-session-attributes&#x3D;false # Whether all HttpSession attributes should be added to the model prior to merging with the template.</span><br><span class="line">spring.freemarker.expose-spring-macro-helpers&#x3D;true # Whether to expose a RequestContext for use by Spring&#39;s macro library, under the name &quot;springMacroRequestContext&quot;.</span><br><span class="line">spring.freemarker.prefer-file-system-access&#x3D;true # Whether to prefer file system access for template loading. File system access enables hot detection of template changes.</span><br><span class="line">spring.freemarker.prefix&#x3D; # Prefix that gets prepended to view names when building a URL.</span><br><span class="line">spring.freemarker.request-context-attribute&#x3D; # Name of the RequestContext attribute for all views.</span><br><span class="line">spring.freemarker.settings.*&#x3D; # Well-known FreeMarker keys which are passed to FreeMarker&#39;s Configuration.</span><br><span class="line">spring.freemarker.suffix&#x3D;.ftl # Suffix that gets appended to view names when building a URL.</span><br><span class="line">spring.freemarker.template-loader-path&#x3D;classpath:&#x2F;templates&#x2F; # Comma-separated list of template paths.</span><br><span class="line">spring.freemarker.view-names&#x3D; # White list of view names that can be resolved.</span><br><span class="line"></span><br><span class="line"># GROOVY TEMPLATES (GroovyTemplateProperties)</span><br><span class="line">spring.groovy.template.allow-request-override&#x3D;false # Whether HttpServletRequest attributes are allowed to override (hide) controller generated model attributes of the same name.</span><br><span class="line">spring.groovy.template.allow-session-override&#x3D;false # Whether HttpSession attributes are allowed to override (hide) controller generated model attributes of the same name.</span><br><span class="line">spring.groovy.template.cache&#x3D;false # Whether to enable template caching.</span><br><span class="line">spring.groovy.template.charset&#x3D;UTF-8 # Template encoding.</span><br><span class="line">spring.groovy.template.check-template-location&#x3D;true # Whether to check that the templates location exists.</span><br><span class="line">spring.groovy.template.configuration.*&#x3D; # See GroovyMarkupConfigurer</span><br><span class="line">spring.groovy.template.content-type&#x3D;text&#x2F;html # Content-Type value.</span><br><span class="line">spring.groovy.template.enabled&#x3D;true # Whether to enable MVC view resolution for this technology.</span><br><span class="line">spring.groovy.template.expose-request-attributes&#x3D;false # Whether all request attributes should be added to the model prior to merging with the template.</span><br><span class="line">spring.groovy.template.expose-session-attributes&#x3D;false # Whether all HttpSession attributes should be added to the model prior to merging with the template.</span><br><span class="line">spring.groovy.template.expose-spring-macro-helpers&#x3D;true # Whether to expose a RequestContext for use by Spring&#39;s macro library, under the name &quot;springMacroRequestContext&quot;.</span><br><span class="line">spring.groovy.template.prefix&#x3D; # Prefix that gets prepended to view names when building a URL.</span><br><span class="line">spring.groovy.template.request-context-attribute&#x3D; # Name of the RequestContext attribute for all views.</span><br><span class="line">spring.groovy.template.resource-loader-path&#x3D;classpath:&#x2F;templates&#x2F; # Template path.</span><br><span class="line">spring.groovy.template.suffix&#x3D;.tpl # Suffix that gets appended to view names when building a URL.</span><br><span class="line">spring.groovy.template.view-names&#x3D; # White list of view names that can be resolved.</span><br><span class="line"></span><br><span class="line"># SPRING HATEOAS (HateoasProperties)</span><br><span class="line">spring.hateoas.use-hal-as-default-json-media-type&#x3D;true # Whether application&#x2F;hal+json responses should be sent to requests that accept application&#x2F;json.</span><br><span class="line"></span><br><span class="line"># HTTP (HttpProperties)</span><br><span class="line">spring.http.converters.preferred-json-mapper&#x3D; # Preferred JSON mapper to use for HTTP message conversion. By default, auto-detected according to the environment.</span><br><span class="line">spring.http.encoding.charset&#x3D;UTF-8 # Charset of HTTP requests and responses. Added to the &quot;Content-Type&quot; header if not set explicitly.</span><br><span class="line">spring.http.encoding.enabled&#x3D;true # Whether to enable http encoding support.</span><br><span class="line">spring.http.encoding.force&#x3D; # Whether to force the encoding to the configured charset on HTTP requests and responses.</span><br><span class="line">spring.http.encoding.force-request&#x3D; # Whether to force the encoding to the configured charset on HTTP requests. Defaults to true when &quot;force&quot; has not been specified.</span><br><span class="line">spring.http.encoding.force-response&#x3D; # Whether to force the encoding to the configured charset on HTTP responses.</span><br><span class="line">spring.http.encoding.mapping&#x3D; # Locale in which to encode mapping.</span><br><span class="line">spring.http.log-request-details&#x3D;false # Whether logging of (potentially sensitive) request details at DEBUG and TRACE level is allowed.</span><br><span class="line"></span><br><span class="line"># MULTIPART (MultipartProperties)</span><br><span class="line">spring.servlet.multipart.enabled&#x3D;true # Whether to enable support of multipart uploads.</span><br><span class="line">spring.servlet.multipart.file-size-threshold&#x3D;0B # Threshold after which files are written to disk.</span><br><span class="line">spring.servlet.multipart.location&#x3D; # Intermediate location of uploaded files.</span><br><span class="line">spring.servlet.multipart.max-file-size&#x3D;1MB # Max file size.</span><br><span class="line">spring.servlet.multipart.max-request-size&#x3D;10MB # Max request size.</span><br><span class="line">spring.servlet.multipart.resolve-lazily&#x3D;false # Whether to resolve the multipart request lazily at the time of file or parameter access.</span><br><span class="line"></span><br><span class="line"># JACKSON (JacksonProperties)</span><br><span class="line">spring.jackson.date-format&#x3D; # Date format string or a fully-qualified date format class name. For instance, &#96;yyyy-MM-dd HH:mm:ss&#96;.</span><br><span class="line">spring.jackson.default-property-inclusion&#x3D; # Controls the inclusion of properties during serialization. Configured with one of the values in Jackson&#39;s JsonInclude.Include enumeration.</span><br><span class="line">spring.jackson.deserialization.*&#x3D; # Jackson on&#x2F;off features that affect the way Java objects are deserialized.</span><br><span class="line">spring.jackson.generator.*&#x3D; # Jackson on&#x2F;off features for generators.</span><br><span class="line">spring.jackson.joda-date-time-format&#x3D; # Joda date time format string. If not configured, &quot;date-format&quot; is used as a fallback if it is configured with a format string.</span><br><span class="line">spring.jackson.locale&#x3D; # Locale used for formatting.</span><br><span class="line">spring.jackson.mapper.*&#x3D; # Jackson general purpose on&#x2F;off features.</span><br><span class="line">spring.jackson.parser.*&#x3D; # Jackson on&#x2F;off features for parsers.</span><br><span class="line">spring.jackson.property-naming-strategy&#x3D; # One of the constants on Jackson&#39;s PropertyNamingStrategy. Can also be a fully-qualified class name of a PropertyNamingStrategy subclass.</span><br><span class="line">spring.jackson.serialization.*&#x3D; # Jackson on&#x2F;off features that affect the way Java objects are serialized.</span><br><span class="line">spring.jackson.time-zone&#x3D; #  Time zone used when formatting dates. For instance, &quot;America&#x2F;Los_Angeles&quot; or &quot;GMT+10&quot;.</span><br><span class="line">spring.jackson.visibility.*&#x3D; # Jackson visibility thresholds that can be used to limit which methods (and fields) are auto-detected.</span><br><span class="line"></span><br><span class="line"># GSON (GsonProperties)</span><br><span class="line">spring.gson.date-format&#x3D; # Format to use when serializing Date objects.</span><br><span class="line">spring.gson.disable-html-escaping&#x3D; # Whether to disable the escaping of HTML characters such as &#39;&lt;&#39;, &#39;&gt;&#39;, etc.</span><br><span class="line">spring.gson.disable-inner-class-serialization&#x3D; # Whether to exclude inner classes during serialization.</span><br><span class="line">spring.gson.enable-complex-map-key-serialization&#x3D; # Whether to enable serialization of complex map keys (i.e. non-primitives).</span><br><span class="line">spring.gson.exclude-fields-without-expose-annotation&#x3D; # Whether to exclude all fields from consideration for serialization or deserialization that do not have the &quot;Expose&quot; annotation.</span><br><span class="line">spring.gson.field-naming-policy&#x3D; # Naming policy that should be applied to an object&#39;s field during serialization and deserialization.</span><br><span class="line">spring.gson.generate-non-executable-json&#x3D; # Whether to generate non executable JSON by prefixing the output with some special text.</span><br><span class="line">spring.gson.lenient&#x3D; # Whether to be lenient about parsing JSON that doesn&#39;t conform to RFC 4627.</span><br><span class="line">spring.gson.long-serialization-policy&#x3D; # Serialization policy for Long and long types.</span><br><span class="line">spring.gson.pretty-printing&#x3D; # Whether to output serialized JSON that fits in a page for pretty printing.</span><br><span class="line">spring.gson.serialize-nulls&#x3D; # Whether to serialize null fields.</span><br><span class="line"></span><br><span class="line"># JERSEY (JerseyProperties)</span><br><span class="line">spring.jersey.application-path&#x3D; # Path that serves as the base URI for the application. If specified, overrides the value of &quot;@ApplicationPath&quot;.</span><br><span class="line">spring.jersey.filter.order&#x3D;0 # Jersey filter chain order.</span><br><span class="line">spring.jersey.init.*&#x3D; # Init parameters to pass to Jersey through the servlet or filter.</span><br><span class="line">spring.jersey.servlet.load-on-startup&#x3D;-1 # Load on startup priority of the Jersey servlet.</span><br><span class="line">spring.jersey.type&#x3D;servlet # Jersey integration type.</span><br><span class="line"></span><br><span class="line"># SPRING LDAP (LdapProperties)</span><br><span class="line">spring.ldap.anonymous-read-only&#x3D;false # Whether read-only operations should use an anonymous environment.</span><br><span class="line">spring.ldap.base&#x3D; # Base suffix from which all operations should originate.</span><br><span class="line">spring.ldap.base-environment.*&#x3D; # LDAP specification settings.</span><br><span class="line">spring.ldap.password&#x3D; # Login password of the server.</span><br><span class="line">spring.ldap.urls&#x3D; # LDAP URLs of the server.</span><br><span class="line">spring.ldap.username&#x3D; # Login username of the server.</span><br><span class="line"></span><br><span class="line"># EMBEDDED LDAP (EmbeddedLdapProperties)</span><br><span class="line">spring.ldap.embedded.base-dn&#x3D; # List of base DNs.</span><br><span class="line">spring.ldap.embedded.credential.username&#x3D; # Embedded LDAP username.</span><br><span class="line">spring.ldap.embedded.credential.password&#x3D; # Embedded LDAP password.</span><br><span class="line">spring.ldap.embedded.ldif&#x3D;classpath:schema.ldif # Schema (LDIF) script resource reference.</span><br><span class="line">spring.ldap.embedded.port&#x3D;0 # Embedded LDAP port.</span><br><span class="line">spring.ldap.embedded.validation.enabled&#x3D;true # Whether to enable LDAP schema validation.</span><br><span class="line">spring.ldap.embedded.validation.schema&#x3D; # Path to the custom schema.</span><br><span class="line"></span><br><span class="line"># MUSTACHE TEMPLATES (MustacheAutoConfiguration)</span><br><span class="line">spring.mustache.allow-request-override&#x3D;false # Whether HttpServletRequest attributes are allowed to override (hide) controller generated model attributes of the same name.</span><br><span class="line">spring.mustache.allow-session-override&#x3D;false # Whether HttpSession attributes are allowed to override (hide) controller generated model attributes of the same name.</span><br><span class="line">spring.mustache.cache&#x3D;false # Whether to enable template caching.</span><br><span class="line">spring.mustache.charset&#x3D;UTF-8 # Template encoding.</span><br><span class="line">spring.mustache.check-template-location&#x3D;true # Whether to check that the templates location exists.</span><br><span class="line">spring.mustache.content-type&#x3D;text&#x2F;html # Content-Type value.</span><br><span class="line">spring.mustache.enabled&#x3D;true # Whether to enable MVC view resolution for this technology.</span><br><span class="line">spring.mustache.expose-request-attributes&#x3D;false # Whether all request attributes should be added to the model prior to merging with the template.</span><br><span class="line">spring.mustache.expose-session-attributes&#x3D;false # Whether all HttpSession attributes should be added to the model prior to merging with the template.</span><br><span class="line">spring.mustache.expose-spring-macro-helpers&#x3D;true # Whether to expose a RequestContext for use by Spring&#39;s macro library, under the name &quot;springMacroRequestContext&quot;.</span><br><span class="line">spring.mustache.prefix&#x3D;classpath:&#x2F;templates&#x2F; # Prefix to apply to template names.</span><br><span class="line">spring.mustache.request-context-attribute&#x3D; # Name of the RequestContext attribute for all views.</span><br><span class="line">spring.mustache.suffix&#x3D;.mustache # Suffix to apply to template names.</span><br><span class="line">spring.mustache.view-names&#x3D; # White list of view names that can be resolved.</span><br><span class="line"></span><br><span class="line"># SPRING MVC (WebMvcProperties)</span><br><span class="line">spring.mvc.async.request-timeout&#x3D; # Amount of time before asynchronous request handling times out.</span><br><span class="line">spring.mvc.contentnegotiation.favor-parameter&#x3D;false # Whether a request parameter (&quot;format&quot; by default) should be used to determine the requested media type.</span><br><span class="line">spring.mvc.contentnegotiation.favor-path-extension&#x3D;false # Whether the path extension in the URL path should be used to determine the requested media type.</span><br><span class="line">spring.mvc.contentnegotiation.media-types.*&#x3D; # Map file extensions to media types for content negotiation. For instance, yml to text&#x2F;yaml.</span><br><span class="line">spring.mvc.contentnegotiation.parameter-name&#x3D; # Query parameter name to use when &quot;favor-parameter&quot; is enabled.</span><br><span class="line">spring.mvc.date-format&#x3D; # Date format to use. For instance, &#96;dd&#x2F;MM&#x2F;yyyy&#96;.</span><br><span class="line">spring.mvc.dispatch-trace-request&#x3D;false # Whether to dispatch TRACE requests to the FrameworkServlet doService method.</span><br><span class="line">spring.mvc.dispatch-options-request&#x3D;true # Whether to dispatch OPTIONS requests to the FrameworkServlet doService method.</span><br><span class="line">spring.mvc.favicon.enabled&#x3D;true # Whether to enable resolution of favicon.ico.</span><br><span class="line">spring.mvc.formcontent.filter.enabled&#x3D;true # Whether to enable Spring&#39;s FormContentFilter.</span><br><span class="line">spring.mvc.hiddenmethod.filter.enabled&#x3D;true # Whether to enable Spring&#39;s HiddenHttpMethodFilter.</span><br><span class="line">spring.mvc.ignore-default-model-on-redirect&#x3D;true # Whether the content of the &quot;default&quot; model should be ignored during redirect scenarios.</span><br><span class="line">spring.mvc.locale&#x3D; # Locale to use. By default, this locale is overridden by the &quot;Accept-Language&quot; header.</span><br><span class="line">spring.mvc.locale-resolver&#x3D;accept-header # Define how the locale should be resolved.</span><br><span class="line">spring.mvc.log-resolved-exception&#x3D;false # Whether to enable warn logging of exceptions resolved by a &quot;HandlerExceptionResolver&quot;, except for &quot;DefaultHandlerExceptionResolver&quot;.</span><br><span class="line">spring.mvc.message-codes-resolver-format&#x3D; # Formatting strategy for message codes. For instance, &#96;PREFIX_ERROR_CODE&#96;.</span><br><span class="line">spring.mvc.pathmatch.use-registered-suffix-pattern&#x3D;false # Whether suffix pattern matching should work only against extensions registered with &quot;spring.mvc.contentnegotiation.media-types.*&quot;.</span><br><span class="line">spring.mvc.pathmatch.use-suffix-pattern&#x3D;false # Whether to use suffix pattern match (&quot;.*&quot;) when matching patterns to requests.</span><br><span class="line">spring.mvc.servlet.load-on-startup&#x3D;-1 # Load on startup priority of the dispatcher servlet.</span><br><span class="line">spring.mvc.servlet.path&#x3D;&#x2F; # Path of the dispatcher servlet.</span><br><span class="line">spring.mvc.static-path-pattern&#x3D;&#x2F;** # Path pattern used for static resources.</span><br><span class="line">spring.mvc.throw-exception-if-no-handler-found&#x3D;false # Whether a &quot;NoHandlerFoundException&quot; should be thrown if no Handler was found to process a request.</span><br><span class="line">spring.mvc.view.prefix&#x3D; # Spring MVC view prefix.</span><br><span class="line">spring.mvc.view.suffix&#x3D; # Spring MVC view suffix.</span><br><span class="line"></span><br><span class="line"># SPRING RESOURCES HANDLING (ResourceProperties)</span><br><span class="line">spring.resources.add-mappings&#x3D;true # Whether to enable default resource handling.</span><br><span class="line">spring.resources.cache.cachecontrol.cache-private&#x3D; # Indicate that the response message is intended for a single user and must not be stored by a shared cache.</span><br><span class="line">spring.resources.cache.cachecontrol.cache-public&#x3D; # Indicate that any cache may store the response.</span><br><span class="line">spring.resources.cache.cachecontrol.max-age&#x3D; # Maximum time the response should be cached, in seconds if no duration suffix is not specified.</span><br><span class="line">spring.resources.cache.cachecontrol.must-revalidate&#x3D; # Indicate that once it has become stale, a cache must not use the response without re-validating it with the server.</span><br><span class="line">spring.resources.cache.cachecontrol.no-cache&#x3D; # Indicate that the cached response can be reused only if re-validated with the server.</span><br><span class="line">spring.resources.cache.cachecontrol.no-store&#x3D; # Indicate to not cache the response in any case.</span><br><span class="line">spring.resources.cache.cachecontrol.no-transform&#x3D; # Indicate intermediaries (caches and others) that they should not transform the response content.</span><br><span class="line">spring.resources.cache.cachecontrol.proxy-revalidate&#x3D; # Same meaning as the &quot;must-revalidate&quot; directive, except that it does not apply to private caches.</span><br><span class="line">spring.resources.cache.cachecontrol.s-max-age&#x3D; # Maximum time the response should be cached by shared caches, in seconds if no duration suffix is not specified.</span><br><span class="line">spring.resources.cache.cachecontrol.stale-if-error&#x3D; # Maximum time the response may be used when errors are encountered, in seconds if no duration suffix is not specified.</span><br><span class="line">spring.resources.cache.cachecontrol.stale-while-revalidate&#x3D; # Maximum time the response can be served after it becomes stale, in seconds if no duration suffix is not specified.</span><br><span class="line">spring.resources.cache.period&#x3D; # Cache period for the resources served by the resource handler. If a duration suffix is not specified, seconds will be used.</span><br><span class="line">spring.resources.chain.cache&#x3D;true # Whether to enable caching in the Resource chain.</span><br><span class="line">spring.resources.chain.compressed&#x3D;false # Whether to enable resolution of already compressed resources (gzip, brotli).</span><br><span class="line">spring.resources.chain.enabled&#x3D; # Whether to enable the Spring Resource Handling chain. By default, disabled unless at least one strategy has been enabled.</span><br><span class="line">spring.resources.chain.html-application-cache&#x3D;false # Whether to enable HTML5 application cache manifest rewriting.</span><br><span class="line">spring.resources.chain.strategy.content.enabled&#x3D;false # Whether to enable the content Version Strategy.</span><br><span class="line">spring.resources.chain.strategy.content.paths&#x3D;&#x2F;** # Comma-separated list of patterns to apply to the content Version Strategy.</span><br><span class="line">spring.resources.chain.strategy.fixed.enabled&#x3D;false # Whether to enable the fixed Version Strategy.</span><br><span class="line">spring.resources.chain.strategy.fixed.paths&#x3D;&#x2F;** # Comma-separated list of patterns to apply to the fixed Version Strategy.</span><br><span class="line">spring.resources.chain.strategy.fixed.version&#x3D; # Version string to use for the fixed Version Strategy.</span><br><span class="line">spring.resources.static-locations&#x3D;classpath:&#x2F;META-INF&#x2F;resources&#x2F;,classpath:&#x2F;resources&#x2F;,classpath:&#x2F;static&#x2F;,classpath:&#x2F;public&#x2F; # Locations of static resources.</span><br><span class="line"></span><br><span class="line"># SPRING SESSION (SessionProperties)</span><br><span class="line">spring.session.store-type&#x3D; # Session store type.</span><br><span class="line">spring.session.timeout&#x3D; # Session timeout. If a duration suffix is not specified, seconds will be used.</span><br><span class="line">spring.session.servlet.filter-order&#x3D;-2147483598 # Session repository filter order.</span><br><span class="line">spring.session.servlet.filter-dispatcher-types&#x3D;async,error,request # Session repository filter dispatcher types.</span><br><span class="line"></span><br><span class="line"># SPRING SESSION HAZELCAST (HazelcastSessionProperties)</span><br><span class="line">spring.session.hazelcast.flush-mode&#x3D;on-save # Sessions flush mode.</span><br><span class="line">spring.session.hazelcast.map-name&#x3D;spring:session:sessions # Name of the map used to store sessions.</span><br><span class="line"></span><br><span class="line"># SPRING SESSION JDBC (JdbcSessionProperties)</span><br><span class="line">spring.session.jdbc.cleanup-cron&#x3D;0 * * * * * # Cron expression for expired session cleanup job.</span><br><span class="line">spring.session.jdbc.initialize-schema&#x3D;embedded # Database schema initialization mode.</span><br><span class="line">spring.session.jdbc.schema&#x3D;classpath:org&#x2F;springframework&#x2F;session&#x2F;jdbc&#x2F;schema-@@platform@@.sql # Path to the SQL file to use to initialize the database schema.</span><br><span class="line">spring.session.jdbc.table-name&#x3D;SPRING_SESSION # Name of the database table used to store sessions.</span><br><span class="line"></span><br><span class="line"># SPRING SESSION MONGODB (MongoSessionProperties)</span><br><span class="line">spring.session.mongodb.collection-name&#x3D;sessions # Collection name used to store sessions.</span><br><span class="line"></span><br><span class="line"># SPRING SESSION REDIS (RedisSessionProperties)</span><br><span class="line">spring.session.redis.cleanup-cron&#x3D;0 * * * * * # Cron expression for expired session cleanup job.</span><br><span class="line">spring.session.redis.flush-mode&#x3D;on-save # Sessions flush mode.</span><br><span class="line">spring.session.redis.namespace&#x3D;spring:session # Namespace for keys used to store sessions.</span><br><span class="line"></span><br><span class="line"># THYMELEAF (ThymeleafAutoConfiguration)</span><br><span class="line">spring.thymeleaf.cache&#x3D;true # Whether to enable template caching.</span><br><span class="line">spring.thymeleaf.check-template&#x3D;true # Whether to check that the template exists before rendering it.</span><br><span class="line">spring.thymeleaf.check-template-location&#x3D;true # Whether to check that the templates location exists.</span><br><span class="line">spring.thymeleaf.enabled&#x3D;true # Whether to enable Thymeleaf view resolution for Web frameworks.</span><br><span class="line">spring.thymeleaf.enable-spring-el-compiler&#x3D;false # Enable the SpringEL compiler in SpringEL expressions.</span><br><span class="line">spring.thymeleaf.encoding&#x3D;UTF-8 # Template files encoding.</span><br><span class="line">spring.thymeleaf.excluded-view-names&#x3D; # Comma-separated list of view names (patterns allowed) that should be excluded from resolution.</span><br><span class="line">spring.thymeleaf.mode&#x3D;HTML # Template mode to be applied to templates. See also Thymeleaf&#39;s TemplateMode enum.</span><br><span class="line">spring.thymeleaf.prefix&#x3D;classpath:&#x2F;templates&#x2F; # Prefix that gets prepended to view names when building a URL.</span><br><span class="line">spring.thymeleaf.reactive.chunked-mode-view-names&#x3D; # Comma-separated list of view names (patterns allowed) that should be the only ones executed in CHUNKED mode when a max chunk size is set.</span><br><span class="line">spring.thymeleaf.reactive.full-mode-view-names&#x3D; # Comma-separated list of view names (patterns allowed) that should be executed in FULL mode even if a max chunk size is set.</span><br><span class="line">spring.thymeleaf.reactive.max-chunk-size&#x3D;0B # Maximum size of data buffers used for writing to the response.</span><br><span class="line">spring.thymeleaf.reactive.media-types&#x3D; # Media types supported by the view technology.</span><br><span class="line">spring.thymeleaf.render-hidden-markers-before-checkboxes&#x3D;false # Whether hidden form inputs acting as markers for checkboxes should be rendered before the checkbox element itself.</span><br><span class="line">spring.thymeleaf.servlet.content-type&#x3D;text&#x2F;html # Content-Type value written to HTTP responses.</span><br><span class="line">spring.thymeleaf.servlet.produce-partial-output-while-processing&#x3D;true # Whether Thymeleaf should start writing partial output as soon as possible or buffer until template processing is finished.</span><br><span class="line">spring.thymeleaf.suffix&#x3D;.html # Suffix that gets appended to view names when building a URL.</span><br><span class="line">spring.thymeleaf.template-resolver-order&#x3D; # Order of the template resolver in the chain.</span><br><span class="line">spring.thymeleaf.view-names&#x3D; # Comma-separated list of view names (patterns allowed) that can be resolved.</span><br><span class="line"></span><br><span class="line"># SPRING WEBFLUX (WebFluxProperties)</span><br><span class="line">spring.webflux.date-format&#x3D; # Date format to use. For instance, &#96;dd&#x2F;MM&#x2F;yyyy&#96;.</span><br><span class="line">spring.webflux.hiddenmethod.filter.enabled&#x3D;true # Whether to enable Spring&#39;s HiddenHttpMethodFilter.</span><br><span class="line">spring.webflux.static-path-pattern&#x3D;&#x2F;** # Path pattern used for static resources.</span><br><span class="line"></span><br><span class="line"># SPRING WEB SERVICES (WebServicesProperties)</span><br><span class="line">spring.webservices.path&#x3D;&#x2F;services # Path that serves as the base URI for the services.</span><br><span class="line">spring.webservices.servlet.init&#x3D; # Servlet init parameters to pass to Spring Web Services.</span><br><span class="line">spring.webservices.servlet.load-on-startup&#x3D;-1 # Load on startup priority of the Spring Web Services servlet.</span><br><span class="line">spring.webservices.wsdl-locations&#x3D; # Comma-separated list of locations of WSDLs and accompanying XSDs to be exposed as beans.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ----------------------------------------</span><br><span class="line"># SECURITY PROPERTIES</span><br><span class="line"># ----------------------------------------</span><br><span class="line"># SECURITY (SecurityProperties)</span><br><span class="line">spring.security.filter.order&#x3D;-100 # Security filter chain order.</span><br><span class="line">spring.security.filter.dispatcher-types&#x3D;async,error,request # Security filter chain dispatcher types.</span><br><span class="line">spring.security.user.name&#x3D;user # Default user name.</span><br><span class="line">spring.security.user.password&#x3D; # Password for the default user name.</span><br><span class="line">spring.security.user.roles&#x3D; # Granted roles for the default user name.</span><br><span class="line"></span><br><span class="line"># SECURITY OAUTH2 CLIENT (OAuth2ClientProperties)</span><br><span class="line">spring.security.oauth2.client.provider.*&#x3D; # OAuth provider details.</span><br><span class="line">spring.security.oauth2.client.registration.*&#x3D; # OAuth client registrations.</span><br><span class="line"></span><br><span class="line"># SECURITY OAUTH2 RESOURCE SERVER (OAuth2ResourceServerProperties)</span><br><span class="line">spring.security.oauth2.resourceserver.jwt.jwk-set-uri&#x3D; # JSON Web Key URI to use to verify the JWT token.</span><br><span class="line">   spring.security.oauth2.resourceserver.jwt.issuer-uri&#x3D; # URI that an OpenID Connect Provider asserts as its Issuer Identifier.</span><br><span class="line"></span><br><span class="line"># ----------------------------------------</span><br><span class="line"># DATA PROPERTIES</span><br><span class="line"># ----------------------------------------</span><br><span class="line"></span><br><span class="line"># FLYWAY (FlywayProperties)</span><br><span class="line">spring.flyway.baseline-description&#x3D;&lt;&lt; Flyway Baseline &gt;&gt; # Description to tag an existing schema with when applying a baseline.</span><br><span class="line">spring.flyway.baseline-on-migrate&#x3D;false # Whether to automatically call baseline when migrating a non-empty schema.</span><br><span class="line">spring.flyway.baseline-version&#x3D;1 # Version to tag an existing schema with when executing baseline.</span><br><span class="line">spring.flyway.check-location&#x3D;true # Whether to check that migration scripts location exists.</span><br><span class="line">spring.flyway.clean-disabled&#x3D;false # Whether to disable cleaning of the database.</span><br><span class="line">spring.flyway.clean-on-validation-error&#x3D;false # Whether to automatically call clean when a validation error occurs.</span><br><span class="line">spring.flyway.connect-retries&#x3D;0 # Maximum number of retries when attempting to connect to the database.</span><br><span class="line">spring.flyway.enabled&#x3D;true # Whether to enable flyway.</span><br><span class="line">spring.flyway.encoding&#x3D;UTF-8 # Encoding of SQL migrations.</span><br><span class="line">spring.flyway.group&#x3D;false # Whether to group all pending migrations together in the same transaction when applying them.</span><br><span class="line">spring.flyway.ignore-future-migrations&#x3D;true # Whether to ignore future migrations when reading the schema history table.</span><br><span class="line">spring.flyway.ignore-ignored-migrations&#x3D;false # Whether to ignore ignored migrations when reading the schema history table.</span><br><span class="line">spring.flyway.ignore-missing-migrations&#x3D;false # Whether to ignore missing migrations when reading the schema history table.</span><br><span class="line">spring.flyway.ignore-pending-migrations&#x3D;false # Whether to ignore pending migrations when reading the schema history table.</span><br><span class="line">spring.flyway.init-sqls&#x3D; # SQL statements to execute to initialize a connection immediately after obtaining it.</span><br><span class="line">spring.flyway.installed-by&#x3D; # Username recorded in the schema history table as having applied the migration.</span><br><span class="line">spring.flyway.locations&#x3D;classpath:db&#x2F;migration # Locations of migrations scripts. Can contain the special &quot;&#123;vendor&#125;&quot; placeholder to use vendor-specific locations.</span><br><span class="line">spring.flyway.mixed&#x3D;false # Whether to allow mixing transactional and non-transactional statements within the same migration.</span><br><span class="line">spring.flyway.out-of-order&#x3D;false # Whether to allow migrations to be run out of order.</span><br><span class="line">spring.flyway.password&#x3D; # Login password of the database to migrate.</span><br><span class="line">spring.flyway.placeholder-prefix&#x3D;$&#123; # Prefix of placeholders in migration scripts.</span><br><span class="line">spring.flyway.placeholder-replacement&#x3D;true # Perform placeholder replacement in migration scripts.</span><br><span class="line">spring.flyway.placeholder-suffix&#x3D;&#125; # Suffix of placeholders in migration scripts.</span><br><span class="line">spring.flyway.placeholders&#x3D; # Placeholders and their replacements to apply to sql migration scripts.</span><br><span class="line">spring.flyway.repeatable-sql-migration-prefix&#x3D;R # File name prefix for repeatable SQL migrations.</span><br><span class="line">spring.flyway.schemas&#x3D; # Scheme names managed by Flyway (case-sensitive).</span><br><span class="line">spring.flyway.skip-default-callbacks&#x3D;false # Whether to skip default callbacks. If true, only custom callbacks are used.</span><br><span class="line">spring.flyway.skip-default-resolvers&#x3D;false # Whether to skip default resolvers. If true, only custom resolvers are used.</span><br><span class="line">spring.flyway.sql-migration-prefix&#x3D;V # File name prefix for SQL migrations.</span><br><span class="line">spring.flyway.sql-migration-separator&#x3D;__ # File name separator for SQL migrations.</span><br><span class="line">spring.flyway.sql-migration-suffixes&#x3D;.sql # File name suffix for SQL migrations.</span><br><span class="line">spring.flyway.table&#x3D;flyway_schema_history # Name of the schema schema history table that will be used by Flyway.</span><br><span class="line">spring.flyway.target&#x3D; # Target version up to which migrations should be considered.</span><br><span class="line">spring.flyway.url&#x3D; # JDBC url of the database to migrate. If not set, the primary configured data source is used.</span><br><span class="line">spring.flyway.user&#x3D; # Login user of the database to migrate.</span><br><span class="line">spring.flyway.validate-on-migrate&#x3D;true # Whether to automatically call validate when performing a migration.</span><br><span class="line"></span><br><span class="line"># LIQUIBASE (LiquibaseProperties)</span><br><span class="line">spring.liquibase.change-log&#x3D;classpath:&#x2F;db&#x2F;changelog&#x2F;db.changelog-master.yaml # Change log configuration path.</span><br><span class="line">spring.liquibase.check-change-log-location&#x3D;true # Whether to check that the change log location exists.</span><br><span class="line">spring.liquibase.contexts&#x3D; # Comma-separated list of runtime contexts to use.</span><br><span class="line">spring.liquibase.database-change-log-lock-table&#x3D;DATABASECHANGELOGLOCK # Name of table to use for tracking concurrent Liquibase usage.</span><br><span class="line">spring.liquibase.database-change-log-table&#x3D;DATABASECHANGELOG # Name of table to use for tracking change history.</span><br><span class="line">spring.liquibase.default-schema&#x3D; # Default database schema.</span><br><span class="line">spring.liquibase.drop-first&#x3D;false # Whether to first drop the database schema.</span><br><span class="line">spring.liquibase.enabled&#x3D;true # Whether to enable Liquibase support.</span><br><span class="line">spring.liquibase.labels&#x3D; # Comma-separated list of runtime labels to use.</span><br><span class="line">spring.liquibase.liquibase-schema&#x3D; # Schema to use for Liquibase objects.</span><br><span class="line">spring.liquibase.liquibase-tablespace&#x3D; # Tablespace to use for Liquibase objects.</span><br><span class="line">spring.liquibase.parameters.*&#x3D; # Change log parameters.</span><br><span class="line">spring.liquibase.password&#x3D; # Login password of the database to migrate.</span><br><span class="line">spring.liquibase.rollback-file&#x3D; # File to which rollback SQL is written when an update is performed.</span><br><span class="line">spring.liquibase.test-rollback-on-update&#x3D;false # Whether rollback should be tested before update is performed.</span><br><span class="line">spring.liquibase.url&#x3D; # JDBC URL of the database to migrate. If not set, the primary configured data source is used.</span><br><span class="line">spring.liquibase.user&#x3D; # Login user of the database to migrate.</span><br><span class="line"></span><br><span class="line"># COUCHBASE (CouchbaseProperties)</span><br><span class="line">spring.couchbase.bootstrap-hosts&#x3D; # Couchbase nodes (host or IP address) to bootstrap from.</span><br><span class="line">spring.couchbase.bucket.name&#x3D;default # Name of the bucket to connect to.</span><br><span class="line">spring.couchbase.bucket.password&#x3D;  # Password of the bucket.</span><br><span class="line">spring.couchbase.env.endpoints.key-value&#x3D;1 # Number of sockets per node against the key&#x2F;value service.</span><br><span class="line">spring.couchbase.env.endpoints.queryservice.min-endpoints&#x3D;1 # Minimum number of sockets per node.</span><br><span class="line">spring.couchbase.env.endpoints.queryservice.max-endpoints&#x3D;1 # Maximum number of sockets per node.</span><br><span class="line">spring.couchbase.env.endpoints.viewservice.min-endpoints&#x3D;1 # Minimum number of sockets per node.</span><br><span class="line">spring.couchbase.env.endpoints.viewservice.max-endpoints&#x3D;1 # Maximum number of sockets per node.</span><br><span class="line">spring.couchbase.env.ssl.enabled&#x3D; # Whether to enable SSL support. Enabled automatically if a &quot;keyStore&quot; is provided unless specified otherwise.</span><br><span class="line">spring.couchbase.env.ssl.key-store&#x3D; # Path to the JVM key store that holds the certificates.</span><br><span class="line">spring.couchbase.env.ssl.key-store-password&#x3D; # Password used to access the key store.</span><br><span class="line">spring.couchbase.env.timeouts.connect&#x3D;5000ms # Bucket connections timeouts.</span><br><span class="line">spring.couchbase.env.timeouts.key-value&#x3D;2500ms # Blocking operations performed on a specific key timeout.</span><br><span class="line">spring.couchbase.env.timeouts.query&#x3D;7500ms # N1QL query operations timeout.</span><br><span class="line">spring.couchbase.env.timeouts.socket-connect&#x3D;1000ms # Socket connect connections timeout.</span><br><span class="line">spring.couchbase.env.timeouts.view&#x3D;7500ms # Regular and geospatial view operations timeout.</span><br><span class="line"></span><br><span class="line"># DAO (PersistenceExceptionTranslationAutoConfiguration)</span><br><span class="line">spring.dao.exceptiontranslation.enabled&#x3D;true # Whether to enable the PersistenceExceptionTranslationPostProcessor.</span><br><span class="line"></span><br><span class="line"># CASSANDRA (CassandraProperties)</span><br><span class="line">spring.data.cassandra.cluster-name&#x3D; # Name of the Cassandra cluster.</span><br><span class="line">spring.data.cassandra.compression&#x3D;none # Compression supported by the Cassandra binary protocol.</span><br><span class="line">spring.data.cassandra.connect-timeout&#x3D; # Socket option: connection time out.</span><br><span class="line">spring.data.cassandra.consistency-level&#x3D; # Queries consistency level.</span><br><span class="line">spring.data.cassandra.contact-points&#x3D;localhost # Cluster node addresses.</span><br><span class="line">spring.data.cassandra.fetch-size&#x3D; # Queries default fetch size.</span><br><span class="line">spring.data.cassandra.jmx-enabled&#x3D;false # Whether to enable JMX reporting.</span><br><span class="line">spring.data.cassandra.keyspace-name&#x3D; # Keyspace name to use.</span><br><span class="line">spring.data.cassandra.port&#x3D; # Port of the Cassandra server.</span><br><span class="line">spring.data.cassandra.password&#x3D; # Login password of the server.</span><br><span class="line">spring.data.cassandra.pool.heartbeat-interval&#x3D;30s # Heartbeat interval after which a message is sent on an idle connection to make sure it&#39;s still alive. If a duration suffix is not specified, seconds will be used.</span><br><span class="line">spring.data.cassandra.pool.idle-timeout&#x3D;120s # Idle timeout before an idle connection is removed. If a duration suffix is not specified, seconds will be used.</span><br><span class="line">spring.data.cassandra.pool.max-queue-size&#x3D;256 # Maximum number of requests that get queued if no connection is available.</span><br><span class="line">spring.data.cassandra.pool.pool-timeout&#x3D;5000ms # Pool timeout when trying to acquire a connection from a host&#39;s pool.</span><br><span class="line">spring.data.cassandra.read-timeout&#x3D; # Socket option: read time out.</span><br><span class="line">spring.data.cassandra.repositories.type&#x3D;auto # Type of Cassandra repositories to enable.</span><br><span class="line">spring.data.cassandra.serial-consistency-level&#x3D; # Queries serial consistency level.</span><br><span class="line">spring.data.cassandra.schema-action&#x3D;none # Schema action to take at startup.</span><br><span class="line">spring.data.cassandra.ssl&#x3D;false # Enable SSL support.</span><br><span class="line">spring.data.cassandra.username&#x3D; # Login user of the server.</span><br><span class="line"></span><br><span class="line"># DATA COUCHBASE (CouchbaseDataProperties)</span><br><span class="line">spring.data.couchbase.auto-index&#x3D;false # Automatically create views and indexes.</span><br><span class="line">spring.data.couchbase.consistency&#x3D;read-your-own-writes # Consistency to apply by default on generated queries.</span><br><span class="line">spring.data.couchbase.repositories.type&#x3D;auto # Type of Couchbase repositories to enable.</span><br><span class="line"></span><br><span class="line"># ELASTICSEARCH (ElasticsearchProperties)</span><br><span class="line">spring.data.elasticsearch.cluster-name&#x3D;elasticsearch # Elasticsearch cluster name.</span><br><span class="line">spring.data.elasticsearch.cluster-nodes&#x3D; # Comma-separated list of cluster node addresses.</span><br><span class="line">spring.data.elasticsearch.properties.*&#x3D; # Additional properties used to configure the client.</span><br><span class="line">spring.data.elasticsearch.repositories.enabled&#x3D;true # Whether to enable Elasticsearch repositories.</span><br><span class="line"></span><br><span class="line"># DATA JDBC</span><br><span class="line">spring.data.jdbc.repositories.enabled&#x3D;true # Whether to enable JDBC repositories.</span><br><span class="line"></span><br><span class="line"># DATA LDAP</span><br><span class="line">spring.data.ldap.repositories.enabled&#x3D;true # Whether to enable LDAP repositories.</span><br><span class="line"></span><br><span class="line"># MONGODB (MongoProperties)</span><br><span class="line">spring.data.mongodb.authentication-database&#x3D; # Authentication database name.</span><br><span class="line">spring.data.mongodb.database&#x3D; # Database name.</span><br><span class="line">spring.data.mongodb.field-naming-strategy&#x3D; # Fully qualified name of the FieldNamingStrategy to use.</span><br><span class="line">spring.data.mongodb.grid-fs-database&#x3D; # GridFS database name.</span><br><span class="line">spring.data.mongodb.host&#x3D; # Mongo server host. Cannot be set with URI.</span><br><span class="line">spring.data.mongodb.password&#x3D; # Login password of the mongo server. Cannot be set with URI.</span><br><span class="line">spring.data.mongodb.port&#x3D; # Mongo server port. Cannot be set with URI.</span><br><span class="line">spring.data.mongodb.repositories.type&#x3D;auto # Type of Mongo repositories to enable.</span><br><span class="line">spring.data.mongodb.uri&#x3D;mongodb:&#x2F;&#x2F;localhost&#x2F;test # Mongo database URI. Cannot be set with host, port and credentials.</span><br><span class="line">spring.data.mongodb.username&#x3D; # Login user of the mongo server. Cannot be set with URI.</span><br><span class="line"></span><br><span class="line"># DATA REDIS</span><br><span class="line">spring.data.redis.repositories.enabled&#x3D;true # Whether to enable Redis repositories.</span><br><span class="line"></span><br><span class="line"># NEO4J (Neo4jProperties)</span><br><span class="line">spring.data.neo4j.auto-index&#x3D;none # Auto index mode.</span><br><span class="line">spring.data.neo4j.embedded.enabled&#x3D;true # Whether to enable embedded mode if the embedded driver is available.</span><br><span class="line">spring.data.neo4j.open-in-view&#x3D;true # Register OpenSessionInViewInterceptor. Binds a Neo4j Session to the thread for the entire processing of the request.</span><br><span class="line">spring.data.neo4j.password&#x3D; # Login password of the server.</span><br><span class="line">spring.data.neo4j.repositories.enabled&#x3D;true # Whether to enable Neo4j repositories.</span><br><span class="line">spring.data.neo4j.uri&#x3D; # URI used by the driver. Auto-detected by default.</span><br><span class="line">spring.data.neo4j.username&#x3D; # Login user of the server.</span><br><span class="line"></span><br><span class="line"># DATA REST (RepositoryRestProperties)</span><br><span class="line">spring.data.rest.base-path&#x3D; # Base path to be used by Spring Data REST to expose repository resources.</span><br><span class="line">spring.data.rest.default-media-type&#x3D; # Content type to use as a default when none is specified.</span><br><span class="line">spring.data.rest.default-page-size&#x3D; # Default size of pages.</span><br><span class="line">spring.data.rest.detection-strategy&#x3D;default # Strategy to use to determine which repositories get exposed.</span><br><span class="line">spring.data.rest.enable-enum-translation&#x3D; # Whether to enable enum value translation through the Spring Data REST default resource bundle.</span><br><span class="line">spring.data.rest.limit-param-name&#x3D; # Name of the URL query string parameter that indicates how many results to return at once.</span><br><span class="line">spring.data.rest.max-page-size&#x3D; # Maximum size of pages.</span><br><span class="line">spring.data.rest.page-param-name&#x3D; # Name of the URL query string parameter that indicates what page to return.</span><br><span class="line">spring.data.rest.return-body-on-create&#x3D; # Whether to return a response body after creating an entity.</span><br><span class="line">spring.data.rest.return-body-on-update&#x3D; # Whether to return a response body after updating an entity.</span><br><span class="line">spring.data.rest.sort-param-name&#x3D; # Name of the URL query string parameter that indicates what direction to sort results.</span><br><span class="line"></span><br><span class="line"># SOLR (SolrProperties)</span><br><span class="line">spring.data.solr.host&#x3D;http:&#x2F;&#x2F;127.0.0.1:8983&#x2F;solr # Solr host. Ignored if &quot;zk-host&quot; is set.</span><br><span class="line">spring.data.solr.repositories.enabled&#x3D;true # Whether to enable Solr repositories.</span><br><span class="line">spring.data.solr.zk-host&#x3D; # ZooKeeper host address in the form HOST:PORT.</span><br><span class="line"></span><br><span class="line"># DATA WEB (SpringDataWebProperties)</span><br><span class="line">spring.data.web.pageable.default-page-size&#x3D;20 # Default page size.</span><br><span class="line">spring.data.web.pageable.max-page-size&#x3D;2000 # Maximum page size to be accepted.</span><br><span class="line">spring.data.web.pageable.one-indexed-parameters&#x3D;false # Whether to expose and assume 1-based page number indexes.</span><br><span class="line">spring.data.web.pageable.page-parameter&#x3D;page # Page index parameter name.</span><br><span class="line">spring.data.web.pageable.prefix&#x3D; # General prefix to be prepended to the page number and page size parameters.</span><br><span class="line">spring.data.web.pageable.qualifier-delimiter&#x3D;_ # Delimiter to be used between the qualifier and the actual page number and size properties.</span><br><span class="line">spring.data.web.pageable.size-parameter&#x3D;size # Page size parameter name.</span><br><span class="line">spring.data.web.sort.sort-parameter&#x3D;sort # Sort parameter name.</span><br><span class="line"></span><br><span class="line"># DATASOURCE (DataSourceAutoConfiguration &amp; DataSourceProperties)</span><br><span class="line">spring.datasource.continue-on-error&#x3D;false # Whether to stop if an error occurs while initializing the database.</span><br><span class="line">spring.datasource.data&#x3D; # Data (DML) script resource references.</span><br><span class="line">spring.datasource.data-username&#x3D; # Username of the database to execute DML scripts (if different).</span><br><span class="line">spring.datasource.data-password&#x3D; # Password of the database to execute DML scripts (if different).</span><br><span class="line">spring.datasource.dbcp2.*&#x3D; # Commons DBCP2 specific settings</span><br><span class="line">spring.datasource.driver-class-name&#x3D; # Fully qualified name of the JDBC driver. Auto-detected based on the URL by default.</span><br><span class="line">spring.datasource.generate-unique-name&#x3D;false # Whether to generate a random datasource name.</span><br><span class="line">spring.datasource.hikari.*&#x3D; # Hikari specific settings</span><br><span class="line">spring.datasource.initialization-mode&#x3D;embedded # Initialize the datasource with available DDL and DML scripts.</span><br><span class="line">spring.datasource.jmx-enabled&#x3D;false # Whether to enable JMX support (if provided by the underlying pool).</span><br><span class="line">spring.datasource.jndi-name&#x3D; # JNDI location of the datasource. Class, url, username &amp; password are ignored when set.</span><br><span class="line">spring.datasource.name&#x3D; # Name of the datasource. Default to &quot;testdb&quot; when using an embedded database.</span><br><span class="line">spring.datasource.password&#x3D; # Login password of the database.</span><br><span class="line">spring.datasource.platform&#x3D;all # Platform to use in the DDL or DML scripts (such as schema-$&#123;platform&#125;.sql or data-$&#123;platform&#125;.sql).</span><br><span class="line">spring.datasource.schema&#x3D; # Schema (DDL) script resource references.</span><br><span class="line">spring.datasource.schema-username&#x3D; # Username of the database to execute DDL scripts (if different).</span><br><span class="line">spring.datasource.schema-password&#x3D; # Password of the database to execute DDL scripts (if different).</span><br><span class="line">spring.datasource.separator&#x3D;; # Statement separator in SQL initialization scripts.</span><br><span class="line">spring.datasource.sql-script-encoding&#x3D; # SQL scripts encoding.</span><br><span class="line">spring.datasource.tomcat.*&#x3D; # Tomcat datasource specific settings</span><br><span class="line">spring.datasource.type&#x3D; # Fully qualified name of the connection pool implementation to use. By default, it is auto-detected from the classpath.</span><br><span class="line">spring.datasource.url&#x3D; # JDBC URL of the database.</span><br><span class="line">spring.datasource.username&#x3D; # Login username of the database.</span><br><span class="line">spring.datasource.xa.data-source-class-name&#x3D; # XA datasource fully qualified name.</span><br><span class="line">spring.datasource.xa.properties&#x3D; # Properties to pass to the XA data source.</span><br><span class="line"></span><br><span class="line"># JEST (Elasticsearch HTTP client) (JestProperties)</span><br><span class="line">spring.elasticsearch.jest.connection-timeout&#x3D;3s # Connection timeout.</span><br><span class="line">spring.elasticsearch.jest.multi-threaded&#x3D;true # Whether to enable connection requests from multiple execution threads.</span><br><span class="line">spring.elasticsearch.jest.password&#x3D; # Login password.</span><br><span class="line">spring.elasticsearch.jest.proxy.host&#x3D; # Proxy host the HTTP client should use.</span><br><span class="line">spring.elasticsearch.jest.proxy.port&#x3D; # Proxy port the HTTP client should use.</span><br><span class="line">spring.elasticsearch.jest.read-timeout&#x3D;3s # Read timeout.</span><br><span class="line">spring.elasticsearch.jest.uris&#x3D;http:&#x2F;&#x2F;localhost:9200 # Comma-separated list of the Elasticsearch instances to use.</span><br><span class="line">spring.elasticsearch.jest.username&#x3D; # Login username.</span><br><span class="line"></span><br><span class="line"># Elasticsearch REST clients (RestClientProperties)</span><br><span class="line">spring.elasticsearch.rest.password&#x3D; # Credentials password.</span><br><span class="line">   spring.elasticsearch.rest.uris&#x3D;http:&#x2F;&#x2F;localhost:9200 # Comma-separated list of the Elasticsearch instances to use.</span><br><span class="line">   spring.elasticsearch.rest.username&#x3D; # Credentials username.</span><br><span class="line"></span><br><span class="line"># H2 Web Console (H2ConsoleProperties)</span><br><span class="line">spring.h2.console.enabled&#x3D;false # Whether to enable the console.</span><br><span class="line">spring.h2.console.path&#x3D;&#x2F;h2-console # Path at which the console is available.</span><br><span class="line">spring.h2.console.settings.trace&#x3D;false # Whether to enable trace output.</span><br><span class="line">spring.h2.console.settings.web-allow-others&#x3D;false # Whether to enable remote access.</span><br><span class="line"></span><br><span class="line"># InfluxDB (InfluxDbProperties)</span><br><span class="line">spring.influx.password&#x3D; # Login password.</span><br><span class="line">spring.influx.url&#x3D; # URL of the InfluxDB instance to which to connect.</span><br><span class="line">spring.influx.user&#x3D; # Login user.</span><br><span class="line"></span><br><span class="line"># JOOQ (JooqProperties)</span><br><span class="line">spring.jooq.sql-dialect&#x3D; # SQL dialect to use. Auto-detected by default.</span><br><span class="line"></span><br><span class="line"># JDBC (JdbcProperties)</span><br><span class="line">spring.jdbc.template.fetch-size&#x3D;-1 # Number of rows that should be fetched from the database when more rows are needed.</span><br><span class="line">spring.jdbc.template.max-rows&#x3D;-1 # Maximum number of rows.</span><br><span class="line">spring.jdbc.template.query-timeout&#x3D; # Query timeout. Default is to use the JDBC driver&#39;s default configuration. If a duration suffix is not specified, seconds will be used.</span><br><span class="line"></span><br><span class="line"># JPA (JpaBaseConfiguration, HibernateJpaAutoConfiguration)</span><br><span class="line">spring.data.jpa.repositories.bootstrap-mode&#x3D;default # Bootstrap mode for JPA repositories.</span><br><span class="line">spring.data.jpa.repositories.enabled&#x3D;true # Whether to enable JPA repositories.</span><br><span class="line">spring.jpa.database&#x3D; # Target database to operate on, auto-detected by default. Can be alternatively set using the &quot;databasePlatform&quot; property.</span><br><span class="line">spring.jpa.database-platform&#x3D; # Name of the target database to operate on, auto-detected by default. Can be alternatively set using the &quot;Database&quot; enum.</span><br><span class="line">spring.jpa.generate-ddl&#x3D;false # Whether to initialize the schema on startup.</span><br><span class="line">spring.jpa.hibernate.ddl-auto&#x3D; # DDL mode. This is actually a shortcut for the &quot;hibernate.hbm2ddl.auto&quot; property. Defaults to &quot;create-drop&quot; when using an embedded database and no schema manager was detected. Otherwise, defaults to &quot;none&quot;.</span><br><span class="line">spring.jpa.hibernate.naming.implicit-strategy&#x3D; # Fully qualified name of the implicit naming strategy.</span><br><span class="line">spring.jpa.hibernate.naming.physical-strategy&#x3D; # Fully qualified name of the physical naming strategy.</span><br><span class="line">spring.jpa.hibernate.use-new-id-generator-mappings&#x3D; # Whether to use Hibernate&#39;s newer IdentifierGenerator for AUTO, TABLE and SEQUENCE.</span><br><span class="line">spring.jpa.mapping-resources&#x3D; # Mapping resources (equivalent to &quot;mapping-file&quot; entries in persistence.xml).</span><br><span class="line">spring.jpa.open-in-view&#x3D;true # Register OpenEntityManagerInViewInterceptor. Binds a JPA EntityManager to the thread for the entire processing of the request.</span><br><span class="line">spring.jpa.properties.*&#x3D; # Additional native properties to set on the JPA provider.</span><br><span class="line">spring.jpa.show-sql&#x3D;false # Whether to enable logging of SQL statements.</span><br><span class="line"></span><br><span class="line"># JTA (JtaAutoConfiguration)</span><br><span class="line">spring.jta.enabled&#x3D;true # Whether to enable JTA support.</span><br><span class="line">spring.jta.log-dir&#x3D; # Transaction logs directory.</span><br><span class="line">spring.jta.transaction-manager-id&#x3D; # Transaction manager unique identifier.</span><br><span class="line"></span><br><span class="line"># ATOMIKOS (AtomikosProperties)</span><br><span class="line">spring.jta.atomikos.connectionfactory.borrow-connection-timeout&#x3D;30 # Timeout, in seconds, for borrowing connections from the pool.</span><br><span class="line">spring.jta.atomikos.connectionfactory.ignore-session-transacted-flag&#x3D;true # Whether to ignore the transacted flag when creating session.</span><br><span class="line">spring.jta.atomikos.connectionfactory.local-transaction-mode&#x3D;false # Whether local transactions are desired.</span><br><span class="line">spring.jta.atomikos.connectionfactory.maintenance-interval&#x3D;60 # The time, in seconds, between runs of the pool&#39;s maintenance thread.</span><br><span class="line">spring.jta.atomikos.connectionfactory.max-idle-time&#x3D;60 # The time, in seconds, after which connections are cleaned up from the pool.</span><br><span class="line">spring.jta.atomikos.connectionfactory.max-lifetime&#x3D;0 # The time, in seconds, that a connection can be pooled for before being destroyed. 0 denotes no limit.</span><br><span class="line">spring.jta.atomikos.connectionfactory.max-pool-size&#x3D;1 # The maximum size of the pool.</span><br><span class="line">spring.jta.atomikos.connectionfactory.min-pool-size&#x3D;1 # The minimum size of the pool.</span><br><span class="line">spring.jta.atomikos.connectionfactory.reap-timeout&#x3D;0 # The reap timeout, in seconds, for borrowed connections. 0 denotes no limit.</span><br><span class="line">spring.jta.atomikos.connectionfactory.unique-resource-name&#x3D;jmsConnectionFactory # The unique name used to identify the resource during recovery.</span><br><span class="line">spring.jta.atomikos.connectionfactory.xa-connection-factory-class-name&#x3D; # Vendor-specific implementation of XAConnectionFactory.</span><br><span class="line">spring.jta.atomikos.connectionfactory.xa-properties&#x3D; # Vendor-specific XA properties.</span><br><span class="line">spring.jta.atomikos.datasource.borrow-connection-timeout&#x3D;30 # Timeout, in seconds, for borrowing connections from the pool.</span><br><span class="line">spring.jta.atomikos.datasource.concurrent-connection-validation&#x3D; # Whether to use concurrent connection validation.</span><br><span class="line">spring.jta.atomikos.datasource.default-isolation-level&#x3D; # Default isolation level of connections provided by the pool.</span><br><span class="line">spring.jta.atomikos.datasource.login-timeout&#x3D; # Timeout, in seconds, for establishing a database connection.</span><br><span class="line">spring.jta.atomikos.datasource.maintenance-interval&#x3D;60 # The time, in seconds, between runs of the pool&#39;s maintenance thread.</span><br><span class="line">spring.jta.atomikos.datasource.max-idle-time&#x3D;60 # The time, in seconds, after which connections are cleaned up from the pool.</span><br><span class="line">spring.jta.atomikos.datasource.max-lifetime&#x3D;0 # The time, in seconds, that a connection can be pooled for before being destroyed. 0 denotes no limit.</span><br><span class="line">spring.jta.atomikos.datasource.max-pool-size&#x3D;1 # The maximum size of the pool.</span><br><span class="line">spring.jta.atomikos.datasource.min-pool-size&#x3D;1 # The minimum size of the pool.</span><br><span class="line">spring.jta.atomikos.datasource.reap-timeout&#x3D;0 # The reap timeout, in seconds, for borrowed connections. 0 denotes no limit.</span><br><span class="line">spring.jta.atomikos.datasource.test-query&#x3D; # SQL query or statement used to validate a connection before returning it.</span><br><span class="line">spring.jta.atomikos.datasource.unique-resource-name&#x3D;dataSource # The unique name used to identify the resource during recovery.</span><br><span class="line">spring.jta.atomikos.datasource.xa-data-source-class-name&#x3D; # Vendor-specific implementation of XAConnectionFactory.</span><br><span class="line">spring.jta.atomikos.datasource.xa-properties&#x3D; # Vendor-specific XA properties.</span><br><span class="line">spring.jta.atomikos.properties.allow-sub-transactions&#x3D;true # Specify whether sub-transactions are allowed.</span><br><span class="line">spring.jta.atomikos.properties.checkpoint-interval&#x3D;500 # Interval between checkpoints, expressed as the number of log writes between two checkpoints.</span><br><span class="line">spring.jta.atomikos.properties.default-jta-timeout&#x3D;10000ms # Default timeout for JTA transactions.</span><br><span class="line">spring.jta.atomikos.properties.default-max-wait-time-on-shutdown&#x3D;9223372036854775807 # How long should normal shutdown (no-force) wait for transactions to complete.</span><br><span class="line">spring.jta.atomikos.properties.enable-logging&#x3D;true # Whether to enable disk logging.</span><br><span class="line">spring.jta.atomikos.properties.force-shutdown-on-vm-exit&#x3D;false # Whether a VM shutdown should trigger forced shutdown of the transaction core.</span><br><span class="line">spring.jta.atomikos.properties.log-base-dir&#x3D; # Directory in which the log files should be stored.</span><br><span class="line">spring.jta.atomikos.properties.log-base-name&#x3D;tmlog # Transactions log file base name.</span><br><span class="line">spring.jta.atomikos.properties.max-actives&#x3D;50 # Maximum number of active transactions.</span><br><span class="line">spring.jta.atomikos.properties.max-timeout&#x3D;300000ms # Maximum timeout that can be allowed for transactions.</span><br><span class="line">spring.jta.atomikos.properties.recovery.delay&#x3D;10000ms # Delay between two recovery scans.</span><br><span class="line">spring.jta.atomikos.properties.recovery.forget-orphaned-log-entries-delay&#x3D;86400000ms # Delay after which recovery can cleanup pending (&#39;orphaned&#39;) log entries.</span><br><span class="line">spring.jta.atomikos.properties.recovery.max-retries&#x3D;5 # Number of retry attempts to commit the transaction before throwing an exception.</span><br><span class="line">spring.jta.atomikos.properties.recovery.retry-interval&#x3D;10000ms # Delay between retry attempts.</span><br><span class="line">spring.jta.atomikos.properties.serial-jta-transactions&#x3D;true # Whether sub-transactions should be joined when possible.</span><br><span class="line">spring.jta.atomikos.properties.service&#x3D; # Transaction manager implementation that should be started.</span><br><span class="line">spring.jta.atomikos.properties.threaded-two-phase-commit&#x3D;false # Whether to use different (and concurrent) threads for two-phase commit on the participating resources.</span><br><span class="line">spring.jta.atomikos.properties.transaction-manager-unique-name&#x3D; # The transaction manager&#39;s unique name.</span><br><span class="line"></span><br><span class="line"># BITRONIX</span><br><span class="line">spring.jta.bitronix.connectionfactory.acquire-increment&#x3D;1 # Number of connections to create when growing the pool.</span><br><span class="line">spring.jta.bitronix.connectionfactory.acquisition-interval&#x3D;1 # Time, in seconds, to wait before trying to acquire a connection again after an invalid connection was acquired.</span><br><span class="line">spring.jta.bitronix.connectionfactory.acquisition-timeout&#x3D;30 # Timeout, in seconds, for acquiring connections from the pool.</span><br><span class="line">spring.jta.bitronix.connectionfactory.allow-local-transactions&#x3D;true # Whether the transaction manager should allow mixing XA and non-XA transactions.</span><br><span class="line">spring.jta.bitronix.connectionfactory.apply-transaction-timeout&#x3D;false # Whether the transaction timeout should be set on the XAResource when it is enlisted.</span><br><span class="line">spring.jta.bitronix.connectionfactory.automatic-enlisting-enabled&#x3D;true # Whether resources should be enlisted and delisted automatically.</span><br><span class="line">spring.jta.bitronix.connectionfactory.cache-producers-consumers&#x3D;true # Whether producers and consumers should be cached.</span><br><span class="line">spring.jta.bitronix.connectionfactory.class-name&#x3D; # Underlying implementation class name of the XA resource.</span><br><span class="line">spring.jta.bitronix.connectionfactory.defer-connection-release&#x3D;true # Whether the provider can run many transactions on the same connection and supports transaction interleaving.</span><br><span class="line">spring.jta.bitronix.connectionfactory.disabled&#x3D; # Whether this resource is disabled, meaning it&#39;s temporarily forbidden to acquire a connection from its pool.</span><br><span class="line">spring.jta.bitronix.connectionfactory.driver-properties&#x3D; # Properties that should be set on the underlying implementation.</span><br><span class="line">spring.jta.bitronix.connectionfactory.failed&#x3D; # Mark this resource producer as failed.</span><br><span class="line">spring.jta.bitronix.connectionfactory.ignore-recovery-failures&#x3D;false # Whether recovery failures should be ignored.</span><br><span class="line">spring.jta.bitronix.connectionfactory.max-idle-time&#x3D;60 # The time, in seconds, after which connections are cleaned up from the pool.</span><br><span class="line">spring.jta.bitronix.connectionfactory.max-pool-size&#x3D;10 # The maximum size of the pool. 0 denotes no limit.</span><br><span class="line">spring.jta.bitronix.connectionfactory.min-pool-size&#x3D;0 # The minimum size of the pool.</span><br><span class="line">spring.jta.bitronix.connectionfactory.password&#x3D; # The password to use to connect to the JMS provider.</span><br><span class="line">spring.jta.bitronix.connectionfactory.share-transaction-connections&#x3D;false #  Whether connections in the ACCESSIBLE state can be shared within the context of a transaction.</span><br><span class="line">spring.jta.bitronix.connectionfactory.test-connections&#x3D;true # Whether connections should be tested when acquired from the pool.</span><br><span class="line">spring.jta.bitronix.connectionfactory.two-pc-ordering-position&#x3D;1 # The position that this resource should take during two-phase commit (always first is Integer.MIN_VALUE, always last is Integer.MAX_VALUE).</span><br><span class="line">spring.jta.bitronix.connectionfactory.unique-name&#x3D;jmsConnectionFactory # The unique name used to identify the resource during recovery.</span><br><span class="line">spring.jta.bitronix.connectionfactory.use-tm-join&#x3D;true # Whether TMJOIN should be used when starting XAResources.</span><br><span class="line">spring.jta.bitronix.connectionfactory.user&#x3D; # The user to use to connect to the JMS provider.</span><br><span class="line">spring.jta.bitronix.datasource.acquire-increment&#x3D;1 # Number of connections to create when growing the pool.</span><br><span class="line">spring.jta.bitronix.datasource.acquisition-interval&#x3D;1 # Time, in seconds, to wait before trying to acquire a connection again after an invalid connection was acquired.</span><br><span class="line">spring.jta.bitronix.datasource.acquisition-timeout&#x3D;30 # Timeout, in seconds, for acquiring connections from the pool.</span><br><span class="line">spring.jta.bitronix.datasource.allow-local-transactions&#x3D;true # Whether the transaction manager should allow mixing XA and non-XA transactions.</span><br><span class="line">spring.jta.bitronix.datasource.apply-transaction-timeout&#x3D;false # Whether the transaction timeout should be set on the XAResource when it is enlisted.</span><br><span class="line">spring.jta.bitronix.datasource.automatic-enlisting-enabled&#x3D;true # Whether resources should be enlisted and delisted automatically.</span><br><span class="line">spring.jta.bitronix.datasource.class-name&#x3D; # Underlying implementation class name of the XA resource.</span><br><span class="line">spring.jta.bitronix.datasource.cursor-holdability&#x3D; # The default cursor holdability for connections.</span><br><span class="line">spring.jta.bitronix.datasource.defer-connection-release&#x3D;true # Whether the database can run many transactions on the same connection and supports transaction interleaving.</span><br><span class="line">spring.jta.bitronix.datasource.disabled&#x3D; # Whether this resource is disabled, meaning it&#39;s temporarily forbidden to acquire a connection from its pool.</span><br><span class="line">spring.jta.bitronix.datasource.driver-properties&#x3D; # Properties that should be set on the underlying implementation.</span><br><span class="line">spring.jta.bitronix.datasource.enable-jdbc4-connection-test&#x3D; # Whether Connection.isValid() is called when acquiring a connection from the pool.</span><br><span class="line">spring.jta.bitronix.datasource.failed&#x3D; # Mark this resource producer as failed.</span><br><span class="line">spring.jta.bitronix.datasource.ignore-recovery-failures&#x3D;false # Whether recovery failures should be ignored.</span><br><span class="line">spring.jta.bitronix.datasource.isolation-level&#x3D; # The default isolation level for connections.</span><br><span class="line">spring.jta.bitronix.datasource.local-auto-commit&#x3D; # The default auto-commit mode for local transactions.</span><br><span class="line">spring.jta.bitronix.datasource.login-timeout&#x3D; # Timeout, in seconds, for establishing a database connection.</span><br><span class="line">spring.jta.bitronix.datasource.max-idle-time&#x3D;60 # The time, in seconds, after which connections are cleaned up from the pool.</span><br><span class="line">spring.jta.bitronix.datasource.max-pool-size&#x3D;10 # The maximum size of the pool. 0 denotes no limit.</span><br><span class="line">spring.jta.bitronix.datasource.min-pool-size&#x3D;0 # The minimum size of the pool.</span><br><span class="line">spring.jta.bitronix.datasource.prepared-statement-cache-size&#x3D;0 # The target size of the prepared statement cache. 0 disables the cache.</span><br><span class="line">spring.jta.bitronix.datasource.share-transaction-connections&#x3D;false #  Whether connections in the ACCESSIBLE state can be shared within the context of a transaction.</span><br><span class="line">spring.jta.bitronix.datasource.test-query&#x3D; # SQL query or statement used to validate a connection before returning it.</span><br><span class="line">spring.jta.bitronix.datasource.two-pc-ordering-position&#x3D;1 # The position that this resource should take during two-phase commit (always first is Integer.MIN_VALUE, and always last is Integer.MAX_VALUE).</span><br><span class="line">spring.jta.bitronix.datasource.unique-name&#x3D;dataSource # The unique name used to identify the resource during recovery.</span><br><span class="line">spring.jta.bitronix.datasource.use-tm-join&#x3D;true # Whether TMJOIN should be used when starting XAResources.</span><br><span class="line">spring.jta.bitronix.properties.allow-multiple-lrc&#x3D;false # Whether to allow multiple LRC resources to be enlisted into the same transaction.</span><br><span class="line">spring.jta.bitronix.properties.asynchronous2-pc&#x3D;false # Whether to enable asynchronously execution of two phase commit.</span><br><span class="line">spring.jta.bitronix.properties.background-recovery-interval-seconds&#x3D;60 # Interval in seconds at which to run the recovery process in the background.</span><br><span class="line">spring.jta.bitronix.properties.current-node-only-recovery&#x3D;true # Whether to recover only the current node.</span><br><span class="line">spring.jta.bitronix.properties.debug-zero-resource-transaction&#x3D;false # Whether to log the creation and commit call stacks of transactions executed without a single enlisted resource.</span><br><span class="line">spring.jta.bitronix.properties.default-transaction-timeout&#x3D;60 # Default transaction timeout, in seconds.</span><br><span class="line">spring.jta.bitronix.properties.disable-jmx&#x3D;false # Whether to enable JMX support.</span><br><span class="line">spring.jta.bitronix.properties.exception-analyzer&#x3D; # Set the fully qualified name of the exception analyzer implementation to use.</span><br><span class="line">spring.jta.bitronix.properties.filter-log-status&#x3D;false # Whether to enable filtering of logs so that only mandatory logs are written.</span><br><span class="line">spring.jta.bitronix.properties.force-batching-enabled&#x3D;true #  Whether disk forces are batched.</span><br><span class="line">spring.jta.bitronix.properties.forced-write-enabled&#x3D;true # Whether logs are forced to disk.</span><br><span class="line">spring.jta.bitronix.properties.graceful-shutdown-interval&#x3D;60 # Maximum amount of seconds the TM waits for transactions to get done before aborting them at shutdown time.</span><br><span class="line">spring.jta.bitronix.properties.jndi-transaction-synchronization-registry-name&#x3D; # JNDI name of the TransactionSynchronizationRegistry.</span><br><span class="line">spring.jta.bitronix.properties.jndi-user-transaction-name&#x3D; # JNDI name of the UserTransaction.</span><br><span class="line">spring.jta.bitronix.properties.journal&#x3D;disk # Name of the journal. Can be &#39;disk&#39;, &#39;null&#39;, or a class name.</span><br><span class="line">spring.jta.bitronix.properties.log-part1-filename&#x3D;btm1.tlog # Name of the first fragment of the journal.</span><br><span class="line">spring.jta.bitronix.properties.log-part2-filename&#x3D;btm2.tlog # Name of the second fragment of the journal.</span><br><span class="line">spring.jta.bitronix.properties.max-log-size-in-mb&#x3D;2 # Maximum size in megabytes of the journal fragments.</span><br><span class="line">spring.jta.bitronix.properties.resource-configuration-filename&#x3D; # ResourceLoader configuration file name.</span><br><span class="line">spring.jta.bitronix.properties.server-id&#x3D; # ASCII ID that must uniquely identify this TM instance. Defaults to the machine&#39;s IP address.</span><br><span class="line">spring.jta.bitronix.properties.skip-corrupted-logs&#x3D;false # Skip corrupted transactions log entries.</span><br><span class="line">spring.jta.bitronix.properties.warn-about-zero-resource-transaction&#x3D;true # Whether to log a warning for transactions executed without a single enlisted resource.</span><br><span class="line"></span><br><span class="line"># EMBEDDED MONGODB (EmbeddedMongoProperties)</span><br><span class="line">spring.mongodb.embedded.features&#x3D;sync_delay # Comma-separated list of features to enable.</span><br><span class="line">spring.mongodb.embedded.storage.database-dir&#x3D; # Directory used for data storage.</span><br><span class="line">spring.mongodb.embedded.storage.oplog-size&#x3D; # Maximum size of the oplog.</span><br><span class="line">spring.mongodb.embedded.storage.repl-set-name&#x3D; # Name of the replica set.</span><br><span class="line">spring.mongodb.embedded.version&#x3D;3.5.5 # Version of Mongo to use.</span><br><span class="line"></span><br><span class="line"># REDIS (RedisProperties)</span><br><span class="line">spring.redis.cluster.max-redirects&#x3D; # Maximum number of redirects to follow when executing commands across the cluster.</span><br><span class="line">spring.redis.cluster.nodes&#x3D; # Comma-separated list of &quot;host:port&quot; pairs to bootstrap from.</span><br><span class="line">spring.redis.database&#x3D;0 # Database index used by the connection factory.</span><br><span class="line">spring.redis.url&#x3D; # Connection URL. Overrides host, port, and password. User is ignored. Example: redis:&#x2F;&#x2F;user:password@example.com:6379</span><br><span class="line">spring.redis.host&#x3D;localhost # Redis server host.</span><br><span class="line">spring.redis.jedis.pool.max-active&#x3D;8 # Maximum number of connections that can be allocated by the pool at a given time. Use a negative value for no limit.</span><br><span class="line">spring.redis.jedis.pool.max-idle&#x3D;8 # Maximum number of &quot;idle&quot; connections in the pool. Use a negative value to indicate an unlimited number of idle connections.</span><br><span class="line">spring.redis.jedis.pool.max-wait&#x3D;-1ms # Maximum amount of time a connection allocation should block before throwing an exception when the pool is exhausted. Use a negative value to block indefinitely.</span><br><span class="line">spring.redis.jedis.pool.min-idle&#x3D;0 # Target for the minimum number of idle connections to maintain in the pool. This setting only has an effect if it is positive.</span><br><span class="line">spring.redis.lettuce.pool.max-active&#x3D;8 # Maximum number of connections that can be allocated by the pool at a given time. Use a negative value for no limit.</span><br><span class="line">spring.redis.lettuce.pool.max-idle&#x3D;8 # Maximum number of &quot;idle&quot; connections in the pool. Use a negative value to indicate an unlimited number of idle connections.</span><br><span class="line">spring.redis.lettuce.pool.max-wait&#x3D;-1ms # Maximum amount of time a connection allocation should block before throwing an exception when the pool is exhausted. Use a negative value to block indefinitely.</span><br><span class="line">spring.redis.lettuce.pool.min-idle&#x3D;0 # Target for the minimum number of idle connections to maintain in the pool. This setting only has an effect if it is positive.</span><br><span class="line">spring.redis.lettuce.shutdown-timeout&#x3D;100ms # Shutdown timeout.</span><br><span class="line">spring.redis.password&#x3D; # Login password of the redis server.</span><br><span class="line">spring.redis.port&#x3D;6379 # Redis server port.</span><br><span class="line">spring.redis.sentinel.master&#x3D; # Name of the Redis server.</span><br><span class="line">spring.redis.sentinel.nodes&#x3D; # Comma-separated list of &quot;host:port&quot; pairs.</span><br><span class="line">spring.redis.ssl&#x3D;false # Whether to enable SSL support.</span><br><span class="line">spring.redis.timeout&#x3D; # Connection timeout.</span><br><span class="line"></span><br><span class="line"># TRANSACTION (TransactionProperties)</span><br><span class="line">spring.transaction.default-timeout&#x3D; # Default transaction timeout. If a duration suffix is not specified, seconds will be used.</span><br><span class="line">spring.transaction.rollback-on-commit-failure&#x3D; # Whether to roll back on commit failures.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ----------------------------------------</span><br><span class="line"># INTEGRATION PROPERTIES</span><br><span class="line"># ----------------------------------------</span><br><span class="line"></span><br><span class="line"># ACTIVEMQ (ActiveMQProperties)</span><br><span class="line">spring.activemq.broker-url&#x3D; # URL of the ActiveMQ broker. Auto-generated by default.</span><br><span class="line">spring.activemq.close-timeout&#x3D;15s # Time to wait before considering a close complete.</span><br><span class="line">spring.activemq.in-memory&#x3D;true # Whether the default broker URL should be in memory. Ignored if an explicit broker has been specified.</span><br><span class="line">spring.activemq.non-blocking-redelivery&#x3D;false # Whether to stop message delivery before re-delivering messages from a rolled back transaction. This implies that message order is not preserved when this is enabled.</span><br><span class="line">spring.activemq.password&#x3D; # Login password of the broker.</span><br><span class="line">spring.activemq.send-timeout&#x3D;0ms # Time to wait on message sends for a response. Set it to 0 to wait forever.</span><br><span class="line">spring.activemq.user&#x3D; # Login user of the broker.</span><br><span class="line">spring.activemq.packages.trust-all&#x3D; # Whether to trust all packages.</span><br><span class="line">spring.activemq.packages.trusted&#x3D; # Comma-separated list of specific packages to trust (when not trusting all packages).</span><br><span class="line">spring.activemq.pool.block-if-full&#x3D;true # Whether to block when a connection is requested and the pool is full. Set it to false to throw a &quot;JMSException&quot; instead.</span><br><span class="line">spring.activemq.pool.block-if-full-timeout&#x3D;-1ms # Blocking period before throwing an exception if the pool is still full.</span><br><span class="line">spring.activemq.pool.enabled&#x3D;false # Whether a JmsPoolConnectionFactory should be created, instead of a regular ConnectionFactory.</span><br><span class="line">spring.activemq.pool.idle-timeout&#x3D;30s # Connection idle timeout.</span><br><span class="line">spring.activemq.pool.max-connections&#x3D;1 # Maximum number of pooled connections.</span><br><span class="line">spring.activemq.pool.max-sessions-per-connection&#x3D;500 # Maximum number of pooled sessions per connection in the pool.</span><br><span class="line">spring.activemq.pool.time-between-expiration-check&#x3D;-1ms # Time to sleep between runs of the idle connection eviction thread. When negative, no idle connection eviction thread runs.</span><br><span class="line">spring.activemq.pool.use-anonymous-producers&#x3D;true # Whether to use only one anonymous &quot;MessageProducer&quot; instance. Set it to false to create one &quot;MessageProducer&quot; every time one is required.</span><br><span class="line"></span><br><span class="line"># ARTEMIS (ArtemisProperties)</span><br><span class="line">spring.artemis.embedded.cluster-password&#x3D; # Cluster password. Randomly generated on startup by default.</span><br><span class="line">spring.artemis.embedded.data-directory&#x3D; # Journal file directory. Not necessary if persistence is turned off.</span><br><span class="line">spring.artemis.embedded.enabled&#x3D;true # Whether to enable embedded mode if the Artemis server APIs are available.</span><br><span class="line">spring.artemis.embedded.persistent&#x3D;false # Whether to enable persistent store.</span><br><span class="line">spring.artemis.embedded.queues&#x3D; # Comma-separated list of queues to create on startup.</span><br><span class="line">spring.artemis.embedded.server-id&#x3D; # Server ID. By default, an auto-incremented counter is used.</span><br><span class="line">spring.artemis.embedded.topics&#x3D; # Comma-separated list of topics to create on startup.</span><br><span class="line">spring.artemis.host&#x3D;localhost # Artemis broker host.</span><br><span class="line">spring.artemis.mode&#x3D; # Artemis deployment mode, auto-detected by default.</span><br><span class="line">spring.artemis.password&#x3D; # Login password of the broker.</span><br><span class="line">spring.artemis.pool.block-if-full&#x3D;true # Whether to block when a connection is requested and the pool is full. Set it to false to throw a &quot;JMSException&quot; instead.</span><br><span class="line">spring.artemis.pool.block-if-full-timeout&#x3D;-1ms # Blocking period before throwing an exception if the pool is still full.</span><br><span class="line">spring.artemis.pool.enabled&#x3D;false # Whether a JmsPoolConnectionFactory should be created, instead of a regular ConnectionFactory.</span><br><span class="line">spring.artemis.pool.idle-timeout&#x3D;30s # Connection idle timeout.</span><br><span class="line">spring.artemis.pool.max-connections&#x3D;1 # Maximum number of pooled connections.</span><br><span class="line">spring.artemis.pool.max-sessions-per-connection&#x3D;500 # Maximum number of pooled sessions per connection in the pool.</span><br><span class="line">spring.artemis.pool.time-between-expiration-check&#x3D;-1ms # Time to sleep between runs of the idle connection eviction thread. When negative, no idle connection eviction thread runs.</span><br><span class="line">spring.artemis.pool.use-anonymous-producers&#x3D;true # Whether to use only one anonymous &quot;MessageProducer&quot; instance. Set it to false to create one &quot;MessageProducer&quot; every time one is required.</span><br><span class="line">spring.artemis.port&#x3D;61616 # Artemis broker port.</span><br><span class="line">spring.artemis.user&#x3D; # Login user of the broker.</span><br><span class="line"></span><br><span class="line"># SPRING BATCH (BatchProperties)</span><br><span class="line">spring.batch.initialize-schema&#x3D;embedded # Database schema initialization mode.</span><br><span class="line">spring.batch.job.enabled&#x3D;true # Execute all Spring Batch jobs in the context on startup.</span><br><span class="line">spring.batch.job.names&#x3D; # Comma-separated list of job names to execute on startup (for instance, &#96;job1,job2&#96;). By default, all Jobs found in the context are executed.</span><br><span class="line">spring.batch.schema&#x3D;classpath:org&#x2F;springframework&#x2F;batch&#x2F;core&#x2F;schema-@@platform@@.sql # Path to the SQL file to use to initialize the database schema.</span><br><span class="line">spring.batch.table-prefix&#x3D; # Table prefix for all the batch meta-data tables.</span><br><span class="line"></span><br><span class="line"># SPRING INTEGRATION (IntegrationProperties)</span><br><span class="line">spring.integration.jdbc.initialize-schema&#x3D;embedded # Database schema initialization mode.</span><br><span class="line">spring.integration.jdbc.schema&#x3D;classpath:org&#x2F;springframework&#x2F;integration&#x2F;jdbc&#x2F;schema-@@platform@@.sql # Path to the SQL file to use to initialize the database schema.</span><br><span class="line"></span><br><span class="line"># JMS (JmsProperties)</span><br><span class="line">spring.jms.cache.consumers&#x3D;false # Whether to cache message consumers.</span><br><span class="line">spring.jms.cache.enabled&#x3D;true # Whether to cache sessions.</span><br><span class="line">spring.jms.cache.producers&#x3D;true # Whether to cache message producers.</span><br><span class="line">spring.jms.cache.session-cache-size&#x3D;1 # Size of the session cache (per JMS Session type).</span><br><span class="line">spring.jms.jndi-name&#x3D; # Connection factory JNDI name. When set, takes precedence to others connection factory auto-configurations.</span><br><span class="line">spring.jms.listener.acknowledge-mode&#x3D; # Acknowledge mode of the container. By default, the listener is transacted with automatic acknowledgment.</span><br><span class="line">spring.jms.listener.auto-startup&#x3D;true # Start the container automatically on startup.</span><br><span class="line">spring.jms.listener.concurrency&#x3D; # Minimum number of concurrent consumers.</span><br><span class="line">spring.jms.listener.max-concurrency&#x3D; # Maximum number of concurrent consumers.</span><br><span class="line">spring.jms.pub-sub-domain&#x3D;false # Whether the default destination type is topic.</span><br><span class="line">spring.jms.template.default-destination&#x3D; # Default destination to use on send and receive operations that do not have a destination parameter.</span><br><span class="line">spring.jms.template.delivery-delay&#x3D; # Delivery delay to use for send calls.</span><br><span class="line">spring.jms.template.delivery-mode&#x3D; # Delivery mode. Enables QoS (Quality of Service) when set.</span><br><span class="line">spring.jms.template.priority&#x3D; # Priority of a message when sending. Enables QoS (Quality of Service) when set.</span><br><span class="line">spring.jms.template.qos-enabled&#x3D; # Whether to enable explicit QoS (Quality of Service) when sending a message.</span><br><span class="line">spring.jms.template.receive-timeout&#x3D; # Timeout to use for receive calls.</span><br><span class="line">spring.jms.template.time-to-live&#x3D; # Time-to-live of a message when sending. Enables QoS (Quality of Service) when set.</span><br><span class="line"></span><br><span class="line"># APACHE KAFKA (KafkaProperties)</span><br><span class="line">spring.kafka.admin.client-id&#x3D; # ID to pass to the server when making requests. Used for server-side logging.</span><br><span class="line">spring.kafka.admin.fail-fast&#x3D;false # Whether to fail fast if the broker is not available on startup.</span><br><span class="line">spring.kafka.admin.properties.*&#x3D; # Additional admin-specific properties used to configure the client.</span><br><span class="line">spring.kafka.admin.ssl.key-password&#x3D; # Password of the private key in the key store file.</span><br><span class="line">spring.kafka.admin.ssl.key-store-location&#x3D; # Location of the key store file.</span><br><span class="line">spring.kafka.admin.ssl.key-store-password&#x3D; # Store password for the key store file.</span><br><span class="line">spring.kafka.admin.ssl.key-store-type&#x3D; # Type of the key store.</span><br><span class="line">spring.kafka.admin.ssl.protocol&#x3D; # SSL protocol to use.</span><br><span class="line">spring.kafka.admin.ssl.trust-store-location&#x3D; # Location of the trust store file.</span><br><span class="line">spring.kafka.admin.ssl.trust-store-password&#x3D; # Store password for the trust store file.</span><br><span class="line">spring.kafka.admin.ssl.trust-store-type&#x3D; # Type of the trust store.</span><br><span class="line">spring.kafka.bootstrap-servers&#x3D; # Comma-delimited list of host:port pairs to use for establishing the initial connections to the Kafka cluster. Applies to all components unless overridden.</span><br><span class="line">spring.kafka.client-id&#x3D; # ID to pass to the server when making requests. Used for server-side logging.</span><br><span class="line">spring.kafka.consumer.auto-commit-interval&#x3D; # Frequency with which the consumer offsets are auto-committed to Kafka if &#39;enable.auto.commit&#39; is set to true.</span><br><span class="line">spring.kafka.consumer.auto-offset-reset&#x3D; # What to do when there is no initial offset in Kafka or if the current offset no longer exists on the server.</span><br><span class="line">spring.kafka.consumer.bootstrap-servers&#x3D; # Comma-delimited list of host:port pairs to use for establishing the initial connections to the Kafka cluster. Overrides the global property, for consumers.</span><br><span class="line">spring.kafka.consumer.client-id&#x3D; # ID to pass to the server when making requests. Used for server-side logging.</span><br><span class="line">spring.kafka.consumer.enable-auto-commit&#x3D; # Whether the consumer&#39;s offset is periodically committed in the background.</span><br><span class="line">spring.kafka.consumer.fetch-max-wait&#x3D; # Maximum amount of time the server blocks before answering the fetch request if there isn&#39;t sufficient data to immediately satisfy the requirement given by &quot;fetch-min-size&quot;.</span><br><span class="line">spring.kafka.consumer.fetch-min-size&#x3D; # Minimum amount of data the server should return for a fetch request.</span><br><span class="line">spring.kafka.consumer.group-id&#x3D; # Unique string that identifies the consumer group to which this consumer belongs.</span><br><span class="line">spring.kafka.consumer.heartbeat-interval&#x3D; # Expected time between heartbeats to the consumer coordinator.</span><br><span class="line">spring.kafka.consumer.key-deserializer&#x3D; # Deserializer class for keys.</span><br><span class="line">spring.kafka.consumer.max-poll-records&#x3D; # Maximum number of records returned in a single call to poll().</span><br><span class="line">spring.kafka.consumer.properties.*&#x3D; # Additional consumer-specific properties used to configure the client.</span><br><span class="line">spring.kafka.consumer.ssl.key-password&#x3D; # Password of the private key in the key store file.</span><br><span class="line">spring.kafka.consumer.ssl.key-store-location&#x3D; # Location of the key store file.</span><br><span class="line">spring.kafka.consumer.ssl.key-store-password&#x3D; # Store password for the key store file.</span><br><span class="line">spring.kafka.consumer.ssl.key-store-type&#x3D; # Type of the key store.</span><br><span class="line">spring.kafka.consumer.ssl.protocol&#x3D; # SSL protocol to use.</span><br><span class="line">spring.kafka.consumer.ssl.trust-store-location&#x3D; # Location of the trust store file.</span><br><span class="line">spring.kafka.consumer.ssl.trust-store-password&#x3D; # Store password for the trust store file.</span><br><span class="line">spring.kafka.consumer.ssl.trust-store-type&#x3D; # Type of the trust store.</span><br><span class="line">spring.kafka.consumer.value-deserializer&#x3D; # Deserializer class for values.</span><br><span class="line">spring.kafka.jaas.control-flag&#x3D;required # Control flag for login configuration.</span><br><span class="line">spring.kafka.jaas.enabled&#x3D;false # Whether to enable JAAS configuration.</span><br><span class="line">spring.kafka.jaas.login-module&#x3D;com.sun.security.auth.module.Krb5LoginModule # Login module.</span><br><span class="line">spring.kafka.jaas.options&#x3D; # Additional JAAS options.</span><br><span class="line">spring.kafka.listener.ack-count&#x3D; # Number of records between offset commits when ackMode is &quot;COUNT&quot; or &quot;COUNT_TIME&quot;.</span><br><span class="line">spring.kafka.listener.ack-mode&#x3D; # Listener AckMode. See the spring-kafka documentation.</span><br><span class="line">spring.kafka.listener.ack-time&#x3D; # Time between offset commits when ackMode is &quot;TIME&quot; or &quot;COUNT_TIME&quot;.</span><br><span class="line">spring.kafka.listener.client-id&#x3D; # Prefix for the listener&#39;s consumer client.id property.</span><br><span class="line">spring.kafka.listener.concurrency&#x3D; # Number of threads to run in the listener containers.</span><br><span class="line">spring.kafka.listener.idle-event-interval&#x3D; # Time between publishing idle consumer events (no data received).</span><br><span class="line">spring.kafka.listener.log-container-config&#x3D; # Whether to log the container configuration during initialization (INFO level).</span><br><span class="line">spring.kafka.listener.monitor-interval&#x3D; # Time between checks for non-responsive consumers. If a duration suffix is not specified, seconds will be used.</span><br><span class="line">spring.kafka.listener.no-poll-threshold&#x3D; # Multiplier applied to &quot;pollTimeout&quot; to determine if a consumer is non-responsive.</span><br><span class="line">spring.kafka.listener.poll-timeout&#x3D; # Timeout to use when polling the consumer.</span><br><span class="line">spring.kafka.listener.type&#x3D;single # Listener type.</span><br><span class="line">spring.kafka.producer.acks&#x3D; # Number of acknowledgments the producer requires the leader to have received before considering a request complete.</span><br><span class="line">spring.kafka.producer.batch-size&#x3D; # Default batch size.</span><br><span class="line">spring.kafka.producer.bootstrap-servers&#x3D; # Comma-delimited list of host:port pairs to use for establishing the initial connections to the Kafka cluster. Overrides the global property, for producers.</span><br><span class="line">spring.kafka.producer.buffer-memory&#x3D; # Total memory size the producer can use to buffer records waiting to be sent to the server.</span><br><span class="line">spring.kafka.producer.client-id&#x3D; # ID to pass to the server when making requests. Used for server-side logging.</span><br><span class="line">spring.kafka.producer.compression-type&#x3D; # Compression type for all data generated by the producer.</span><br><span class="line">spring.kafka.producer.key-serializer&#x3D; # Serializer class for keys.</span><br><span class="line">spring.kafka.producer.properties.*&#x3D; # Additional producer-specific properties used to configure the client.</span><br><span class="line">spring.kafka.producer.retries&#x3D; # When greater than zero, enables retrying of failed sends.</span><br><span class="line">spring.kafka.producer.ssl.key-password&#x3D; # Password of the private key in the key store file.</span><br><span class="line">spring.kafka.producer.ssl.key-store-location&#x3D; # Location of the key store file.</span><br><span class="line">spring.kafka.producer.ssl.key-store-password&#x3D; # Store password for the key store file.</span><br><span class="line">spring.kafka.producer.ssl.key-store-type&#x3D; # Type of the key store.</span><br><span class="line">spring.kafka.producer.ssl.protocol&#x3D; # SSL protocol to use.</span><br><span class="line">spring.kafka.producer.ssl.trust-store-location&#x3D; # Location of the trust store file.</span><br><span class="line">spring.kafka.producer.ssl.trust-store-password&#x3D; # Store password for the trust store file.</span><br><span class="line">spring.kafka.producer.ssl.trust-store-type&#x3D; # Type of the trust store.</span><br><span class="line">spring.kafka.producer.transaction-id-prefix&#x3D; # When non empty, enables transaction support for producer.</span><br><span class="line">spring.kafka.producer.value-serializer&#x3D; # Serializer class for values.</span><br><span class="line">spring.kafka.properties.*&#x3D; # Additional properties, common to producers and consumers, used to configure the client.</span><br><span class="line">spring.kafka.ssl.key-password&#x3D; # Password of the private key in the key store file.</span><br><span class="line">spring.kafka.ssl.key-store-location&#x3D; # Location of the key store file.</span><br><span class="line">spring.kafka.ssl.key-store-password&#x3D; # Store password for the key store file.</span><br><span class="line">spring.kafka.ssl.key-store-type&#x3D; # Type of the key store.</span><br><span class="line">spring.kafka.ssl.protocol&#x3D; # SSL protocol to use.</span><br><span class="line">spring.kafka.ssl.trust-store-location&#x3D; # Location of the trust store file.</span><br><span class="line">spring.kafka.ssl.trust-store-password&#x3D; # Store password for the trust store file.</span><br><span class="line">spring.kafka.ssl.trust-store-type&#x3D; # Type of the trust store.</span><br><span class="line">spring.kafka.streams.application-id&#x3D; # Kafka streams application.id property; default spring.application.name.</span><br><span class="line">spring.kafka.streams.auto-startup&#x3D;true # Whether or not to auto-start the streams factory bean.</span><br><span class="line">spring.kafka.streams.bootstrap-servers&#x3D; # Comma-delimited list of host:port pairs to use for establishing the initial connections to the Kafka cluster. Overrides the global property, for streams.</span><br><span class="line">spring.kafka.streams.cache-max-size-buffering&#x3D; # Maximum memory size to be used for buffering across all threads.</span><br><span class="line">spring.kafka.streams.client-id&#x3D; # ID to pass to the server when making requests. Used for server-side logging.</span><br><span class="line">spring.kafka.streams.properties.*&#x3D; # Additional Kafka properties used to configure the streams.</span><br><span class="line">spring.kafka.streams.replication-factor&#x3D; # The replication factor for change log topics and repartition topics created by the stream processing application.</span><br><span class="line">spring.kafka.streams.ssl.key-password&#x3D; # Password of the private key in the key store file.</span><br><span class="line">spring.kafka.streams.ssl.key-store-location&#x3D; # Location of the key store file.</span><br><span class="line">spring.kafka.streams.ssl.key-store-password&#x3D; # Store password for the key store file.</span><br><span class="line">spring.kafka.streams.ssl.key-store-type&#x3D; # Type of the key store.</span><br><span class="line">spring.kafka.streams.ssl.protocol&#x3D; # SSL protocol to use.</span><br><span class="line">spring.kafka.streams.ssl.trust-store-location&#x3D; # Location of the trust store file.</span><br><span class="line">spring.kafka.streams.ssl.trust-store-password&#x3D; # Store password for the trust store file.</span><br><span class="line">spring.kafka.streams.ssl.trust-store-type&#x3D; # Type of the trust store.</span><br><span class="line">spring.kafka.streams.state-dir&#x3D; # Directory location for the state store.</span><br><span class="line">spring.kafka.template.default-topic&#x3D; # Default topic to which messages are sent.</span><br><span class="line"></span><br><span class="line"># RABBIT (RabbitProperties)</span><br><span class="line">spring.rabbitmq.addresses&#x3D; # Comma-separated list of addresses to which the client should connect.</span><br><span class="line">spring.rabbitmq.cache.channel.checkout-timeout&#x3D; # Duration to wait to obtain a channel if the cache size has been reached.</span><br><span class="line">spring.rabbitmq.cache.channel.size&#x3D; # Number of channels to retain in the cache.</span><br><span class="line">spring.rabbitmq.cache.connection.mode&#x3D;channel # Connection factory cache mode.</span><br><span class="line">spring.rabbitmq.cache.connection.size&#x3D; # Number of connections to cache.</span><br><span class="line">spring.rabbitmq.connection-timeout&#x3D; # Connection timeout. Set it to zero to wait forever.</span><br><span class="line">spring.rabbitmq.dynamic&#x3D;true # Whether to create an AmqpAdmin bean.</span><br><span class="line">spring.rabbitmq.host&#x3D;localhost # RabbitMQ host.</span><br><span class="line">spring.rabbitmq.listener.direct.acknowledge-mode&#x3D; # Acknowledge mode of container.</span><br><span class="line">spring.rabbitmq.listener.direct.auto-startup&#x3D;true # Whether to start the container automatically on startup.</span><br><span class="line">spring.rabbitmq.listener.direct.consumers-per-queue&#x3D; # Number of consumers per queue.</span><br><span class="line">spring.rabbitmq.listener.direct.default-requeue-rejected&#x3D; # Whether rejected deliveries are re-queued by default.</span><br><span class="line">spring.rabbitmq.listener.direct.idle-event-interval&#x3D; # How often idle container events should be published.</span><br><span class="line">spring.rabbitmq.listener.direct.missing-queues-fatal&#x3D;false # Whether to fail if the queues declared by the container are not available on the broker.</span><br><span class="line">spring.rabbitmq.listener.direct.prefetch&#x3D; # Maximum number of unacknowledged messages that can be outstanding at each consumer.</span><br><span class="line">spring.rabbitmq.listener.direct.retry.enabled&#x3D;false # Whether publishing retries are enabled.</span><br><span class="line">spring.rabbitmq.listener.direct.retry.initial-interval&#x3D;1000ms # Duration between the first and second attempt to deliver a message.</span><br><span class="line">spring.rabbitmq.listener.direct.retry.max-attempts&#x3D;3 # Maximum number of attempts to deliver a message.</span><br><span class="line">spring.rabbitmq.listener.direct.retry.max-interval&#x3D;10000ms # Maximum duration between attempts.</span><br><span class="line">spring.rabbitmq.listener.direct.retry.multiplier&#x3D;1 # Multiplier to apply to the previous retry interval.</span><br><span class="line">spring.rabbitmq.listener.direct.retry.stateless&#x3D;true # Whether retries are stateless or stateful.</span><br><span class="line">spring.rabbitmq.listener.simple.acknowledge-mode&#x3D; # Acknowledge mode of container.</span><br><span class="line">spring.rabbitmq.listener.simple.auto-startup&#x3D;true # Whether to start the container automatically on startup.</span><br><span class="line">spring.rabbitmq.listener.simple.concurrency&#x3D; # Minimum number of listener invoker threads.</span><br><span class="line">spring.rabbitmq.listener.simple.default-requeue-rejected&#x3D; # Whether rejected deliveries are re-queued by default.</span><br><span class="line">spring.rabbitmq.listener.simple.idle-event-interval&#x3D; # How often idle container events should be published.</span><br><span class="line">spring.rabbitmq.listener.simple.max-concurrency&#x3D; # Maximum number of listener invoker threads.</span><br><span class="line">spring.rabbitmq.listener.simple.missing-queues-fatal&#x3D;true # Whether to fail if the queues declared by the container are not available on the broker and&#x2F;or whether to stop the container if one or more queues are deleted at runtime.</span><br><span class="line">spring.rabbitmq.listener.simple.prefetch&#x3D; # Maximum number of unacknowledged messages that can be outstanding at each consumer.</span><br><span class="line">spring.rabbitmq.listener.simple.retry.enabled&#x3D;false # Whether publishing retries are enabled.</span><br><span class="line">spring.rabbitmq.listener.simple.retry.initial-interval&#x3D;1000ms # Duration between the first and second attempt to deliver a message.</span><br><span class="line">spring.rabbitmq.listener.simple.retry.max-attempts&#x3D;3 # Maximum number of attempts to deliver a message.</span><br><span class="line">spring.rabbitmq.listener.simple.retry.max-interval&#x3D;10000ms # Maximum duration between attempts.</span><br><span class="line">spring.rabbitmq.listener.simple.retry.multiplier&#x3D;1 # Multiplier to apply to the previous retry interval.</span><br><span class="line">spring.rabbitmq.listener.simple.retry.stateless&#x3D;true # Whether retries are stateless or stateful.</span><br><span class="line">spring.rabbitmq.listener.simple.transaction-size&#x3D; # Number of messages to be processed between acks when the acknowledge mode is AUTO. If larger than prefetch, prefetch will be increased to this value.</span><br><span class="line">spring.rabbitmq.listener.type&#x3D;simple # Listener container type.</span><br><span class="line">spring.rabbitmq.password&#x3D;guest # Login to authenticate against the broker.</span><br><span class="line">spring.rabbitmq.port&#x3D;5672 # RabbitMQ port.</span><br><span class="line">spring.rabbitmq.publisher-confirms&#x3D;false # Whether to enable publisher confirms.</span><br><span class="line">spring.rabbitmq.publisher-returns&#x3D;false # Whether to enable publisher returns.</span><br><span class="line">spring.rabbitmq.requested-heartbeat&#x3D; # Requested heartbeat timeout; zero for none. If a duration suffix is not specified, seconds will be used.</span><br><span class="line">spring.rabbitmq.ssl.algorithm&#x3D; # SSL algorithm to use. By default, configured by the Rabbit client library.</span><br><span class="line">spring.rabbitmq.ssl.enabled&#x3D;false # Whether to enable SSL support.</span><br><span class="line">spring.rabbitmq.ssl.key-store&#x3D; # Path to the key store that holds the SSL certificate.</span><br><span class="line">spring.rabbitmq.ssl.key-store-password&#x3D; # Password used to access the key store.</span><br><span class="line">spring.rabbitmq.ssl.key-store-type&#x3D;PKCS12 # Key store type.</span><br><span class="line">spring.rabbitmq.ssl.trust-store&#x3D; # Trust store that holds SSL certificates.</span><br><span class="line">spring.rabbitmq.ssl.trust-store-password&#x3D; # Password used to access the trust store.</span><br><span class="line">spring.rabbitmq.ssl.trust-store-type&#x3D;JKS # Trust store type.</span><br><span class="line">spring.rabbitmq.ssl.validate-server-certificate&#x3D;true # Whether to enable server side certificate validation.</span><br><span class="line">spring.rabbitmq.ssl.verify-hostname&#x3D;true # Whether to enable hostname verification.</span><br><span class="line">spring.rabbitmq.template.default-receive-queue&#x3D; # Name of the default queue to receive messages from when none is specified explicitly.</span><br><span class="line">spring.rabbitmq.template.exchange&#x3D; # Name of the default exchange to use for send operations.</span><br><span class="line">spring.rabbitmq.template.mandatory&#x3D; # Whether to enable mandatory messages.</span><br><span class="line">spring.rabbitmq.template.receive-timeout&#x3D; # Timeout for &#96;receive()&#96; operations.</span><br><span class="line">spring.rabbitmq.template.reply-timeout&#x3D; # Timeout for &#96;sendAndReceive()&#96; operations.</span><br><span class="line">spring.rabbitmq.template.retry.enabled&#x3D;false # Whether publishing retries are enabled.</span><br><span class="line">spring.rabbitmq.template.retry.initial-interval&#x3D;1000ms # Duration between the first and second attempt to deliver a message.</span><br><span class="line">spring.rabbitmq.template.retry.max-attempts&#x3D;3 # Maximum number of attempts to deliver a message.</span><br><span class="line">spring.rabbitmq.template.retry.max-interval&#x3D;10000ms # Maximum duration between attempts.</span><br><span class="line">spring.rabbitmq.template.retry.multiplier&#x3D;1 # Multiplier to apply to the previous retry interval.</span><br><span class="line">spring.rabbitmq.template.routing-key&#x3D; # Value of a default routing key to use for send operations.</span><br><span class="line">spring.rabbitmq.username&#x3D;guest # Login user to authenticate to the broker.</span><br><span class="line">spring.rabbitmq.virtual-host&#x3D; # Virtual host to use when connecting to the broker.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ----------------------------------------</span><br><span class="line"># ACTUATOR PROPERTIES</span><br><span class="line"># ----------------------------------------</span><br><span class="line"></span><br><span class="line"># MANAGEMENT HTTP SERVER (ManagementServerProperties)</span><br><span class="line">management.server.add-application-context-header&#x3D;false # Add the &quot;X-Application-Context&quot; HTTP header in each response.</span><br><span class="line">management.server.address&#x3D; # Network address to which the management endpoints should bind. Requires a custom management.server.port.</span><br><span class="line">management.server.port&#x3D; # Management endpoint HTTP port (uses the same port as the application by default). Configure a different port to use management-specific SSL.</span><br><span class="line">management.server.servlet.context-path&#x3D; # Management endpoint context-path (for instance, &#96;&#x2F;management&#96;). Requires a custom management.server.port.</span><br><span class="line">management.server.ssl.ciphers&#x3D; # Supported SSL ciphers.</span><br><span class="line">management.server.ssl.client-auth&#x3D; # Client authentication mode.</span><br><span class="line">management.server.ssl.enabled&#x3D;true # Whether to enable SSL support.</span><br><span class="line">management.server.ssl.enabled-protocols&#x3D; # Enabled SSL protocols.</span><br><span class="line">management.server.ssl.key-alias&#x3D; # Alias that identifies the key in the key store.</span><br><span class="line">management.server.ssl.key-password&#x3D; # Password used to access the key in the key store.</span><br><span class="line">management.server.ssl.key-store&#x3D; # Path to the key store that holds the SSL certificate (typically a jks file).</span><br><span class="line">management.server.ssl.key-store-password&#x3D; # Password used to access the key store.</span><br><span class="line">management.server.ssl.key-store-provider&#x3D; # Provider for the key store.</span><br><span class="line">management.server.ssl.key-store-type&#x3D; # Type of the key store.</span><br><span class="line">management.server.ssl.protocol&#x3D;TLS # SSL protocol to use.</span><br><span class="line">management.server.ssl.trust-store&#x3D; # Trust store that holds SSL certificates.</span><br><span class="line">management.server.ssl.trust-store-password&#x3D; # Password used to access the trust store.</span><br><span class="line">management.server.ssl.trust-store-provider&#x3D; # Provider for the trust store.</span><br><span class="line">management.server.ssl.trust-store-type&#x3D; # Type of the trust store.</span><br><span class="line"></span><br><span class="line"># CLOUDFOUNDRY</span><br><span class="line">management.cloudfoundry.enabled&#x3D;true # Whether to enable extended Cloud Foundry actuator endpoints.</span><br><span class="line">management.cloudfoundry.skip-ssl-validation&#x3D;false # Whether to skip SSL verification for Cloud Foundry actuator endpoint security calls.</span><br><span class="line"></span><br><span class="line"># ENDPOINTS GENERAL CONFIGURATION</span><br><span class="line">management.endpoints.enabled-by-default&#x3D; # Whether to enable or disable all endpoints by default.</span><br><span class="line"></span><br><span class="line"># ENDPOINTS JMX CONFIGURATION (JmxEndpointProperties)</span><br><span class="line">management.endpoints.jmx.domain&#x3D;org.springframework.boot # Endpoints JMX domain name. Fallback to &#39;spring.jmx.default-domain&#39; if set.</span><br><span class="line">management.endpoints.jmx.exposure.include&#x3D;* # Endpoint IDs that should be included or &#39;*&#39; for all.</span><br><span class="line">management.endpoints.jmx.exposure.exclude&#x3D; # Endpoint IDs that should be excluded or &#39;*&#39; for all.</span><br><span class="line">management.endpoints.jmx.static-names&#x3D; # Additional static properties to append to all ObjectNames of MBeans representing Endpoints.</span><br><span class="line"></span><br><span class="line"># ENDPOINTS WEB CONFIGURATION (WebEndpointProperties)</span><br><span class="line">management.endpoints.web.exposure.include&#x3D;health,info # Endpoint IDs that should be included or &#39;*&#39; for all.</span><br><span class="line">management.endpoints.web.exposure.exclude&#x3D; # Endpoint IDs that should be excluded or &#39;*&#39; for all.</span><br><span class="line">management.endpoints.web.base-path&#x3D;&#x2F;actuator # Base path for Web endpoints. Relative to server.servlet.context-path or management.server.servlet.context-path if management.server.port is configured.</span><br><span class="line">management.endpoints.web.path-mapping&#x3D; # Mapping between endpoint IDs and the path that should expose them.</span><br><span class="line"></span><br><span class="line"># ENDPOINTS CORS CONFIGURATION (CorsEndpointProperties)</span><br><span class="line">management.endpoints.web.cors.allow-credentials&#x3D; # Whether credentials are supported. When not set, credentials are not supported.</span><br><span class="line">management.endpoints.web.cors.allowed-headers&#x3D; # Comma-separated list of headers to allow in a request. &#39;*&#39; allows all headers.</span><br><span class="line">management.endpoints.web.cors.allowed-methods&#x3D; # Comma-separated list of methods to allow. &#39;*&#39; allows all methods. When not set, defaults to GET.</span><br><span class="line">management.endpoints.web.cors.allowed-origins&#x3D; # Comma-separated list of origins to allow. &#39;*&#39; allows all origins. When not set, CORS support is disabled.</span><br><span class="line">management.endpoints.web.cors.exposed-headers&#x3D; # Comma-separated list of headers to include in a response.</span><br><span class="line">management.endpoints.web.cors.max-age&#x3D;1800s # How long the response from a pre-flight request can be cached by clients. If a duration suffix is not specified, seconds will be used.</span><br><span class="line"></span><br><span class="line"># AUDIT EVENTS ENDPOINT (AuditEventsEndpoint)</span><br><span class="line">management.endpoint.auditevents.cache.time-to-live&#x3D;0ms # Maximum time that a response can be cached.</span><br><span class="line">management.endpoint.auditevents.enabled&#x3D;true # Whether to enable the auditevents endpoint.</span><br><span class="line"></span><br><span class="line"># BEANS ENDPOINT (BeansEndpoint)</span><br><span class="line">management.endpoint.beans.cache.time-to-live&#x3D;0ms # Maximum time that a response can be cached.</span><br><span class="line">management.endpoint.beans.enabled&#x3D;true # Whether to enable the beans endpoint.</span><br><span class="line"></span><br><span class="line"># CACHES ENDPOINT (CachesEndpoint)</span><br><span class="line">management.endpoint.caches.cache.time-to-live&#x3D;0ms # Maximum time that a response can be cached.</span><br><span class="line">management.endpoint.caches.enabled&#x3D;true # Whether to enable the caches endpoint.</span><br><span class="line"></span><br><span class="line"># CONDITIONS REPORT ENDPOINT (ConditionsReportEndpoint)</span><br><span class="line">management.endpoint.conditions.cache.time-to-live&#x3D;0ms # Maximum time that a response can be cached.</span><br><span class="line">management.endpoint.conditions.enabled&#x3D;true # Whether to enable the conditions endpoint.</span><br><span class="line"></span><br><span class="line"># CONFIGURATION PROPERTIES REPORT ENDPOINT (ConfigurationPropertiesReportEndpoint, ConfigurationPropertiesReportEndpointProperties)</span><br><span class="line">management.endpoint.configprops.cache.time-to-live&#x3D;0ms # Maximum time that a response can be cached.</span><br><span class="line">management.endpoint.configprops.enabled&#x3D;true # Whether to enable the configprops endpoint.</span><br><span class="line">management.endpoint.configprops.keys-to-sanitize&#x3D;password,secret,key,token,.*credentials.*,vcap_services,sun.java.command # Keys that should be sanitized. Keys can be simple strings that the property ends with or regular expressions.</span><br><span class="line"></span><br><span class="line"># ENVIRONMENT ENDPOINT (EnvironmentEndpoint, EnvironmentEndpointProperties)</span><br><span class="line">management.endpoint.env.cache.time-to-live&#x3D;0ms # Maximum time that a response can be cached.</span><br><span class="line">management.endpoint.env.enabled&#x3D;true # Whether to enable the env endpoint.</span><br><span class="line">management.endpoint.env.keys-to-sanitize&#x3D;password,secret,key,token,.*credentials.*,vcap_services,sun.java.command # Keys that should be sanitized. Keys can be simple strings that the property ends with or regular expressions.</span><br><span class="line"></span><br><span class="line"># FLYWAY ENDPOINT (FlywayEndpoint)</span><br><span class="line">management.endpoint.flyway.cache.time-to-live&#x3D;0ms # Maximum time that a response can be cached.</span><br><span class="line">management.endpoint.flyway.enabled&#x3D;true # Whether to enable the flyway endpoint.</span><br><span class="line"></span><br><span class="line"># HEALTH ENDPOINT (HealthEndpoint, HealthEndpointProperties)</span><br><span class="line">management.endpoint.health.cache.time-to-live&#x3D;0ms # Maximum time that a response can be cached.</span><br><span class="line">management.endpoint.health.enabled&#x3D;true # Whether to enable the health endpoint.</span><br><span class="line">management.endpoint.health.roles&#x3D; # Roles used to determine whether or not a user is authorized to be shown details. When empty, all authenticated users are authorized.</span><br><span class="line">management.endpoint.health.show-details&#x3D;never # When to show full health details.</span><br><span class="line"></span><br><span class="line"># HEAP DUMP ENDPOINT (HeapDumpWebEndpoint)</span><br><span class="line">management.endpoint.heapdump.cache.time-to-live&#x3D;0ms # Maximum time that a response can be cached.</span><br><span class="line">management.endpoint.heapdump.enabled&#x3D;true # Whether to enable the heapdump endpoint.</span><br><span class="line"></span><br><span class="line"># HTTP TRACE ENDPOINT (HttpTraceEndpoint)</span><br><span class="line">management.endpoint.httptrace.cache.time-to-live&#x3D;0ms # Maximum time that a response can be cached.</span><br><span class="line">management.endpoint.httptrace.enabled&#x3D;true # Whether to enable the httptrace endpoint.</span><br><span class="line"></span><br><span class="line"># INFO ENDPOINT (InfoEndpoint)</span><br><span class="line">info&#x3D; # Arbitrary properties to add to the info endpoint.</span><br><span class="line">management.endpoint.info.cache.time-to-live&#x3D;0ms # Maximum time that a response can be cached.</span><br><span class="line">management.endpoint.info.enabled&#x3D;true # Whether to enable the info endpoint.</span><br><span class="line"></span><br><span class="line"># INTEGRATION GRAPH ENDPOINT (IntegrationGraphEndpoint)</span><br><span class="line">management.endpoint.integrationgraph.cache.time-to-live&#x3D;0ms # Maximum time that a response can be cached.</span><br><span class="line">management.endpoint.integrationgraph.enabled&#x3D;true # Whether to enable the integrationgraph endpoint.</span><br><span class="line"></span><br><span class="line"># JOLOKIA ENDPOINT (JolokiaProperties)</span><br><span class="line">management.endpoint.jolokia.config.*&#x3D; # Jolokia settings. Refer to the documentation of Jolokia for more details.</span><br><span class="line">management.endpoint.jolokia.enabled&#x3D;true # Whether to enable the jolokia endpoint.</span><br><span class="line"></span><br><span class="line"># LIQUIBASE ENDPOINT (LiquibaseEndpoint)</span><br><span class="line">management.endpoint.liquibase.cache.time-to-live&#x3D;0ms # Maximum time that a response can be cached.</span><br><span class="line">management.endpoint.liquibase.enabled&#x3D;true # Whether to enable the liquibase endpoint.</span><br><span class="line"></span><br><span class="line"># LOG FILE ENDPOINT (LogFileWebEndpoint, LogFileWebEndpointProperties)</span><br><span class="line">management.endpoint.logfile.cache.time-to-live&#x3D;0ms # Maximum time that a response can be cached.</span><br><span class="line">management.endpoint.logfile.enabled&#x3D;true # Whether to enable the logfile endpoint.</span><br><span class="line">management.endpoint.logfile.external-file&#x3D; # External Logfile to be accessed. Can be used if the logfile is written by output redirect and not by the logging system itself.</span><br><span class="line"></span><br><span class="line"># LOGGERS ENDPOINT (LoggersEndpoint)</span><br><span class="line">management.endpoint.loggers.cache.time-to-live&#x3D;0ms # Maximum time that a response can be cached.</span><br><span class="line">management.endpoint.loggers.enabled&#x3D;true # Whether to enable the loggers endpoint.</span><br><span class="line"></span><br><span class="line"># REQUEST MAPPING ENDPOINT  (MappingsEndpoint)</span><br><span class="line">management.endpoint.mappings.cache.time-to-live&#x3D;0ms # Maximum time that a response can be cached.</span><br><span class="line">management.endpoint.mappings.enabled&#x3D;true # Whether to enable the mappings endpoint.</span><br><span class="line"></span><br><span class="line"># METRICS ENDPOINT (MetricsEndpoint)</span><br><span class="line">management.endpoint.metrics.cache.time-to-live&#x3D;0ms # Maximum time that a response can be cached.</span><br><span class="line">management.endpoint.metrics.enabled&#x3D;true # Whether to enable the metrics endpoint.</span><br><span class="line"></span><br><span class="line"># PROMETHEUS ENDPOINT (PrometheusScrapeEndpoint)</span><br><span class="line">management.endpoint.prometheus.cache.time-to-live&#x3D;0ms # Maximum time that a response can be cached.</span><br><span class="line">management.endpoint.prometheus.enabled&#x3D;true # Whether to enable the prometheus endpoint.</span><br><span class="line"></span><br><span class="line"># SCHEDULED TASKS ENDPOINT (ScheduledTasksEndpoint)</span><br><span class="line">management.endpoint.scheduledtasks.cache.time-to-live&#x3D;0ms # Maximum time that a response can be cached.</span><br><span class="line">management.endpoint.scheduledtasks.enabled&#x3D;true # Whether to enable the scheduledtasks endpoint.</span><br><span class="line"></span><br><span class="line"># SESSIONS ENDPOINT (SessionsEndpoint)</span><br><span class="line">management.endpoint.sessions.enabled&#x3D;true # Whether to enable the sessions endpoint.</span><br><span class="line"></span><br><span class="line"># SHUTDOWN ENDPOINT (ShutdownEndpoint)</span><br><span class="line">management.endpoint.shutdown.enabled&#x3D;false # Whether to enable the shutdown endpoint.</span><br><span class="line"></span><br><span class="line"># THREAD DUMP ENDPOINT (ThreadDumpEndpoint)</span><br><span class="line">management.endpoint.threaddump.cache.time-to-live&#x3D;0ms # Maximum time that a response can be cached.</span><br><span class="line">management.endpoint.threaddump.enabled&#x3D;true # Whether to enable the threaddump endpoint.</span><br><span class="line"></span><br><span class="line"># HEALTH INDICATORS</span><br><span class="line">management.health.db.enabled&#x3D;true # Whether to enable database health check.</span><br><span class="line">management.health.cassandra.enabled&#x3D;true # Whether to enable Cassandra health check.</span><br><span class="line">management.health.couchbase.enabled&#x3D;true # Whether to enable Couchbase health check.</span><br><span class="line">management.health.defaults.enabled&#x3D;true # Whether to enable default health indicators.</span><br><span class="line">management.health.diskspace.enabled&#x3D;true # Whether to enable disk space health check.</span><br><span class="line">management.health.diskspace.path&#x3D; # Path used to compute the available disk space.</span><br><span class="line">management.health.diskspace.threshold&#x3D;10MB # Minimum disk space that should be available.</span><br><span class="line">management.health.elasticsearch.enabled&#x3D;true # Whether to enable Elasticsearch health check.</span><br><span class="line">management.health.elasticsearch.indices&#x3D; # Comma-separated index names.</span><br><span class="line">management.health.elasticsearch.response-timeout&#x3D;100ms # Time to wait for a response from the cluster.</span><br><span class="line">management.health.influxdb.enabled&#x3D;true # Whether to enable InfluxDB health check.</span><br><span class="line">management.health.jms.enabled&#x3D;true # Whether to enable JMS health check.</span><br><span class="line">management.health.ldap.enabled&#x3D;true # Whether to enable LDAP health check.</span><br><span class="line">management.health.mail.enabled&#x3D;true # Whether to enable Mail health check.</span><br><span class="line">management.health.mongo.enabled&#x3D;true # Whether to enable MongoDB health check.</span><br><span class="line">management.health.neo4j.enabled&#x3D;true # Whether to enable Neo4j health check.</span><br><span class="line">management.health.rabbit.enabled&#x3D;true # Whether to enable RabbitMQ health check.</span><br><span class="line">management.health.redis.enabled&#x3D;true # Whether to enable Redis health check.</span><br><span class="line">management.health.solr.enabled&#x3D;true # Whether to enable Solr health check.</span><br><span class="line">management.health.status.http-mapping&#x3D; # Mapping of health statuses to HTTP status codes. By default, registered health statuses map to sensible defaults (for example, UP maps to 200).</span><br><span class="line">management.health.status.order&#x3D;DOWN,OUT_OF_SERVICE,UP,UNKNOWN # Comma-separated list of health statuses in order of severity.</span><br><span class="line"></span><br><span class="line"># HTTP TRACING (HttpTraceProperties)</span><br><span class="line">management.trace.http.enabled&#x3D;true # Whether to enable HTTP request-response tracing.</span><br><span class="line">management.trace.http.include&#x3D;request-headers,response-headers,cookies,errors # Items to be included in the trace.</span><br><span class="line"></span><br><span class="line"># INFO CONTRIBUTORS (InfoContributorProperties)</span><br><span class="line">management.info.build.enabled&#x3D;true # Whether to enable build info.</span><br><span class="line">management.info.defaults.enabled&#x3D;true # Whether to enable default info contributors.</span><br><span class="line">management.info.env.enabled&#x3D;true # Whether to enable environment info.</span><br><span class="line">management.info.git.enabled&#x3D;true # Whether to enable git info.</span><br><span class="line">management.info.git.mode&#x3D;simple # Mode to use to expose git information.</span><br><span class="line"></span><br><span class="line"># METRICS</span><br><span class="line">management.metrics.distribution.maximum-expected-value.*&#x3D; # Maximum value that meter IDs starting-with the specified name are expected to observe.</span><br><span class="line">management.metrics.distribution.minimum-expected-value.*&#x3D; # Minimum value that meter IDs starting-with the specified name are expected to observe.</span><br><span class="line">management.metrics.distribution.percentiles.*&#x3D; # Specific computed non-aggregable percentiles to ship to the backend for meter IDs starting-with the specified name.</span><br><span class="line">management.metrics.distribution.percentiles-histogram.*&#x3D; # Whether meter IDs starting with the specified name should publish percentile histograms.</span><br><span class="line">management.metrics.distribution.sla.*&#x3D; # Specific SLA boundaries for meter IDs starting-with the specified name. The longest match wins.</span><br><span class="line">management.metrics.enable.*&#x3D; # Whether meter IDs starting-with the specified name should be enabled. The longest match wins, the key &#96;all&#96; can also be used to configure all meters.</span><br><span class="line">management.metrics.export.appoptics.api-token&#x3D; # AppOptics API token.</span><br><span class="line">management.metrics.export.appoptics.batch-size&#x3D;500 # Number of measurements per request to use for this backend. If more measurements are found, then multiple requests will be made.</span><br><span class="line">management.metrics.export.appoptics.connect-timeout&#x3D;5s # Connection timeout for requests to this backend.</span><br><span class="line">management.metrics.export.appoptics.enabled&#x3D;true # Whether exporting of metrics to this backend is enabled.</span><br><span class="line">management.metrics.export.appoptics.host-tag&#x3D;instance # Tag that will be mapped to &quot;@host&quot; when shipping metrics to AppOptics.</span><br><span class="line">management.metrics.export.appoptics.num-threads&#x3D;2 # Number of threads to use with the metrics publishing scheduler.</span><br><span class="line">management.metrics.export.appoptics.read-timeout&#x3D;10s # Read timeout for requests to this backend.</span><br><span class="line">management.metrics.export.appoptics.step&#x3D;1m # Step size (i.e. reporting frequency) to use.</span><br><span class="line">management.metrics.export.appoptics.uri&#x3D;https:&#x2F;&#x2F;api.appoptics.com&#x2F;v1&#x2F;measurements # URI to ship metrics to.</span><br><span class="line">management.metrics.export.atlas.batch-size&#x3D;10000 # Number of measurements per request to use for this backend. If more measurements are found, then multiple requests will be made.</span><br><span class="line">management.metrics.export.atlas.config-refresh-frequency&#x3D;10s # Frequency for refreshing config settings from the LWC service.</span><br><span class="line">management.metrics.export.atlas.config-time-to-live&#x3D;150s # Time to live for subscriptions from the LWC service.</span><br><span class="line">management.metrics.export.atlas.config-uri&#x3D;http:&#x2F;&#x2F;localhost:7101&#x2F;lwc&#x2F;api&#x2F;v1&#x2F;expressions&#x2F;local-dev # URI for the Atlas LWC endpoint to retrieve current subscriptions.</span><br><span class="line">management.metrics.export.atlas.connect-timeout&#x3D;1s # Connection timeout for requests to this backend.</span><br><span class="line">management.metrics.export.atlas.enabled&#x3D;true # Whether exporting of metrics to this backend is enabled.</span><br><span class="line">management.metrics.export.atlas.eval-uri&#x3D;http:&#x2F;&#x2F;localhost:7101&#x2F;lwc&#x2F;api&#x2F;v1&#x2F;evaluate # URI for the Atlas LWC endpoint to evaluate the data for a subscription.</span><br><span class="line">management.metrics.export.atlas.lwc-enabled&#x3D;false # Whether to enable streaming to Atlas LWC.</span><br><span class="line">management.metrics.export.atlas.meter-time-to-live&#x3D;15m # Time to live for meters that do not have any activity. After this period the meter will be considered expired and will not get reported.</span><br><span class="line">management.metrics.export.atlas.num-threads&#x3D;2 # Number of threads to use with the metrics publishing scheduler.</span><br><span class="line">management.metrics.export.atlas.read-timeout&#x3D;10s # Read timeout for requests to this backend.</span><br><span class="line">management.metrics.export.atlas.step&#x3D;1m # Step size (i.e. reporting frequency) to use.</span><br><span class="line">management.metrics.export.atlas.uri&#x3D;http:&#x2F;&#x2F;localhost:7101&#x2F;api&#x2F;v1&#x2F;publish # URI of the Atlas server.</span><br><span class="line">management.metrics.export.datadog.api-key&#x3D; # Datadog API key.</span><br><span class="line">management.metrics.export.datadog.application-key&#x3D; # Datadog application key. Not strictly required, but improves the Datadog experience by sending meter descriptions, types, and base units to Datadog.</span><br><span class="line">management.metrics.export.datadog.batch-size&#x3D;10000 # Number of measurements per request to use for this backend. If more measurements are found, then multiple requests will be made.</span><br><span class="line">management.metrics.export.datadog.connect-timeout&#x3D;1s # Connection timeout for requests to this backend.</span><br><span class="line">management.metrics.export.datadog.descriptions&#x3D;true # Whether to publish descriptions metadata to Datadog. Turn this off to minimize the amount of metadata sent.</span><br><span class="line">management.metrics.export.datadog.enabled&#x3D;true # Whether exporting of metrics to this backend is enabled.</span><br><span class="line">management.metrics.export.datadog.host-tag&#x3D;instance # Tag that will be mapped to &quot;host&quot; when shipping metrics to Datadog.</span><br><span class="line">management.metrics.export.datadog.num-threads&#x3D;2 # Number of threads to use with the metrics publishing scheduler.</span><br><span class="line">management.metrics.export.datadog.read-timeout&#x3D;10s # Read timeout for requests to this backend.</span><br><span class="line">management.metrics.export.datadog.step&#x3D;1m # Step size (i.e. reporting frequency) to use.</span><br><span class="line">management.metrics.export.datadog.uri&#x3D;https:&#x2F;&#x2F;app.datadoghq.com # URI to ship metrics to. If you need to publish metrics to an internal proxy en-route to Datadog, you can define the location of the proxy with this.</span><br><span class="line">management.metrics.export.dynatrace.api-token&#x3D; # Dynatrace authentication token.</span><br><span class="line">management.metrics.export.dynatrace.batch-size&#x3D;10000 # Number of measurements per request to use for this backend. If more measurements are found, then multiple requests will be made.</span><br><span class="line">management.metrics.export.dynatrace.connect-timeout&#x3D;1s # Connection timeout for requests to this backend.</span><br><span class="line">management.metrics.export.dynatrace.device-id&#x3D; # ID of the custom device that is exporting metrics to Dynatrace.</span><br><span class="line">management.metrics.export.dynatrace.enabled&#x3D;true # Whether exporting of metrics to this backend is enabled.</span><br><span class="line">management.metrics.export.dynatrace.num-threads&#x3D;2 # Number of threads to use with the metrics publishing scheduler.</span><br><span class="line">management.metrics.export.dynatrace.read-timeout&#x3D;10s # Read timeout for requests to this backend.</span><br><span class="line">management.metrics.export.dynatrace.step&#x3D;1m # Step size (i.e. reporting frequency) to use.</span><br><span class="line">management.metrics.export.dynatrace.technology-type&#x3D;java # Technology type for exported metrics. Used to group metrics under a logical technology name in the Dynatrace UI.</span><br><span class="line">management.metrics.export.dynatrace.uri&#x3D; # URI to ship metrics to. Should be used for SaaS, self managed instances or to en-route through an internal proxy.</span><br><span class="line">management.metrics.export.elastic.auto-create-index&#x3D;true # Whether to create the index automatically if it does not exist.</span><br><span class="line">management.metrics.export.elastic.batch-size&#x3D;10000 # Number of measurements per request to use for this backend. If more measurements are found, then multiple requests will be made.</span><br><span class="line">management.metrics.export.elastic.connect-timeout&#x3D;1s # Connection timeout for requests to this backend.</span><br><span class="line">management.metrics.export.elastic.enabled&#x3D;true # Whether exporting of metrics to this backend is enabled.</span><br><span class="line">management.metrics.export.elastic.host&#x3D;http:&#x2F;&#x2F;localhost:9200 # Host to export metrics to.</span><br><span class="line">management.metrics.export.elastic.index&#x3D;metrics # Index to export metrics to.</span><br><span class="line">management.metrics.export.elastic.index-date-format&#x3D;yyyy-MM # Index date format used for rolling indices. Appended to the index name, preceded by a &#39;-&#39;.</span><br><span class="line">management.metrics.export.elastic.num-threads&#x3D;2 # Number of threads to use with the metrics publishing scheduler.</span><br><span class="line">management.metrics.export.elastic.password&#x3D; # Login password of the Elastic server.</span><br><span class="line">management.metrics.export.elastic.read-timeout&#x3D;10s # Read timeout for requests to this backend.</span><br><span class="line">management.metrics.export.elastic.step&#x3D;1m # Step size (i.e. reporting frequency) to use.</span><br><span class="line">management.metrics.export.elastic.timestamp-field-name&#x3D;@timestamp # Name of the timestamp field.</span><br><span class="line">management.metrics.export.elastic.user-name&#x3D; # Login user of the Elastic server.</span><br><span class="line">management.metrics.export.ganglia.addressing-mode&#x3D;multicast # UDP addressing mode, either unicast or multicast.</span><br><span class="line">management.metrics.export.ganglia.duration-units&#x3D;milliseconds # Base time unit used to report durations.</span><br><span class="line">management.metrics.export.ganglia.enabled&#x3D;true # Whether exporting of metrics to Ganglia is enabled.</span><br><span class="line">management.metrics.export.ganglia.host&#x3D;localhost # Host of the Ganglia server to receive exported metrics.</span><br><span class="line">management.metrics.export.ganglia.port&#x3D;8649 # Port of the Ganglia server to receive exported metrics.</span><br><span class="line">management.metrics.export.ganglia.protocol-version&#x3D;3.1 # Ganglia protocol version. Must be either 3.1 or 3.0.</span><br><span class="line">management.metrics.export.ganglia.rate-units&#x3D;seconds # Base time unit used to report rates.</span><br><span class="line">management.metrics.export.ganglia.step&#x3D;1m # Step size (i.e. reporting frequency) to use.</span><br><span class="line">management.metrics.export.ganglia.time-to-live&#x3D;1 # Time to live for metrics on Ganglia. Set the multi-cast Time-To-Live to be one greater than the number of hops (routers) between the hosts.</span><br><span class="line">management.metrics.export.graphite.duration-units&#x3D;milliseconds # Base time unit used to report durations.</span><br><span class="line">management.metrics.export.graphite.enabled&#x3D;true # Whether exporting of metrics to Graphite is enabled.</span><br><span class="line">management.metrics.export.graphite.host&#x3D;localhost # Host of the Graphite server to receive exported metrics.</span><br><span class="line">management.metrics.export.graphite.port&#x3D;2004 # Port of the Graphite server to receive exported metrics.</span><br><span class="line">management.metrics.export.graphite.protocol&#x3D;pickled # Protocol to use while shipping data to Graphite.</span><br><span class="line">management.metrics.export.graphite.rate-units&#x3D;seconds # Base time unit used to report rates.</span><br><span class="line">management.metrics.export.graphite.step&#x3D;1m # Step size (i.e. reporting frequency) to use.</span><br><span class="line">management.metrics.export.graphite.tags-as-prefix&#x3D; # For the default naming convention, turn the specified tag keys into part of the metric prefix.</span><br><span class="line">management.metrics.export.humio.api-token&#x3D; # Humio API token.</span><br><span class="line">management.metrics.export.humio.batch-size&#x3D;10000 # Number of measurements per request to use for this backend. If more measurements are found, then multiple requests will be made.</span><br><span class="line">management.metrics.export.humio.connect-timeout&#x3D;5s # Connection timeout for requests to this backend.</span><br><span class="line">management.metrics.export.humio.enabled&#x3D;true # Whether exporting of metrics to this backend is enabled.</span><br><span class="line">management.metrics.export.humio.num-threads&#x3D;2 # Number of threads to use with the metrics publishing scheduler.</span><br><span class="line">management.metrics.export.humio.read-timeout&#x3D;10s # Read timeout for requests to this backend.</span><br><span class="line">management.metrics.export.humio.repository&#x3D;sandbox # Name of the repository to publish metrics to.</span><br><span class="line">management.metrics.export.humio.step&#x3D;1m # Step size (i.e. reporting frequency) to use.</span><br><span class="line">management.metrics.export.humio.tags.*&#x3D; # Humio tags describing the data source in which metrics will be stored. Humio tags are a distinct concept from Micrometer&#39;s tags. Micrometer&#39;s tags are used to divide metrics along dimensional boundaries.</span><br><span class="line">management.metrics.export.humio.uri&#x3D;https:&#x2F;&#x2F;cloud.humio.com # URI to ship metrics to. If you need to publish metrics to an internal proxy en-route to Humio, you can define the location of the proxy with this.</span><br><span class="line">management.metrics.export.influx.auto-create-db&#x3D;true # Whether to create the Influx database if it does not exist before attempting to publish metrics to it.</span><br><span class="line">management.metrics.export.influx.batch-size&#x3D;10000 # Number of measurements per request to use for this backend. If more measurements are found, then multiple requests will be made.</span><br><span class="line">management.metrics.export.influx.compressed&#x3D;true # Whether to enable GZIP compression of metrics batches published to Influx.</span><br><span class="line">management.metrics.export.influx.connect-timeout&#x3D;1s # Connection timeout for requests to this backend.</span><br><span class="line">management.metrics.export.influx.consistency&#x3D;one # Write consistency for each point.</span><br><span class="line">management.metrics.export.influx.db&#x3D;mydb # Tag that will be mapped to &quot;host&quot; when shipping metrics to Influx.</span><br><span class="line">management.metrics.export.influx.enabled&#x3D;true # Whether exporting of metrics to this backend is enabled.</span><br><span class="line">management.metrics.export.influx.num-threads&#x3D;2 # Number of threads to use with the metrics publishing scheduler.</span><br><span class="line">management.metrics.export.influx.password&#x3D; # Login password of the Influx server.</span><br><span class="line">management.metrics.export.influx.read-timeout&#x3D;10s # Read timeout for requests to this backend.</span><br><span class="line">management.metrics.export.influx.retention-duration&#x3D; # Time period for which Influx should retain data in the current database.</span><br><span class="line">management.metrics.export.influx.retention-shard-duration&#x3D; # Time range covered by a shard group.</span><br><span class="line">management.metrics.export.influx.retention-policy&#x3D; # Retention policy to use (Influx writes to the DEFAULT retention policy if one is not specified).</span><br><span class="line">management.metrics.export.influx.retention-replication-factor&#x3D; # How many copies of the data are stored in the cluster.</span><br><span class="line">management.metrics.export.influx.step&#x3D;1m # Step size (i.e. reporting frequency) to use.</span><br><span class="line">management.metrics.export.influx.uri&#x3D;http:&#x2F;&#x2F;localhost:8086 # URI of the Influx server.</span><br><span class="line">management.metrics.export.influx.user-name&#x3D; # Login user of the Influx server.</span><br><span class="line">management.metrics.export.jmx.domain&#x3D;metrics # Metrics JMX domain name.</span><br><span class="line">management.metrics.export.jmx.enabled&#x3D;true # Whether exporting of metrics to JMX is enabled.</span><br><span class="line">management.metrics.export.jmx.step&#x3D;1m # Step size (i.e. reporting frequency) to use.</span><br><span class="line">management.metrics.export.kairos.batch-size&#x3D;10000 # Number of measurements per request to use for this backend. If more measurements are found, then multiple requests will be made.</span><br><span class="line">management.metrics.export.kairos.connect-timeout&#x3D;1s # Connection timeout for requests to this backend.</span><br><span class="line">management.metrics.export.kairos.enabled&#x3D;true # Whether exporting of metrics to this backend is enabled.</span><br><span class="line">management.metrics.export.kairos.num-threads&#x3D;2 # Number of threads to use with the metrics publishing scheduler.</span><br><span class="line">management.metrics.export.kairos.password&#x3D; # Login password of the KairosDB server.</span><br><span class="line">management.metrics.export.kairos.read-timeout&#x3D;10s # Read timeout for requests to this backend.</span><br><span class="line">management.metrics.export.kairos.step&#x3D;1m # Step size (i.e. reporting frequency) to use.</span><br><span class="line">management.metrics.export.kairos.uri&#x3D; localhost:8080&#x2F;api&#x2F;v1&#x2F;datapoints # URI of the KairosDB server.</span><br><span class="line">management.metrics.export.kairos.user-name&#x3D; # Login user of the KairosDB server.</span><br><span class="line">management.metrics.export.newrelic.account-id&#x3D; # New Relic account ID.</span><br><span class="line">management.metrics.export.newrelic.api-key&#x3D; # New Relic API key.</span><br><span class="line">management.metrics.export.newrelic.batch-size&#x3D;10000 # Number of measurements per request to use for this backend. If more measurements are found, then multiple requests will be made.</span><br><span class="line">management.metrics.export.newrelic.connect-timeout&#x3D;1s # Connection timeout for requests to this backend.</span><br><span class="line">management.metrics.export.newrelic.enabled&#x3D;true # Whether exporting of metrics to this backend is enabled.</span><br><span class="line">management.metrics.export.newrelic.num-threads&#x3D;2 # Number of threads to use with the metrics publishing scheduler.</span><br><span class="line">management.metrics.export.newrelic.read-timeout&#x3D;10s # Read timeout for requests to this backend.</span><br><span class="line">management.metrics.export.newrelic.step&#x3D;1m # Step size (i.e. reporting frequency) to use.</span><br><span class="line">management.metrics.export.newrelic.uri&#x3D;https:&#x2F;&#x2F;insights-collector.newrelic.com # URI to ship metrics to.</span><br><span class="line">management.metrics.export.prometheus.descriptions&#x3D;true # Whether to enable publishing descriptions as part of the scrape payload to Prometheus. Turn this off to minimize the amount of data sent on each scrape.</span><br><span class="line">management.metrics.export.prometheus.enabled&#x3D;true # Whether exporting of metrics to Prometheus is enabled.</span><br><span class="line">management.metrics.export.prometheus.step&#x3D;1m # Step size (i.e. reporting frequency) to use.</span><br><span class="line">management.metrics.export.prometheus.pushgateway.base-url&#x3D;localhost:9091 # Base URL for the Pushgateway.</span><br><span class="line">management.metrics.export.prometheus.pushgateway.enabled&#x3D;false # Enable publishing via a Prometheus Pushgateway.</span><br><span class="line">management.metrics.export.prometheus.pushgateway.grouping-key&#x3D; # Grouping key for the pushed metrics.</span><br><span class="line">management.metrics.export.prometheus.pushgateway.job&#x3D; # Job identifier for this application instance.</span><br><span class="line">management.metrics.export.prometheus.pushgateway.push-rate&#x3D;1m # Frequency with which to push metrics.</span><br><span class="line">management.metrics.export.prometheus.pushgateway.shutdown-operation&#x3D; # Operation that should be performed on shutdown.</span><br><span class="line">management.metrics.export.signalfx.access-token&#x3D; # SignalFX access token.</span><br><span class="line">management.metrics.export.signalfx.batch-size&#x3D;10000 # Number of measurements per request to use for this backend. If more measurements are found, then multiple requests will be made.</span><br><span class="line">management.metrics.export.signalfx.connect-timeout&#x3D;1s # Connection timeout for requests to this backend.</span><br><span class="line">management.metrics.export.signalfx.enabled&#x3D;true # Whether exporting of metrics to this backend is enabled.</span><br><span class="line">management.metrics.export.signalfx.num-threads&#x3D;2 # Number of threads to use with the metrics publishing scheduler.</span><br><span class="line">management.metrics.export.signalfx.read-timeout&#x3D;10s # Read timeout for requests to this backend.</span><br><span class="line">management.metrics.export.signalfx.source&#x3D; # Uniquely identifies the app instance that is publishing metrics to SignalFx. Defaults to the local host name.</span><br><span class="line">management.metrics.export.signalfx.step&#x3D;10s # Step size (i.e. reporting frequency) to use.</span><br><span class="line">management.metrics.export.signalfx.uri&#x3D;https:&#x2F;&#x2F;ingest.signalfx.com # URI to ship metrics to.</span><br><span class="line">management.metrics.export.simple.enabled&#x3D;true # Whether, in the absence of any other exporter, exporting of metrics to an in-memory backend is enabled.</span><br><span class="line">management.metrics.export.simple.mode&#x3D;cumulative # Counting mode.</span><br><span class="line">management.metrics.export.simple.step&#x3D;1m # Step size (i.e. reporting frequency) to use.</span><br><span class="line">management.metrics.export.statsd.enabled&#x3D;true # Whether exporting of metrics to StatsD is enabled.</span><br><span class="line">management.metrics.export.statsd.flavor&#x3D;datadog # StatsD line protocol to use.</span><br><span class="line">management.metrics.export.statsd.host&#x3D;localhost # Host of the StatsD server to receive exported metrics.</span><br><span class="line">management.metrics.export.statsd.max-packet-length&#x3D;1400 # Total length of a single payload should be kept within your network&#39;s MTU.</span><br><span class="line">management.metrics.export.statsd.polling-frequency&#x3D;10s # How often gauges will be polled. When a gauge is polled, its value is recalculated and if the value has changed (or publishUnchangedMeters is true), it is sent to the StatsD server.</span><br><span class="line">management.metrics.export.statsd.port&#x3D;8125 # Port of the StatsD server to receive exported metrics.</span><br><span class="line">management.metrics.export.statsd.publish-unchanged-meters&#x3D;true # Whether to send unchanged meters to the StatsD server.</span><br><span class="line">management.metrics.export.wavefront.api-token&#x3D; # API token used when publishing metrics directly to the Wavefront API host.</span><br><span class="line">management.metrics.export.wavefront.batch-size&#x3D;10000 # Number of measurements per request to use for this backend. If more measurements are found, then multiple requests will be made.</span><br><span class="line">management.metrics.export.wavefront.connect-timeout&#x3D;1s # Connection timeout for requests to this backend.</span><br><span class="line">management.metrics.export.wavefront.enabled&#x3D;true # Whether exporting of metrics to this backend is enabled.</span><br><span class="line">management.metrics.export.wavefront.global-prefix&#x3D; # Global prefix to separate metrics originating from this app&#39;s white box instrumentation from those originating from other Wavefront integrations when viewed in the Wavefront UI.</span><br><span class="line">management.metrics.export.wavefront.num-threads&#x3D;2 # Number of threads to use with the metrics publishing scheduler.</span><br><span class="line">management.metrics.export.wavefront.read-timeout&#x3D;10s # Read timeout for requests to this backend.</span><br><span class="line">management.metrics.export.wavefront.source&#x3D; # Unique identifier for the app instance that is the source of metrics being published to Wavefront. Defaults to the local host name.</span><br><span class="line">management.metrics.export.wavefront.step&#x3D;10s # Step size (i.e. reporting frequency) to use.</span><br><span class="line">management.metrics.export.wavefront.uri&#x3D;https:&#x2F;&#x2F;longboard.wavefront.com # URI to ship metrics to.</span><br><span class="line">management.metrics.use-global-registry&#x3D;true # Whether auto-configured MeterRegistry implementations should be bound to the global static registry on Metrics.</span><br><span class="line">management.metrics.tags.*&#x3D; # Common tags that are applied to every meter.</span><br><span class="line">management.metrics.web.client.max-uri-tags&#x3D;100 # Maximum number of unique URI tag values allowed. After the max number of tag values is reached, metrics with additional tag values are denied by filter.</span><br><span class="line">management.metrics.web.client.requests-metric-name&#x3D;http.client.requests # Name of the metric for sent requests.</span><br><span class="line">management.metrics.web.server.auto-time-requests&#x3D;true # Whether requests handled by Spring MVC, WebFlux or Jersey should be automatically timed.</span><br><span class="line">management.metrics.web.server.max-uri-tags&#x3D;100 # Maximum number of unique URI tag values allowed. After the max number of tag values is reached, metrics with additional tag values are denied by filter.</span><br><span class="line">management.metrics.web.server.requests-metric-name&#x3D;http.server.requests # Name of the metric for received requests.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ----------------------------------------</span><br><span class="line"># DEVTOOLS PROPERTIES</span><br><span class="line"># ----------------------------------------</span><br><span class="line"></span><br><span class="line"># DEVTOOLS (DevToolsProperties)</span><br><span class="line">spring.devtools.add-properties&#x3D;true # Whether to enable development property defaults.</span><br><span class="line">spring.devtools.livereload.enabled&#x3D;true # Whether to enable a livereload.com-compatible server.</span><br><span class="line">spring.devtools.livereload.port&#x3D;35729 # Server port.</span><br><span class="line">spring.devtools.restart.additional-exclude&#x3D; # Additional patterns that should be excluded from triggering a full restart.</span><br><span class="line">spring.devtools.restart.additional-paths&#x3D; # Additional paths to watch for changes.</span><br><span class="line">spring.devtools.restart.enabled&#x3D;true # Whether to enable automatic restart.</span><br><span class="line">spring.devtools.restart.exclude&#x3D;META-INF&#x2F;maven&#x2F;**,META-INF&#x2F;resources&#x2F;**,resources&#x2F;**,static&#x2F;**,public&#x2F;**,templates&#x2F;**,**&#x2F;*Test.class,**&#x2F;*Tests.class,git.properties,META-INF&#x2F;build-info.properties # Patterns that should be excluded from triggering a full restart.</span><br><span class="line">spring.devtools.restart.log-condition-evaluation-delta&#x3D;true # Whether to log the condition evaluation delta upon restart.</span><br><span class="line">spring.devtools.restart.poll-interval&#x3D;1s # Amount of time to wait between polling for classpath changes.</span><br><span class="line">spring.devtools.restart.quiet-period&#x3D;400ms # Amount of quiet time required without any classpath changes before a restart is triggered.</span><br><span class="line">spring.devtools.restart.trigger-file&#x3D; # Name of a specific file that, when changed, triggers the restart check. If not specified, any classpath file change triggers the restart.</span><br><span class="line"></span><br><span class="line"># REMOTE DEVTOOLS (RemoteDevToolsProperties)</span><br><span class="line">spring.devtools.remote.context-path&#x3D;&#x2F;.~~spring-boot!~ # Context path used to handle the remote connection.</span><br><span class="line">spring.devtools.remote.proxy.host&#x3D; # The host of the proxy to use to connect to the remote application.</span><br><span class="line">spring.devtools.remote.proxy.port&#x3D; # The port of the proxy to use to connect to the remote application.</span><br><span class="line">spring.devtools.remote.restart.enabled&#x3D;true # Whether to enable remote restart.</span><br><span class="line">spring.devtools.remote.secret&#x3D; # A shared secret required to establish a connection (required to enable remote support).</span><br><span class="line">spring.devtools.remote.secret-header-name&#x3D;X-AUTH-TOKEN # HTTP header used to transfer the shared secret.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ----------------------------------------</span><br><span class="line"># TESTING PROPERTIES</span><br><span class="line"># ----------------------------------------</span><br><span class="line"></span><br><span class="line">spring.test.database.replace&#x3D;any # Type of existing DataSource to replace.</span><br><span class="line">spring.test.mockmvc.print&#x3D;default # MVC Print option.</span><br></pre></td></tr></table></figure>

<h2 id="附录B-配置元数据"><a href="#附录B-配置元数据" class="headerlink" title="附录B.配置元数据"></a>附录B.配置元数据</h2><p>Spring Boot jar包括元数据文件，提供所有支持的配置属性的详细信息。这些文件旨在让IDE开发人员在用户使用<code>application.properties</code>或<code>application.yml</code>文件时提供上下文帮助和“代码完成”。</p>
<p>通过处理使用<code>@ConfigurationProperties</code>注释的所有项目，在编译时自动生成大部分元数据文件。但是，可以 针对极端情况或更高级的用例<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#configuration-metadata-additional-metadata">手动编写部分元数据</a>。</p>
<h2 id="B-1元数据格式"><a href="#B-1元数据格式" class="headerlink" title="B.1元数据格式"></a>B.1元数据格式</h2><p>配置元数据文件位于<code>META-INF/spring-configuration-metadata.json</code>下的jar中。它们使用简单的JSON格式，其中的项目分类为“groups”或“properties”，其他值提示分类在“hints”下，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;groups&quot;: [</span><br><span class="line">	&#123;</span><br><span class="line">		&quot;name&quot;: &quot;server&quot;,</span><br><span class="line">		&quot;type&quot;: &quot;org.springframework.boot.autoconfigure.web.ServerProperties&quot;,</span><br><span class="line">		&quot;sourceType&quot;: &quot;org.springframework.boot.autoconfigure.web.ServerProperties&quot;</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		&quot;name&quot;: &quot;spring.jpa.hibernate&quot;,</span><br><span class="line">		&quot;type&quot;: &quot;org.springframework.boot.autoconfigure.orm.jpa.JpaProperties$Hibernate&quot;,</span><br><span class="line">		&quot;sourceType&quot;: &quot;org.springframework.boot.autoconfigure.orm.jpa.JpaProperties&quot;,</span><br><span class="line">		&quot;sourceMethod&quot;: &quot;getHibernate()&quot;</span><br><span class="line">	&#125;</span><br><span class="line">	...</span><br><span class="line">],&quot;properties&quot;: [</span><br><span class="line">	&#123;</span><br><span class="line">		&quot;name&quot;: &quot;server.port&quot;,</span><br><span class="line">		&quot;type&quot;: &quot;java.lang.Integer&quot;,</span><br><span class="line">		&quot;sourceType&quot;: &quot;org.springframework.boot.autoconfigure.web.ServerProperties&quot;</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		&quot;name&quot;: &quot;server.address&quot;,</span><br><span class="line">		&quot;type&quot;: &quot;java.net.InetAddress&quot;,</span><br><span class="line">		&quot;sourceType&quot;: &quot;org.springframework.boot.autoconfigure.web.ServerProperties&quot;</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		  &quot;name&quot;: &quot;spring.jpa.hibernate.ddl-auto&quot;,</span><br><span class="line">		  &quot;type&quot;: &quot;java.lang.String&quot;,</span><br><span class="line">		  &quot;description&quot;: &quot;DDL mode. This is actually a shortcut for the \&quot;hibernate.hbm2ddl.auto\&quot; property.&quot;,</span><br><span class="line">		  &quot;sourceType&quot;: &quot;org.springframework.boot.autoconfigure.orm.jpa.JpaProperties$Hibernate&quot;</span><br><span class="line">	&#125;</span><br><span class="line">	...</span><br><span class="line">],&quot;hints&quot;: [</span><br><span class="line">	&#123;</span><br><span class="line">		&quot;name&quot;: &quot;spring.jpa.hibernate.ddl-auto&quot;,</span><br><span class="line">		&quot;values&quot;: [</span><br><span class="line">			&#123;</span><br><span class="line">				&quot;value&quot;: &quot;none&quot;,</span><br><span class="line">				&quot;description&quot;: &quot;Disable DDL handling.&quot;</span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">				&quot;value&quot;: &quot;validate&quot;,</span><br><span class="line">				&quot;description&quot;: &quot;Validate the schema, make no changes to the database.&quot;</span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">				&quot;value&quot;: &quot;update&quot;,</span><br><span class="line">				&quot;description&quot;: &quot;Update the schema if necessary.&quot;</span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">				&quot;value&quot;: &quot;create&quot;,</span><br><span class="line">				&quot;description&quot;: &quot;Create the schema and destroy previous data.&quot;</span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">				&quot;value&quot;: &quot;create-drop&quot;,</span><br><span class="line">				&quot;description&quot;: &quot;Create and then destroy the schema at the end of the session.&quot;</span><br><span class="line">			&#125;</span><br><span class="line">		]</span><br><span class="line">	&#125;</span><br><span class="line">]&#125;</span><br></pre></td></tr></table></figure>

<p>每个“属性”是用户使用给定值指定的配置项。例如，<code>server.port</code>和<code>server.address</code>可能在<code>application.properties</code>中指定，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">server.port&#x3D;9090</span><br><span class="line">server.address&#x3D;127.0.0.1</span><br></pre></td></tr></table></figure>

<p>“组”是更高级别的项目，它们本身不指定值，而是为属性提供上下文分组。例如，<code>server.port</code>和<code>server.address</code>属性是<code>server</code>组的一部分。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>并不要求每个“财产”都有“团体”。某些属性可能本身就存在。</td>
</tr>
</tbody></table>
<p>最后，“提示”是用于帮助用户配置给定属性的附加信息。例如，当开发人员配置<code>spring.jpa.hibernate.ddl-auto</code>属性时，工具可以使用提示为<code>none</code>，<code>validate</code>，<code>update</code>，<code>create</code>提供一些自动完成帮助，和<code>create-drop</code>值。</p>
<h3 id="B-1-1组属性"><a href="#B-1-1组属性" class="headerlink" title="B.1.1组属性"></a>B.1.1组属性</h3><p><code>groups</code>数组中包含的JSON对象可以包含下表中显示的属性：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>类型</th>
<th>目的</th>
</tr>
</thead>
<tbody><tr>
<td><code>name</code></td>
<td>String</td>
<td>The full name of the group. This attribute is mandatory.</td>
</tr>
<tr>
<td><code>type</code></td>
<td>String</td>
<td>The class name of the data type of the group. For example, if the group were based on a class annotated with <code>@ConfigurationProperties</code>, the attribute would contain the fully qualified name of that class. If it were based on a <code>@Bean</code> method, it would be the return type of that method. If the type is not known, the attribute may be omitted.</td>
</tr>
<tr>
<td><code>description</code></td>
<td>String</td>
<td>A short description of the group that can be displayed to users. If not description is available, it may be omitted. It is recommended that descriptions be short paragraphs, with the first line providing a concise summary. The last line in the description should end with a period (<code>.</code>).</td>
</tr>
<tr>
<td><code>sourceType</code></td>
<td>String</td>
<td>The class name of the source that contributed this group. For example, if the group were based on a <code>@Bean</code> method annotated with <code>@ConfigurationProperties</code>, this attribute would contain the fully qualified name of the <code>@Configuration</code> class that contains the method. If the source type is not known, the attribute may be omitted.</td>
</tr>
<tr>
<td><code>sourceMethod</code></td>
<td>String</td>
<td>The full name of the method (include parenthesis and argument types) that contributed this group (for example, the name of a <code>@ConfigurationProperties</code> annotated <code>@Bean</code> method). If the source method is not known, it may be omitted.</td>
</tr>
</tbody></table>
<h3 id="B-1-2-Property属性"><a href="#B-1-2-Property属性" class="headerlink" title="B.1.2 Property属性"></a>B.1.2 Property属性</h3><p><code>properties</code>数组中包含的JSON对象可以包含下表中描述的属性：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>类型</th>
<th>目的</th>
</tr>
</thead>
<tbody><tr>
<td><code>name</code></td>
<td>String</td>
<td>The full name of the property. Names are in lower-case period-separated form (for example, <code>server.address</code>). This attribute is mandatory.</td>
</tr>
<tr>
<td><code>type</code></td>
<td>String</td>
<td>The full signature of the data type of the property (for example, <code>java.lang.String</code>) but also a full generic type (such as <code>java.util.Map&lt;java.util.String,acme.MyEnum&gt;</code>). You can use this attribute to guide the user as to the types of values that they can enter. For consistency, the type of a primitive is specified by using its wrapper counterpart (for example, <code>boolean</code> becomes <code>java.lang.Boolean</code>). Note that this class may be a complex type that gets converted from a <code>String</code> as values are bound. If the type is not known, it may be omitted.</td>
</tr>
<tr>
<td><code>description</code></td>
<td>String</td>
<td>A short description of the group that can be displayed to users. If no description is available, it may be omitted. It is recommended that descriptions be short paragraphs, with the first line providing a concise summary. The last line in the description should end with a period (<code>.</code>).</td>
</tr>
<tr>
<td><code>sourceType</code></td>
<td>String</td>
<td>The class name of the source that contributed this property. For example, if the property were from a class annotated with <code>@ConfigurationProperties</code>, this attribute would contain the fully qualified name of that class. If the source type is unknown, it may be omitted.</td>
</tr>
<tr>
<td><code>defaultValue</code></td>
<td>Object</td>
<td>The default value, which is used if the property is not specified. If the type of the property is an array, it can be an array of value(s). If the default value is unknown, it may be omitted.</td>
</tr>
<tr>
<td><code>deprecation</code></td>
<td>Deprecation</td>
<td>Specify whether the property is deprecated. If the field is not deprecated or if that information is not known, it may be omitted. The next table offers more detail about the <code>deprecation</code> attribute.</td>
</tr>
</tbody></table>
<p>每个<code>properties</code>元素的<code>deprecation</code>属性中包含的JSON对象可以包含以下属性：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>类型</th>
<th>目的</th>
</tr>
</thead>
<tbody><tr>
<td><code>level</code></td>
<td>String</td>
<td>The level of deprecation, which can be either <code>warning</code> (the default) or <code>error</code>. When a property has a <code>warning</code> deprecation level, it should still be bound in the environment. However, when it has an <code>error</code> deprecation level, the property is no longer managed and is not bound.</td>
</tr>
<tr>
<td><code>reason</code></td>
<td>String</td>
<td>A short description of the reason why the property was deprecated. If no reason is available, it may be omitted. It is recommended that descriptions be short paragraphs, with the first line providing a concise summary. The last line in the description should end with a period (<code>.</code>).</td>
</tr>
<tr>
<td><code>replacement</code></td>
<td>String</td>
<td>The full name of the property that <em>replaces</em> this deprecated property. If there is no replacement for this property, it may be omitted.</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>在Spring Boot 1.3之前，可以使用单个<code>deprecated</code>布尔属性来代替<code>deprecation</code>元素。仍以不推荐的方式支持此功能，不应再使用它。如果没有可用的原因和替换，则应设置空的<code>deprecation</code>对象。</td>
</tr>
</tbody></table>
<p>通过将<code>@DeprecatedConfigurationProperty</code>注释添加到公开不推荐使用的属性的getter中，也可以在代码中以声明方式指定弃用。例如，假设<code>app.acme.target</code>属性令人困惑，并重命名为<code>app.acme.name</code>。以下示例显示了如何处理这种情况：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">@ConfigurationProperties(&quot;app.acme&quot;)</span><br><span class="line">public class AcmeProperties &#123;</span><br><span class="line"></span><br><span class="line">	private String name;</span><br><span class="line"></span><br><span class="line">	public String getName() &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">	public void setName(String name) &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">	@DeprecatedConfigurationProperty(replacement &#x3D; &quot;app.acme.name&quot;)</span><br><span class="line">	@Deprecated</span><br><span class="line">	public String getTarget() &#123;</span><br><span class="line">		return getName();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Deprecated</span><br><span class="line">	public void setTarget(String target) &#123;</span><br><span class="line">		setName(target);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>没有办法设置<code>level</code>。始终假设<code>warning</code>，因为代码仍在处理属性。</td>
</tr>
</tbody></table>
<p>前面的代码确保deprecated属性仍然有效（委托给幕后的<code>name</code>属性）。一旦可以从公共API中删除<code>getTarget</code>和<code>setTarget</code>方法，元数据中的自动弃用提示也会消失。如果要保留提示，添加具有<code>error</code>弃用级别的手动元数据可确保用户仍然了解该属性。当提供<code>replacement</code>时，这样做特别有用。</p>
<h3 id="B-1-3提示属性"><a href="#B-1-3提示属性" class="headerlink" title="B.1.3提示属性"></a>B.1.3提示属性</h3><p><code>hints</code>数组中包含的JSON对象可以包含下表中显示的属性：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>类型</th>
<th>目的</th>
</tr>
</thead>
<tbody><tr>
<td><code>name</code></td>
<td>String</td>
<td>The full name of the property to which this hint refers. Names are in lower-case period-separated form (such as <code>spring.mvc.servlet.path</code>). If the property refers to a map (such as <code>system.contexts</code>), the hint either applies to the <em>keys</em> of the map (<code>system.context.keys</code>) or the <em>values</em> (<code>system.context.values</code>) of the map. This attribute is mandatory.</td>
</tr>
<tr>
<td><code>values</code></td>
<td>ValueHint[]</td>
<td>A list of valid values as defined by the <code>ValueHint</code> object (described in the next table). Each entry defines the value and may have a description.</td>
</tr>
<tr>
<td><code>providers</code></td>
<td>ValueProvider[]</td>
<td>A list of providers as defined by the <code>ValueProvider</code> object (described later in this document). Each entry defines the name of the provider and its parameters, if any.</td>
</tr>
</tbody></table>
<p>每个<code>hint</code>元素的<code>values</code>属性中包含的JSON对象可以包含下表中描述的属性：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>类型</th>
<th>目的</th>
</tr>
</thead>
<tbody><tr>
<td><code>value</code></td>
<td>Object</td>
<td>A valid value for the element to which the hint refers. If the type of the property is an array, it can also be an array of value(s). This attribute is mandatory.</td>
</tr>
<tr>
<td><code>description</code></td>
<td>String</td>
<td>A short description of the value that can be displayed to users. If no description is available, it may be omitted . It is recommended that descriptions be short paragraphs, with the first line providing a concise summary. The last line in the description should end with a period (<code>.</code>).</td>
</tr>
</tbody></table>
<p>每个<code>hint</code>元素的<code>providers</code>属性中包含的JSON对象可以包含下表中描述的属性：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>类型</th>
<th>目的</th>
</tr>
</thead>
<tbody><tr>
<td><code>name</code></td>
<td>String</td>
<td>The name of the provider to use to offer additional content assistance for the element to which the hint refers.</td>
</tr>
<tr>
<td><code>parameters</code></td>
<td>JSON object</td>
<td>Any additional parameter that the provider supports (check the documentation of the provider for more details).</td>
</tr>
</tbody></table>
<h3 id="B-1-4重复的元数据项"><a href="#B-1-4重复的元数据项" class="headerlink" title="B.1.4重复的元数据项"></a>B.1.4重复的元数据项</h3><p>具有相同“属性”和“组”名称的对象可以在元数据文件中多次出现。例如，您可以将两个单独的类绑定到同一个前缀，每个类都有可能重叠的属性名称。虽然多次出现在元数据中的相同名称不应该是常见的，但元数据的使用者应该注意确保他们支持它。</p>
<h2 id="B-2提供手动提示"><a href="#B-2提供手动提示" class="headerlink" title="B.2提供手动提示"></a>B.2提供手动提示</h2><p>要改善用户体验并进一步帮助用户配置给定属性，您可以提供以下其他元数据：</p>
<ul>
<li>描述属性的潜在值列表。</li>
<li>关联提供者，将明确定义的语义附加到属性，以便工具可以根据项目的上下文发现潜在值列表。</li>
</ul>
<h3 id="B-2-1价值提示"><a href="#B-2-1价值提示" class="headerlink" title="B.2.1价值提示"></a>B.2.1价值提示</h3><p>每个提示的<code>name</code>属性指的是属性的<code>name</code>。在<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#configuration-metadata-format">前面显示</a>的 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#configuration-metadata-format">初始示例中</a>，我们为<code>spring.jpa.hibernate.ddl-auto</code>属性提供了五个值：<code>none</code>，<code>validate</code>，<code>update</code>，<code>create</code>和<code>create-drop</code>。每个值也可以有描述。</p>
<p>如果您的属性类型为<code>Map</code>，则可以提供键和值的提示（但不能提供地图本身的提示）。特殊的<code>.keys</code>和<code>.values</code>后缀必须分别引用键和值。</p>
<p>假设<code>sample.contexts</code>将magic <code>String</code>值映射为整数，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@ConfigurationProperties(&quot;sample&quot;)</span><br><span class="line">public class SampleProperties &#123;</span><br><span class="line"></span><br><span class="line">	private Map&lt;String,Integer&gt; contexts;</span><br><span class="line">	&#x2F;&#x2F; getters and setters</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>神奇的值（在这个例子中）是<code>sample1</code>和<code>sample2</code>。为了为密钥提供额外的内容帮助，您可以将以下JSON添加到 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#configuration-metadata-additional-metadata">模块的手动元数据中</a>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;hints&quot;: [</span><br><span class="line">	&#123;</span><br><span class="line">		&quot;name&quot;: &quot;sample.contexts.keys&quot;,</span><br><span class="line">		&quot;values&quot;: [</span><br><span class="line">			&#123;</span><br><span class="line">				&quot;value&quot;: &quot;sample1&quot;</span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">				&quot;value&quot;: &quot;sample2&quot;</span><br><span class="line">			&#125;</span><br><span class="line">		]</span><br><span class="line">	&#125;</span><br><span class="line">]&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>我们建议您使用<code>Enum</code>代替这两个值。如果您的IDE支持它，这是迄今为止最有效的自动完成方法。</td>
</tr>
</tbody></table>
<h3 id="B-2-2价值提供者"><a href="#B-2-2价值提供者" class="headerlink" title="B.2.2价值提供者"></a>B.2.2价值提供者</h3><p>提供程序是将语义附加到属性的强大方法。在本节中，我们定义了可用于您自己的提示的官方提供程序。但是，您最喜欢的IDE可能会实现其中一些或不实现。此外，它最终可以提供自己的。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>由于这是一项新功能，因此IDE供应商必须了解其工作原理。采用时间自然会有所不同。</td>
</tr>
</tbody></table>
<p>下表总结了支持的提供程序列表：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>any</code></td>
<td>允许提供任何附加值。</td>
</tr>
<tr>
<td><code>class-reference</code></td>
<td>自动完成项目中可用的类。通常由<code>target</code>参数指定的基类约束。</td>
</tr>
<tr>
<td><code>handle-as</code></td>
<td>处理属性，就好像它是由强制<code>target</code>参数定义的类型定义的一样。</td>
</tr>
<tr>
<td><code>logger-name</code></td>
<td>自动完成有效的记录器名称和 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-custom-log-groups">记录器组</a>。通常，当前项目中可用的包名和类名可以自动完成，也可以自定义组。</td>
</tr>
<tr>
<td><code>spring-bean-reference</code></td>
<td>自动完成当前项目中可用的bean名称。通常由<code>target</code>参数指定的基类约束。</td>
</tr>
<tr>
<td><code>spring-profile-name</code></td>
<td>自动完成项目中可用的Spring配置文件名称。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>对于给定的属性，只有一个提供程序可以处于活动状态，但如果它们都可以<em>以某种方式</em>管理属性<em>，</em>则可以指定多个提供程序。确保首先放置最强大的提供程序，因为IDE必须使用它可以处理的JSON部分中的第一个。如果不支持给定属性的提供者，则也不提供特殊内容帮助。</td>
</tr>
</tbody></table>
<h4 id="任何"><a href="#任何" class="headerlink" title="任何"></a>任何</h4><p>特殊的<strong>任何</strong>提供者值都允许提供任何其他值。如果支持，则应应用基于属性类型的常规值验证。</p>
<p>如果您有值列表并且任何额外值仍应被视为有效，则通常使用此提供程序。</p>
<p>以下示例提供<code>on</code>和<code>off</code>作为<code>system.state</code>的自动完成值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;hints&quot;: [</span><br><span class="line">	&#123;</span><br><span class="line">		&quot;name&quot;: &quot;system.state&quot;,</span><br><span class="line">		&quot;values&quot;: [</span><br><span class="line">			&#123;</span><br><span class="line">				&quot;value&quot;: &quot;on&quot;</span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">				&quot;value&quot;: &quot;off&quot;</span><br><span class="line">			&#125;</span><br><span class="line">		],</span><br><span class="line">		&quot;providers&quot;: [</span><br><span class="line">			&#123;</span><br><span class="line">				&quot;name&quot;: &quot;any&quot;</span><br><span class="line">			&#125;</span><br><span class="line">		]</span><br><span class="line">	&#125;</span><br><span class="line">]&#125;</span><br></pre></td></tr></table></figure>

<p>请注意，在前面的示例中，还允许任何其他值。</p>
<h4 id="课程参考"><a href="#课程参考" class="headerlink" title="课程参考"></a>课程参考</h4><p>在<strong>类引用</strong>提供商自动完成项目中可用的类。此提供程序支持以下参数：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>默认值</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>target</code></td>
<td><code>String</code> (<code>Class</code>)</td>
<td><em>none</em></td>
<td>应分配给所选值的类的完全限定名称。通常用于过滤非候选类。请注意，通过公开具有适当上限的类，可以通过类型本身提供此信息。</td>
</tr>
<tr>
<td><code>concrete</code></td>
<td><code>boolean</code></td>
<td>true</td>
<td>指定是否仅将具体类视为有效候选。</td>
</tr>
</tbody></table>
<p>以下元数据片段对应于标准要使用的<code>JspServlet</code>类名称的标准<code>server.servlet.jsp.class-name</code>属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;hints&quot;: [</span><br><span class="line">	&#123;</span><br><span class="line">		&quot;name&quot;: &quot;server.servlet.jsp.class-name&quot;,</span><br><span class="line">		&quot;providers&quot;: [</span><br><span class="line">			&#123;</span><br><span class="line">				&quot;name&quot;: &quot;class-reference&quot;,</span><br><span class="line">				&quot;parameters&quot;: &#123;</span><br><span class="line">					&quot;target&quot;: &quot;javax.servlet.http.HttpServlet&quot;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		]</span><br><span class="line">	&#125;</span><br><span class="line">]&#125;</span><br></pre></td></tr></table></figure>

<h4 id="处理为"><a href="#处理为" class="headerlink" title="处理为"></a>处理为</h4><p>该<strong>手柄的</strong>供应商，您可以替代属性的类型到一个更高层次的类型。当属性具有<code>java.lang.String</code>类型时，通常会发生这种情况，因为您不希望配置类依赖于可能不在类路径上的类。此提供程序支持以下参数：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>默认值</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><strong><code>target</code></strong></td>
<td><code>String</code> (<code>Class</code>)</td>
<td><em>none</em></td>
<td>要为该属性考虑的类型的完全限定名称。此参数是必需的。</td>
</tr>
</tbody></table>
<p>可以使用以下类型：</p>
<ul>
<li>任何<code>java.lang.Enum</code>：列出属性的可能值。（我们建议使用<code>Enum</code>类型定义属性，因为IDE不需要进一步提示来自动完成值。）</li>
<li><code>java.nio.charset.Charset</code>：支持自动完成字符集/编码值（例如<code>UTF-8</code>）</li>
<li><code>java.util.Locale</code>：自动完成语言环境（例如<code>en_US</code>）</li>
<li><code>org.springframework.util.MimeType</code>：支持自动完成内容类型值（例如<code>text/plain</code>）</li>
<li><code>org.springframework.core.io.Resource</code>：支持自动完成Spring的资源抽象，以引用文件系统或类路径上的文件。（例如<code>classpath:/sample.properties</code>）</li>
</ul>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果可以提供多个值，请使用<code>Collection</code>或<em>Array</em>类型向IDE讲授它。</td>
</tr>
</tbody></table>
<p>以下元数据片段对应于标准<code>spring.liquibase.change-log</code>属性，该属性定义要使用的更改日志的路径。它实际上在内部用作<code>org.springframework.core.io.Resource</code>但不能这样暴露，因为我们需要保留原始的String值以将其传递给Liquibase API。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;hints&quot;: [</span><br><span class="line">	&#123;</span><br><span class="line">		&quot;name&quot;: &quot;spring.liquibase.change-log&quot;,</span><br><span class="line">		&quot;providers&quot;: [</span><br><span class="line">			&#123;</span><br><span class="line">				&quot;name&quot;: &quot;handle-as&quot;,</span><br><span class="line">				&quot;parameters&quot;: &#123;</span><br><span class="line">					&quot;target&quot;: &quot;org.springframework.core.io.Resource&quot;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		]</span><br><span class="line">	&#125;</span><br><span class="line">]&#125;</span><br></pre></td></tr></table></figure>

<h4 id="记录器名称"><a href="#记录器名称" class="headerlink" title="记录器名称"></a>记录器名称</h4><p>该<strong>记录器名</strong>提供商自动完成有效的记录名称和 <a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-boot.html#boot-features-custom-log-groups">记录器组</a>。通常，可以自动完成当前项目中可用的包名和类名。如果启用了组（默认），并且在配置中标识了自定义记录器组，则应提供自动完成组。特定框架可能还有额外的魔术记录器名称，也可以支持。</p>
<p>此提供程序支持以下参数：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>默认值</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>group</code></td>
<td><code>boolean</code></td>
<td><code>true</code></td>
<td>指定是否应考虑已知组。</td>
</tr>
</tbody></table>
<p>由于记录器名称可以是任意名称，因此此提供程序应允许任何值，但可以突出显示项目类路径中不可用的有效包名和类名。</p>
<p>以下元数据片段对应于标准<code>logging.level</code>属性。键是<em>记录器名称</em>，值对应于标准日志级别或任何自定义级别。由于Spring Boot定义了几个开箱即用的记录器组，因此为这些记录器添加了专用值提示。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;hints&quot;: [</span><br><span class="line">	&#123;</span><br><span class="line">		&quot;name&quot;: &quot;logging.level.keys&quot;,</span><br><span class="line">		&quot;values&quot;: [</span><br><span class="line">			&#123;</span><br><span class="line">				&quot;value&quot;: &quot;root&quot;,</span><br><span class="line">				&quot;description&quot;: &quot;Root logger used to assign the default logging level.&quot;</span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">				&quot;value&quot;: &quot;sql&quot;,</span><br><span class="line">				&quot;description&quot;: &quot;SQL logging group including Hibernate SQL logger.&quot;</span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">				&quot;value&quot;: &quot;web&quot;,</span><br><span class="line">				&quot;description&quot;: &quot;Web logging group including codecs.&quot;</span><br><span class="line">			&#125;</span><br><span class="line">		],</span><br><span class="line">		&quot;providers&quot;: [</span><br><span class="line">			&#123;</span><br><span class="line">				&quot;name&quot;: &quot;logger-name&quot;</span><br><span class="line">			&#125;</span><br><span class="line">		]</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		&quot;name&quot;: &quot;logging.level.values&quot;,</span><br><span class="line">		&quot;values&quot;: [</span><br><span class="line">			&#123;</span><br><span class="line">				&quot;value&quot;: &quot;trace&quot;</span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">				&quot;value&quot;: &quot;debug&quot;</span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">				&quot;value&quot;: &quot;info&quot;</span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">				&quot;value&quot;: &quot;warn&quot;</span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">				&quot;value&quot;: &quot;error&quot;</span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">				&quot;value&quot;: &quot;fatal&quot;</span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">				&quot;value&quot;: &quot;off&quot;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		],</span><br><span class="line">		&quot;providers&quot;: [</span><br><span class="line">			&#123;</span><br><span class="line">				&quot;name&quot;: &quot;any&quot;</span><br><span class="line">			&#125;</span><br><span class="line">		]</span><br><span class="line">	&#125;</span><br><span class="line">]&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Spring-Bean参考"><a href="#Spring-Bean参考" class="headerlink" title="Spring Bean参考"></a>Spring Bean参考</h4><p>的<strong>spring-bean-reference</strong>提供商自动完成在当前项目中的配置中定义的beans。此提供程序支持以下参数：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>默认值</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>target</code></td>
<td><code>String</code> (<code>Class</code>)</td>
<td><em>none</em></td>
<td>应分配给候选人的bean类的完全限定名称。通常用于过滤掉非候选beans。</td>
</tr>
</tbody></table>
<p>以下元数据片段对应于标准<code>spring.jmx.server</code>属性，该属性定义要使用的<code>MBeanServer</code> bean的名称：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;hints&quot;: [</span><br><span class="line">	&#123;</span><br><span class="line">		&quot;name&quot;: &quot;spring.jmx.server&quot;,</span><br><span class="line">		&quot;providers&quot;: [</span><br><span class="line">			&#123;</span><br><span class="line">				&quot;name&quot;: &quot;spring-bean-reference&quot;,</span><br><span class="line">				&quot;parameters&quot;: &#123;</span><br><span class="line">					&quot;target&quot;: &quot;javax.management.MBeanServer&quot;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		]</span><br><span class="line">	&#125;</span><br><span class="line">]&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>活页夹不知道元数据。如果您提供该提示，则仍需要将bean名称转换为<code>ApplicationContext</code>使用的实际Bean引用。</td>
</tr>
</tbody></table>
<h4 id="Spring个人资料名称"><a href="#Spring个人资料名称" class="headerlink" title="Spring个人资料名称"></a>Spring个人资料名称</h4><p>的<strong>spring-profile-name</strong>提供商自动完成Spring在当前项目中的配置中定义的配置文件。</p>
<p>以下元数据片段对应于标准<code>spring.profiles.active</code>属性，该属性定义要启用的Spring配置文件的名称：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;hints&quot;: [</span><br><span class="line">	&#123;</span><br><span class="line">		&quot;name&quot;: &quot;spring.profiles.active&quot;,</span><br><span class="line">		&quot;providers&quot;: [</span><br><span class="line">			&#123;</span><br><span class="line">				&quot;name&quot;: &quot;spring-profile-name&quot;</span><br><span class="line">			&#125;</span><br><span class="line">		]</span><br><span class="line">	&#125;</span><br><span class="line">]&#125;</span><br></pre></td></tr></table></figure>

<h2 id="B-3使用注释处理器生成自己的元数据"><a href="#B-3使用注释处理器生成自己的元数据" class="headerlink" title="B.3使用注释处理器生成自己的元数据"></a>B.3使用注释处理器生成自己的元数据</h2><p>您可以使用<code>spring-boot-configuration-processor</code> jar从<code>@ConfigurationProperties</code>注释的项目轻松生成自己的配置元数据文件。jar包含一个Java注释处理器，在您编译项目时调用该处理器。要使用处理器，请在<code>spring-boot-configuration-processor</code>上包含依赖项。</p>
<p>使用Maven时，依赖项应声明为可选，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-boot-configuration-processor&lt;&#x2F;artifactId&gt;</span><br><span class="line">	&lt;optional&gt;true&lt;&#x2F;optional&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<p>对于Gradle 4.5及更早版本，应在<code>compileOnly</code>配置中声明依赖项，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">	compileOnly &quot;org.springframework.boot:spring-boot-configuration-processor&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对于Gradle 4.6及更高版本，应在<code>annotationProcessor</code>配置中声明依赖项，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">	annotationProcessor &quot;org.springframework.boot:spring-boot-configuration-processor&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果您使用的是<code>additional-spring-configuration-metadata.json</code>文件，则应将<code>compileJava</code>任务配置为依赖于<code>processResources</code>任务，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compileJava.dependsOn(processResources)</span><br></pre></td></tr></table></figure>

<p>此依赖关系确保在编译期间注释处理器运行时可以使用其他元数据。</p>
<p>处理器选择使用<code>@ConfigurationProperties</code>注释的类和方法。配置类中的字段值的Javadoc用于填充<code>description</code>属性。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>您应该只使用<code>@ConfigurationProperties</code>字段Javadoc的简单文本，因为它们在添加到JSON之前不会被处理。</td>
</tr>
</tbody></table>
<p>通过存在标准的getter和setter来发现属性，这些getter和setter具有对集合类型的特殊处理（即使只有getter存在也会检测到）。注释处理器还支持使用<code>@Data</code>，<code>@Getter</code>和<code>@Setter</code> lombok注释。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>如果在项目中使用AspectJ，则需要确保注释处理器仅运行一次。有几种方法可以做到这一点。使用Maven，您可以显式配置<code>maven-apt-plugin</code>并仅在那里将依赖项添加到注释处理器。您还可以让AspectJ插件在<code>maven-compiler-plugin</code>配置中运行所有处理并禁用注释处理，如下所示：<code>&lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;configuration&gt;     &lt;proc&gt;none&lt;/proc&gt; &lt;/configuration&gt; &lt;/plugin&gt;</code></td>
</tr>
</tbody></table>
<h3 id="B-3-1嵌套属性"><a href="#B-3-1嵌套属性" class="headerlink" title="B.3.1嵌套属性"></a>B.3.1嵌套属性</h3><p>注释处理器自动将内部类视为嵌套属性。考虑以下课程：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">@ConfigurationProperties(prefix&#x3D;&quot;server&quot;)</span><br><span class="line">public class ServerProperties &#123;</span><br><span class="line"></span><br><span class="line">	private String name;</span><br><span class="line"></span><br><span class="line">	private Host host;</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F; ... getter and setters</span><br><span class="line"></span><br><span class="line">	public static class Host &#123;</span><br><span class="line"></span><br><span class="line">		private String ip;</span><br><span class="line"></span><br><span class="line">		private int port;</span><br><span class="line"></span><br><span class="line">		&#x2F;&#x2F; ... getter and setters</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的示例为<code>server.name</code>，<code>server.host.ip</code>和<code>server.host.port</code>属性生成元数据信息。您可以在字段上使用<code>@NestedConfigurationProperty</code>注释来指示应将常规（非内部）类视为嵌套。</p>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>这对集合和映射没有影响，因为这些类型是自动标识的，并且为每个类型生成单个元数据属性。</td>
</tr>
</tbody></table>
<h3 id="B-3-2添加附加元数据"><a href="#B-3-2添加附加元数据" class="headerlink" title="B.3.2添加附加元数据"></a>B.3.2添加附加元数据</h3><p>Spring Boot的配置文件处理非常灵活，通常情况下可能存在未绑定到<code>@ConfigurationProperties</code> bean的属性。您可能还需要调整现有密钥的某些属性。为支持此类情况并允许您提供自定义“提示”，注释处理器会自动将<code>META-INF/additional-spring-configuration-metadata.json</code>中的项目合并到主元数据文件中。</p>
<p>如果引用自动检测到的属性，则会覆盖描述，默认值和弃用信息（如果已指定）。如果未在当前模块中标识手动属性声明，则将其添加为新属性。</p>
<p><code>additional-spring-configuration-metadata.json</code>文件的格式与常规<code>spring-configuration-metadata.json</code>完全相同。附加属性文件是可选的。如果您没有任何其他属性，请不要添加该文件。</p>
<h2 id="附录C-自动配置类"><a href="#附录C-自动配置类" class="headerlink" title="附录C.自动配置类"></a>附录C.自动配置类</h2><p>以下是Spring Boot提供的所有自动配置类的列表，其中包含文档和源代码的链接。请记住还要查看应用程序中的条件报告，以获取有关打开哪些功能的更多详细信息。（为此，请使用<code>--debug</code>或<code>-Ddebug</code>启动应用程序，或者在Actuator应用程序中使用<code>conditions</code>端点）。</p>
<h2 id="C-1来自“spring-boot-autoconfigure”模块"><a href="#C-1来自“spring-boot-autoconfigure”模块" class="headerlink" title="C.1来自“spring-boot-autoconfigure”模块"></a>C.1来自“spring-boot-autoconfigure”模块</h2><p>以下自动配置类来自<code>spring-boot-autoconfigure</code>模块：</p>
<table>
<thead>
<tr>
<th>配置类</th>
<th>链接</th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jms/activemq/ActiveMQAutoConfiguration.java"><code>ActiveMQAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/jms/activemq/ActiveMQAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/aop/AopAutoConfiguration.java"><code>AopAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/aop/AopAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jms/artemis/ArtemisAutoConfiguration.java"><code>ArtemisAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/jms/artemis/ArtemisAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/batch/BatchAutoConfiguration.java"><code>BatchAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/batch/BatchAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/cache/CacheAutoConfiguration.java"><code>CacheAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/cache/CacheAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/cassandra/CassandraAutoConfiguration.java"><code>CassandraAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/cassandra/CassandraAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/data/cassandra/CassandraDataAutoConfiguration.java"><code>CassandraDataAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/data/cassandra/CassandraDataAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/data/cassandra/CassandraReactiveDataAutoConfiguration.java"><code>CassandraReactiveDataAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/data/cassandra/CassandraReactiveDataAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/data/cassandra/CassandraReactiveRepositoriesAutoConfiguration.java"><code>CassandraReactiveRepositoriesAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/data/cassandra/CassandraReactiveRepositoriesAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/data/cassandra/CassandraRepositoriesAutoConfiguration.java"><code>CassandraRepositoriesAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/data/cassandra/CassandraRepositoriesAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/reactive/function/client/ClientHttpConnectorAutoConfiguration.java"><code>ClientHttpConnectorAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/web/reactive/function/client/ClientHttpConnectorAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/cloud/CloudServiceConnectorsAutoConfiguration.java"><code>CloudServiceConnectorsAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/cloud/CloudServiceConnectorsAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/http/codec/CodecsAutoConfiguration.java"><code>CodecsAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/http/codec/CodecsAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/context/ConfigurationPropertiesAutoConfiguration.java"><code>ConfigurationPropertiesAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/context/ConfigurationPropertiesAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/couchbase/CouchbaseAutoConfiguration.java"><code>CouchbaseAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/couchbase/CouchbaseAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/data/couchbase/CouchbaseDataAutoConfiguration.java"><code>CouchbaseDataAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/data/couchbase/CouchbaseDataAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/data/couchbase/CouchbaseReactiveDataAutoConfiguration.java"><code>CouchbaseReactiveDataAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/data/couchbase/CouchbaseReactiveDataAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/data/couchbase/CouchbaseReactiveRepositoriesAutoConfiguration.java"><code>CouchbaseReactiveRepositoriesAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/data/couchbase/CouchbaseReactiveRepositoriesAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/data/couchbase/CouchbaseRepositoriesAutoConfiguration.java"><code>CouchbaseRepositoriesAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/data/couchbase/CouchbaseRepositoriesAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jdbc/DataSourceAutoConfiguration.java"><code>DataSourceAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/jdbc/DataSourceAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jdbc/DataSourceTransactionManagerAutoConfiguration.java"><code>DataSourceTransactionManagerAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/jdbc/DataSourceTransactionManagerAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/servlet/DispatcherServletAutoConfiguration.java"><code>DispatcherServletAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/web/servlet/DispatcherServletAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/data/elasticsearch/ElasticsearchAutoConfiguration.java"><code>ElasticsearchAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/data/elasticsearch/ElasticsearchAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/data/elasticsearch/ElasticsearchDataAutoConfiguration.java"><code>ElasticsearchDataAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/data/elasticsearch/ElasticsearchDataAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/data/elasticsearch/ElasticsearchRepositoriesAutoConfiguration.java"><code>ElasticsearchRepositoriesAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/data/elasticsearch/ElasticsearchRepositoriesAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/ldap/embedded/EmbeddedLdapAutoConfiguration.java"><code>EmbeddedLdapAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/ldap/embedded/EmbeddedLdapAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/mongo/embedded/EmbeddedMongoAutoConfiguration.java"><code>EmbeddedMongoAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/mongo/embedded/EmbeddedMongoAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/embedded/EmbeddedWebServerFactoryCustomizerAutoConfiguration.java"><code>EmbeddedWebServerFactoryCustomizerAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/web/embedded/EmbeddedWebServerFactoryCustomizerAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/servlet/error/ErrorMvcAutoConfiguration.java"><code>ErrorMvcAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/web/servlet/error/ErrorMvcAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/reactive/error/ErrorWebFluxAutoConfiguration.java"><code>ErrorWebFluxAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/web/reactive/error/ErrorWebFluxAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration.java"><code>FlywayAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/freemarker/FreeMarkerAutoConfiguration.java"><code>FreeMarkerAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/freemarker/FreeMarkerAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/groovy/template/GroovyTemplateAutoConfiguration.java"><code>GroovyTemplateAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/groovy/template/GroovyTemplateAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/gson/GsonAutoConfiguration.java"><code>GsonAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/gson/GsonAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/h2/H2ConsoleAutoConfiguration.java"><code>H2ConsoleAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/h2/H2ConsoleAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/hazelcast/HazelcastAutoConfiguration.java"><code>HazelcastAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/hazelcast/HazelcastAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/hazelcast/HazelcastJpaDependencyAutoConfiguration.java"><code>HazelcastJpaDependencyAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/hazelcast/HazelcastJpaDependencyAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/orm/jpa/HibernateJpaAutoConfiguration.java"><code>HibernateJpaAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/orm/jpa/HibernateJpaAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/servlet/HttpEncodingAutoConfiguration.java"><code>HttpEncodingAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/web/servlet/HttpEncodingAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/reactive/HttpHandlerAutoConfiguration.java"><code>HttpHandlerAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/web/reactive/HttpHandlerAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/http/HttpMessageConvertersAutoConfiguration.java"><code>HttpMessageConvertersAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/http/HttpMessageConvertersAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/hateoas/HypermediaAutoConfiguration.java"><code>HypermediaAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/hateoas/HypermediaAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/influx/InfluxDbAutoConfiguration.java"><code>InfluxDbAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/influx/InfluxDbAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/integration/IntegrationAutoConfiguration.java"><code>IntegrationAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/integration/IntegrationAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jackson/JacksonAutoConfiguration.java"><code>JacksonAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/jackson/JacksonAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/data/jdbc/JdbcRepositoriesAutoConfiguration.java"><code>JdbcRepositoriesAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/data/jdbc/JdbcRepositoriesAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jdbc/JdbcTemplateAutoConfiguration.java"><code>JdbcTemplateAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/jdbc/JdbcTemplateAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jersey/JerseyAutoConfiguration.java"><code>JerseyAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/jersey/JerseyAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/elasticsearch/jest/JestAutoConfiguration.java"><code>JestAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/elasticsearch/jest/JestAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jms/JmsAutoConfiguration.java"><code>JmsAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/jms/JmsAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jmx/JmxAutoConfiguration.java"><code>JmxAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/jmx/JmxAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jms/JndiConnectionFactoryAutoConfiguration.java"><code>JndiConnectionFactoryAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/jms/JndiConnectionFactoryAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jdbc/JndiDataSourceAutoConfiguration.java"><code>JndiDataSourceAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/jdbc/JndiDataSourceAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jooq/JooqAutoConfiguration.java"><code>JooqAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/jooq/JooqAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/data/jpa/JpaRepositoriesAutoConfiguration.java"><code>JpaRepositoriesAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/data/jpa/JpaRepositoriesAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jsonb/JsonbAutoConfiguration.java"><code>JsonbAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/jsonb/JsonbAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/transaction/jta/JtaAutoConfiguration.java"><code>JtaAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/transaction/jta/JtaAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/kafka/KafkaAutoConfiguration.java"><code>KafkaAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/kafka/KafkaAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/ldap/LdapAutoConfiguration.java"><code>LdapAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/ldap/LdapAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/data/ldap/LdapRepositoriesAutoConfiguration.java"><code>LdapRepositoriesAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/data/ldap/LdapRepositoriesAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/liquibase/LiquibaseAutoConfiguration.java"><code>LiquibaseAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/liquibase/LiquibaseAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/mail/MailSenderAutoConfiguration.java"><code>MailSenderAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/mail/MailSenderAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/mail/MailSenderValidatorAutoConfiguration.java"><code>MailSenderValidatorAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/mail/MailSenderValidatorAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/context/MessageSourceAutoConfiguration.java"><code>MessageSourceAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/context/MessageSourceAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/mongo/MongoAutoConfiguration.java"><code>MongoAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/mongo/MongoAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/data/mongo/MongoDataAutoConfiguration.java"><code>MongoDataAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/data/mongo/MongoDataAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/mongo/MongoReactiveAutoConfiguration.java"><code>MongoReactiveAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/mongo/MongoReactiveAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/data/mongo/MongoReactiveDataAutoConfiguration.java"><code>MongoReactiveDataAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/data/mongo/MongoReactiveDataAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/data/mongo/MongoReactiveRepositoriesAutoConfiguration.java"><code>MongoReactiveRepositoriesAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/data/mongo/MongoReactiveRepositoriesAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/data/mongo/MongoRepositoriesAutoConfiguration.java"><code>MongoRepositoriesAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/data/mongo/MongoRepositoriesAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/servlet/MultipartAutoConfiguration.java"><code>MultipartAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/web/servlet/MultipartAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/mustache/MustacheAutoConfiguration.java"><code>MustacheAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/mustache/MustacheAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/data/neo4j/Neo4jDataAutoConfiguration.java"><code>Neo4jDataAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/data/neo4j/Neo4jDataAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/data/neo4j/Neo4jRepositoriesAutoConfiguration.java"><code>Neo4jRepositoriesAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/data/neo4j/Neo4jRepositoriesAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/security/oauth2/client/servlet/OAuth2ClientAutoConfiguration.java"><code>OAuth2ClientAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/security/oauth2/client/servlet/OAuth2ClientAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/security/oauth2/resource/servlet/OAuth2ResourceServerAutoConfiguration.java"><code>OAuth2ResourceServerAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/security/oauth2/resource/servlet/OAuth2ResourceServerAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/dao/PersistenceExceptionTranslationAutoConfiguration.java"><code>PersistenceExceptionTranslationAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/dao/PersistenceExceptionTranslationAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/info/ProjectInfoAutoConfiguration.java"><code>ProjectInfoAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/info/ProjectInfoAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/context/PropertyPlaceholderAutoConfiguration.java"><code>PropertyPlaceholderAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/context/PropertyPlaceholderAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/quartz/QuartzAutoConfiguration.java"><code>QuartzAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/quartz/QuartzAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/amqp/RabbitAutoConfiguration.java"><code>RabbitAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/amqp/RabbitAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/security/oauth2/client/reactive/ReactiveOAuth2ClientAutoConfiguration.java"><code>ReactiveOAuth2ClientAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/security/oauth2/client/reactive/ReactiveOAuth2ClientAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/security/oauth2/resource/reactive/ReactiveOAuth2ResourceServerAutoConfiguration.java"><code>ReactiveOAuth2ResourceServerAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/security/oauth2/resource/reactive/ReactiveOAuth2ResourceServerAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/security/reactive/ReactiveSecurityAutoConfiguration.java"><code>ReactiveSecurityAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/security/reactive/ReactiveSecurityAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/security/reactive/ReactiveUserDetailsServiceAutoConfiguration.java"><code>ReactiveUserDetailsServiceAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/security/reactive/ReactiveUserDetailsServiceAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/reactive/ReactiveWebServerFactoryAutoConfiguration.java"><code>ReactiveWebServerFactoryAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/web/reactive/ReactiveWebServerFactoryAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/reactor/core/ReactorCoreAutoConfiguration.java"><code>ReactorCoreAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/reactor/core/ReactorCoreAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/data/redis/RedisAutoConfiguration.java"><code>RedisAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/data/redis/RedisAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/data/redis/RedisReactiveAutoConfiguration.java"><code>RedisReactiveAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/data/redis/RedisReactiveAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/data/redis/RedisRepositoriesAutoConfiguration.java"><code>RedisRepositoriesAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/data/redis/RedisRepositoriesAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/data/rest/RepositoryRestMvcAutoConfiguration.java"><code>RepositoryRestMvcAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/data/rest/RepositoryRestMvcAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/elasticsearch/rest/RestClientAutoConfiguration.java"><code>RestClientAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/elasticsearch/rest/RestClientAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/client/RestTemplateAutoConfiguration.java"><code>RestTemplateAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/web/client/RestTemplateAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/security/servlet/SecurityAutoConfiguration.java"><code>SecurityAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/security/servlet/SecurityAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/security/servlet/SecurityFilterAutoConfiguration.java"><code>SecurityFilterAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/security/servlet/SecurityFilterAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/security/servlet/SecurityRequestMatcherProviderAutoConfiguration.java"><code>SecurityRequestMatcherProviderAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/security/servlet/SecurityRequestMatcherProviderAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/sendgrid/SendGridAutoConfiguration.java"><code>SendGridAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/sendgrid/SendGridAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/servlet/ServletWebServerFactoryAutoConfiguration.java"><code>ServletWebServerFactoryAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/web/servlet/ServletWebServerFactoryAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/session/SessionAutoConfiguration.java"><code>SessionAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/session/SessionAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/solr/SolrAutoConfiguration.java"><code>SolrAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/solr/SolrAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/data/solr/SolrRepositoriesAutoConfiguration.java"><code>SolrRepositoriesAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/data/solr/SolrRepositoriesAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/admin/SpringApplicationAdminJmxAutoConfiguration.java"><code>SpringApplicationAdminJmxAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/admin/SpringApplicationAdminJmxAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/data/web/SpringDataWebAutoConfiguration.java"><code>SpringDataWebAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/data/web/SpringDataWebAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/task/TaskExecutionAutoConfiguration.java"><code>TaskExecutionAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/task/TaskExecutionAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/task/TaskSchedulingAutoConfiguration.java"><code>TaskSchedulingAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/task/TaskSchedulingAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/thymeleaf/ThymeleafAutoConfiguration.java"><code>ThymeleafAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/thymeleaf/ThymeleafAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/transaction/TransactionAutoConfiguration.java"><code>TransactionAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/transaction/TransactionAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/security/servlet/UserDetailsServiceAutoConfiguration.java"><code>UserDetailsServiceAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/security/servlet/UserDetailsServiceAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/validation/ValidationAutoConfiguration.java"><code>ValidationAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/validation/ValidationAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/reactive/function/client/WebClientAutoConfiguration.java"><code>WebClientAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/web/reactive/function/client/WebClientAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/reactive/WebFluxAutoConfiguration.java"><code>WebFluxAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/web/reactive/WebFluxAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/servlet/WebMvcAutoConfiguration.java"><code>WebMvcAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/web/servlet/WebMvcAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/webservices/client/WebServiceTemplateAutoConfiguration.java"><code>WebServiceTemplateAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/webservices/client/WebServiceTemplateAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/webservices/WebServicesAutoConfiguration.java"><code>WebServicesAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/webservices/WebServicesAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/websocket/servlet/WebSocketMessagingAutoConfiguration.java"><code>WebSocketMessagingAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/websocket/servlet/WebSocketMessagingAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/websocket/reactive/WebSocketReactiveAutoConfiguration.java"><code>WebSocketReactiveAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/websocket/reactive/WebSocketReactiveAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/websocket/servlet/WebSocketServletAutoConfiguration.java"><code>WebSocketServletAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/websocket/servlet/WebSocketServletAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jdbc/XADataSourceAutoConfiguration.java"><code>XADataSourceAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/jdbc/XADataSourceAutoConfiguration.html">javadoc</a></td>
</tr>
</tbody></table>
<h2 id="C-2来自“spring-boot-actuator-autoconfigure”模块"><a href="#C-2来自“spring-boot-actuator-autoconfigure”模块" class="headerlink" title="C.2来自“spring-boot-actuator-autoconfigure”模块"></a>C.2来自“spring-boot-actuator-autoconfigure”模块</h2><p>以下自动配置类来自<code>spring-boot-actuator-autoconfigure</code>模块：</p>
<table>
<thead>
<tr>
<th>配置类</th>
<th>链接</th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/metrics/export/appoptics/AppOpticsMetricsExportAutoConfiguration.java"><code>AppOpticsMetricsExportAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/metrics/export/appoptics/AppOpticsMetricsExportAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/metrics/export/atlas/AtlasMetricsExportAutoConfiguration.java"><code>AtlasMetricsExportAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/metrics/export/atlas/AtlasMetricsExportAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/audit/AuditAutoConfiguration.java"><code>AuditAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/audit/AuditAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/audit/AuditEventsEndpointAutoConfiguration.java"><code>AuditEventsEndpointAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/audit/AuditEventsEndpointAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/beans/BeansEndpointAutoConfiguration.java"><code>BeansEndpointAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/beans/BeansEndpointAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/metrics/cache/CacheMetricsAutoConfiguration.java"><code>CacheMetricsAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/metrics/cache/CacheMetricsAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/cache/CachesEndpointAutoConfiguration.java"><code>CachesEndpointAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/cache/CachesEndpointAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/cassandra/CassandraHealthIndicatorAutoConfiguration.java"><code>CassandraHealthIndicatorAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/cassandra/CassandraHealthIndicatorAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/cassandra/CassandraReactiveHealthIndicatorAutoConfiguration.java"><code>CassandraReactiveHealthIndicatorAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/cassandra/CassandraReactiveHealthIndicatorAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/cloudfoundry/servlet/CloudFoundryActuatorAutoConfiguration.java"><code>CloudFoundryActuatorAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/cloudfoundry/servlet/CloudFoundryActuatorAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/metrics/CompositeMeterRegistryAutoConfiguration.java"><code>CompositeMeterRegistryAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/metrics/CompositeMeterRegistryAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/condition/ConditionsReportEndpointAutoConfiguration.java"><code>ConditionsReportEndpointAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/condition/ConditionsReportEndpointAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/context/properties/ConfigurationPropertiesReportEndpointAutoConfiguration.java"><code>ConfigurationPropertiesReportEndpointAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/context/properties/ConfigurationPropertiesReportEndpointAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/couchbase/CouchbaseHealthIndicatorAutoConfiguration.java"><code>CouchbaseHealthIndicatorAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/couchbase/CouchbaseHealthIndicatorAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/couchbase/CouchbaseReactiveHealthIndicatorAutoConfiguration.java"><code>CouchbaseReactiveHealthIndicatorAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/couchbase/CouchbaseReactiveHealthIndicatorAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/jdbc/DataSourceHealthIndicatorAutoConfiguration.java"><code>DataSourceHealthIndicatorAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/jdbc/DataSourceHealthIndicatorAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/metrics/jdbc/DataSourcePoolMetricsAutoConfiguration.java"><code>DataSourcePoolMetricsAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/metrics/jdbc/DataSourcePoolMetricsAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/metrics/export/datadog/DatadogMetricsExportAutoConfiguration.java"><code>DatadogMetricsExportAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/metrics/export/datadog/DatadogMetricsExportAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/system/DiskSpaceHealthIndicatorAutoConfiguration.java"><code>DiskSpaceHealthIndicatorAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/system/DiskSpaceHealthIndicatorAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/metrics/export/dynatrace/DynatraceMetricsExportAutoConfiguration.java"><code>DynatraceMetricsExportAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/metrics/export/dynatrace/DynatraceMetricsExportAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/metrics/export/elastic/ElasticMetricsExportAutoConfiguration.java"><code>ElasticMetricsExportAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/metrics/export/elastic/ElasticMetricsExportAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/elasticsearch/ElasticSearchClientHealthIndicatorAutoConfiguration.java"><code>ElasticSearchClientHealthIndicatorAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/elasticsearch/ElasticSearchClientHealthIndicatorAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/elasticsearch/ElasticSearchJestHealthIndicatorAutoConfiguration.java"><code>ElasticSearchJestHealthIndicatorAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/elasticsearch/ElasticSearchJestHealthIndicatorAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/elasticsearch/ElasticSearchRestHealthIndicatorAutoConfiguration.java"><code>ElasticSearchRestHealthIndicatorAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/elasticsearch/ElasticSearchRestHealthIndicatorAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/endpoint/EndpointAutoConfiguration.java"><code>EndpointAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/endpoint/EndpointAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/env/EnvironmentEndpointAutoConfiguration.java"><code>EnvironmentEndpointAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/env/EnvironmentEndpointAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/flyway/FlywayEndpointAutoConfiguration.java"><code>FlywayEndpointAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/flyway/FlywayEndpointAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/metrics/export/ganglia/GangliaMetricsExportAutoConfiguration.java"><code>GangliaMetricsExportAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/metrics/export/ganglia/GangliaMetricsExportAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/metrics/export/graphite/GraphiteMetricsExportAutoConfiguration.java"><code>GraphiteMetricsExportAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/metrics/export/graphite/GraphiteMetricsExportAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/health/HealthEndpointAutoConfiguration.java"><code>HealthEndpointAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/health/HealthEndpointAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/health/HealthIndicatorAutoConfiguration.java"><code>HealthIndicatorAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/health/HealthIndicatorAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/management/HeapDumpWebEndpointAutoConfiguration.java"><code>HeapDumpWebEndpointAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/management/HeapDumpWebEndpointAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/metrics/orm/jpa/HibernateMetricsAutoConfiguration.java"><code>HibernateMetricsAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/metrics/orm/jpa/HibernateMetricsAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/metrics/web/client/HttpClientMetricsAutoConfiguration.java"><code>HttpClientMetricsAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/metrics/web/client/HttpClientMetricsAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/trace/http/HttpTraceAutoConfiguration.java"><code>HttpTraceAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/trace/http/HttpTraceAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/trace/http/HttpTraceEndpointAutoConfiguration.java"><code>HttpTraceEndpointAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/trace/http/HttpTraceEndpointAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/metrics/export/humio/HumioMetricsExportAutoConfiguration.java"><code>HumioMetricsExportAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/metrics/export/humio/HumioMetricsExportAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/influx/InfluxDbHealthIndicatorAutoConfiguration.java"><code>InfluxDbHealthIndicatorAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/influx/InfluxDbHealthIndicatorAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/metrics/export/influx/InfluxMetricsExportAutoConfiguration.java"><code>InfluxMetricsExportAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/metrics/export/influx/InfluxMetricsExportAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/info/InfoContributorAutoConfiguration.java"><code>InfoContributorAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/info/InfoContributorAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/info/InfoEndpointAutoConfiguration.java"><code>InfoEndpointAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/info/InfoEndpointAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/integration/IntegrationGraphEndpointAutoConfiguration.java"><code>IntegrationGraphEndpointAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/integration/IntegrationGraphEndpointAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/metrics/jersey/JerseyServerMetricsAutoConfiguration.java"><code>JerseyServerMetricsAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/metrics/jersey/JerseyServerMetricsAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/metrics/web/jetty/JettyMetricsAutoConfiguration.java"><code>JettyMetricsAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/metrics/web/jetty/JettyMetricsAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/jms/JmsHealthIndicatorAutoConfiguration.java"><code>JmsHealthIndicatorAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/jms/JmsHealthIndicatorAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/endpoint/jmx/JmxEndpointAutoConfiguration.java"><code>JmxEndpointAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/endpoint/jmx/JmxEndpointAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/metrics/export/jmx/JmxMetricsExportAutoConfiguration.java"><code>JmxMetricsExportAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/metrics/export/jmx/JmxMetricsExportAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/jolokia/JolokiaEndpointAutoConfiguration.java"><code>JolokiaEndpointAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/jolokia/JolokiaEndpointAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/metrics/JvmMetricsAutoConfiguration.java"><code>JvmMetricsAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/metrics/JvmMetricsAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/metrics/KafkaMetricsAutoConfiguration.java"><code>KafkaMetricsAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/metrics/KafkaMetricsAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/metrics/export/kairos/KairosMetricsExportAutoConfiguration.java"><code>KairosMetricsExportAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/metrics/export/kairos/KairosMetricsExportAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/ldap/LdapHealthIndicatorAutoConfiguration.java"><code>LdapHealthIndicatorAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/ldap/LdapHealthIndicatorAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/liquibase/LiquibaseEndpointAutoConfiguration.java"><code>LiquibaseEndpointAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/liquibase/LiquibaseEndpointAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/metrics/Log4J2MetricsAutoConfiguration.java"><code>Log4J2MetricsAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/metrics/Log4J2MetricsAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/logging/LogFileWebEndpointAutoConfiguration.java"><code>LogFileWebEndpointAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/logging/LogFileWebEndpointAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/metrics/LogbackMetricsAutoConfiguration.java"><code>LogbackMetricsAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/metrics/LogbackMetricsAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/logging/LoggersEndpointAutoConfiguration.java"><code>LoggersEndpointAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/logging/LoggersEndpointAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/mail/MailHealthIndicatorAutoConfiguration.java"><code>MailHealthIndicatorAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/mail/MailHealthIndicatorAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/web/server/ManagementContextAutoConfiguration.java"><code>ManagementContextAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/web/server/ManagementContextAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/security/servlet/ManagementWebSecurityAutoConfiguration.java"><code>ManagementWebSecurityAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/security/servlet/ManagementWebSecurityAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/web/mappings/MappingsEndpointAutoConfiguration.java"><code>MappingsEndpointAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/web/mappings/MappingsEndpointAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/metrics/MetricsAutoConfiguration.java"><code>MetricsAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/metrics/MetricsAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/metrics/MetricsEndpointAutoConfiguration.java"><code>MetricsEndpointAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/metrics/MetricsEndpointAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/mongo/MongoHealthIndicatorAutoConfiguration.java"><code>MongoHealthIndicatorAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/mongo/MongoHealthIndicatorAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/mongo/MongoReactiveHealthIndicatorAutoConfiguration.java"><code>MongoReactiveHealthIndicatorAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/mongo/MongoReactiveHealthIndicatorAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/neo4j/Neo4jHealthIndicatorAutoConfiguration.java"><code>Neo4jHealthIndicatorAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/neo4j/Neo4jHealthIndicatorAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/metrics/export/newrelic/NewRelicMetricsExportAutoConfiguration.java"><code>NewRelicMetricsExportAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/metrics/export/newrelic/NewRelicMetricsExportAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/metrics/export/prometheus/PrometheusMetricsExportAutoConfiguration.java"><code>PrometheusMetricsExportAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/metrics/export/prometheus/PrometheusMetricsExportAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/amqp/RabbitHealthIndicatorAutoConfiguration.java"><code>RabbitHealthIndicatorAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/amqp/RabbitHealthIndicatorAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/metrics/amqp/RabbitMetricsAutoConfiguration.java"><code>RabbitMetricsAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/metrics/amqp/RabbitMetricsAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/cloudfoundry/reactive/ReactiveCloudFoundryActuatorAutoConfiguration.java"><code>ReactiveCloudFoundryActuatorAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/cloudfoundry/reactive/ReactiveCloudFoundryActuatorAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/web/reactive/ReactiveManagementContextAutoConfiguration.java"><code>ReactiveManagementContextAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/web/reactive/ReactiveManagementContextAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/security/reactive/ReactiveManagementWebSecurityAutoConfiguration.java"><code>ReactiveManagementWebSecurityAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/security/reactive/ReactiveManagementWebSecurityAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/redis/RedisHealthIndicatorAutoConfiguration.java"><code>RedisHealthIndicatorAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/redis/RedisHealthIndicatorAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/redis/RedisReactiveHealthIndicatorAutoConfiguration.java"><code>RedisReactiveHealthIndicatorAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/redis/RedisReactiveHealthIndicatorAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/scheduling/ScheduledTasksEndpointAutoConfiguration.java"><code>ScheduledTasksEndpointAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/scheduling/ScheduledTasksEndpointAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/web/servlet/ServletManagementContextAutoConfiguration.java"><code>ServletManagementContextAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/web/servlet/ServletManagementContextAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/session/SessionsEndpointAutoConfiguration.java"><code>SessionsEndpointAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/session/SessionsEndpointAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/context/ShutdownEndpointAutoConfiguration.java"><code>ShutdownEndpointAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/context/ShutdownEndpointAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/metrics/export/signalfx/SignalFxMetricsExportAutoConfiguration.java"><code>SignalFxMetricsExportAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/metrics/export/signalfx/SignalFxMetricsExportAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/metrics/export/simple/SimpleMetricsExportAutoConfiguration.java"><code>SimpleMetricsExportAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/metrics/export/simple/SimpleMetricsExportAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/solr/SolrHealthIndicatorAutoConfiguration.java"><code>SolrHealthIndicatorAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/solr/SolrHealthIndicatorAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/metrics/export/statsd/StatsdMetricsExportAutoConfiguration.java"><code>StatsdMetricsExportAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/metrics/export/statsd/StatsdMetricsExportAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/metrics/SystemMetricsAutoConfiguration.java"><code>SystemMetricsAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/metrics/SystemMetricsAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/management/ThreadDumpEndpointAutoConfiguration.java"><code>ThreadDumpEndpointAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/management/ThreadDumpEndpointAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/metrics/web/tomcat/TomcatMetricsAutoConfiguration.java"><code>TomcatMetricsAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/metrics/web/tomcat/TomcatMetricsAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/metrics/export/wavefront/WavefrontMetricsExportAutoConfiguration.java"><code>WavefrontMetricsExportAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/metrics/export/wavefront/WavefrontMetricsExportAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/endpoint/web/WebEndpointAutoConfiguration.java"><code>WebEndpointAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/endpoint/web/WebEndpointAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/metrics/web/reactive/WebFluxMetricsAutoConfiguration.java"><code>WebFluxMetricsAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/metrics/web/reactive/WebFluxMetricsAutoConfiguration.html">javadoc</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/metrics/web/servlet/WebMvcMetricsAutoConfiguration.java"><code>WebMvcMetricsAutoConfiguration</code></a></td>
<td><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/actuate/autoconfigure/metrics/web/servlet/WebMvcMetricsAutoConfiguration.html">javadoc</a></td>
</tr>
</tbody></table>
<h2 id="附录D-测试自动配置注释"><a href="#附录D-测试自动配置注释" class="headerlink" title="附录D.测试自动配置注释"></a>附录D.测试自动配置注释</h2><p>下表列出了可用于测试应用程序片段的各种<code>@…Test</code>注释以及默认情况下导入的自动配置：</p>
<table>
<thead>
<tr>
<th>测试切片</th>
<th>导入的自动配置</th>
</tr>
</thead>
<tbody><tr>
<td><code>@DataJdbcTest</code></td>
<td><code>org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.data.jdbc.JdbcRepositoriesAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.flyway.FlywayAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.jdbc.DataSourceTransactionManagerAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.jdbc.JdbcTemplateAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.liquibase.LiquibaseAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.transaction.TransactionAutoConfiguration</code> <code>org.springframework.boot.test.autoconfigure.jdbc.TestDatabaseAutoConfiguration</code></td>
</tr>
<tr>
<td><code>@DataJpaTest</code></td>
<td><code>org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.data.jpa.JpaRepositoriesAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.flyway.FlywayAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.jdbc.DataSourceTransactionManagerAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.jdbc.JdbcTemplateAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.liquibase.LiquibaseAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.orm.jpa.HibernateJpaAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.transaction.TransactionAutoConfiguration</code> <code>org.springframework.boot.test.autoconfigure.jdbc.TestDatabaseAutoConfiguration</code> <code>org.springframework.boot.test.autoconfigure.orm.jpa.TestEntityManagerAutoConfiguration</code></td>
</tr>
<tr>
<td><code>@DataLdapTest</code></td>
<td><code>org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.data.ldap.LdapRepositoriesAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.ldap.LdapAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.ldap.embedded.EmbeddedLdapAutoConfiguration</code></td>
</tr>
<tr>
<td><code>@DataMongoTest</code></td>
<td><code>org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.data.mongo.MongoDataAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.data.mongo.MongoReactiveDataAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.data.mongo.MongoReactiveRepositoriesAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.data.mongo.MongoRepositoriesAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.mongo.MongoReactiveAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.mongo.embedded.EmbeddedMongoAutoConfiguration</code></td>
</tr>
<tr>
<td><code>@DataNeo4jTest</code></td>
<td><code>org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.data.neo4j.Neo4jDataAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.data.neo4j.Neo4jRepositoriesAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.transaction.TransactionAutoConfiguration</code></td>
</tr>
<tr>
<td><code>@DataRedisTest</code></td>
<td><code>org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.data.redis.RedisRepositoriesAutoConfiguration</code></td>
</tr>
<tr>
<td><code>@JdbcTest</code></td>
<td><code>org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.flyway.FlywayAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.jdbc.DataSourceTransactionManagerAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.jdbc.JdbcTemplateAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.liquibase.LiquibaseAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.transaction.TransactionAutoConfiguration</code> <code>org.springframework.boot.test.autoconfigure.jdbc.TestDatabaseAutoConfiguration</code></td>
</tr>
<tr>
<td><code>@JooqTest</code></td>
<td><code>org.springframework.boot.autoconfigure.flyway.FlywayAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.jdbc.DataSourceTransactionManagerAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.jooq.JooqAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.liquibase.LiquibaseAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.transaction.TransactionAutoConfiguration</code></td>
</tr>
<tr>
<td><code>@JsonTest</code></td>
<td><code>org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.gson.GsonAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.jackson.JacksonAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.jsonb.JsonbAutoConfiguration</code> <code>org.springframework.boot.test.autoconfigure.json.JsonTestersAutoConfiguration</code></td>
</tr>
<tr>
<td><code>@RestClientTest</code></td>
<td><code>org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.gson.GsonAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.http.HttpMessageConvertersAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.http.codec.CodecsAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.jackson.JacksonAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.jsonb.JsonbAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.web.client.RestTemplateAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.web.reactive.function.client.WebClientAutoConfiguration</code> <code>org.springframework.boot.test.autoconfigure.web.client.MockRestServiceServerAutoConfiguration</code> <code>org.springframework.boot.test.autoconfigure.web.client.WebClientRestTemplateAutoConfiguration</code></td>
</tr>
<tr>
<td><code>@WebFluxTest</code></td>
<td><code>org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.context.MessageSourceAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.gson.GsonAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.http.codec.CodecsAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.jackson.JacksonAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.jsonb.JsonbAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.security.reactive.ReactiveSecurityAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.security.reactive.ReactiveUserDetailsServiceAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.validation.ValidationAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.web.reactive.WebFluxAutoConfiguration</code> <code>org.springframework.boot.test.autoconfigure.web.reactive.WebTestClientAutoConfiguration</code></td>
</tr>
<tr>
<td><code>@WebMvcTest</code></td>
<td><code>org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.context.MessageSourceAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.data.web.SpringDataWebAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.freemarker.FreeMarkerAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.groovy.template.GroovyTemplateAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.gson.GsonAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.hateoas.HypermediaAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.http.HttpMessageConvertersAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.jackson.JacksonAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.jsonb.JsonbAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.mustache.MustacheAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.task.TaskExecutionAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.thymeleaf.ThymeleafAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.validation.ValidationAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.web.servlet.WebMvcAutoConfiguration</code> <code>org.springframework.boot.autoconfigure.web.servlet.error.ErrorMvcAutoConfiguration</code> <code>org.springframework.boot.test.autoconfigure.web.servlet.MockMvcAutoConfiguration</code> <code>org.springframework.boot.test.autoconfigure.web.servlet.MockMvcSecurityAutoConfiguration</code> <code>org.springframework.boot.test.autoconfigure.web.servlet.MockMvcWebClientAutoConfiguration</code> <code>org.springframework.boot.test.autoconfigure.web.servlet.MockMvcWebDriverAutoConfiguration</code></td>
</tr>
</tbody></table>
<h2 id="附录E-可执行的Jar格式"><a href="#附录E-可执行的Jar格式" class="headerlink" title="附录E.可执行的Jar格式"></a>附录E.可执行的Jar格式</h2><p><code>spring-boot-loader</code>模块允许Spring Boot支持可执行jar和war文件。如果您使用Maven插件或Gradle插件，则会自动生成可执行jar，并且您通常不需要知道它们如何工作的详细信息。</p>
<p>如果您需要从不同的构建系统创建可执行jar，或者如果您只是对底层技术感到好奇，本节提供了一些背景知识。</p>
<h2 id="E-1嵌套JAR"><a href="#E-1嵌套JAR" class="headerlink" title="E.1嵌套JAR"></a>E.1嵌套JAR</h2><p>Java没有提供任何标准方法来加载嵌套的jar文件（即jar文件本身包含在jar中）。如果您需要分发可以从命令行运行而不解压缩的自包含应用程序，则可能会出现问题。</p>
<p>为了解决这个问题，许多开发人员使用“阴影”罐子。一个带阴影的罐子将所有类别的所有类别打包成一个“超级罐子”。阴影罐的问题在于很难看出哪些库实际上在您的应用程序中。如果在多个罐子中使用相同的文件名（但具有不同的内容），也可能会有问题。Spring Boot采用不同的方法，让你直接嵌套罐子。</p>
<h3 id="E-1-1可执行Jar文件结构"><a href="#E-1-1可执行Jar文件结构" class="headerlink" title="E.1.1可执行Jar文件结构"></a>E.1.1可执行Jar文件结构</h3><p>Spring Boot与Loader兼容的jar文件应按以下方式构建：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">example.jar</span><br><span class="line"> |</span><br><span class="line"> +-META-INF</span><br><span class="line"> |  +-MANIFEST.MF</span><br><span class="line"> +-org</span><br><span class="line"> |  +-springframework</span><br><span class="line"> |     +-boot</span><br><span class="line"> |        +-loader</span><br><span class="line"> |           +-&lt;spring boot loader classes&gt;</span><br><span class="line"> +-BOOT-INF</span><br><span class="line">    +-classes</span><br><span class="line">    |  +-mycompany</span><br><span class="line">    |     +-project</span><br><span class="line">    |        +-YourClasses.class</span><br><span class="line">    +-lib</span><br><span class="line">       +-dependency1.jar</span><br><span class="line">       +-dependency2.jar</span><br></pre></td></tr></table></figure>

<p>应用程序类应放在嵌套的<code>BOOT-INF/classes</code>目录中。依赖项应放在嵌套的<code>BOOT-INF/lib</code>目录中。</p>
<h3 id="E-1-2可执行文件War文件结构"><a href="#E-1-2可执行文件War文件结构" class="headerlink" title="E.1.2可执行文件War文件结构"></a>E.1.2可执行文件War文件结构</h3><p>Spring Boot与Loader兼容的war文件应按以下方式构建：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">example.war</span><br><span class="line"> |</span><br><span class="line"> +-META-INF</span><br><span class="line"> |  +-MANIFEST.MF</span><br><span class="line"> +-org</span><br><span class="line"> |  +-springframework</span><br><span class="line"> |     +-boot</span><br><span class="line"> |        +-loader</span><br><span class="line"> |           +-&lt;spring boot loader classes&gt;</span><br><span class="line"> +-WEB-INF</span><br><span class="line">    +-classes</span><br><span class="line">    |  +-com</span><br><span class="line">    |     +-mycompany</span><br><span class="line">    |        +-project</span><br><span class="line">    |           +-YourClasses.class</span><br><span class="line">    +-lib</span><br><span class="line">    |  +-dependency1.jar</span><br><span class="line">    |  +-dependency2.jar</span><br><span class="line">    +-lib-provided</span><br><span class="line">       +-servlet-api.jar</span><br><span class="line">       +-dependency3.jar</span><br></pre></td></tr></table></figure>

<p>依赖项应放在嵌套的<code>WEB-INF/lib</code>目录中。运行嵌入式时所需的任何依赖项，但在部署到传统Web容器时不需要，应放在<code>WEB-INF/lib-provided</code>中。</p>
<h2 id="E-2-Spring-Boot的“JarFile”类"><a href="#E-2-Spring-Boot的“JarFile”类" class="headerlink" title="E.2 Spring Boot的“JarFile”类"></a>E.2 Spring Boot的“JarFile”类</h2><p>用于支持加载嵌套jar的核心类是<code>org.springframework.boot.loader.jar.JarFile</code>。它允许您从标准jar文件或嵌套子jar数据中加载jar内容。首次加载时，每个<code>JarEntry</code>的位置将映射到外部jar的物理文件偏移量，如以下示例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">myapp.jar</span><br><span class="line">+-------------------+-------------------------+</span><br><span class="line">| &#x2F;BOOT-INF&#x2F;classes | &#x2F;BOOT-INF&#x2F;lib&#x2F;mylib.jar |</span><br><span class="line">|+-----------------+||+-----------+----------+|</span><br><span class="line">||     A.class      |||  B.class  |  C.class ||</span><br><span class="line">|+-----------------+||+-----------+----------+|</span><br><span class="line">+-------------------+-------------------------+</span><br><span class="line"> ^                    ^           ^</span><br><span class="line"> 0063                 3452        3980</span><br></pre></td></tr></table></figure>

<p>上面的示例显示如何在位于<code>0063</code>的<code>myapp.jar</code> <code>/BOOT-INF/classes</code>中找到<code>A.class</code>。来自嵌套jar的<code>B.class</code>实际上可以在位置<code>3452</code>的<code>myapp.jar</code>中找到，而<code>C.class</code>位于<code>3980</code>位置。</p>
<p>有了这些信息，我们可以通过寻找外部jar的适当部分来加载特定的嵌套条目。我们不需要解压缩归档文件，也不需要将所有条目数据读入内存。</p>
<h3 id="E-2-1与标准Java“JarFile”的兼容性"><a href="#E-2-1与标准Java“JarFile”的兼容性" class="headerlink" title="E.2.1与标准Java“JarFile”的兼容性"></a>E.2.1与标准Java“JarFile”的兼容性</h3><p>Spring Boot Loader努力保持与现有代码和库的兼容性。<code>org.springframework.boot.loader.jar.JarFile</code>从<code>java.util.jar.JarFile</code>延伸，应该作为替代品。<code>getURL()</code>方法返回<code>URL</code>，打开与<code>java.net.JarURLConnection</code>兼容的连接，并可与Java的<code>URLClassLoader</code>一起使用。</p>
<h2 id="E-3启动可执行的Jars"><a href="#E-3启动可执行的Jars" class="headerlink" title="E.3启动可执行的Jars"></a>E.3启动可执行的Jars</h2><p><code>org.springframework.boot.loader.Launcher</code>类是一个特殊的引导类，用作可执行jar的主要入口点。这是您的jar文件中的实际<code>Main-Class</code>，它用于设置适当的<code>URLClassLoader</code>并最终调用您的<code>main()</code>方法。</p>
<p>有三个启动器子类（<code>JarLauncher</code>，<code>WarLauncher</code>和<code>PropertiesLauncher</code>）。它们的目的是从嵌套的jar文件或目录中的war文件加载资源（<code>.class</code>文件等。）（而不是在类路径上显式的那些文件）。在<code>JarLauncher</code>和<code>WarLauncher</code>的情况下，嵌套路径是固定的。<code>JarLauncher</code>查看<code>BOOT-INF/lib/</code>，<code>WarLauncher</code>查看<code>WEB-INF/lib/</code>和<code>WEB-INF/lib-provided/</code>。如果您需要更多，可以在这些位置添加额外的罐子。默认情况下，<code>PropertiesLauncher</code>会在您的应用程序存档中查找<code>BOOT-INF/lib/</code>，但您可以通过在<code>loader.properties</code>中设置名为<code>LOADER_PATH</code>或<code>loader.path</code>的环境变量来添加其他位置（这是一个逗号 - 存档中的目录，存档或目录的分隔列表）。</p>
<h3 id="E-3-1发射器清单"><a href="#E-3-1发射器清单" class="headerlink" title="E.3.1发射器清单"></a>E.3.1发射器清单</h3><p>您需要指定适当的<code>Launcher</code>作为<code>META-INF/MANIFEST.MF</code>的<code>Main-Class</code>属性。应在<code>Start-Class</code>属性中指定要启动的实际类（即包含<code>main</code>方法的类）。</p>
<p>以下示例显示了可执行jar文件的典型<code>MANIFEST.MF</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Main-Class: org.springframework.boot.loader.JarLauncher</span><br><span class="line">Start-Class: com.mycompany.project.MyApplication</span><br></pre></td></tr></table></figure>

<p>对于war文件，它将如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Main-Class: org.springframework.boot.loader.WarLauncher</span><br><span class="line">Start-Class: com.mycompany.project.MyApplication</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/note.png" alt="[注意]"></th>
</tr>
</thead>
<tbody><tr>
<td>您无需在清单文件中指定<code>Class-Path</code>条目。类路径是从嵌套的jar中推导出来的。</td>
</tr>
</tbody></table>
<h3 id="E-3-2分解档案"><a href="#E-3-2分解档案" class="headerlink" title="E.3.2分解档案"></a>E.3.2分解档案</h3><p>某些PaaS实现可能会选择在运行之前解压缩档案。例如，Cloud Foundry就是这样运作的。您可以通过启动相应的启动程序来运行解压缩的存档，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ unzip -q myapp.jar</span><br><span class="line">$ java org.springframework.boot.loader.JarLauncher</span><br></pre></td></tr></table></figure>

<h2 id="E-4-PropertiesLauncher特点"><a href="#E-4-PropertiesLauncher特点" class="headerlink" title="E.4 PropertiesLauncher特点"></a>E.4 <code>PropertiesLauncher</code>特点</h2><p><code>PropertiesLauncher</code>具有一些可以使用外部属性启用的特殊功能（系统属性，环境变量，清单条目或<code>loader.properties</code>）。下表描述了这些属性：</p>
<table>
<thead>
<tr>
<th>键</th>
<th>目的</th>
</tr>
</thead>
<tbody><tr>
<td><code>loader.path</code></td>
<td>Comma-separated Classpath, such as <code>lib,$&#123;HOME&#125;/app/lib</code>. Earlier entries take precedence, like a regular <code>-classpath</code> on the <code>javac</code> command line.</td>
</tr>
<tr>
<td><code>loader.home</code></td>
<td>Used to resolve relative paths in <code>loader.path</code>. For example, given <code>loader.path=lib</code>, then <code>$&#123;loader.home&#125;/lib</code> is a classpath location (along with all jar files in that directory). This property is also used to locate a <code>loader.properties</code> file, as in the following example <code>/opt/app</code> It defaults to <code>$&#123;user.dir&#125;</code>.</td>
</tr>
<tr>
<td><code>loader.args</code></td>
<td>Default arguments for the main method (space separated).</td>
</tr>
<tr>
<td><code>loader.main</code></td>
<td>Name of main class to launch (for example, <code>com.app.Application</code>).</td>
</tr>
<tr>
<td><code>loader.config.name</code></td>
<td>Name of properties file (for example, <code>launcher</code>) It defaults to <code>loader</code>.</td>
</tr>
<tr>
<td><code>loader.config.location</code></td>
<td>Path to properties file (for example, <code>classpath:loader.properties</code>). It defaults to <code>loader.properties</code>.</td>
</tr>
<tr>
<td><code>loader.system</code></td>
<td>Boolean flag to indicate that all properties should be added to System properties It defaults to <code>false</code>.</td>
</tr>
</tbody></table>
<p>指定为环境变量或清单条目时，应使用以下名称：</p>
<table>
<thead>
<tr>
<th>键</th>
<th>清单入口</th>
<th>环境变量</th>
</tr>
</thead>
<tbody><tr>
<td><code>loader.path</code></td>
<td><code>Loader-Path</code></td>
<td><code>LOADER_PATH</code></td>
</tr>
<tr>
<td><code>loader.home</code></td>
<td><code>Loader-Home</code></td>
<td><code>LOADER_HOME</code></td>
</tr>
<tr>
<td><code>loader.args</code></td>
<td><code>Loader-Args</code></td>
<td><code>LOADER_ARGS</code></td>
</tr>
<tr>
<td><code>loader.main</code></td>
<td><code>Start-Class</code></td>
<td><code>LOADER_MAIN</code></td>
</tr>
<tr>
<td><code>loader.config.location</code></td>
<td><code>Loader-Config-Location</code></td>
<td><code>LOADER_CONFIG_LOCATION</code></td>
</tr>
<tr>
<td><code>loader.system</code></td>
<td><code>Loader-System</code></td>
<td><code>LOADER_SYSTEM</code></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><img src="https://www.springcloud.cc/images/tip.png" alt="[小费]"></th>
</tr>
</thead>
<tbody><tr>
<td>构建胖罐时，构建插件会自动将<code>Main-Class</code>属性移动到<code>Start-Class</code>。如果您使用它，请使用<code>Main-Class</code>属性指定要启动的类的名称，并省略<code>Start-Class</code>。</td>
</tr>
</tbody></table>
<p>以下规则适用于使用<code>PropertiesLauncher</code>：</p>
<ul>
<li><code>loader.properties</code>在<code>loader.home</code>中搜索，然后在类路径的根目录中搜索，然后在<code>classpath:/BOOT-INF/classes</code>中搜索。使用具有该名称的文件的第一个位置。</li>
<li><code>loader.home</code>是仅在未指定<code>loader.config.location</code>时附加属性文件的目录位置（覆盖默认值）。</li>
<li><code>loader.path</code>可以包含目录（以递归方式扫描jar和zip文件），存档路径，存档中扫描jar文件的目录（例如，<code>dependencies.jar!/lib</code>）或通配符模式（默认情况下） JVM行为）。存档路径可以相对于<code>loader.home</code>或文件系统中具有<code>jar:file:</code>前缀的任何位置。</li>
<li><code>loader.path</code>（如果为空）默认为<code>BOOT-INF/lib</code>（表示本地目录或嵌套的目录，如果从存档运行）。因此，<code>PropertiesLauncher</code>在没有提供其他配置时与<code>JarLauncher</code>的行为相同。</li>
<li><code>loader.path</code>不能用于配置<code>loader.properties</code>的位置（用于搜索后者的类路径是启动<code>PropertiesLauncher</code>时的JVM类路径）。</li>
<li>占位符替换是在使用前从系统和环境变量以及属性文件本身在所有值上完成的。</li>
<li>属性的搜索顺序（在多个位置查看的位置）是环境变量，系统属性，<code>loader.properties</code>，展开的存档清单和存档清单。</li>
</ul>
<h2 id="E-5可执行的Jar限制"><a href="#E-5可执行的Jar限制" class="headerlink" title="E.5可执行的Jar限制"></a>E.5可执行的Jar限制</h2><p>使用Spring Boot Loader打包应用程序时，需要考虑以下限制：</p>
<ul>
<li>Zip条目压缩：必须使用<code>ZipEntry.STORED</code>方法保存嵌套jar的<code>ZipEntry</code>。这是必需的，以便我们可以直接寻找嵌套jar中的单个内容。嵌套的jar文件本身的内容仍然可以被压缩，外部jar中的任何其他条目也是如此。</li>
</ul>
<ul>
<li>System classLoader：启动的应用程序在加载类时应该使用<code>Thread.getContextClassLoader()</code>（大多数库和框架默认都这样做）。尝试使用<code>ClassLoader.getSystemClassLoader()</code>加载嵌套的jar类失败。<code>java.util.Logging</code>始终使用系统类加载器。因此，您应该考虑使用不同的日志记录实现。</li>
</ul>
<h2 id="E-6替代单罐解决方案"><a href="#E-6替代单罐解决方案" class="headerlink" title="E.6替代单罐解决方案"></a>E.6替代单罐解决方案</h2><p>如果前面的限制意味着您不能使用Spring Boot Loader，请考虑以下备选方案：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://maven.apache.org/plugins/maven-shade-plugin/">Maven Shade插件</a></li>
<li><a target="_blank" rel="noopener" href="http://www.jdotsoft.com/JarClassLoader.php">的JarClassLoader</a></li>
<li><a target="_blank" rel="noopener" href="http://one-jar.sourceforge.net/">OneJar</a></li>
<li><a target="_blank" rel="noopener" href="https://imperceptiblethoughts.com/shadow/">Gradle Shadow Plugin</a></li>
</ul>
<h2 id="附录F-依赖版本"><a href="#附录F-依赖版本" class="headerlink" title="附录F.依赖版本"></a>附录F.依赖版本</h2><p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/reference/html/appendix-dependency-versions.html#dependency-versions-coordinates">https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/reference/html/appendix-dependency-versions.html#dependency-versions-coordinates</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/07/27/cpj/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ZP">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/27/cpj/" class="post-title-link" itemprop="url">Java并发专家DougLea文章</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2020-07-27 16:32:57 / 修改时间：16:38:46" itemprop="dateCreated datePublished" datetime="2020-07-27T16:32:57+08:00">2020-07-27</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Java并发结构"><a href="#Java并发结构" class="headerlink" title="Java并发结构"></a><a href="#1">Java并发结构</a></h1><h1 id="任务取消-Cancellation"><a href="#任务取消-Cancellation" class="headerlink" title="任务取消(Cancellation)"></a><a href="#2">任务取消(Cancellation)</a></h1><h1 id="同步和Java内存模型"><a href="#同步和Java内存模型" class="headerlink" title="同步和Java内存模型"></a><a href="#3">同步和Java内存模型</a></h1><h1 id="Java并发结构-1"><a href="#Java并发结构-1" class="headerlink" title="Java并发结构"></a><span id="1">Java并发结构</span></h1><p>原文链接：<a target="_blank" rel="noopener" href="http://gee.cs.oswego.edu/dl/cpj/mechanics.html">http://gee.cs.oswego.edu/dl/cpj/mechanics.html</a></p>
<p><kbd><strong>Doug Lea<br>Last modified: Sun Oct 17 14:21:45 EDT 1999</strong></kbd></p>
<h2 id="线程"><a href="#线程" class="headerlink" title="线程"></a>线程</h2><p>线程是一个独立执行的调用序列，同一个进程的线程在同一时刻共享一些系统资源（比如文件句柄等）也能访问同一个进程所创建的对象资源（内存资源）。java.lang.Thread对象负责统计和控制这种行为。</p>
<p>每个程序都至少拥有一个线程-即作为Java虚拟机(JVM)启动参数运行在主类main方法的线程。在Java虚拟机初始化过程中也可能启动其他的后台线程。这种线程的数目和种类因JVM的实现而异。然而所有用户级线程都是显式被构造并在主线程或者是其他用户线程中被启动。</p>
<p>这里对Thread类中的主要方法和属性以及一些使用注意事项作出总结。这些内容会在这本书(《Java Concurrency Constructs》)上进行进一步的讨论阐述。Java语言规范以及已发布的API文档中都会有更详细权威的描述。</p>
<h2 id="构造方法"><a href="#构造方法" class="headerlink" title="构造方法"></a>构造方法</h2><p>Thread类中不同的构造方法接受如下参数的不同组合：</p>
<p>一个Runnable对象，这种情况下，Thread.start方法将会调用对应Runnable对象的run方法。如果没有提供Runnable对象，那么就会立即得到一个Thread.run的默认实现。<br>一个作为线程标识名的String字符串，该标识在跟踪和调试过程中会非常有用，除此别无它用。<br>线程组（ThreadGroup），用来放置新创建的线程，如果提供的ThreadGroup不允许被访问，那么就会抛出一个SecurityException 。<br>Thread类本身就已经实现了Runnable接口，因此，除了提供一个用于执行的Runnable对象作为构造参数的办法之外，也可以创建一个Thread的子类，通过重写其run方法来达到同样的效果。然而，比较好的实践方法却是分开定义一个Runnable对象并用来作为构造方法的参数。将代码分散在不同的类中使得开发人员无需纠结于Runnable和Thread对象中使用的同步方法或同步块之间的内部交互。更普遍的是，这种分隔使得对操作的本身与其运行的上下文有着独立的控制。更好的是，同一个Runnable对象可以同时用来初始化其他的线程，也可以用于构造一些轻量化的执行框架(Executors)。另外需要提到的是通过继承Thread类实现线程的方式有一个缺点：使得该类无法再继承其他的类。</p>
<p>Thread对象拥有一个守护(daemon)标识属性，这个属性无法在构造方法中被赋值，但是可以在线程启动之前设置该属性(通过setDaemon方法)。当程序中所有的非守护线程都已经终止，调用setDaemon方法可能会导致虚拟机粗暴的终止线程并退出。isDaemon方法能够返回该属性的值。守护状态的作用非常有限，即使是后台线程在程序退出的时候也经常需要做一些清理工作。（daemon的发音为”day-mon”,这是系统编程传统的遗留，系统守护进程是一个持续运行的进程，比如打印机队列管理，它总是在系统中运行。）</p>
<h2 id="启动线程"><a href="#启动线程" class="headerlink" title="启动线程"></a>启动线程</h2><p>调用start方法会触发Thread实例以一个新的线程启动其run方法。新线程不会持有调用线程的任何同步锁。</p>
<p>当一个线程正常地运行结束或者抛出某种未检测的异常（比如，运行时异常(RuntimeException)，错误(ERROR) 或者其子类）线程就会终止。当线程终止之后，是不能被重新启动的。在同一个Thread上调用多次start方法会抛出InvalidThreadStateException异常。</p>
<p>如果线程已经启动但是还没有终止，那么调用isAlive方法就会返回true.即使线程由于某些原因处于阻塞(Blocked)状态该方法依然返回true。如果线程已经被取消(cancelled),那么调用其isAlive在什么时候返回false就因各Java虚拟机的实现而异了。没有方法可以得知一个处于非活动状态的线程是否已经被启动过了(译者注：即线程在开始运行前和结束运行后都会返回false，你无法得知处于false的线程具体的状态)。另一点，虽然一个线程能够得知同一个线程组的其他线程的标识，但是却无法得知自己是由哪个线程调用启动的。</p>
<h2 id="优先级"><a href="#优先级" class="headerlink" title="优先级"></a>优先级</h2><p>Java虚拟机为了实现跨平台(不同的硬件平台和各种操作系统)的特性，Java语言在线程调度与调度公平性上未作出任何的承诺，甚至都不会严格保证线程会被执行。但是Java线程却支持优先级的方法，这些方法会影响线程的调度：</p>
<p>每个线程都有一个优先级，分布在Thread.MIN_PRIORITY和Thread.MAX_PRIORITY之间（分别为1和10）<br>默认情况下，新创建的线程都拥有和创建它的线程相同的优先级。main方法所关联的初始化线程拥有一个默认的优先级，这个优先级是Thread.NORM_PRIORITY (5).<br>线程的当前优先级可以通过getPriority方法获得。<br>线程的优先级可以通过setPriority方法来动态的修改，一个线程的最高优先级由其所在的线程组限定。</p>
<p>当可运行的线程数超过了可用的CPU数目的时候，线程调度器更偏向于去执行那些拥有更高优先级的线程。具体的策略因平台而异。比如有些Java虚拟机实现总是选择当前优先级最高的线程执行。有些虚拟机实现将Java中的十个优先级映射到系统所支持的更小范围的优先级上，因此，拥有不同优先级的线程可能最终被同等对待。还有些虚拟机会使用老化策略（随着时间的增长，线程的优先级逐渐升高）动态调整线程优先级，另一些虚拟机实现的调度策略会确保低优先级的线程最终还是能够有机会运行。设置线程优先级可以影响在同一台机器上运行的程序之间的调度结果，但是这不是必须的。</p>
<p>线程优先级对语义和正确性没有任何的影响。特别是，优先级管理不能用来代替锁机制。优先级仅仅是用来表明哪些线程是重要紧急的，当存在很多线程在激励进行CPU资源竞争的情况下，线程的优先级标识将会显得非常有用。比如，在ParticleApplet中将particle animation线程的优先级设置的比创建它们的applet线程低，在某些系统上能够提高对鼠标点击的响应，而且不会对其他功能造成影响。但是即使setPriority方法被定义为空实现，程序在设计上也应该保证能够正确执行（尽管可能会没有响应）。</p>
<p>下面这个表格列出不同类型任务在线程优先级设定上的通常约定。在很多并发应用中，在任一指定的时间点上，只有相对较少的线程处于可执行的状态（另外的线程可能由于各种原因处于阻塞状态），在这种情况下，没有什么理由需要去管理线程的优先级。另一些情况下，在线程优先级上的调整可能会对并发系统的调优起到一些作用。</p>
<p>范围  用途<br>10      Crisis management（应急处理）<br>7-9    Interactive, event-driven（交互相关，事件驱动）<br>4-6    IO-bound（IO限制类）<br>2-3    Background computation（后台计算）<br>1        Run only if nothing else can（仅在没有任何线程运行时运行的）</p>
<h2 id="控制方法"><a href="#控制方法" class="headerlink" title="控制方法"></a>控制方法</h2><p>只有很少几个方法可以用于跨线程交流：</p>
<p>每个线程都有一个相关的Boolean类型的中断标识。在线程t上调用t.interrupt会将该线程的中断标识设为true，除非线程t正处于Object.wait,Thread.sleep,或者Thread.join,这些情况下interrupt调用会导致t上的这些操作抛出InterruptedException异常，但是t的中断标识会被设为false。<br>任何一个线程的中断状态都可以通过调用isInterrupted方法来得到。如果线程已经通过interrupt方法被中断，这个方法将会返回true。<br>但是如果调用了Thread.interrupted方法且中断标识还没有被重置，或者是线程处于wait，sleep，join过程中，调用isInterrupted方法将会抛出InterruptedException异常。调用t.join()方法将会暂停执行调用线程，直到线程t执行完毕：当t.isAlive()方法返回false的时候调用t.join()将会直接返回(return)。另一个带参数毫秒(millisecond)的join方法在被调用时，如果线程没能够在指定的时间内完成，调用线程将重新得到控制权。因为isAlive方法的实现原理，所以在一个还没有启动的线程上调用join方法是没有任何意义的。同样的，试图在一个还没有创建的线程上调用join方法也是不明智的。<br>起初，Thread类还支持一些另外一些控制方法：suspend,resume,stop以及destroy。这几个方法已经被声明过期。其中destroy方法从来没有被实现，估计以后也不会。而通过使用等待/唤醒机制增加suspend和resume方法在安全性和可靠性的效果有所欠缺，将在3.2章节进行具体讨论。而stop方法所带来的问题也将在3.1.2.3进行探讨。</p>
<h2 id="静态方法"><a href="#静态方法" class="headerlink" title="静态方法"></a>静态方法</h2><p>Thread类中的部分方法被设计为只适用于当前正在运行的线程（即调用Thread方法的线程）。为强调这点，这些方法都被声明为静态的。</p>
<p>Thread.currentThread方法会返回当前线程的引用，得到这个引用可以用来调用其他的非静态方法，比如Thread.currentThread().getPriority()会返回调用线程的优先级。<br>Thread.interrupted方法会清除当前线程的中断状态并返回前一个状态。（一个线程的中断状态是不允许被其他线程清除的）<br>Thread.sleep(long msecs)方法会使得当前线程暂停执行至少msecs毫秒。<br>Thread.yield方法纯粹只是建议Java虚拟机对其他已经处于就绪状态的线程（如果有的话）调度执行，而不是当前线程。最终Java虚拟机如何去实现这种行为就完全看其喜好了。</p>
<p>尽管缺乏保障，但在不支持分时间片/可抢占式的线程调度方式的单CPU的Java虚拟机实现上，yield方法依然能够起到切实的作用。在这种情况下，线程只在被阻塞的情况下（比如等待IO，或是调用了sleep等）才会进行重新调度。在这些系统上，那些执行非阻塞的耗时的计算任务的线程就会占用CPU很长的时间，最终导致应用的响应能力降低。如果一个非阻塞的耗时计算线程会导致时间处理线程或者其他交互线程超出可容忍的限度的话，就可以在其中插入yield操作(或者是sleep)，使得具有较低线程优先级的线程也可以执行。为了避免不必要的影响，你可以只在偶然间调用yield方法，比如，可以在一个循环中插入如下代码:if (Math.random() &lt; 0.01) Thread.yield();</p>
<p>在支持可抢占式调度的Java虚拟机实现上，线程调度器忽略yield操作可能是最完美的策略，特别是在多核处理器上。</p>
<h2 id="线程组"><a href="#线程组" class="headerlink" title="线程组"></a>线程组</h2><p>每一个线程都是一个线程组中的成员。默认情况下，新建线程和创建它的线程属于同一个线程组。线程组是以树状分布的。当创建一个新的线程组，这个线程组成为当前线程组的子组。getThreadGroup方法会返回当前线程所属的线程组，对应地，ThreadGroup类也有方法可以得到哪些线程目前属于这个线程组，比如enumerate方法。</p>
<p>ThreadGroup类存在的一个目的是支持安全策略来动态的限制对该组的线程操作。比如对不属于同一组的线程调用interrupt是不合法的。这是为避免某些问题(比如，一个applet线程尝试杀掉主屏幕的刷新线程)所采取的措施。ThreadGroup也可以为该组所有线程设置一个最大的线程优先级。</p>
<p>线程组往往不会直接在程序中被使用。在大多数的应用中，如果仅仅是为在程序中跟踪线程对象的分组，那么普通的集合类（比如java.util.Vector）应是更好的选择。</p>
<p>在ThreadGroup类为数不多的几个方法中，uncaughtException方法却是非常有用的，当线程组中的某个线程因抛出未检测的异常（比如空指针异常NullPointerException）而中断的时候，调用这个方法可以打印出线程的调用栈信息。</p>
<h2 id="同步"><a href="#同步" class="headerlink" title="同步"></a>同步</h2><h4 id="对象与锁"><a href="#对象与锁" class="headerlink" title="对象与锁"></a>对象与锁</h4><p>每一个Object类及其子类的实例都拥有一个锁。其中，标量类型int，float等不是对象类型，但是标量类型可以通过其包装类来作为锁。单独的成员变量是不能被标明为同步的。锁只能用在使用了这些变量的方法上。然而正如在2.2.7.4上描述的，成员变量可以被声明为volatile，这种方式会影响该变量的原子性，可见性以及排序性。</p>
<p>类似的，持有标量变量元素的数组对象拥有锁，但是其中的标量元素却不拥有锁。（也就是说，没有办法将数组成员声明为volatile类型的）。如果锁住了一个数组并不代表其数组成员都可以被原子的锁定。也没有能在一个原子操作中锁住多个对象的方法。</p>
<p>Class实例本质上是个对象。正如下所述，在静态同步方法中用的就是类对象的锁。</p>
<h4 id="同步方法和同步块"><a href="#同步方法和同步块" class="headerlink" title="同步方法和同步块"></a>同步方法和同步块</h4><p>使用synchronized关键字，有两种语法结构：同步代码块和同步方法。同步代码块需要提供一个作为锁的对象参数。这就允许了任意方法可以去锁任一一个对象。但在同步代码块中使用的最普通的参数却是this。</p>
<p>同步代码块被认为比同步方法更加的基础。如下两种声明方式是等同的：</p>
<p>1<br>synchronized void f() { /* body <em>/ }<br>2<br>void f() { synchronized(this) { /</em> body */ } }<br>synchronized关键字并不是方法签名的一部分。所以当子类覆写父类中的同步方法或是接口中声明的同步方法的时候，synchronized修饰符是不会被自动继承的，另外，构造方法不可能是真正同步的（尽管可以在构造方法中使用同步块）。</p>
<p>同步实例方法在其子类和父类中使用同样的锁。但是内部类方法的同步却独立于其外部类， 然而一个非静态的内部类方法可以通过下面这种方式锁住其外部类：</p>
<p>1<br>synchronized(OuterClass.this) { /* body */ }</p>
<h4 id="等待锁与释放锁"><a href="#等待锁与释放锁" class="headerlink" title="等待锁与释放锁"></a>等待锁与释放锁</h4><p>使用synchronized关键字须遵循一套内置的锁等待-释放机制。所有的锁都是块结构的。当进入一个同步方法或同步块的时候必须获得该锁，而退出的时候（即使是异常退出）必须释放这个锁。你不能忘记释放锁。</p>
<p>锁操作是建立在独立的线程上的而不是独立的调用基础上。一个线程能够进入一个同步代码的条件是当前锁未被占用或者是当前线程已经占用了这个锁，否则线程就会阻塞住。（这种可重入锁或是递归锁不同于POSIX线程）。这就允许一个同步方法可以去直接调用同一个锁管理的另一个同步方法，而不需要被冻结（注：即不需要再经历释放锁-阻塞-申请锁的过程）。</p>
<p>同步方法或同步块遵循这种锁获取/锁释放的机制有一个前提，那就是所有的同步方法或同步块都是在同一个锁对象上。如果一个同步方法正在执行中，其他的非同步方法也可以在任何时候执行。也就是说，同步不等于原子性，但是同步机制可以用来实现原子性。</p>
<p>当一个线程释放锁的时候，另一个线程可能正等待这个锁（也可能是同一个线程，因为这个线程可能需要进入另一个同步方法）。但是关于哪一个线程能够紧接着获得这个锁以及什么时候，这是没有任何保证的。（也就是，没有任何的公平性保证-见3.4.1.5）另外，没有什么办法能够得到一个给定的锁正被哪个线程拥有着。</p>
<p>正如2.2.7讨论的，除了锁控制之外，同步也会对底层的内存系统带来副作用。</p>
<h4 id="静态变量-方法"><a href="#静态变量-方法" class="headerlink" title="静态变量/方法"></a>静态变量/方法</h4><p>锁住一个对象并不会原子性的保护该对象类或其父类的静态成员变量。而应该通过同步的静态方法或代码块来保证访问一个静态的成员变量。静态同步使用的是静态方法锁声明的类对象所拥有的锁。类C的静态锁可以通过内置的实例方法获取到：<br>synchronized(C.class) { /* body */ }</p>
<p>每个类所对应的静态锁和其他的类（包括其父类）没有任何的关系。通过在子类中增加一个静态同步方法来试图保护父类中的静态成员变量是无效的。应使用显式的代码块来代替。</p>
<p>如下这种方式也是一种不好的实践：<br>synchronized(getClass()) { /* body */ } // Do not use<br>这种方式，可能锁住的实际中的类，并不是需要保护的静态成员变量所对应的类（有可能是其子类）</p>
<p>Java虚拟机在类加载和类初始化阶段，内部获得并释放类锁。除非你要去写一个特殊的类加载器或者需要使用多个锁来控制静态初始顺序，这些内部机制不应该干扰普通类对象的同步方法和同步块的使用。Java虚拟机没有什么内部操作可以独立的获取你创建和使用的类对象的锁。然而当你继承java.*的类的时候，你需要特别小心这些类中使用的锁机制。</p>
<h4 id="监视器"><a href="#监视器" class="headerlink" title="监视器"></a>监视器</h4><p>正如每个对象都有一个锁一样，每一个对象同时拥有一个由这些方法(wait,notify,notifyAll,Thread,interrupt)管理的一个等待集合。拥有锁和等待集合的实体通常被称为监视器（虽然每种语言定义的细节略有不同），任何一个对象都可以作为一个监视器。</p>
<p>对象的等待集合是由Java虚拟机来管理的。每个等待集合上都持有在当前对象上等待但尚未被唤醒或是释放的阻塞线程。</p>
<p>因为与等待集合交互的方法（wait，notify，notifyAll）只在拥有目标对象的锁的情况下才被调用，因此无法在编译阶段验证其正确性，但在运行阶段错误的操作会导致抛出IllegalMonitorStateException异常。</p>
<p>这些方法的操作描述如下：</p>
<h5 id="Wait"><a href="#Wait" class="headerlink" title="Wait"></a>Wait</h5><p>调用wait方法会产生如下操作：</p>
<p>如果当前线程已经终止，那么这个方法会立即退出并抛出一个InterruptedException异常。否则当前线程就进入阻塞状态。<br>Java虚拟机将该线程放置在目标对象的等待集合中。<br>释放目标对象的同步锁，但是除此之外的其他锁依然由该线程持有。即使是在目标对象上多次嵌套的同步调用，所持有的可重入锁也会完整的释放。这样，后面恢复的时候，当前的锁状态能够完全地恢复。</p>
<h5 id="Notify"><a href="#Notify" class="headerlink" title="Notify"></a>Notify</h5><p>调用Notify会产生如下操作：</p>
<p>Java虚拟机从目标对象的等待集合中随意选择一个线程(称为T，前提是等待集合中还存在一个或多个线程)并从等待集合中移出T。当等待集合中存在多个线程时，并没有机制保证哪个线程会被选择到。<br>线程T必须重新获得目标对象的锁，直到有线程调用notify释放该锁，否则线程会一直阻塞下去。如果其他线程先一步获得了该锁，那么线程T将继续进入阻塞状态。<br>线程T从之前wait的点开始继续执行。</p>
<h5 id="NotifyAll"><a href="#NotifyAll" class="headerlink" title="NotifyAll"></a>NotifyAll</h5><p>notifyAll方法与notify方法的运行机制是一样的，只是这些过程是在对象等待集合中的所有线程上发生（事实上，是同时发生）的。但是因为这些线程都需要获得同一个锁，最终也只能有一个线程继续执行下去。</p>
<h5 id="Interrupt（中断）"><a href="#Interrupt（中断）" class="headerlink" title="Interrupt（中断）"></a>Interrupt（中断）</h5><p>如果在一个因wait而中断的线程上调用Thread.interrupt方法，之后的处理机制和notify机制相同，只是在重新获取这个锁之后，该方法将会抛出一个InterruptedException异常并且线程的中断标识将被设为false。如果interrupt操作和一个notify操作在同一时间发生，那么不能保证那个操作先被执行，因此任何一个结果都是可能的。（JLS的未来版本可能会对这些操作结果提供确定性保证）</p>
<h5 id="Timed-Wait（定时等待）"><a href="#Timed-Wait（定时等待）" class="headerlink" title="Timed Wait（定时等待）"></a>Timed Wait（定时等待）</h5><p>定时版本的wait方法，wait(long mesecs)和wait(long msecs,int nanosecs),参数指定了需要在等待集合中等待的最大时间值。如果在时间限制之内没有被唤醒，它将自动释放，除此之外，其他的操作都和无参数的wait方法一样。并没有状态能够表明线程正常唤醒与超时唤醒之间的不同。需要注意的是，wait(0)与wait(0,0)方法其实都具有特殊的意义，其相当于不限时的wait()方法，这可能与你的直觉相反。</p>
<p>由于线程竞争，调度策略以及定时器粒度等方面的原因，定时等待方法可能会消耗任意的时间。（注：关于定时器粒度并没有任何的保证，目前大多数的Java虚拟机实现当参数设置小于1毫秒的时候，观察的结果基本上在1～20毫秒之间）</p>
<p>Thread.sleep(long msecs)方法使用了定时等待的wait方法，但是使用的并不是当前对象的同步锁。它的效果如下描述：<br>if (msecs != 0)  {<br>Object s = new Object();<br>synchronized(s) { s.wait(msecs); }<br>}<br>当然，系统不需要使用这种方式去实现sleep方法。需要注意的，sleep(0)方法的含义是中断线程至少零时间，随便怎么解释都行。（译者注：该方法有着特殊的作用，从原理上它可以促使系统重新进行一次CPU竞争）。</p>
<h1 id="任务取消-Cancellation-1"><a href="#任务取消-Cancellation-1" class="headerlink" title="任务取消(Cancellation)"></a><span id="2">任务取消(Cancellation)</span></h1><p>原文链接：<a target="_blank" rel="noopener" href="http://gee.cs.oswego.edu/dl/cpj/cancel.html">http://gee.cs.oswego.edu/dl/cpj/cancel.html</a></p>
<p><kbd><strong>Doug Lea<br>Last modified: Sun Oct 17 14:21:45 EDT 1999</strong></kbd></p>
<p>当某个线程中的活动执行失败或想改变运行意图，也许就有必要或想要在其它线程中取消这个线程的活动，而不管这个线程正在做什么。取消会给运行中的线程带来一些无法预料的失败情况。取消操作异步特性相关的设计技巧，让人想起了因系统崩溃和连接断开任何时候都有可能失败的分布式系统的那些技巧。并发程序还要确保多线程共享的对象的状态一致性。
在大多数多线程程序中，取消任务（Cancellation）是普遍存在的，常见于：
几乎所有与GUI中取消按钮相关的活动。
多媒体演示（如动画循环）中的正常终止活动。
线程中生成的结果不再需要。例如使用多个线程搜索数据库，只要某个线程返回了结果，其它的都可以取消掉。
由于一组活动中的一或多个遇到意外错误或异常导致整组活动无法继续。
脚注：在并发编程中两个l的cancellation最常见。译者注：英语”取消”有两种写法cancelation和cancellation</p>


<h2 id="中断（Interruption）"><a href="#中断（Interruption）" class="headerlink" title="中断（Interruption）"></a>中断（Interruption）</h2><p>实现取消任务的最佳技术是使用线程的中断状态，这个状态由Thread.interrupt设置，可被Thread.isInterrupted检测到，通过Thread.interrupted清除，有时候抛出InterruptedException异常来响应。</p>
<p>脚注：JDK1.0不支持中断机制。版本间政策与机制（policies and mechanisms）的更新说明对任务取消支持中的不规则行为做出了说明</p>
<p>线程中断起着请求取消活动的作用。但无法阻止有人将其用作它途，而用来作取消操作是预期的用途。基于中断的任务取消依赖于取消者和被取消者间的一个协议以确保跨多线程使用的对象在被取消线程终止的时候不被损坏。大部分（理想情况下是所有的）java.*包中的类都遵守这个协议。</p>
<p>几乎在所有的情况下，取消一个与线程有关系的活动都应当终止对应的线程。但中断机制不会强制线程立马终止。这就给任何被中断的线程一个在终止前做些清理操作的机会，但也给代码强加了及时检查中断状态以及采取合适操作的职责。</p>
<p>延迟甚至忽略任务取消的请求给写出良好响应性且非常健壮的代码提供了途径。因为不会直接将线程中断掉，所以很难或不可能撤销的动作的前面可以作为一个安全点，然后在此安全点检查中断状态。响应中断大部分可选的方式在§3.1.1中有讨论：</p>
<p>继续执行（忽略或清除了中断）可能适用于那些不打算终止的线程；例如，那些对于程序基本功能不可或缺的数据库管理服务。一旦遇到中断，可中止这些特殊的任务，然后允许线程继续执行其它任务。然而，即使在这里，将中断的线程替换成一个处于初始状态的新启动的线程会更易于管理。</p>
<p>突然终止（比如抛出错误）一般适用于提供独立服务、除了run方法中finally子句外无需其它清理操作的线程。但是，当线程执行的服务被其它线程依赖时（见§4.3），就应当以某种形式通知这些依赖的线程或设置状态指示。（异常本身不会自动在线程间传播）</p>
<p>线程中使用的对象被其它线程依赖时必须使用回滚或前滚技术。</p>
<p>在某种程度上，可以通过决定多久用Thread.currentThread().isInterrupted()来检查中断状态以控制代码对中断的响应灵敏性。中断状态检查不需要太频繁以免影响程序效率。例如，如果需要取消的活动包含大约10000条指令，每10000条指令做一次取消检查，那么从取消请求到关闭平均会耗费15000条指令。只要活动继续运行没有什么实际的危害，这个数量级可以满足大部分应用的需要。通常，这个理由可以让你将中断检测代码仅放到既方便检测又是重要的程序点。在性能关键型应用中，也许值得构建一个分析模型或收集经验值来准确地决定响应性与吞吐量间的最佳权衡（参见§4.4.1.7）。</p>
<p>Object.wait、Thread.join、Thread.sleep以及它们衍生出的方法都会自动检测中断。这些方法一旦中断就会抛出InterruptedException来中止，然后让线程苏醒并执行与活动取消相关的代码。</p>
<p>按照惯例，应当在抛出InterruptedException时清除中断状态。有时候有必要这样做来支持一些清理工作，但这也可能是错误与混乱之源。当处理完InterruptedException后想要传播中断状态，必须要么重新抛出捕获的InterruptedException，要么通过Thread.currentThread().interrupt()重新设置中断状态。如果你的代码调用了其它未正确维持中断状态的代码（例如，忽略InterruptedException又不重设状态），可以能通过维持一个字段来规避问题，这个字段用于保存活动取消的标识，在调用interrupt的时候设置该字段，从有问题的调用中返回时检查该字段。</p>
<p>有两种情况线程会保持休眠而无法检测中断状态或接收InterruptedException：在同步块中和在IO中阻塞时。线程在等待同步方法或同步块的锁时不会对中断有响应。但是，如§2.5中讨论的，当需要大幅降低在活动取消期间被卡在锁等待中的几率，可以使用lock工具类。使用lock类的代码阻塞仅是为了访问锁对象本身，而不是这些锁所保护的代码。这些阻塞的耗时天生就很短（尽管时间不能严格保证）。</p>
<h2 id="IO和资源撤销（IO-and-resource-revocation）"><a href="#IO和资源撤销（IO-and-resource-revocation）" class="headerlink" title="IO和资源撤销（IO and resource revocation）"></a>IO和资源撤销（IO and resource revocation）</h2><p>一些IO支持类（尤其是java.net.Socket及其相关类）提供了在读操作阻塞的时候能够超时的可选途径，在这种情况下就可以在超时后检测中断。java.io中的其它类采用了另一种方式——一种特殊形式的资源撤销。如果某个线程在一个IO对象s（如InputStream）上执行s.close()，那么任何其它尝试使用s的线程将收到一个IOException。IO关闭会影响所有使用关闭了的IO对象的线程，会导致IO对象不可用。如有必要，可以创建一个新IO对象来替代关闭了的IO对象。</p>
<p>这与其它资源撤销的用途密切相关（如为了安全目的）。该策略也会保护应用免让共享的IO对象因其它使用了此IO对象的线程被取消而自动变得不可用。大部分java.io中的类不会也不能在出现IO异常时清除失败状态。例如，如果在StreamTokenizer或ObjectInputStream操作中间出现了一个底层IO异常，没有一个实用的恢复动作能继续保持预期的保障。所以，作为一种策略，JVM不会自动中断IO操作。</p>
<p>这给代码强加了额外的职责来处理取消事件。若一个线程正在执行IO操作，如果在此IO操作期间试图取消该IO操作，必须意识到IO对象正在使用且关闭该IO对象是你想要的行为。如果能接受这种情况，就可以通过关闭IO对象和中断线程来完成活动取消。例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CancellableReader</span> </span>&#123;                        <span class="comment">// Incomplete</span></span><br><span class="line">	<span class="keyword">private</span> Thread readerThread; <span class="comment">// only one at a time supported</span></span><br><span class="line">	<span class="keyword">private</span> FileInputStream dataFile;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">startReaderThread</span><span class="params">()</span> </span></span><br><span class="line"><span class="function">		<span class="keyword">throws</span> IllegalStateException, FileNotFoundException </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (readerThread != <span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException();</span><br><span class="line">			dataFile = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;data&quot;</span>);</span><br><span class="line">			readerThread = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">				<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; doRead(); &#125;</span><br><span class="line">			&#125;);</span><br><span class="line">		readerThread.start();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">closeFile</span><span class="params">()</span> </span>&#123; <span class="comment">// utility method</span></span><br><span class="line">		<span class="keyword">if</span> (dataFile != <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">try</span> &#123; dataFile.close(); &#125; </span><br><span class="line">			<span class="keyword">catch</span> (IOException ignore) &#123;&#125;</span><br><span class="line">			dataFile = <span class="keyword">null</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doRead</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="keyword">while</span> (!Thread.interrupted()) &#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					<span class="keyword">int</span> c = dataFile.read();</span><br><span class="line">					<span class="keyword">if</span> (c == -<span class="number">1</span>) <span class="keyword">break</span>;</span><br><span class="line">					<span class="keyword">else</span> process(c);</span><br><span class="line">				&#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">					<span class="keyword">break</span>; <span class="comment">// perhaps first do other cleanup</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			closeFile();</span><br><span class="line">			<span class="keyword">synchronized</span>(<span class="keyword">this</span>) &#123; readerThread = <span class="keyword">null</span>; &#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">cancelReaderThread</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (readerThread != <span class="keyword">null</span>) readerThread.interrupt();</span><br><span class="line">			closeFile();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>很多其它取消IO的场景源于需要中断那些等待输入而输入却不会或不能及时到来的线程。大部分基于套接字的流，可以通过设置套接字的超时参数来处理。其它的，可以依赖InputStream.available，然后手写自己的带时间限制的轮询循环来避免超时之后还阻塞在IO中（见§4.1.5）。这种设计可以使用一种类似于§3.1.1.5中描述的有时间限制的退避重试协议。例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReaderWithTimeout</span> </span>&#123;                <span class="comment">// Generic code sketch</span></span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">attemptRead</span><span class="params">(InputStream stream, <span class="keyword">long</span> timeout)</span> <span class="keyword">throws</span>... </span>&#123;</span><br><span class="line">		<span class="keyword">long</span> startTime = System.currentTimeMillis();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="keyword">for</span> (;;) &#123;</span><br><span class="line">				<span class="keyword">if</span> (stream.available() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">					<span class="keyword">int</span> c = stream.read();</span><br><span class="line">					<span class="keyword">if</span> (c != -<span class="number">1</span>) process(c);</span><br><span class="line">					<span class="keyword">else</span> <span class="keyword">break</span>; <span class="comment">// eof</span></span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					<span class="keyword">try</span> &#123;</span><br><span class="line">						Thread.sleep(<span class="number">100</span>); <span class="comment">// arbitrary fixed back-off time</span></span><br><span class="line">					&#125; <span class="keyword">catch</span> (InterruptedException ie) &#123;</span><br><span class="line">						<span class="comment">/* ... quietly wrap up and return ... */</span> </span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">long</span> now = System.currentTimeMillis();</span><br><span class="line">					<span class="keyword">if</span> (now - startTime &gt;= timeout) &#123;</span><br><span class="line">						<span class="comment">/* ... fail ...*/</span></span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException ex) &#123; <span class="comment">/* ... fail ... */</span> &#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>脚注：有些JDK发布版本也支持InterruptedIOException，但只是部分实现了且仅限于某些平台。在本文撰写之时，未来版本打算停止对其支持，部分原因是由于IO对象不可用会引起不良后果。但既然InterruptedIOException定义为IOException的一个子类，这种设计的工作方式与包含InterruptedIOException支持的版本上描述的相似，尽管存在额外的不确定性：中断可能抛出InterruptedIOException或InterruptedException。捕获InterruptedIOException然后将其作为一个InterruptedException重新抛出能部分解决该问题。</p>
<h2 id="异步终止（Asynchronous-termination）"><a href="#异步终止（Asynchronous-termination）" class="headerlink" title="异步终止（Asynchronous termination）"></a>异步终止（Asynchronous termination）</h2><p>stop方法起初包含在Thread类中，但是已经不推荐使用了。Thread.stop会导致不管线程正在做什么就突然抛出一个ThreadDeath异常。（与interrupt类似，stop不会中止锁等待或IO等待。但与interrupt不同的是，它不严格保证会中止wait，sleep或join）</p>
<p>这会是个非常危险的操作。因为Thread.stop产生异步信号，某些操作由于程序安全和对象一致性必须回滚或前滚，而活动正在执行这些操作或代码段时可能被终止掉。看下面例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> </span>&#123;                                         <span class="comment">// Fragments</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> v;  <span class="comment">// invariant: v &gt;= 0</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		v = -<span class="number">1</span>  ;   <span class="comment">// temporarily set to illegal value as flag</span></span><br><span class="line">		compute();  <span class="comment">// possible stop point (*)</span></span><br><span class="line">		v = <span class="number">1</span>;      <span class="comment">// set to legal value</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">g</span><span class="params">()</span> </span>&#123; </span><br><span class="line">		<span class="keyword">while</span> (v != <span class="number">0</span>) &#123; </span><br><span class="line">			--v; </span><br><span class="line">			something(); </span><br><span class="line">		&#125; </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果Thread.stop碰巧导致(<em>)行终止，对象就被破坏了：线程一终止，对象将保持在不一致状态，因为变量v被设了一个非法的值。其它线程在该对象上的任何调用会执行不想要的或危险的操作。例如，这里g方法中的循环将自旋2</em>Integer.MAX_VALUE次。stop让回滚或前滚恢复技术的使用变得极其困难。乍一看，这个问题看起来不太严重 —— 毕竟，调用compute抛出的任何未捕获异常都会破坏状态。但是，Thread.stop的后果更隐蔽，因为在可能忽略了ThreadDeath异常（由Thread.stop抛出）而仍传播取消请求的方法中你什么也做不了。而且，除非在每行代码后都放一个catch(ThreadDeath)，否则就没办法准确恢复当前对象的状态，所以可能碰到未检测到的破坏。相比之下，通常可以将代码写的健壮些，不用大费周章就能消除或处理其它类型的运行时异常。</p>
<p>换而言之，禁用Thread.stop不是为了修复它有缺陷的逻辑，而是纠正对其功能的错误认识。不可能允许所有方法的每条字节码都能出现取消操作导致的异常（底层操作系统代码开发者非常熟悉这个事实。即使程序非常短，很小的异步取消安全的例程也会是个艰巨的任务。）</p>
<p>注意，任意正在执行的方法可以捕获并忽略由stop导致的ThreadDeath异常。这样的话，stop就和interrupt一样不能保证线程会被终止，这更危险。任何stop的使用都暗含着开发者评估过试图突然终止某个活动带来的潜在危害比不这样做的潜在危害更大。</p>
<h2 id="资源控制（Resource-control）"><a href="#资源控制（Resource-control）" class="headerlink" title="资源控制（Resource control）"></a>资源控制（Resource control）</h2><p>活动取消可能出现在可装载和执行外部代码的任一系统的设计中。试图取消未遵守标准约定的代码面临着难题。外部代码也许完全忽略了中断，甚至是捕获ThreadDeath异常后将其丢弃，在这种情况下调用Thread.interrupt和Thread.stop将不会有什么效果。</p>
<p>你无法精确控制外来代码的行为及其耗时。但能够且应当使用标准的安全措施来限制不良后果。一种方式是创建和使用一个SecurityManager，当某个线程运行的时间太长，就拒绝所有对受检资源的请求。（细节内容超出本书范围，参考推荐读物。）这种形式的资源拒绝同§3.1.2.2中讨论的资源撤销策略一起能够阻止外部代码执行任一与其它应当继续执行的线程竞争资源。副作用就是这些措施经常最终会导致线程因异常而挂掉。</p>
<p>此外，可以调用某个线程的setPriority(Thread.MIN_PRIORITY)将CPU资源的竞争降到最小。可以用一个SecurityManager来阻止该线程将优先级提高。</p>
<h2 id="多步取消（Multiphase-cancellation）"><a href="#多步取消（Multiphase-cancellation）" class="headerlink" title="多步取消（Multiphase cancellation）"></a>多步取消（Multiphase cancellation）</h2><p>有时候，即使取消的是普通的代码，损害也比通常的更大。为应付这种可能性，可以建立一个通用的多步取消功能，尽可能尝试以破坏性最小的方式来取消任务，如果稍候还没有终止，再使用一种破坏性较大的方式。</p>
<p>在大多数操作系统进程级，多步取消是一种常见的模式。例如，它用在Unix关闭期间，先尝试使用kill -1终止任务，若有必要随后再使用kill -9.大多数win系统中的任务管理器也使用了类似的策略。</p>
<p>这里有个简单版本的示例。（Thread.join使用方面的更多细节参见§4.3.2.）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Terminator</span> </span>&#123;</span><br><span class="line">	<span class="comment">// Try to kill; return true if known to be dead</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">terminate</span><span class="params">(Thread t, <span class="keyword">long</span> maxWaitToDie)</span> </span>&#123; </span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> (!t.isAlive()) <span class="keyword">return</span> <span class="keyword">true</span>;  <span class="comment">// already dead</span></span><br><span class="line">		<span class="comment">// phase 1 -- graceful cancellation</span></span><br><span class="line">		</span><br><span class="line">		t.interrupt();       </span><br><span class="line">		<span class="keyword">try</span> &#123; t.join(maxWaitToDie); &#125; </span><br><span class="line">		<span class="keyword">catch</span>(InterruptedException e)&#123;&#125; <span class="comment">//  ignore </span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (!t.isAlive()) <span class="keyword">return</span> <span class="keyword">true</span>;  <span class="comment">// success</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// phase 2 -- trap all security checks</span></span><br><span class="line"></span><br><span class="line">		theSecurityMgr.denyAllChecksFor(t); <span class="comment">// a made-up method</span></span><br><span class="line">		<span class="keyword">try</span> &#123; t.join(maxWaitToDie); &#125; </span><br><span class="line">		<span class="keyword">catch</span>(InterruptedException ex) &#123;&#125; </span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (!t.isAlive()) <span class="keyword">return</span> <span class="keyword">true</span>; </span><br><span class="line"></span><br><span class="line">		<span class="comment">// phase 3 -- minimize damage</span></span><br><span class="line"></span><br><span class="line">		t.setPriority(Thread.MIN_PRIORITY);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意这里的terminate方法本身忽略了中断。这表明取消操作所做的这种策略选择一旦开始就必须继续。取消正在执行的取消操作，会给处理已经开始的与终止相关的清理带来另外一些问题。</p>
<p>因不同JVM实现中Thread.isAlive的行为不尽相同（参见§1.1.2），当join因线程结束返回后，在线程完全死掉之前isAlive还有可能返回true。</p>
<h1 id="同步与Java内存模型"><a href="#同步与Java内存模型" class="headerlink" title="同步与Java内存模型"></a><span id="3">同步与Java内存模型</span></h1><p>原文地址：<a target="_blank" rel="noopener" href="http://gee.cs.oswego.edu/dl/cpj/jmm.html">http://gee.cs.oswego.edu/dl/cpj/jmm.html</a></p>
<p><kbd><strong>Doug Lea Last modified: Sun Oct 17 14:21:45 EDT 1999</strong></kbd></p>
<p>先来看如下这个简单的Java类，该类中并没有使用任何的同步。<br> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">SetCheck</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span>  a = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">long</span> b = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    a =  <span class="number">1</span>;</span><br><span class="line">    b = -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">check</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ((b ==  <span class="number">0</span>) ||</span><br><span class="line">    (b == -<span class="number">1</span> &amp;&amp; a == <span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br></pre></td></tr></table></figure><br>如果是在一个串行执行的语言中，执行SetCheck类中的check方法永远不会返回false，即使编译器，运行时和计算机硬件并没有按照你所期望的逻辑来处理这段程序，该方法依然不会返回false。在程序执行过程中，下面这些你所不能预料的行为都是可能发生的：</p>
<ul>
<li><p>编译器可能会进行指令重排序，所以b变量的赋值操作可能先于a变量。如果是一个内联方法，编译器可能更甚一步将该方法的指令与其他语句进行重排序。</p>
</li>
<li><p>处理器可能会对语句所对应的机器指令进行重排序之后再执行，甚至并发地去执行。</p>
</li>
<li><p>内存系统（由高速缓存控制单元组成）可能会对变量所对应的内存单元的写操作指令进行重排序。重排之后的写操作可能会对其他的计算/内存操作造成覆盖。</p>
</li>
<li><p>编译器，处理器以及内存系统可能会让两条语句的机器指令交错。比如在32位机器上，b变量的高位字节先被写入，然后是a变量，紧接着才会是b变量的低位字节。</p>
</li>
<li><p>编译器，处理器以及内存系统可能会导致代表两个变量的内存单元在（如果有的话）连续的check调用（如果有的话）之后的某个时刻才更新，而以这种方式保存相应的值（如在CPU寄存器中）仍会得到预期的结果（check永远不会返回false）。</p>
</li>
</ul>
<p>在串行执行的语言中，只要程序执行遵循类似串行的语义，如上几种行为就不会有任何的影响。在一段简单的代码块中，串行执行程序不会依赖于代码的内部执行细节，因此如上的几种行为可以随意控制代码。这样就为编译器和计算机硬件提供了基本的灵活性。基于此，在过去的数十年内很多技术（CPU的流水线操作，多级缓存，读写平衡，寄存器分配等等）应运而生，为计算机处理速度的大幅提升奠定了基础。这些操作的类似串行执行的特性可以让开发人员无须知道其内部发生了什么。对于开发人员来说，如果不创建自己的线程，那么这些行为也不会对其产生任何的影响。</p>
<p>然而这些情况在并发编程中就完全不一样了，上面的代码在并发过程中，当一个线程调用check方法的时候完全有可能另一个线程正在执行set方法，这种情况下check方法就会将上面提到的优化操作过程暴露出来。如果上述任意一个操作发生，那么check方法就有可能返回false。例如，check方法读取long类型的变量b的时候可能得到的既不是0也不是-1.而是一个被写入一半的值。另一种情况，set方法中的语句的乱序执行有可能导致check方法读取变量b的值的时候是-1，然而读取变量a时却依然是0。</p>
<p>换句话说，不仅是并发执行会导致问题，而且在一些优化操作（比如指令重排序）进行之后也会导致代码执行结果和源代码中的逻辑有所出入。由于编译器和运行时技术的日趋成熟以及多处理器的逐渐普及，这种现象就变得越来越普遍。对于那些一直从事串行编程背景的开发人员（其实，基本上所有的程序员）来说，这可能会导致令人诧异的结果，而这些结果可能从没在串行编程中出现过。这可能就是那些微妙难解的并发编程错误的根本源头吧。</p>
<p>在绝大部分的情况下，有一个很简单易行的方法来避免那些在复杂的并发程序中因代码执行优化导致的问题：使用同步。例如，如果SetCheck类中所有的方法都被声明为synchronized,那么你就可以确保那么内部处理细节都不会影响代码预期的结果了。</p>
<p>但是在有些情况下你却不能或者不想去使用同步，抑或着你需要推断别人未使用同步的代码。在这些情况下你只能依赖Java内存模型所阐述的结果语义所提供的最小保证。Java内存模型允许上面提到的所有操作，但是限制了它们在执行语义上潜在的结果，此外还提出了一些技术让程序员可以用来控制这些语义的某些方面。</p>
<p>Java内存模型是Java语言规范的一部分，主要在JLS的第17章节介绍。这里，我们只是讨论一些基本的动机，属性以及模型的程序一致性。这里对JLS第一版中所缺少的部分进行了澄清。</p>
<p>我们假设Java内存模型可以被看作在1.2.4中描述的那种标准的SMP机器的理想化模型。</p>
<p><img src="data:image/png;base64,R0lGODlhHQLWAPcAAP///wAAAOq+k8ahfPbj0YBoUAAAAMevr6mUlOfd3WteXgAAAI6iwXiKpM3W5ElUZP///9TU2rS0ue3t8HZ2egAAAMevr9TU2j8/P97e3r29vSEhIWNjY0JCQpSUlHNzc1FR+///APoTQADuAP8A/39/f0xMTAAAAAAAPwAAfwAAvwAA/wA/AAA/PwA/fwA/vwA//wB/AAB/PwB/fwB/vwB//wC/AAC/PwC/fwC/vwC//wD/AAD/PwD/fwD/vwD//z8AAD8APz8Afz8Avz8A/z8/AD8/Pz8/fz8/vz8//z9/AD9/Pz9/fz9/vz9//z+/AD+/Pz+/fz+/vz+//z//AD//Pz//fz//vz///38AAH8AP38Af38Av38A/38/AH8/P38/f38/v38//39/AH9/P39/f39/v39//3+/AH+/P3+/f3+/v3+//3//AH//P3//f3//v3///78AAL8AP78Af78Av78A/78/AL8/P78/f78/v78//79/AL9/P79/f79/v79//7+/AL+/P7+/f7+/v7+//7//AL//P7//f7//v7////8AAP8AP/8Af/8Av/8A//8/AP8/P/8/f/8/v/8///9/AP9/P/9/f/9/v/9///+/AP+/P/+/f/+/v/+/////AP//P///f///v////wAAABERESIiIjMzM0RERFVVVWZmZnd3d4iIiJmZmaqqqru7u8zMzN3d3e7u7v///ziMKOUA//+ZAJmZmQD+/urg4HFkZKmVlYyMjP/vAPf/AN//AMf/AK//AJf/AH//AGf/AE//ADf/AB//AAf/AAD/DwD/JwD/PwD/VwD/bwD/hwD/nwD/twD/zwD/5wD//wDn/wDP/wC3/wCf/wCH/wBv/wBX/wA//wAn/wAP/wcA/x8A/zcA/08A/2cA/38A/5cA/68A/8cA/98A//cA//8A7/8A1/8Av/8Ap/8Aj/8Ad/8AX/8AR/8AL/8AFwBdDBKWNVEATIAAgL2Wcp+ipaJFoj+fojZMk/X19URERDTIAJOHbyH5BAAAAKYALAAAAAAdAtYAAAj+AAEIHEiwoMGDCBMqXMiwocOHECNKnEixosWLGDNq3Mixo8ePIEOKHEmypMmTKFOqXMmypcuXMGPKnEmzps2bOHPq3Mmzp8+fQIMKHUq0qNGjSJMqXcq0qdOnUKNKnUq1qtWrWLNq3cq1q9evYMOKHUu2rNmzaNOqXRs0gFu2cOPKJes2wNy7ePNSrau3r9+/F/m+HVjXLuG3fAEkJliYcWHDAhsbFDx4cWTLhwc71qxY8ma7mD1nhowTM+DTex9fVr36MevOrltXjl3QtW3ZnG/jNqx7t+bevW+aRk38Ke3EyCkj/j0bsuXkpGGDVr66Omzr0LEz5704e/acw4v+i1f6PDf389pJf79+uHbz6uWtu48+eT37+OEVUv68+T7n1p+Z9x987/FX34CivTYaewvOR994YZWn23f2rWfbfxQuNyFt0oXGmoS+Taegfh9yeOFrF+K224Ennpegicdx2KFnwMkIYYQCxoief+oVOKOHOyon45AoaigfjzCKlpCO6YkoYmbygcgggI1lGGSBVkIpnZbUTXkjWFIemN6RFg4435j59Scmj2T6uKSZa7Y5JptcbufYmWzG5+WRB0kmJX5wfgkmhlgW6pyPfxJ65aJzZkljc4eiZ9+bPW7I6JRlBkenkCUWOSKTdd6mqaBeAdnpnD9GCqmSWaa64qv+W3aXom8/OiQhqK2ieiKe3s2q4mh2Vrjqo0qSytVwL17aoIEArimsovQV2yWV0DLbUJi8GqqmrA9u+16aWmarLJ0kdmvsuVKBaxGQjSLqbqV8tiqvttcR22yebqKrL1OTdmSqn/S6Khut3i7aKbEIM7grraPu6/BRvn6EbKI7LmtxsZvm6CCLYt7qZbLmPiwyURiPDJG6JqesMkUh/9TvyjBn1DKEM/cUccw4B+YwyjbznPPP5e7rM9BETzU0YEcXrXRTSfc14tJQG13yeE9HbbVTVdM89dVcQ7x1cVl3LTbJX6PW8Nhou2yj1mGnjdHLbkt0Nthrxy1zvnbLXTf+3XPnPRHcfjO08I2DBx4Y3oYLfjPbNW/VpWnJkmtxvfYiJC3FGydOaeOnlX1si9shPLivo5s5a40V922452Y3XVWV01rppMLvJtknvfNWrHnm57KuVe53Zqz7s3sWr2euu2+ur+9Z5Y5rwJJPq6aDpyLp+tjM/5X9Vc5XjzzxEz+48LPXA7DI+einj37M2+dVOI6Xhgd8qNRbbjqcLzed/kCL8M+/+iJ7n3gE+JVczY9bUYKWuQ6Iu0AdZH39E0gEzec/Cf5vfb1b3AD3VqqAnc6DqIvT7XTkvWE1DoMTTGEFKWjBFgLwS6rrHAe7grwt0e9j7MJTuaKFuXspBIP+LAyiClsoxBX2T30TlGHbWrdEpZUvJPsj4hCLKEUjWvGFTpshcZroRM6d5HxUDOMUx2jFKkoQi3PhohId2EU2quSIZRRjHMloRjECkS1qRFr7VvZEj4CxjnSUIyDneMU7niWP2ttj8i4SyEYScpCQtOMfy4LIRHpxkRqJoCMjuUlBelKFURRLH9PoRkx2ZJKdTOUjPzlHw4SShqXcYixNmUlOEnIxdEyMKqvoFlAaknuzNBstUYLKVU6RL42syy7DOJgxTpJ7D7vkMC2iSWMaUZm31MwyU4hNQP4yKtI8yg7GSc5ymvOc6EynOtfJzna6U51+K+YgVbMI29STnrX+ag0ZJXNPXRLymSB5p0AHStCCGnQHJ0GoQgGw0IYy9KEOjShEJyrRilL0ohbNKEURmrdqzlNUoIMO7PBpQUv10ppJ/IhGV4rRlrL0pS6NaUQ5WpJxyvSmMM0pTneqUbvBEZKN6WcEk1PSAEwQmQBzJYCEap1UprQjNtWpVHlK1alK1CRWrapWsypVmrotld0MIjL5xxqmsses5utmdrYZEq5u9a1uzahXRxJVuNo1rnd9qE9Z+av+4dKeTaKNX7WJTVxaM4hQxati85pVrDL2sYvN6VzRtkvbDXZHTG3RUd8y1Pds86kaiSxkR7vSybZVtKglbUt9soLWuva1sH3+LUJiS9vYzra2uF3BbXNL24Ickbe1RepJz1pYO+3TuAzaJWgzUtfUOle1jn2udCFrWpy0FgC6zS52t6vd6x6ku9wNL3i/C97ycle33xWvesdbweuaV7d8WUFSJVjcSFEQgZu1Sz8xe1jzLRcj0w0wY6urUgEb2K6sXa+C0WsQ9y74vLN9sHnJK2EIE+S3Ep7Vfml1WVf6qrNlDatyA3rgEms1uqo1MVcJbBMHv9fCDa4wewviYgkzmMYyDu+FBVLj8pYVSpdNblhfo0J+NrW/AN2IilN8VxYnlslLbmxPXvxiClMZxji+8owJ0uMF35iCi9CyeNlqyzLztYj/BXD+lKH8VhSv+c0MdTJNuvzeLw9EzFu+M56xa2ce51i7O+bzn9FL5jMXupMegbOi45zQRS86wXvus6DxLOlIb9fKMv4yhiN9aCR7epBpvkhz2ezo1daU1KiOq5xnQuf1VvrPl25wpF9t6UC3uryE/vQnOVtBbRqT14hNdKqHbdVVh7bUcIY0rDGtZVovW9aDDnSYYb2CTgMVMtzU72G1GWpRI5vYF3UzuJFt7JjcWrzO3jOzbRzhWp+Rx7M28zaBbehrarvboh63vkvb6H3726LKVje0Kd3uZ9M43hWcNqd7XZjO2nCIQb2MkLV9ViAnl67fXrO4M57qcsPk3N1Nd47+101lkYv5f/COtlhD7JpjsvwxDh+YioKK73xzvMQe9/a/d+7QgI984JkuuMAPrnIXWrra/jup0pkjRV4v/VAST6t+nW7UzgzWoyIZ9c1RvXGe7zvnLgE5lrlM7dsWPcsG/6PYs5trIs6mqEVmemfgbvW6z/3ud2/mqbduYLBXROteX7LPTw70Zgv950QneMKPDvGG2/3um6X7cPPuIuEW8aQ11znfh931zaPW7yxZu6DT6+7EB530aY+g6L0L4qjrffJXbw/k6/50gK2Q3nQNPM9BPxHAex66Uy47yb18eMKb3vCLp3a2pV71yes96ve8b9X9A32yanvpmVez7pP+vfftf/0nqzd5hYdf5+KP/92TPn2QKW/9y0+/QNGPP+3fzx2JZ9/m3lcx7yXi+/xzfcrAZVvkFYCyNYAE6F2ydoAIyEJhpoCtlW1BBWy+1leAhXeCFRsbhlW/J2Cd53/StX8wI0/1RjnT0X6NJ4FPQl8U50/VEXkJ5YHjBoIQ0X8b+Fhxg3XWNoJ8NYGsdH/aV4PP1YFA2GQdpWs5CFYUx1c+CGAwiHP9NoSptVdHaIStBHvGtISa14Sc131Z9Qle+IVgGIZiOIZkWIZfqGpFKG9UqIYVZ0tYiH9daIZyOId0+AloqIFbBYYA8Al72Id8+Id+GIiAOIiCWIiDqIf+UnYVDriAH7GImmY+jjhFjqiDhYYSNOhSekiImmiInLiJnoiIbcaFOJWJnViKnmiKpmiHVSWDQnF0I+GKtoZwKgSLlHiFLCFVpHiKuoiKu6iJqihZT3hTX8iLxNiLxbiHXnhiWBF+r4hw/qNwfyaJ8TaFZvSGWahRw2iM2niMvZiMOiWEEJWM2ziO3MiLvyhTrGgSk4h6Q8dli2h+VxaLKjeLwleLZqYSLyWO5UiO/GiI5yhXwVhR+tiPBLmPfviPMTV453d87MaOiOeOZwdmjLdCzEiNQmSNP4iJBbmRBvmHCAlwohhRA9mRJEmQH7lR4OeMaNeOehaRd1aPLcT+jEVEixaJdSuxUiPJkTpZjCfZUOnYEJe4k0JpkCylkPFYeA0ZY6UHkYr3jBNJRBW5hp50i9hYklbJkUUZkhM1lFxZjgDJWipJdkvZkk25kg9JQTJJj+5WkxjJXDHVlXBJjF9ZUxYVl3aJij0VfGOZcmUplgbHlKd3YdCIZ9IYbTVJRC3Rf3e5mJyYlySRUTlZjI8BiLdBmW9hmXbBjz3JaGDpkn62l+mHfEr5l2gpi/5Dk1I5RS4BmRs5mX1Yma95mbGZmdy4mTaFhyJZkLvyCSfyh3UxiL+5j7YJfjAJmKJplsZnnEl5YU8ZRFHJhnYkE74Xmca4m725h8Hpm27+YZKOmXsSpZvZGZx8wYeFQZ6yaZ602Y8V9ZMkIZOjyZJ8GZjIuZD8k5anWY/U2Jah1VLguZ3Y6Z/jKR3oGYgBqp4YxZ4LMZ0EmZ3/GQC86Z8D+qAO6ocMaqBXpZekGZ/H6ZfwGZrLWZ/KR5HTmJorBBMKuo8V+psMOp4pCqFEaWqPyZ8oWqAkSKEAep7XwZ0HmpKeWXaVFpYvCZr2aUGoCZ0ppJ9KJqP82BiYmaMNGqGz2ZE9iaAKAXj92YnhyaIuKqFYCaM7QYsMWXLw+GDk52pj+l6FSXD5SRNWapA0CpwQyqQtOqEFCZIxmpszSqeFuJtOCqWauZ482pdBmqH+HiqmDpmcZKl+97mWJMqmGEWdplihBJoiftqntQmouLmVboqjcOqa2qmnXCqldvqlxZmoGzqoHeqe80llaRp0R4ikHNGm/fimNuqpT1qrG7mZnQepuiipTbqJNEqr5DhTgSqfHHqWGvqhqIqshUp8M4mfawirSYqnS7qlk5qe15qtXeqTAflQ/QmqKmqtn9qpuTqqOgGm7uiAZ6pgBniAu6WA0qiuFsmm37mpWxquoIqr+qqjF3qnFMWrpRisRgKsOCqs5oipANijG6GqKRFKh2mk0hqrj3qlTWqwAout4zil3YpQrRmgWpqvv2qpFhpuGNqhC1uqbySCD6uEOCH+q3lKmx97ih7LqV7ppVmnpC/rmgYroa5RrjsKluoqEusYE/uzsstkE3XZkde5s9fJryiZqQ0FsLuoGuMasExqleY6TYKpso0anTlxot+anr56rTQ7sj2nlRx7lWq7kwirtQkBREb7jDuRtIxZt4HYthg3sWu7t3+akG7LEEXbtUMUsQWmt3Zbt8MphFLLt4zrhXPJFUgUuV3hsILbE6zZuJj7iY+bt/V6uJnbh92JFVxrQa8kuiiUmoRLYjjruXcZum31lp/ruZtrFaMrSanbE1jEVrerUrDLupg7u6fVu7H7uVmpN140ShVRu45UulcRRaqUZCyzQOFkEEE5vIz+WbzeqZHW27jDeZsPEUMBEkwZwZbQWxW5e0FoFL1To0VVKlOL67va2L1UmhCXuAPvu73xC1OKQ0CbA76MBG/y2l7v2K4E+K7uSsABiL7puy78myriW7/3C7+d2L16hbb/KsE+y2/2E1Ic3MGV5BBwVKSQCKSfSagMu6yI6i8evMJclI8YLKo4Nb8IUb8MFcH464/fCCwsvMMdvBET9JwshK6mqqwlnKok/DY8nMRhQ8P2+8J9q78W3Lk3bLboGCJKfMUaBBHVJMINOGigJcTJaqjvyazqi8VmTB865cTHCIxQK4y5OMWCCIo57MBnfMUY8VPNWn5D5IqhdMJFzKz+fnw4dczDM5zGb+zEckxV4MiaddjIjiyGK7bBHHwyHuzDavlsKRR+R3o+YJzHZnqo9MkRK9y/oJOgcPXIqIzKkdzGUGiDpOy/Voy80jbEYrrHwjeLR9zJgazCLfLKecTEWohXixzMA/a9WSzJH/wQeNw/XKzJFImynoxr6zphJtHADUy/xBxgMnwQwNzKUGzMzMO+dyyihtlet3yauQzNuywSHCTOhZzN/+ev3lzMFRFM4ktNVdTMsyaJ6pzOoHkSgXLP3AzPH7ixBD1aUCGCQKx650yk/mzCR9wU3XzQc5y983yHT4GDPmpEzgyVIYqUYryqZDoVF01dBl3SU5X+0WG00H98crhsmM+kyxHNFBON0jb7uja9yk5BRvrsxc9saZqkeg9tsjRN0Sm2zdSb03m103XE0hs9k84Y1DKtsDSt1G41zFb9s03BtT1NafwM1ALco50s0Ub9eSdd1gjGFIHk1LD40k2Zyf1M1UtR02jtugFV1ya91XLU1Zn21bC2x0NNxkWd1V111oTtt0ux1u8I2EGLy0ErREN7cI8tFXR92FiN1xqc2EZauZvd2f61u5SN2fRMl6ItzIkdt56N2hcJ2k9R2aU9UZdtUY8w27Rd27Z927id27pN2xidFKr924L7TWeBV7td3MZ93LPd25xbVbUNAI/g3ND93NL+Hd3UPd3WXd3Ybd3NnYhIscycbY/g3WnCPRaV3dzXfd7Znd7ovd7bHYryjFPmrd7yvd7zPd+PUNiandrfDdyQNN5fIVXxTd8CXt8Dft73vYqGTVGzTeAMXuAN7twHXtFGodH6XeHhHdysLRTdvOAO3uEPXuARrshRPFG0/eEm7uHs/dwvhdQNy98XbuGHVr5bAVMljuInfuPSveArnuAIZeM+juPy/c0Tvt9EDuNGKONYQcM/vuRAft1CfrMaxeRS3uTQndlH4d1GnuUvvuXMm+Q3NeVgDuRWvtwSFeZmfuPYSxTKW+RczubLm+EtG+VUfuY/nuY43VJ0Pudo7lL+LG4SFN7mWu7izwvnNSHneX7o9Q28qltRHK7niC7gIZ61QrHmAKyAVLSOjm3pUhSJnubfEp1Rjf7ojp7dkX7Td83oHf4YU84XZl7q3Hrl1sTXzebXewbY8/hpSD7XLhXq6q3qQM7qc+7qENXnA+F7vI7eu7LkdUHnwr5QsN5JbN3QpVl0cL1wnZ3rSGHsDp7sJ77sjt7sFfzeC7Xt3v4I5W7iwH7meDsUqiTrNkbrOWbrimdt2F4Usl3fhSHd527j6a7n6x68EXXs1b3v+97gBR/mkg4UWL7SIxqT0s7MUQ2i1v7ihI6PqD7fBO8Wyq7xo67ips67ZY7x/c7qvm7+3Y3x3EJy3flO4M1O7CJB6WgJrRLU0c5ZdvKuqPpd8ZaI5yL/FtNN8itv8sCe8tQd9Pb974tO4vju89ltGz/v9Cei767h4QnvE3/eqoZny7Xm1oFZ7dEY3E4BeORuF+vt9NB9IeaO9s5t9g5e9VCFUQIv9AFA30A/92vP8UQ/9D5/8NXd8lfe7jI/wj7t0WAdk6ap5Upx8QLO9yi/9xyf9naf90xf9yCO9IXrUGNP4Cd/8OXu7enO9JDu9juxTNG+9ehM7RL/9Vmu848Z8gPe72VP+QP/+J4P+qCv3uDeeXEf3Yx/9r4O+9fR+GQf9QxOrEWx8Dwd+F3s1T/912H+Pe9gr+sBX+C9L/y1T/ZFP/mOz/aJ/rSkjflL//h3H/lGAvnn3fl4nyKV//G421+lv2xcL5peT5hsnu2uL99GDxCPAgx8BGBgAIMDAQgkuNAhwwAFIRY8WFGhxIcZHz3aAaDjR48ARI4kWdLkSZQjQa7cqNHlwYwwYU5MiBAjxYs1Fx686bInxpUeO6YkWtToUaSLACgVyXTpSKdKVwCYWpXqVatWm0JdkRXr16oroo70Whbs061Uza6ditbt2LRvoc51itTuXbxEg35s+TNmTpwIZ/LU2XNmYcJ+FTvcOzTv4x17ffqs6HAwwcqBd2JuSJPm4cUFJTt+XNq0yUX+cOXG7XqW7eq1rq/KbR07a9u3tl2r5j03bu/TwYWXjBwSZOiHmRFzznk5YmLoDUFPFm3c+vCjo6lrtFgx8PPO3RUeJi8e+cbRpLGvN8oUOG3ZsX/Xjo9VrO/6seHS19169f/3xqqLPQKR0u68zcyrCbyIErSoMAjFazA0jqz7SL0CSSpur762+84my8YDbEGJopvQQQ8z0i5DFktKDb/3+Mtvqv3yO4u2/uyDMcesAoTxx7QGbHFIDUfrELkHMZJpRO8SLLEzFBGsTjIiVbIwJClTzHJLLR+qsLEqWfTxNxvNmo9HtVRD06r91mxrTABhFDLMFg/skks876TuSwv+MazTyDwD1RNPPqmkkz2l4HRKRtto9G3N2cZiND7cooL0PjIzjTPIQ8Pc0MIjBxVV0PMKvZJOO0kddVUE0+sUUSDjvHRHN9Us86s2b/VP0VijmvNV9lJldVhV/XIVVWGLJXZZ7fwENi/3esWvK2qrtdZa2K7VFlsct/WWVm+35VVTuH59drhPg1J2XWavBAlVd7Fcll1Bm3X2XLteJFfaffvdFK3Kxv0XLpjkKnhgfpcyF9/Tmp33YVXtPTRdUOmF+E5TDWUYWn+ZKvg9mARW7cGOE+btoJEVElmnrRbeuDSKWbJ4Zg8zPtXTePmieWeNbF7p3peJ0ndglKU9eOX+rY42eem0Pmb635DxCxrdnD0KleeZfTYOaAJjrvhirL10+N2pk1pa6UydLjlthRBe+7+o3w6w6JbLxs5rmcHW+yetg4J37Kv3hrjvre02m+CKlBJvwYE87q6pyjRNXKTFASZ5KZQjN9jpJRGCvPGRJk864MdVM9y0sa0OO+vUi0O2ap0FZx32604X2jcJGZdQZfEW6R2/xX3vzikJHf999MuLp7zt4HUXUfOhbYe59cBXH5Vwv3FuXXa9t3ddepQSDb3og0NWeXmoyC84bszXb1v4AMYCHf32mX9/ed5Bj9z8xvd/HiHFxQ9/nAIfzGh3HO6xy3tcC5b3FrKR6iX+0CcQnNIBQ1LAk8ivbW+h21MeFEDP6QSEuHuf+kKIOBOmb371M96CPPi8AbKwg8Q7X1wwiBe8xYuC1pMSBS2YvSo5UGY7JGIRjXhEJBJRiIW7oYs4+MEYglBz/MsdDQEYQ/YZz39XVNrRMrfCzjnvcWRSmsuaeJIl6iyJa2RjG7GXMwauJ4dp/GEd6Zi6M8ZqjPBroQhZtrsTsoyFgrTiIMtXQz/qhHMwBGQWx3dFG+bRKHO0YyXvaMl4/Q2Tl+TkJpkoSfH9JoUDHCHL+KjH8x0SkoP8Yyo3WEoR0s19gkEkLIXHSoVJ8i6d5KUn7xjHu/VSmL6spC6jYkLPRW3+lp8ToCln2Mr8NdNyyYxmHwsJP1rar3/622AYS6k2M+pSJcMkJzHxqD1zprOcEhOnvqroQjFq8YV7VKFFrFlPkn3smc7D3xj1WbnKYVNq4izKOtV50GN5yqALRShBnyLFVZ5SkffzYuRStkKJusWbsrwf8jw3wopK83IQ1ej5wulQSjJUpRbU5Epdakdgng5pbqPpTG3Kr1c+rVwONVBDX8rLmAonpT4lKh0dOrSbyk2nS1VqXBzZ1OjxVC8/LSoxW1pVqi5QqqlJak2Z6tWmlhRtYHWLVCeJVbRyMqjBGWpW01o7nnL1q12l61znYtG5ntSsQnmrW7d3Vb/21V3+awWfXMNa18PaNbHk0uteBRvYsREWdZB9bNUcCxWuZpasiN2sYr2aWc1e1i5trSxVAVta1F5ItEIDbWtd+1q5cla2vYJtVFeLw9Tm9mcTo2xvL3jbKtVWuMMlbnGNa1vgBlO3y5WsAX0L2eYmV7rTBdZzdRvdvJDWuuWkbne9azftMpeop91uWrH7XfSmt2HihS5v2Ztb9cZXvkMKb3l7Sd73qvS88+Vvf61k38fud7QAdqt/DXzgXRK4svhVMDkFjGAIU7fBfX1wdib80ghnWMN8vTBaGZzfolZ4wyOWaof1614TV5XEK+ZvfUHcyQ+n+JcspnF8ZRxiFL9YsDV45rF3XXzjcwZRxz8VcY+NbDgg+7TIUx3yjo/8ZNH+uMlLjPGUzblkKGf5WUl2cI65nE4thxmlXx5mlcl8QCyLWc30tfKJX3dmGK9ZzhiUMpzhSiQ7q3XOewZfnn2ZZjT6+ZJ8JjR4Be1JM7d5k4AudKN3qeiFYjkgADs" alt="理想化模型"></p>
<p>在这个模型中，每一个线程都可以被看作为运行在不同的CPU上，然而即使是在多处理器上，这种情况也是很罕见的。但是实际上，通过模型所具备的某些特性，这种CPU和线程单一映射能够通过一些合理的方法去实现。例如，因为CPU的寄存器不能被另一个CPU直接访问，这种模型必须考虑到某个线程无法得知被另一个线程操作变量的值的情况。这种情况不仅仅存在于多处理器环境上，在单核CPU环境里，因为编译器和处理器的不可预测的行为也可能导致同样的情况。</p>
<p>Java内存模型没有具体讲述前面讨论的执行策略是由编译器，CPU，缓存控制器还是其它机制促成的。甚至没有用开发人员所熟悉的类，对象及方法来讨论。取而代之，Java内存模型中仅仅定义了线程和内存之间那种抽象的关系。众所周知，每个线程都拥有自己的工作存储单元（缓存和寄存器的抽象）来存储线程当前使用的变量的值。Java内存模型仅仅保证了代码指令与变量操作的有序性，大多数规则都只是指出什么时候变量值应该在内存和线程工作内存之间传输。这些规则主要是为了解决如下三个相互牵连的问题：</p>
<h3 id="原子性："><a href="#原子性：" class="headerlink" title="原子性："></a>原子性：</h3><p>哪些指令必须是不可分割的。在Java内存模型中，这些规则需声明仅适用于-—实例变量和静态变量，也包括数组元素，但不包括方法中的局部变量-—的内存单元的简单读写操作。</p>
<h3 id="可见性："><a href="#可见性：" class="headerlink" title="可见性："></a>可见性：</h3><p>在哪些情况下，一个线程执行的结果对另一个线程是可见的。这里需要关心的结果有，写入的字段以及读取这个字段所看到的值。</p>
<h3 id="有序性："><a href="#有序性：" class="headerlink" title="有序性："></a>有序性：</h3><p>在什么情况下，某个线程的操作结果对其它线程来看是无序的。最主要的乱序执行问题主要表现在读写操作和赋值语句的相互执行顺序上。</p>
<p>当正确的使用了同步，上面属性都会具有一个简单的特性：一个同步方法或者代码块中所做的修改对于使用了同一个锁的同步方法或代码块都具有原子性和可见性。同步方法或代码块之间的执行过程都会和代码指定的执行顺序保持一致。即使代码块内部指令也许是乱序执行的，也不会对使用了同步的其它线程造成任何影响。</p>
<p>当没有使用同步或者使用的不一致的时候，情况就会变得复杂。Java内存模型所提供的保障要比大多数开发人员所期望的弱，也远不及目前业界所实现的任意一款Java虚拟机。这样，开发人员就必须负起额外的义务去保证对象的一致性关系：对象间若有能被多个线程看到的某种恒定关系，所有依赖这种关系的线程就必须一直维持这种关系，而不仅仅由执行状态修改的线程来维持。</p>
<h3 id="Atomicity"><a href="#Atomicity" class="headerlink" title="Atomicity:"></a>Atomicity:</h3><p>除了long型字段和double型字段外，java内存模型确保访问任意类型字段所对应的内存单元都是原子的。这包括引用其它对象的引用类型的字段。此外，volatile long 和volatile double也具有原子性 。（虽然java内存模型不保证non-volatile long 和 non-volatile double的原子性，当然它们在某些场合也具有原子性。）（译注：non-volatile long在64位JVM，OS，CPU下具有原子性）</p>
<p>当在一个表达式中使用一个non-long或者non-double型字段时，原子性可以确保你将获得这个字段的初始值或者某个线程对这个字段写入之后的值；但不会是两个或更多线程在同一时间对这个字段写入之后产生混乱的结果值（即原子性可以确保，获取到的结果值所对应的所有bit位，全部都是由单个线程写入的）。但是，如下面（译注：指可见性章节）将要看到的，原子性不能确保你获得的是任意线程写入之后的最新值。 因此，原子性保证通常对并发程序设计的影响很小。</p>
<h3 id="Visibility"><a href="#Visibility" class="headerlink" title="Visibility"></a>Visibility</h3><p>只有在下列情况时，一个线程对字段的修改才能确保对另一个线程可见：</p>
<ul>
<li><p>一个写线程释放一个锁之后，另一个读线程随后获取了同一个锁。本质上，线程释放锁时会将强制刷新工作内存中的脏数据到主内存中，获取一个锁将强制线程装载（或重新装载）字段的值。锁提供对一个同步方法或块的互斥性执行，线程执行获取锁和释放锁时，所有对字段的访问的内存效果都是已定义的。</p>
</li>
<li><p>注意同步的双重含义：锁提供高级同步协议，同时在线程执行同步方法或块时，内存系统（有时通过内存屏障指令）保证值的一致性。这说明，与顺序程序设计相比较，并发程序设计与分布式程序设计更加类似。同步的第二个特性可以视为一种机制：一个线程在运行已同步方法时，它将发送和/或接收其他线程在同步方法中对变量所做的修改。从这一点来说，使用锁和发送消息仅仅是语法不同而已。</p>
</li>
</ul>
<ul>
<li><p>如果把一个字段声明为volatile型，线程对这个字段写入后，在执行后续的内存访问之前，线程必须刷新这个字段且让这个字段对其他线程可见（即该字段立即刷新）。每次对volatile字段的读访问，都要重新装载字段的值。</p>
</li>
<li><p>一个线程首次访问一个对象的字段，它将读到这个字段的初始值或被某个线程写入后的值。<br>此外，把还未构造完成的对象的引用暴露给某个线程，这是一个错误的做法 (see 2.1.2)。在构造函数内部开始一个新线程也是危险的，特别是这个类可能被子类化时。Thread.start有如下的内存效果：调用start方法的线程释放了锁，随后开始执行的新线程获取了这个锁。如果在子类构造函数执行之前，可运行的超类调用了new Thread(this).start()，当run方法执行时，对象很可能还没有完全初始化。同样，如果你创建且开始一个新线程T，这个线程使用了在执行start之后才创建的一个对象X。你不能确信X的字段值将能对线程T可见。除非你把所有用到X的引用的方法都同步。如果可行的话，你可以在开始T线程之前创建X。</p>
</li>
<li><p>线程终止时，所有写过的变量值都要刷新到主内存中。比如，一个线程使用Thread.join来终止另一个线程，那么第一个线程肯定能看到第二个线程对变量值得修改。(see §4.3.2)</p>
</li>
</ul>
<p>注意，在同一个线程的不同方法之间传递对象的引用，永远也不会出现内存可见性问题。<br>内存模型确保上述操作最终会发生，一个线程对一个特定字段的特定更新，最终将会对其他线程可见，但这个“最终”可能是很长一段时间。线程之间没有同步时，很难保证对字段的值能在多线程之间保持一致（指写线程对字段的写入立即能对读线程可见）。特别是，如果字段不是volatile或没有通过同步来访问这个字段，在一个循环中等待其他线程对这个字段的写入，这种情况总是错误的(see 3.2.6)。</p>
<p>在缺乏同步的情况下，模型还允许不一致的可见性。比如，得到一个对象的一个字段的最新值，同时得到这个对象的其他字段的过期的值。同样，可能读到一个引用变量的最新值，但读取到这个引用变量引用的对象的字段的过期值。</p>
<p>不管怎样，线程之间的可见性并不总是失效（指线程即使没有使用同步，仍然有可能读取到字段的最新值），内存模型仅仅是允许这种失效发生而已。因此，即使多个线程之间没有使用同步，也不保证一定会发生内存可见性问题（指线程读取到过期的值），java内存模型仅仅是允许内存可见性问题发生而已。在很多当前的JVM实现和java执行平台中，甚至是在那些使用多处理器的JVM和平台中，也很少出现内存可见性问题。共享同一个CPU的多个线程使用公共的缓存，缺少强大的编译器优化，以及存在强缓存一致性的硬件，这些都会使线程更新后的值能够立即在多线程之间传递。这使得测试基于内存可见性的错误是不切实际的，因为这样的错误极难发生。或者这种错误仅仅在某个你没有使用过的平台上发生，或仅在未来的某个平台上发生。这些类似的解释对于多线程之间的内存可见性问题来说非常普遍。没有同步的并发程序会出现很多问题，包括内存一致性问题。</p>
<h3 id="Ordering"><a href="#Ordering" class="headerlink" title="Ordering"></a>Ordering</h3><p>有序性规则表现在以下两种场景: 线程内和线程间</p>
<p> 从某个线程的角度看方法的执行，指令会按照一种叫“串行”（as-if-serial）的方式执行，此种方式已经应用于顺序编程语言。<br> 这个线程“观察”到其他线程并发地执行非同步的代码时，任何代码都有可能交叉执行。唯一起作用的约束是：对于同步方法，同步块以及volatile字段的操作仍维持相对有序。</p>
<p>再次提醒，这些仅是最小特性的规则。具体到任何一个程序或平台上，可能存在更严格的有序性规则。所以你不能依赖它们，因为即使你的代码遵循了这些更严格的规则，仍可能在不同特性的JVM上运行失败，而且测试非常困难。</p>
<p>需要注意的是，线程内部的观察视角被JLS [1] 中其他的语义的讨论所采用。例如，算术表达式的计算在线程内看来是从左到右地执行操作（JLS 15.6章节），而这种执行效果是没有必要被其他线程观察到的。</p>
<p>仅当某一时刻只有一个线程操作变量时，线程内的执行表现为串行。出现上述情景，可能是因为使用了同步，互斥体[2] 或者纯属巧合。当多线程同时运行在非同步的代码里进行公用字段的读写时，会形成一种执行模式。在这种模式下，代码会任意交叉执行，原子性和可见性会失效，以及产生竞态条件。这时线程执行不再表现为串行。</p>
<p>尽管JLS列出了一些特定的合法和非法的重排序，如果碰到所列范围之外的问题，会降低以下这条实践保证 ：运行结果反映了几乎所有的重排序产生的代码交叉执行的情况。所以，没必要去探究这些代码的有序性。</p>
<p>译注：</p>
<p>【1】JLS：Java Language Specification ，Java语言规范</p>
<p>【2】互斥体：原文为structural exclusion，译者认为意同 mutual exclusion ，详见 互斥体。</p>
<h3 id="Volatile"><a href="#Volatile" class="headerlink" title="Volatile"></a>Volatile</h3><p>从原子性，可见性和有序性的角度分析，声明为volatile字段的作用相当于一个类通过get/set同步方法保护普通字段，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">VFloat</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> value;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">final</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">float</span> f)</span> </span>&#123; value = f; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">final</span> <span class="keyword">synchronized</span> <span class="keyword">float</span> <span class="title">get</span><span class="params">()</span>       </span>&#123; <span class="keyword">return</span> value; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>与使用synchronized相比，声明一个volatile字段的区别在于没有涉及到锁操作。但特别的是对volatile字段进行“++”这样的读写操作不会被当做原子操作执行。</p>
<p>另外，有序性和可见性仅对volatile字段进行一次读取或更新操作起作用。声明一个引用变量为volatile，不能保证通过该引用变量访问到的非volatile变量的可见性。同理，声明一个数组变量为volatile不能确保数组内元素的可见性。volatile的特性不能在数组内传递，因为数组里的元素不能被声明为volatile。</p>
<p>由于没有涉及到锁操作，声明volatile字段很可能比使用同步的开销更低，至少不会更高。但如果在方法内频繁访问volatile字段，很可能导致更低的性能，这时还不如锁住整个方法。</p>
<p>如果你不需要锁，把字段声明为volatile是不错的选择，但仍需要确保多线程对该字段的正确访问。可以使用volatile的情况包括：</p>
<ul>
<li>该字段不遵循其他字段的不变式。</li>
<li>对字段的写操作不依赖于当前值。</li>
<li>没有线程违反预期的语义写入非法值。</li>
<li>读取操作不依赖于其它非volatile字段的值。</li>
</ul>
<p>当只有一个线程可以修改字段的值，其它线程可以随时读取，那么把字段声明为volatile是合理的。例如，一个名叫Thermometer(中文：体温计)的类，可以声明temperature字段为volatile。正如在3.4.2节所讨论，一个volatile字段很适合作为完成某些工作的标志。另一个例子在4.4节有描述，通过使用轻量级的执行框架使某些同步工作自动化，但是仍需把结果字段声明为volatile，使其对各个任务都是可见的。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/07/27/jsr133faq/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ZP">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/27/jsr133faq/" class="post-title-link" itemprop="url">JSR133（Java内存模型）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2020-07-27 16:08:14 / 修改时间：16:12:09" itemprop="dateCreated datePublished" datetime="2020-07-27T16:08:14+08:00">2020-07-27</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>原文出处：<a target="_blank" rel="noopener" href="http://www.cs.umd.edu/~pugh/java/memoryModel/jsr-133-faq.html">http://www.cs.umd.edu/~pugh/java/memoryModel/jsr-133-faq.html</a></p>
<h1 id="JSR-133（Java内存模型）常见问题解答Jeremy-Manson和Brian-Goetz，2004年2月"><a href="#JSR-133（Java内存模型）常见问题解答Jeremy-Manson和Brian-Goetz，2004年2月" class="headerlink" title="JSR 133（Java内存模型）常见问题解答Jeremy Manson和Brian Goetz，2004年2月"></a>JSR 133（Java内存模型）常见问题解答Jeremy Manson和Brian Goetz，2004年2月</h1><h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><h5 id="什么是内存模型？"><a href="#什么是内存模型？" class="headerlink" title="什么是内存模型？"></a><a href="#1">什么是内存模型？</a></h5><h5 id="像C这样的其他语言是否有内存模型？"><a href="#像C这样的其他语言是否有内存模型？" class="headerlink" title="像C这样的其他语言是否有内存模型？"></a><a href="#2">像C这样的其他语言是否有内存模型？</a></h5><h5 id="什么是JSR-133？"><a href="#什么是JSR-133？" class="headerlink" title="什么是JSR 133？"></a><a href="#3">什么是JSR 133？</a></h5><h5 id="重新排序是什么意思？"><a href="#重新排序是什么意思？" class="headerlink" title="重新排序是什么意思？"></a><a href="#4">重新排序是什么意思？</a></h5><h5 id="旧的记忆模型出了什么问题？"><a href="#旧的记忆模型出了什么问题？" class="headerlink" title="旧的记忆模型出了什么问题？"></a><a href="#5">旧的记忆模型出了什么问题？</a></h5><h5 id="错误同步是什么意思？"><a href="#错误同步是什么意思？" class="headerlink" title="错误同步是什么意思？"></a><a href="#6">错误同步是什么意思？</a></h5><h5 id="同步有什么作用？"><a href="#同步有什么作用？" class="headerlink" title="同步有什么作用？"></a><a href="#7">同步有什么作用？</a></h5><h5 id="Final字段如何显示更改其值？"><a href="#Final字段如何显示更改其值？" class="headerlink" title="Final字段如何显示更改其值？"></a><a href="#8">Final字段如何显示更改其值？</a></h5><h5 id="最终字段如何在新的JMM下工作？"><a href="#最终字段如何在新的JMM下工作？" class="headerlink" title="最终字段如何在新的JMM下工作？"></a><a href="#9">最终字段如何在新的JMM下工作？</a></h5><h5 id="Volatile有什么作用？"><a href="#Volatile有什么作用？" class="headerlink" title="Volatile有什么作用？"></a><a href="#10">Volatile有什么作用？</a></h5><h5 id="新内存模型是否修复了“双重检查锁定”问题？"><a href="#新内存模型是否修复了“双重检查锁定”问题？" class="headerlink" title="新内存模型是否修复了“双重检查锁定”问题？"></a><a href="#11">新内存模型是否修复了“双重检查锁定”问题？</a></h5><h5 id="如果我正在编写VM怎么办？-我为什么要在乎？"><a href="#如果我正在编写VM怎么办？-我为什么要在乎？" class="headerlink" title="如果我正在编写VM怎么办？ 我为什么要在乎？"></a><a href="#12">如果我正在编写VM怎么办？ 我为什么要在乎？</a></h5><h4 id="1-什么是内存模型"><a href="#1-什么是内存模型" class="headerlink" title="1. 什么是内存模型?"></a><span id="1">1. 什么是内存模型?</span></h4><blockquote>
<blockquote>
<p>在多处理器系统中，处理器通常具有一层或多层内存高速缓存，这通过加快对数据的访问（因为数据更接近处理器）和<br>减少共享内存总线上的流量来提高性能（因为可以满足许多内存操作）通过本地缓存。内存缓存可以极大地提高性能，<br>但它们带来了许多新的挑战。例如，当两个处理器同时检查相同的内存位置时会发生什么？在什么条件下他们会看到相同的值?</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>在处理器级别，存储器模型定义了必要且充分的条件，用于知道当前处理器对其他处理器的存储器写入是可见的，并且当前处理器的写入对于其他处理器是可见的。某些处理器表现出强大的内存模型，其中所有处理器始终看到任何给定内存位置的完全相同的值。其他处理器表现出较弱的内存模型，其中需要特殊指令（称为内存屏障）来刷新或使本地处理器高速缓存无效，以便查看其他处理器进行的写入或使该处理器的写入对其他处理器可见。这些内存屏障通常在执行锁定和解锁操作时执行;对于高级语言的程序员来说，它们是不可见的。</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>由于减少了对内存屏障的需求，有时可以更容易地为强内存模型编写程序。然而，即使在一些最强大的内存模型上，通常也需要内存屏障;很多时候他们的位置是违反直觉的。处理器设计的最新趋势鼓励了较弱的内存模型，因为它们为缓存一致性所做的放松允许跨多个处理器和更大内存量的更大可扩展性。</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>编译器重新排序代码时，写入对另一个线程可见的问题更加复杂。例如，编译器可能会决定稍后在程序中移动写操作更有效;只要此代码动作不会改变程序的语义，就可以自由地执行此操作。如果编译器推迟操作，则另一个线程在执行之前不会看到它;这反映了缓存的效果。</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>此外，可以在程序中更早地移动对存储器的写入;在这种情况下，其他线程可能会在程序实际“发生”之前看到写入。所有这些灵活性都是通过设计 - 通过为编译器，运行时或硬件提供以最佳顺序执行操作的灵活性，在内存模型的范围内，我们可以实现更高的性能。</p>
</blockquote>
</blockquote>
<p>以下代码中可以看到一个简单的示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Reordering</span> </span>&#123;</span><br><span class="line">	  <span class="keyword">int</span> x = <span class="number">0</span>, y = <span class="number">0</span>;</span><br><span class="line">	  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		x = <span class="number">1</span>;</span><br><span class="line">		y = <span class="number">2</span>;</span><br><span class="line">	  &#125;</span><br><span class="line"></span><br><span class="line">	  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reader</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> r1 = y;</span><br><span class="line">		<span class="keyword">int</span> r2 = x;</span><br><span class="line">	  &#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<blockquote>
<p>假设这个代码同时在两个线程中执行，并且y的读取看到值2.因为这个写入在写入x之后，程序员可能会认为x的读取必须看到值1.但是，写入可能已被重新排序。如果发生这种情况，则可能会发生对y的写入，可能会读取两个变量，然后可能会发生对x的写入。结果是r1的值为2，但r2的值为0</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>Java内存模型描述了多线程代码中哪些行为是合法的，以及线程如何通过内存进行交互。它描述了程序中变量之间的关系，以及在真实计算机系统中存储和检索它们与存储器或寄存器之间的低级细节。它以一种可以使用各种硬件和各种编译器优化正确实现的方式实现。</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>Java包括几种语言结构，包括volatile，final和synchronized，它们旨在帮助程序员描述程序对编译器的并发性要求。 Java内存模型定义了volatile和synchronized的行为，更重要的是，确保正确同步的Java程序在所有处理器体系结构上正确运行。</p>
</blockquote>
</blockquote>
<hr>
<h4 id="2-像C这样的其他语言是否有内存模型？"><a href="#2-像C这样的其他语言是否有内存模型？" class="headerlink" title="2. 像C这样的其他语言是否有内存模型？"></a><span id="2">2. 像C这样的其他语言是否有内存模型？</span></h4><blockquote>
<blockquote>
<p>大多数其他编程语言（如C和C）的设计并未直接支持多线程。这些语言针对编译器和体系结构中发生的各种重新排序提供的保护很大程度上取决于所使用的线程库（例如pthread），所使用的编译器以及运行代码的平台所提供的保证。</p>
</blockquote>
</blockquote>
<hr>
<h4 id="3-什么是JSR-133？"><a href="#3-什么是JSR-133？" class="headerlink" title="3. 什么是JSR 133？"></a><span id="3">3. 什么是JSR 133？</span></h4><blockquote>
<blockquote>
<p>自1997年以来，在Java语言规范的第17章中定义的Java内存模型中发现了几个严重的缺陷。这些缺陷允许混淆行为（例如观察到最终字段改变其值）并破坏编译器执行常见优化的能力。</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>Java内存模型是一项雄心勃勃的事业;这是编程语言规范第一次尝试合并一个内存模型，该内存模型可以为各种体系结构的并发提供一致的语义。不幸的是，定义一致且直观的内存模型证明比预期困难得多。 JSR 133为Java语言定义了一个新的内存模型，它修复了早期内存模型的缺陷。为了做到这一点，需要改变final和volatile的语义。</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>完整的语义可以在<a target="_blank" rel="noopener" href="http://www.cs.umd.edu/users/pugh/java/memoryModel">http://www.cs.umd.edu/users/pugh/java/memoryModel</a><br>上找到，但正式的语义不是胆小的。令人惊讶和发人深省的是，发现像同步一样复杂的看似简单的概念。幸运的是，您无需了解形式语义的细节 - JSR 133的目标是创建一组形式语义，为易变，同步和最终工作提供直观的框架。</p>
</blockquote>
</blockquote>
<pre><code>JSR 133的目标包括: </code></pre>
<blockquote>
<blockquote>
<p>保持现有的安全保障，如类型安全，并加强其他安全保障。例如，变量值可能不会“凭空”创建：某             个线程观察到的变量的每个值必须是某个线程可以合理放置的值。</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>正确同步程序的语义应尽可能简单直观。</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>应定义不完全或不正确同步程序的语义，以便最大限度地减少潜在的安全隐患。</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>程序员应该能够自信地理解多线程程序如何与内存交互。</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>应该可以在广泛的流行硬件架构中设计正确的，高性能的JVM实现。</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>应提供初始化安全性的新保证。如果一个对象被正确构造（这意味着对它的引用在构造期间不会被转义），那么看到对该对象的引用的所有线程也将看到在构造函数中设置的最终字段的值，而不需要同步。<br>对现有代码的影响应该是最小的。</p>
</blockquote>
</blockquote>
<hr>
<h4 id="4-重新排序是什么意思？"><a href="#4-重新排序是什么意思？" class="headerlink" title="4. 重新排序是什么意思？"></a><span id="4">4. 重新排序是什么意思？</span></h4><blockquote>
<blockquote>
<p><kbd>在许多情况下</kbd>，对程序变量（对象实例字段，类静态字段和数组元素）的访问可能看起来以与程序指定的顺序不同的顺序执行。编译器可以自由地使用优化名称中的指令顺序。处理器可能在某些情况下不按顺序执行指令。可以以不同于程序指定的顺序在寄存器，处理器高速缓存和主存储器之间移动数据。</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>例如，如果一个线程写入字段a然后写入字段b，并且b的值不依赖于a的值，则编译器可以自由地重新排序这些操作，并且缓存可以自由地将b刷新到main记忆之前的。有许多潜在的重新排序源，例如编译器，JIT和缓存。</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>编译器，运行时和硬件应该合谋创建as-if-serial语义的假象，这意味着在单线程程序中，程序不应该能够观察重新排序的影响。但是，重新排序可能会在错误同步的多线程程序中发挥作用，其中一个线程能够观察其他线程的影响，并且可能能够检测到变量访问对于其他线程可见，其顺序与执行或指定的顺序不同程序</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>大多数时候，一个线程并不关心对方在做什么。但是当它发生时，这就是同步的目的。</p>
</blockquote>
</blockquote>
<hr>
<h4 id="5-旧的记忆模型出了什么问题？"><a href="#5-旧的记忆模型出了什么问题？" class="headerlink" title="5. 旧的记忆模型出了什么问题？"></a><span id="5">5. 旧的记忆模型出了什么问题？</span></h4><blockquote>
<blockquote>
<p>旧内存模型存在几个严重问题。它很难理解，因此被广泛侵犯。例如，在许多情况下，旧模型不允许在每个JVM中进行各种重新排序。关于旧模型含义的混淆是迫使JSR-133形成的原因</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>例如，一个广泛持有的信念是，如果使用最终字段，则线程之间的同步是不必要的，以保证另一个线程将看到该字段的值。虽然这是一个合理的假设和合理的行为，实际上我们希望事情如何运作，但在旧的记忆模型下，却根本不是真的。旧内存模型中的任何内容都没有处理最终字段与任何其他字段不同 - 这意味着同步是确保所有线程都能看到构造函数写入的最终字段值的唯一方法。因此，线程可以看到该字段的默认值，然后稍后查看其构造值。这意味着，例如，像String这样的不可变对象可能会改变它们的价值 - 这确实是一个令人不安的前景。</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>旧的内存模型允许使用非易失性读写重新排序易失性写入，这与大多数开发人员对volatile的直觉不一致，因此引起混淆</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>最后，正如我们将要看到的，程序员对程序错误同步时可能发生的事情的直觉常常是错误的。 JSR-133的目标之一是引起人们对这一事实的关注。</p>
</blockquote>
</blockquote>
<h4 id="6-错误的同步"><a href="#6-错误的同步" class="headerlink" title="6. 错误的同步"></a><span id="6">6. 错误的同步</span></h4><blockquote>
<blockquote>
<p>错误地同步代码对不同的人来说意味着不同的东西。当我们在Java内存模型的上下文中讨论错误同步的代码时，我们指的是任何代码，其中一个线程写入一个变量，另一个线程读取相同的变量，而写入和读取不是通过同步排序当违反这些规则时，我们说我们对该变量进行了数据竞争。具有数据争用的程序是错误同步的程序。</p>
</blockquote>
</blockquote>
<h4 id="7-Synchronization做了什么？"><a href="#7-Synchronization做了什么？" class="headerlink" title="7. Synchronization做了什么？"></a><span id="7">7. Synchronization做了什么？</span></h4><blockquote>
<blockquote>
<p>同步有几个方面。最常见的是互斥 - 只有一个线程可以同时保存一个监视器，因此在监视器上进行同步意味着一旦一个线程进入受监视器保护的同步块，其他线程就无法进入受该监视器保护的块直到第一个线程退出同步块</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>但是，除了相互排斥之外，还有更多的同步。同步确保线程在同步块之前或期间的内存写入以可预测的方式显示给在同一监视器上同步的其他线程。在我们退出synchronized块之后，我们释放了监视器，它具有将缓存刷新到主内存的效果，因此该线程所做的写操作对其他线程是可见的。在我们进入同步块之前，我们获取监视器，它具有使本地处理器高速缓存无效的效果，以便从主存储器重新加载变量。然后，我们将能够看到前一版本中显示的所有写入。</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>在缓存方面讨论这个问题，听起来好像这些问题只影响多处理器机器。但是，可以在单个处理器上轻松看到重新排序效果。例如，编译器无法在获取之前或发布之后移动代码。当我们说获取和释放对缓存起作用时，我们使用速记来表示许多可能的影响。</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>新的内存模型语义在内存操作（读取字段，写入字段，锁定，解锁）和其他线程操作（启动和加入）上创建部分排序，其中一些操作据说在其他操作之前发生。当一个动作发生在另一个动作之前时，第一个动作保证在第二个动作之前被命令并且可见。这种排序的规则如下：</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<ul>
<li>线程中的每个操作都发生在该线程中的每个操作之前，该操作在程序的顺序中稍后出现。 </li>
</ul>
</blockquote>
</blockquote>
<ul>
<li>监视器上的解锁发生在同一监视器上的每个后续锁定之前。 </li>
<li>对易失性字段的写入在每次后续读取相同的易失性之前发生。 </li>
<li>在线程上调用start（）发生在启动线程中的任何操作之前。 </li>
<li>线程中的所有操作都发生在任何其他线程从该线程上的join（）成功返回之前。 这意味着在退出同步块之前对线程可见的任何内存操作在进入由同一监视器保护的同步块之后对任何线程都是可见的，因为所有内存操作都在发布之前发生，并且释放发生在获得。</li>
</ul>
<blockquote>
<blockquote>
<p>另一个含义是，一些人用来强制内存屏障的以下模式不起作用：</p>
</blockquote>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">synchronized (new Object()) &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>这实际上是一个无操作，并且您的编译器可以完全删除它，因为编译器知道没有其他线程将在同一监视器上同步。您必须为一个线程设置一个before-before关系，以查看另一个线程的结果。</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>重要说明：请注意，两个线程在同一监视器上同步以便正确设置before-before关系非常重要。情况并非如此，在对象X上同步时，线程A可见的所有内容在对象Y上同步后变为对线程B可见。释放和获取必须“匹配”（即，在同一监视器上执行）以使正确的语义。否则，代码会有数据竞争。</p>
</blockquote>
</blockquote>
<hr>
<h4 id="8-最终字段如何显示更改其值"><a href="#8-最终字段如何显示更改其值" class="headerlink" title="8.最终字段如何显示更改其值"></a><span id="8">8.最终字段如何显示更改其值</span></h4><blockquote>
<blockquote>
<p>可以看到最终字段值的变化的最佳示例之一涉及String类的一个特定实现。 String可以实现为具有三个字段的对象 - 字符数组，该数组的偏移量和长度。以这种方式实现String的基本原理是，它允许多个String和StringBuffer对象共享相同的字符数组，并避免额外的对象分配和复制，而不是只有字符数组。因此，例如，方法String.substring（）可以通过创建一个新的字符串来实现，该字符串与原始字符串共享相同的字符数组，并且只是长度和偏移字段不同。对于String，这些字段都是最终字段。</p>
</blockquote>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String s1 &#x3D; &quot;&#x2F;usr&#x2F;tmp&quot;;</span><br><span class="line">String s2 &#x3D; s1.substring(4); </span><br></pre></td></tr></table></figure>
<blockquote>
<blockquote>
<p>字符串s2的偏移量为4，长度为4.但是，在旧模型下，另一个线程可能会将偏移量视为默认值为0，然后再看到正确的值4，它看起来好像字符串“/ usr”变为“/ tmp”</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>最初的Java内存模型允许这种行为;几个JVM已经表现出这种行为。新的Java内存模型使这非法</p>
</blockquote>
</blockquote>
<h4 id="9-最终字段如何在新的JMM下工作"><a href="#9-最终字段如何在新的JMM下工作" class="headerlink" title="9.最终字段如何在新的JMM下工作?"></a><span id="9">9.最终字段如何在新的JMM下工作?</span></h4><p>对象的最终字段的值在其构造函数中设置。假设对象是“正确”构造的，一旦构造了一个对象，分配给构造函数中最终字段的值对于所有其他线程都是可见的，而不进行同步。此外，这些最终字段引用的任何其他对象或数组的可见值将至少与最终字段一样是最新的。</p>
<blockquote>
<blockquote>
<p>对象的正确构造意味着什么？它只是意味着在构造过程中不允许对正在构造的对象的引用“逃逸”。 （有关示例，请参阅安全构造技术。）换句话说，不要在另一个线程可能看到它的任何地方放置对正在构造的对象的引用;不要将它分配给静态字段，不要将其注册为任何其他对象的侦听器，依此类推。这些任务应在构造函数完成后完成，而不是在构造函数中完成。</p>
</blockquote>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FinalFieldExample</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> x;</span><br><span class="line">  <span class="keyword">int</span> y;</span><br><span class="line">  <span class="keyword">static</span> FinalFieldExample f;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">FinalFieldExample</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    x = <span class="number">3</span>;</span><br><span class="line">    y = <span class="number">4</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">writer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    f = <span class="keyword">new</span> FinalFieldExample();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">reader</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (f != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">int</span> i = f.x;</span><br><span class="line">      <span class="keyword">int</span> j = f.y;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p><strong>上面的类是如何使用最终字段的示例。线程执行读取器保证看到f.x的值3，因为它是最终的。不能保证看到y的值为4，因为它不是最终的。如果FinalFieldExample的构造函数如下所示：</strong></p>
</blockquote>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">FinalFieldExample</span><span class="params">()</span> </span>&#123; <span class="comment">// bad!</span></span><br><span class="line">  x = <span class="number">3</span>;</span><br><span class="line">  y = <span class="number">4</span>;</span><br><span class="line">  <span class="comment">// bad construction - allowing this to escape</span></span><br><span class="line">  global.obj = <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<blockquote>
<ul>
<li>然后从global.obj读取对此的引用的线程不保证看到3表示x。</li>
</ul>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>能够看到字段的正确构造值是很好的，但如果字段本身是引用，那么您还希望代码查看它指向的对象（或数组）的最新值。如果您的字段是最终字段，则也可以保证。因此，您可以拥有一个指向数组的最终指针，而不必担心其他线程看到数组引用的正确值，但是数组内容的值不正确。同样，在这里“正确”，我们的意思是“对象的构造函数结束时的最新”，而不是“最新的可用值”。</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>现在，说完所有这些，如果在一个线程构造一个不可变对象（即一个只包含最终字段的对象）之后，你想确保所有其他线程都能正确看到它，你通常还需要使用同步。例如，没有其他方法可以确保第二个线程可以看到对不可变对象的引用。程序从最终字段获得的保证应该仔细调整，仔细了解如何在代码中管理并发。</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>如果要使用JNI更改最终字段，则没有已定义的行为。</p>
</blockquote>
</blockquote>
<h4 id="10-Volatile的作用"><a href="#10-Volatile的作用" class="headerlink" title="10. Volatile的作用"></a><span id="10">10. Volatile的作用</span></h4><blockquote>
<blockquote>
<p>易失性字段是用于在线程之间传递状态的特殊字段。每次读取volatile都会看到任何线程对该volatile的最后一次写入;实际上，它们被程序员指定为字段，由于缓存或重新排序而无法接受看到“陈旧”值的字段。禁止编译器和运行时将它们分配到寄存器中。他们还必须确保在写入之后，将它们从缓存中刷新到主内存，这样它们就可以立即对其他线程可见。类似地，在读取volatile字段之前，必须使高速缓存无效，以便主存储器中的值（而不是本地处理器高速缓存）是所见的值。重新排序对volatile变量的访问还有其他限制。</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>在旧的内存模型下，对volatile变量的访问不能相互重新排序，但可以使用非易失性变量访问重新排序。这破坏了易失性字段作为从一个线程到另一个线程发信号通知的手段的有用性。</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>在新的内存模型下，仍然可以确定volatile变量不能相互重新排序。不同之处在于现在不再那么容易重新排序它们周围的正常字段访问。写入易失性字段与监视器释放具有相同的记忆效应，从易失性字段读取具有与监视器获取相同的记忆效应。实际上，因为新的存储器模型对具有其他字段访问（易失性或非易失性）的易失性字段访问的重新排序施加了更严格的约束，所以当线程A写入易失性字段f时线程A可见的任何内容在读取f时对线程B可见。</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>这是一个如何使用volatile字段的简单示例:</p>
</blockquote>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VolatileExample</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> x = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">volatile</span> <span class="keyword">boolean</span> v = <span class="keyword">false</span>;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    x = <span class="number">42</span>;</span><br><span class="line">    v = <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reader</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (v == <span class="keyword">true</span>) &#123;</span><br><span class="line">      <span class="comment">//uses x - guaranteed to see 42.</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>假设一个线程正在调用writer，另一个线程正在调用reader。写入v中的写入将x的写入释放到内存，而v的读取从内存中获取该值。因此，如果读者看到v的值为true，那么也可以保证看到在它之前发生的写入42。在旧的内存模型下，这不可能是真的。如果v不是volatile，那么编译器可以重新排序writer中的写入，读者对x的读取可能会看到0。</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>实际上，易失性的语义已经大大加强，几乎达到了同步的水平。出于可见性的目的，每次读取或写入易失性字段的行为类似于“半”同步。</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>重要说明：请注意，两个线程都必须访问相同的volatile变量才能正确设置before-before关系。情况并非如此，线程A在写入易失性字段f时可见的所有内容在读取易失性字段g后变为线程B可见。释放和获取必须“匹配”（即，在相同的易失性字段上执行）以具有正确的语义。</p>
</blockquote>
</blockquote>
<h4 id="11-新内存模型是否修复了“双重检查锁定”问题？"><a href="#11-新内存模型是否修复了“双重检查锁定”问题？" class="headerlink" title="11. 新内存模型是否修复了“双重检查锁定”问题？ "></a><span id="11">11. 新内存模型是否修复了“双重检查锁定”问题？ </span></h4><blockquote>
<blockquote>
<p>（臭名昭着的）双重检查锁定习惯用法（也称为多线程单例模式）是一种旨在支持延迟初始化同时避免同步开销的技巧。在早期的JVM中，同步很慢，开发人员急于将其删除 - 可能过于急切。双重检查的锁定习语如下所示：</p>
</blockquote>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// double-checked-locking - don&#x27;t do this!</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Something instance = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Something <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (instance == <span class="keyword">null</span>)</span><br><span class="line">        instance = <span class="keyword">new</span> Something();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> instance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>这看起来非常聪明 - 在公共代码路径上避免了同步。它只有一个问题 - 它不起作用。为什么不？最明显的原因是初始化实例和写入实例字段的写入可以由编译器或高速缓存重新排序，这将产生返回看似部分构造的Something的效果。结果是我们读取了一个未初始化的对象。还有很多其他原因导致错误，以及为什么对它进行算法修正是错误的。使用旧的Java内存模型无法修复它。更多深入的信息可以在双重检查锁定中找到：聪明，但破损和“双重检查锁定已损坏”声明</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>许多人认为使用volatile关键字可以消除尝试使用双重检查锁定模式时出现的问题。在1.5之前的JVM中，volatile不能确保它有效（你的里程可能会有所不同）。在新的内存模型下，使实例字段volatile将“修复”双重检查锁定的问题，因为在构造线程的Something初始化和它的值返回之间会有一个先发生的关系。读取它的线程</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>然而，对于双重检查锁定的粉丝（我们真的希望没有留下），新闻仍然不好。双重检查锁定的重点是避免同步的性能开销。自Java 1.0起，不仅简短的同步得到了更低的成本，而且在新的内存模型下，使用volatile的性能成本几乎上升到了同步成本的水平。所以仍然没有充分的理由使用双重检查锁定。编辑 - 在大多数平台上挥发物都很便宜</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>相反，使用Initialization On Demand Holder惯用法，这是一个线程安全的，更容易理解：</p>
</blockquote>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">LazySomethingHolder</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Something something = <span class="keyword">new</span> Something();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Something <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> LazySomethingHolder.something;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>由于静态字段的初始化保证，此代码保证是正确的。如果在静态初始化程序中设置了一个字段，则可以保证它可以正确地显示给访问该类的任何线程。 </p>
</blockquote>
</blockquote>
<hr>
<h4 id="12-如果我正在编写VM怎么办？"><a href="#12-如果我正在编写VM怎么办？" class="headerlink" title="12. 如果我正在编写VM怎么办？ "></a><span id="12">12. 如果我正在编写VM怎么办？ </span></h4><blockquote>
<blockquote>
<p>你应该看看原文<a target="_blank" rel="noopener" href="http://gee.cs.oswego.edu/dl/jmm/cookbook.html">http://gee.cs.oswego.edu/dl/jmm/cookbook.html</a> ，或<a target="_blank" rel="noopener" href="https://github.com/itcastzp/guava_interview/blob/master/JMM_CookBook.md">https://github.com/itcastzp/guava_interview/blob/master/JMM_CookBook.md</a> 我为什么要在乎？ 你为什么要关心？并发错误很难调试。它们通常不会出现在测试中，等待您的程序在高负载下运行，并且难以重现和陷阱。您最好提前花费额外的精力来确保您的程序正确同步;虽然这并不容易，但它比尝试调试严重同步的应用程序要容易得多。</p>
</blockquote>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/07/27/jmm-cookbook/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ZP">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/27/jmm-cookbook/" class="post-title-link" itemprop="url">JSR133Cookbook</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2020-07-27 16:00:58 / 修改时间：16:30:04" itemprop="dateCreated datePublished" datetime="2020-07-27T16:00:58+08:00">2020-07-27</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="JSR133Cookbook-前言"><a href="#JSR133Cookbook-前言" class="headerlink" title="JSR133Cookbook-前言"></a>JSR133Cookbook-前言</h1><p><kbd>原文地址：<a target="_blank" rel="noopener" href="http://gee.cs.oswego.edu/dl/jmm/cookbook.html">http://gee.cs.oswego.edu/dl/jmm/cookbook.html</a></kbd></p>
<p><kbd><strong>Doug Lea<br>Last modified: Sun Oct 17 14:21:45 EDT 1999</strong></kbd></p>
<h1 id="指令重排"><a href="#指令重排" class="headerlink" title="指令重排"></a><a href="#1">指令重排</a></h1><h1 id="内存屏障"><a href="#内存屏障" class="headerlink" title="内存屏障"></a><a href="#2">内存屏障</a></h1><h1 id="多处理器"><a href="#多处理器" class="headerlink" title="多处理器"></a><a href="#3">多处理器</a></h1><h1 id="指南"><a href="#指南" class="headerlink" title="指南"></a><a href="#4">指南</a></h1><p>前言：从最初的探索至今已经有十年了。在此期间，很多关于处理器和语言的内存模型的规范和问题变得更清楚，更容易理解，但还有一些没有研究清楚。本指南一直在修订、完善来保证它的准确性，然而本指南部分内容展开的细节还不是很完整。想更全面的了解, 可以特别关注下 Peter Sewell和 Cambridge Relaxed Memory Concurrency Group的研究工作。</p>
<p>这是一篇用于说明在JSR-133中制定的新Java内存模型（JMM）的非官方指南。这篇指南提供了在最简单的背景下各种规则存在的原因，而不是这些规则在指令重排、多核处理器屏障指令和原子操作等方面对编译器和JVM所造成的影响。它还包括了一系列遵循JSR-133的指南。本指南是“非官方”的文档，因为它还包括特定处理器性能和规范的解释，我们不能保证所有的解释都是正确的，此外，处理器的规范和实现也可能会随时改变。</p>
<h2 id="1-指令重排"><a href="#1-指令重排" class="headerlink" title="1. 指令重排"></a><span id="1">1. 指令重排</span></h2><p>对于编译器的编写者来说，Java内存模型（JMM）主要是由禁止指令重排的规则所组成的，其中包括了字段（包括数组中的元素）的存取指令和监视器（锁）的控制指令。</p>
<h3 id="Volatile与监视器"><a href="#Volatile与监视器" class="headerlink" title="Volatile与监视器"></a>Volatile与监视器</h3><p>JMM中关于volatile和监视器主要的规则可以被看作一个矩阵。这个矩阵的单元格表示在一些特定的后续关联指令的情况下，指令不能被重排。下面的表格并不是JMM规范包含的，而是一个用来观察JMM模型对编译器和运行系统造成的主要影响的工具。</p>
<table>
<thead>
<tr>
<th><strong>能否重排序</strong></th>
<th><em>第二步操作</em></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td><em>第一步操作</em></td>
<td>Normal Load Normal Store</td>
<td>Volatile Load MonitorEnter</td>
<td>Volatile Store MonitorExit</td>
</tr>
<tr>
<td>Normal Load Normal Store</td>
<td></td>
<td></td>
<td>No</td>
</tr>
<tr>
<td>Volatile Load MonitorEnter</td>
<td>No</td>
<td>No</td>
<td>No</td>
</tr>
<tr>
<td>Volatile store MonitorExit</td>
<td></td>
<td>No</td>
<td>No</td>
</tr>
</tbody></table>
<p><em>关于上面这个表格一些术语的说明:</em></p>
<p>Normal Load指令包括：对非volatile字段的读取，getfield，getstatic和array load；</p>
<p>Normal Store指令包括：对非volatile字段的存储，putfield，putstatic和array store；</p>
<p>Volatile load指令包括：对多线程环境的volatile变量的读取，getfield，getstatic；</p>
<p>Volatile store指令包括：对多线程环境的volatile变量的存储，putfield，putstatic；</p>
<p>MonitorEnters指令（包括进入同步块synchronized方法）是用于多线程环境的锁对象；</p>
<p>MonitorExits指令（包括离开同步块synchronized方法）是用于多线程环境的锁对象。</p>
<p>在JMM中，Normal Load指令与Normal store指令的规则是一致的，类似的还有Volatile load指令与MonitorEnter指令，以及Volatile store指令与MonitorExit指令，因此这几对指令的单元格在上面表格里都合并在了一起（但是在后面部分的表格中，会在有需要的时候展开）。在这个小节中，我们仅仅考虑那些被当作原子单元的可读可写的变量，也就是说那些没有位域（bit fields），非对齐访问（unaligned accesses）或者超过平台最大字长（word size)的访问。</p>
<p>任意数量的指令操作都可被表示成这个表格中的第一个操作或者第二个操作。例如在单元格[Normal Store, Volatile Store]中，有一个No，就表示任何非volatile字段的store指令操作不能与后面任何一个Volatile store指令重排， 如果出现任何这样的重排会使多线程程序的运行发生变化。</p>
<p>JSR-133规范规定上述关于volatile和监视器的规则仅仅适用于可能会被多线程访问的变量或对象。因此，如果一个编译器可以最终证明（往往是需要很大的努力）一个锁只被单线程访问，那么这个锁就可以被去除。与之类似的，一个volatile变量只被单线程访问也可以被当作是普通的变量。还有进一步更细粒度的分析与优化，例如：那些被证明在一段时间内对多线程不可访问的字段。</p>
<p>在上表中，空白的单元格代表在不违反Java的基本语义下的重排是允许的（详细可参考JLS中的说明）。例如，即使上表中没有说明，但是也不能对同一个内存地址上的load指令和之后紧跟着的store指令进行重排。但是你可以对两个不同的内存地址上的load和store指令进行重排，而且往往在很多编译器转换和优化中会这么做。这其中就包括了一些往往不认为是指令重排的例子，例如：重用一个基于已经加载的字段的计算后的值而不是像一次指令重排那样去重新加载并且重新计算。然而，JMM规范允许编译器经过一些转换后消除这些可以避免的依赖，使其可以支持指令重排。</p>
<p>在任何的情况下，即使是程序员错误的使用了同步读取，指令重排的结果也必须达到最基本的Java安全要求。所有的显式字段都必须不是被设定成0或null这样的预构造值，就是被其他线程设值。这通常必须把所有存储在堆内存里的对象在其被构造函数使用前进行归零操作，并且从来不对归零store指令进行重排。一种比较好的方式是在垃圾回收中对回收的内存进行归零操作。可以参考JSR-133规范中其他情况下的一些关于安全保证的规则。</p>
<p>这里描述的规则和属性都是适用于读取Java环境中的字段。在实际的应用中，这些都可能会另外与读取内部的一些记账字段和数据交互，例如对象头，GC表和动态生成的代码。</p>
<h3 id="final字段"><a href="#final字段" class="headerlink" title="final字段"></a>final字段</h3><p>Final字段的load和store指令相对于有锁的或者volatile字段来说，就跟Normal load和Normal store的存取是一样的，但是需要加入两条附加的指令重排规则：</p>
<p>如果在构造函数中有一条final字段的store指令，同时这个字段是一个引用，那么它将不能与构造函数外后续可以让持有这个final字段的对象被其他线程访问的指令重排。例如：你不能重排下列语句：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x.finalField &#x3D; v;</span><br><span class="line">... ;</span><br><span class="line">sharedRef &#x3D; x;</span><br></pre></td></tr></table></figure>
<p>这条规则会在下列情况下生效，例如当你内联一个构造函数时，正如“…”的部分表示这个构造函数的逻辑边界那样。你不能把这个构造函数中的对于这个final字段的store指令移动到构造函数外的一条store指令后面，因为这可能会使这个对象对其他线程可见。（正如你将在下面看到的，这样的操作可能还需要声明一个内存屏障）。类似的，你不能把下面的前两条指令与第三条指令进行重排：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x.afield &#x3D; 1; x.finalField &#x3D; v; ... ; sharedRef &#x3D; x;</span><br></pre></td></tr></table></figure>
<p>一个final字段的初始化load指令不能与包含该字段的对象的初始化load指令进行重排。在下面这种情况下，这条规则就会生效：x = shareRef; … ; i = x.finalField;<br>由于这两条指令是依赖的，编译器将不会对这样的指令进行重排。但是，这条规则会对某些处理器有影响。<br>上述规则，要求对于带有final字段的对象的load本身是synchronized，volatile，final或者来自类似的load指令，从而确保java程序员对与final字段的正确使用，并最终使构造函数中初始化的store指令和构造函数外的store指令排序。</p>
<h2 id="2-内存屏障"><a href="#2-内存屏障" class="headerlink" title="2. 内存屏障"></a><span id="2">2. 内存屏障</span></h2><p>编译器和处理器必须同时遵守重排规则。由于单核处理器能确保与“顺序执行”相同的一致性，所以在单核处理器上并不需要专门做什么处理，就可以保证正确的执行顺序。但在多核处理器上通常需要使用内存屏障指令来确保这种一致性。即使编译器优化掉了一个字段访问（例如，因为一个读入的值未被使用），这种情况下还是需要产生内存屏障，就好像这个访问仍然需要保护。（可以参考下面的优化掉内存屏障的章节）。</p>
<p>内存屏障仅仅与内存模型中“获取”、“释放”这些高层次概念有间接的关系。内存屏障并不是“同步屏障”，内存屏障也与在一些垃圾回收机制中“写屏障（write barriers）”的概念无关。内存屏障指令仅仅直接控制CPU与其缓存之间，CPU与其准备将数据写入主存或者写入等待读取、预测指令执行的缓冲中的写缓冲之间的相互操作。这些操作可能导致缓冲、主内存和其他处理器做进一步的交互。但在JAVA内存模型规范中，没有强制处理器之间的交互方式，只要数据最终变为全局可用，就是说在所有处理器中可见，并当这些数据可见时可以获取它们。</p>
<h3 id="内存屏障的种类"><a href="#内存屏障的种类" class="headerlink" title="内存屏障的种类"></a>内存屏障的种类</h3><p>几乎所有的处理器至少支持一种粗粒度的屏障指令，通常被称为“栅栏（Fence）”，它保证在栅栏前初始化的load和store指令，能够严格有序的在栅栏后的load和store指令之前执行。无论在何种处理器上，这几乎都是最耗时的操作之一（与原子指令差不多，甚至更消耗资源），所以大部分处理器支持更细粒度的屏障指令。</p>
<p>内存屏障的一个特性是将它们运用于内存之间的访问。尽管在一些处理器上有一些名为屏障的指令，但是正确的/最好的屏障使用取决于内存访问的类型。下面是一些屏障指令的通常分类，正好它们可以对应上常用处理器上的特定指令（有时这些指令不会导致操作）。</p>
<h4 id="LoadLoad-屏障"><a href="#LoadLoad-屏障" class="headerlink" title="LoadLoad 屏障"></a>LoadLoad 屏障</h4><p>序列：Load1,Loadload,Load2</p>
<p>确保Load1所要读入的数据能够在被Load2和后续的load指令访问前读入。通常能执行预加载指令或/和支持乱序处理的处理器中需要显式声明Loadload屏障，因为在这些处理器中正在等待的加载指令能够绕过正在等待存储的指令。 而对于总是能保证处理顺序的处理器上，设置该屏障相当于无操作。</p>
<h4 id="StoreStore-屏障"><a href="#StoreStore-屏障" class="headerlink" title="StoreStore  屏障"></a>StoreStore  屏障</h4><p>序列：Store1，StoreStore，Store2</p>
<p>确保Store1的数据在Store2以及后续Store指令操作相关数据之前对其它处理器可见（例如向主存刷新数据）。通常情况下，如果处理器不能保证从写缓冲或/和缓存向其它处理器和主存中按顺序刷新数据，那么它需要使用StoreStore屏障。</p>
<h4 id="LoadStore-屏障"><a href="#LoadStore-屏障" class="headerlink" title="LoadStore 屏障"></a>LoadStore 屏障</h4><p>序列： Load1; LoadStore; Store2</p>
<p>确保Load1的数据在Store2和后续Store指令被刷新之前读取。在等待Store指令可以越过loads指令的乱序处理器上需要使用LoadStore屏障。</p>
<h4 id="StoreLoad-Barriers"><a href="#StoreLoad-Barriers" class="headerlink" title="StoreLoad Barriers"></a>StoreLoad Barriers</h4><p>序列: Store1; StoreLoad; Load2</p>
<p>确保Store1的数据在被Load2和后续的Load指令读取之前对其他处理器可见。StoreLoad屏障可以防止一个后续的load指令 不正确的使用了Store1的数据，而不是另一个处理器在相同内存位置写入一个新数据。正因为如此，所以在下面所讨论的处理器为了在屏障前读取同样内存位置存过的数据，必须使用一个StoreLoad屏障将存储指令和后续的加载指令分开。Storeload屏障在几乎所有的现代多处理器中都需要使用，但通常它的开销也是最昂贵的。它们昂贵的部分原因是它们必须关闭通常的略过缓存直接从写缓冲区读取数据的机制。这可能通过让一个缓冲区进行充分刷新（flush）,以及其他延迟的方式来实现。</p>
<p>在下面讨论的所有处理器中，执行StoreLoad的指令也会同时获得其他三种屏障的效果。所以StoreLoad可以作为最通用的（但通常也是最耗性能）的一种Fence。(这是经验得出的结论，并不是必然)。反之不成立，为了达到StoreLoad的效果而组合使用其他屏障并不常见。</p>
<p>下表显示这些屏障如何符合JSR-133排序规则。</p>
<table>
<thead>
<tr>
<th><strong>Required barriers</strong></th>
<th align="center"><em>2nd operation</em></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td><em>1st operation</em></td>
<td align="center">Normal Load</td>
<td>Normal Store</td>
<td>Volatile Load MonitorEnter</td>
<td>Volatile Store MonitorExit</td>
</tr>
<tr>
<td>Normal Load</td>
<td align="center"></td>
<td></td>
<td></td>
<td>LoadStore</td>
</tr>
<tr>
<td>Normal Store</td>
<td align="center"></td>
<td></td>
<td></td>
<td>StoreStore</td>
</tr>
<tr>
<td>Volatile Load MonitorEnter</td>
<td align="center">LoadLoad</td>
<td>LoadStore</td>
<td>LoadLoad</td>
<td>LoadStore</td>
</tr>
<tr>
<td>Volatile Store MonitorExit</td>
<td align="center"></td>
<td></td>
<td>StoreLoad</td>
<td>StoreStore</td>
</tr>
</tbody></table>
<p>另外，特殊的final字段规则在下列代码中需要一个StoreStore屏障</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x.finalField &#x3D; v; StoreStore; sharedRef &#x3D; x;</span><br></pre></td></tr></table></figure>

<p>如下例子解释如何放置屏障：<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"> class X &#123;</span><br><span class="line">	int a, b;</span><br><span class="line">	volatile int v, u;</span><br><span class="line"></span><br><span class="line">	void f() &#123;</span><br><span class="line">		int i, j;</span><br><span class="line"></span><br><span class="line">		i &#x3D; a;&#x2F;&#x2F; load a</span><br><span class="line">		j &#x3D; b;&#x2F;&#x2F; load b</span><br><span class="line">		i &#x3D; v;&#x2F;&#x2F; load v</span><br><span class="line">		&#x2F;&#x2F; LoadLoad</span><br><span class="line">		j &#x3D; u;&#x2F;&#x2F; load u</span><br><span class="line">		&#x2F;&#x2F; LoadStore</span><br><span class="line">		a &#x3D; i;&#x2F;&#x2F; store a</span><br><span class="line">		b &#x3D; j;&#x2F;&#x2F; store b</span><br><span class="line">		&#x2F;&#x2F; StoreStore</span><br><span class="line">		v &#x3D; i;&#x2F;&#x2F; store v</span><br><span class="line">		&#x2F;&#x2F; StoreStore</span><br><span class="line">		u &#x3D; j;&#x2F;&#x2F; store u</span><br><span class="line">		&#x2F;&#x2F; StoreLoad</span><br><span class="line">		i &#x3D; u;&#x2F;&#x2F; load u</span><br><span class="line">		&#x2F;&#x2F; LoadLoad</span><br><span class="line">		&#x2F;&#x2F; LoadStore</span><br><span class="line">		j &#x3D; b;&#x2F;&#x2F; load b</span><br><span class="line">		a &#x3D; i;&#x2F;&#x2F; store a</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><strong>介绍</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">load a</span><br><span class="line">load b</span><br><span class="line">load v</span><br><span class="line">   LoadLoad</span><br><span class="line">load u</span><br><span class="line">   LoadStore</span><br><span class="line">store a</span><br><span class="line">store b</span><br><span class="line">   StoreStore</span><br><span class="line">store v</span><br><span class="line">   StoreStore</span><br><span class="line">store u</span><br><span class="line">   StoreLoad</span><br><span class="line">load u</span><br><span class="line">   LoadLoad</span><br><span class="line">   LoadStore</span><br><span class="line">load b</span><br><span class="line">store a</span><br></pre></td></tr></table></figure>

<h4 id="数据依赖和屏障"><a href="#数据依赖和屏障" class="headerlink" title="数据依赖和屏障"></a>数据依赖和屏障</h4><p>一些处理器为了保证依赖指令的交互次序需要使用LoadLoad和LoadStore屏障。在一些（大部分）处理器中，一个load指令或者一个依赖于之前加载值的store指令被处理器排序，并不需要一个显式的屏障。这通常发生于两种情况，间接取值（indirection）：</p>
<p>Load x; Load x.field</p>
<p>和条件控制（control）</p>
<p>Load x; if (predicate(x)) Load or Store y;</p>
<p>但特别的是不遵循间接排序的处理器，需要为final字段设置屏障，使它能通过共享引用访问最初的引用。</p>
<p>x = sharedRef; … ; LoadLoad; i = x.finalField;</p>
<p>相反的，如下讨论，确定遵循数据依赖的处理器，提供了几个优化掉LoadLoad和LoadStore屏障指令的机会。（尽管如此，在任何处理器上，对于StoreLoad屏障不会自动清除依赖关系）。</p>
<h4 id="与原子指令交互"><a href="#与原子指令交互" class="headerlink" title="与原子指令交互"></a>与原子指令交互</h4><p>屏障在不同处理器上还需要与MonitorEnter和MonitorExit实现交互。锁或者解锁通常必须使用原子条件更新操作CompareAndSwap（CAS）指令或者LoadLinked/StoreConditional (LL/SC)，就如执行一个volatile store之后紧跟volatile load的语义一样。CAS或者LL/SC能够满足最小功能，一些处理器还提供其他的原子操作（如，一个无条件交换），这在某些时候它可以替代或者与原子条件更新操作结合使用。</p>
<p>在所有处理器中，原子操作可以避免在正被读取/更新的内存位置进行写后读（read-after-write）。（否则标准的循环直到成功的结构体（loop-until-success ）没有办法正常工作）。但处理器在是否为原子操作提供比隐式的StoreLoad更一般的屏障特性上表现不同。一些处理器上这些指令可以为MonitorEnter/Exit原生的生成屏障；其它的处理器中一部分或者全部屏障必须显式的指定。</p>
<p>为了分清这些影响，我们必须把Volatiles和Monitors分开：</p>
<table>
<thead>
<tr>
<th><strong>Required Barriers</strong></th>
<th><em>2nd operation</em></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td><em>1st operation</em></td>
<td>Normal Load</td>
<td>Normal Store</td>
<td>Volatile Load</td>
<td>Volatile Store</td>
<td>MonitorEnter</td>
<td>MonitorExit</td>
</tr>
<tr>
<td>Normal Load</td>
<td></td>
<td></td>
<td></td>
<td>LoadStore</td>
<td></td>
<td>LoadStore</td>
</tr>
<tr>
<td>Normal Store</td>
<td></td>
<td></td>
<td></td>
<td>StoreStore</td>
<td></td>
<td>StoreExit</td>
</tr>
<tr>
<td>Volatile Load</td>
<td>LoadLoad</td>
<td>LoadStore</td>
<td>LoadLoad</td>
<td>LoadStore</td>
<td>LoadEnter</td>
<td>LoadExit</td>
</tr>
<tr>
<td>Volatile Store</td>
<td></td>
<td></td>
<td>StoreLoad</td>
<td>StoreStore</td>
<td>StoreEnter</td>
<td>StoreExit</td>
</tr>
<tr>
<td>MonitorEnter</td>
<td>EnterLoad</td>
<td>EnterStore</td>
<td>EnterLoad</td>
<td>EnterStore</td>
<td>EnterEnter</td>
<td>EnterExit</td>
</tr>
<tr>
<td>MonitorExit</td>
<td></td>
<td></td>
<td>ExitLoad</td>
<td>ExitStore</td>
<td>ExitEnter</td>
<td>ExitExit</td>
</tr>
</tbody></table>
<p>另外，特殊的final字段规则需要一个StoreLoad屏障。</p>
<p><strong>x.finalField = v; StoreStore; sharedRef = x;</strong></p>
<p>在这张表里，”Enter”与”Load”相同，”Exit”与”Store”相同，除非被原子指令的使用和特性覆盖。特别是：</p>
<p>EnterLoad 在进入任何需要执行Load指令的同步块/方法时都需要。这与LoadLoad相同，除非在MonitorEnter时候使用了原子指令并且它本身提供一个至少有LoadLoad属性的屏障，如果是这种情况，相当于没有操作。<br>StoreExit在退出任何执行store指令的同步方法块时候都需要。这与StoreStore一致，除非MonitorExit使用原子操作，并且提供了一个至少有StoreStore属性的屏障，如果是这种情况，相当于没有操作。<br>ExitEnter和StoreLoad一样，除非MonitorExit使用了原子指令，并且/或者MonitorEnter至少提供一种屏障，该屏障具有StoreLoad的属性，如果是这种情况，相当于没有操作。<br>在编译时不起作用或者导致处理器上不产生操作的指令比较特殊。例如，当没有交替的load和store指令时，EnterEnter用于分离嵌套的MonitorEnter。下面这个例子说明如何使用这些指令类型：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"> class X &#123;</span><br><span class="line">	int a;</span><br><span class="line">	volatile int v;</span><br><span class="line"></span><br><span class="line">	void f() &#123;</span><br><span class="line">		int i;</span><br><span class="line">		synchronized (this) &#123; &#x2F;&#x2F; enter EnterLoad EnterStore</span><br><span class="line">			i &#x3D; a;&#x2F;&#x2F; load a</span><br><span class="line">			a &#x3D; i;&#x2F;&#x2F; store a</span><br><span class="line">		&#125;&#x2F;&#x2F; LoadExit StoreExit exit ExitEnter</span><br><span class="line"></span><br><span class="line">		synchronized (this) &#123;&#x2F;&#x2F; enter ExitEnter</span><br><span class="line">			synchronized (this) &#123;&#x2F;&#x2F; enter</span><br><span class="line">			&#125;&#x2F;&#x2F; EnterExit exit</span><br><span class="line">		&#125;&#x2F;&#x2F; ExitExit exit ExitEnter ExitLoad</span><br><span class="line"></span><br><span class="line">		i &#x3D; v;&#x2F;&#x2F; load v</span><br><span class="line"></span><br><span class="line">		synchronized (this) &#123;&#x2F;&#x2F; LoadEnter enter</span><br><span class="line">		&#125; &#x2F;&#x2F; exit ExitEnter ExitStore</span><br><span class="line"></span><br><span class="line">		v &#x3D; i; &#x2F;&#x2F; store v</span><br><span class="line">		synchronized (this) &#123; &#x2F;&#x2F; StoreEnter enter</span><br><span class="line">		&#125; &#x2F;&#x2F; EnterExit exit</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>介绍</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">enter</span><br><span class="line">   EnterLoad</span><br><span class="line">   EnterStore</span><br><span class="line">load a</span><br><span class="line">store a</span><br><span class="line">   LoadExit</span><br><span class="line">   StoreExit</span><br><span class="line">exit</span><br><span class="line">   ExitEnter</span><br><span class="line">enter</span><br><span class="line">   EnterEnter</span><br><span class="line">enter</span><br><span class="line">   EnterExit</span><br><span class="line">exit</span><br><span class="line">   ExitExit</span><br><span class="line">exit</span><br><span class="line">   ExitEnter</span><br><span class="line">   ExitLoad</span><br><span class="line">load v</span><br><span class="line">   LoadEnter</span><br><span class="line">enter</span><br><span class="line">   EnterExit</span><br><span class="line">exit</span><br><span class="line">   ExitEnter</span><br><span class="line">   ExitStore</span><br><span class="line">store v</span><br><span class="line">   StoreEnter</span><br><span class="line">enter</span><br><span class="line">   EnterExit</span><br><span class="line">exit</span><br></pre></td></tr></table></figure>

<p><code>Java层次的对原子条件更新的操作将在JDK1.5中发布（JSR-166），因此编译器需要发布相应的代码，综合使用上表中使用MonitorEnter和MonitorExit的方式，——从语义上说，有时在实践中，这些Java中的原子更新操作，就如同他们都被锁所包围一样。</code></p>
<h2 id="3-多处理器"><a href="#3-多处理器" class="headerlink" title="3. 多处理器"></a><span id="3">3. 多处理器</span></h2><p>本文总结了在多处理器(MPs)中常用的的处理器列表，处理器相关的信息都可以从链接指向的文档中得到（一些网站需要通过注册才能得到相应的手册）。当然，这不是一个完全详细的列表，但已经包括了我所知道的在当前或者将来Java实现中所使用的多核处理器。下面所述的关于处理器的列表和内容也不一定权威。我只是总结一下我所阅读过的文档，但是这些文档也有可能是被我误解了，一些参考手册也没有把Java内存模型(JMM)相关的内容阐述清楚，所以请协助我把本文变得更准确。</p>
<p>一些很好地讲述了跟内存屏障(barriers)相关的硬件信息和机器(machines)相关的特性的资料并没有在本文中列出来，如《Hans Boehm的原子操作库(Hans Boehm’s atomic_ops library)》,  《Linux内核源码(Linux Kernel Source)》, 和 《Linux可扩展性研究计划(Linux Scalability Effort)》。Linux内核中所需的内存屏障与这里讨论的是非常一致的，它已被移植到大多数处理器中。不同处理器所支持的潜在内存模型的相关描述，可以查阅Sarita Adve et al, Recent Advances in Memory Consistency Models for Hardware Shared-Memory Systems和 Sarita Adve and Kourosh Gharachorloo, Shared Memory Consistency Models: A Tutorial.</p>
<p>sparc-TSO</p>
<p>Ultrasparc 1, 2, 3 (sparcv9)都支持全存储顺序模式（TSO:Total Store Orde)，Ultra3s只支持全存储顺序模式（TSO:Total Store Orde)。(Ultra1/2的RMO(Relax Memory Order)模式由于不再使用可以被忽略了)相关内容可进一步查看 UltraSPARC III Cu User’s Manual 和 The SPARC Architecture Manual, Version 9 。</p>
<p>x86 (和 x64)</p>
<p>英特尔486+，AMD以及其他的处理器。在2005到2009年有很多规范出现，但当前的规范都几乎跟TSO一致，主要的区别在于支持不同的缓存模式，和极端情况下的处理(如不对齐的访问和特殊形式的指令)。可进一步查看The IA-32 Intel Architecture Software Developers Manuals: System Programming Guide 和 AMD Architecture Programmer’s Manual Programming。</p>
<p>ia64</p>
<p>安腾处理器。可进一步查看 Intel Itanium Architecture Software Developer’s Manual, Volume 2: System Architecture。</p>
<p>ppc (POWER)</p>
<p>尽管所有的版本都有相同的基本内存模型，但是一些内存屏障指令的名字和定义会随着时间变化而变化。下表中所列的是从Power4开始的版本；可以查阅架构手册获得更多细节。查看 MPC603e RISC Microprocessor Users Manual, MPC7410/MPC7400 RISC Microprocessor Users Manual , Book II of PowerPC Architecture Book, PowerPC Microprocessor Family: Software reference manual, Book E- Enhanced PowerPC Architecture, EREF: A Reference for Motorola Book E and the e500 Core。关于内存屏障的讨论请查看IBM article on power4 barriers, 和 IBM article on powerpc barriers.</p>
<p>arm</p>
<p>arm版本7以上。请查看 ARM processor specifications alpha 21264x和其他所以版本。请查看Alpha Architecture Handbook</p>
<p>pa-risc<br>HP pa-risc实现。请查看pa-risc 2.0 Architecture手册。</p>
<p>下面是这些部分处理器所支持的屏障和原子操作：</p>
<table>
<thead>
<tr>
<th>Processor</th>
<th align="center">LoadStore</th>
<th>LoadLoad</th>
<th>StoreStore</th>
<th>StoreLoad</th>
<th>Data dependency orders loads?</th>
<th>Atomic Conditional</th>
<th>Other Atomics</th>
<th>Atomics provide barrier?</th>
</tr>
</thead>
<tbody><tr>
<td>sparc-TSO</td>
<td align="center">不执行操作</td>
<td>不执行操作</td>
<td>不执行操作</td>
<td>membar (StoreLoad)</td>
<td>是</td>
<td>CAS:casa</td>
<td>swap,ldstub</td>
<td>全部</td>
</tr>
<tr>
<td>x86</td>
<td align="center">不执行操作</td>
<td>不执行操作</td>
<td>不执行操作</td>
<td>mfence or cpuid or locked insn</td>
<td>是</td>
<td>CAS:cmpxchg</td>
<td>xchg,locked insn</td>
<td>全部</td>
</tr>
</tbody></table>
<p>说明：</p>
<p>尽管上面一些单元格中所列的屏障指令比实际需要的特性更强，但可能是最廉价的方式获得所需要的效果。</p>
<p>上面所列的屏障指令主要是为正常的程序内存的使用而设计的，IO和系统任务就没有必要用特别形式/模式的缓存和内存。举例来说，在x86 SPO中，StoreStore屏障指令(“sfence”)需要写合并(WC)缓存模式，其目的是用在系统级的块传输等地方。操作系统为程序和数据使用写回(Writeback)模式，这就不需要StoreStore屏障了。</p>
<p>在x86中，任何lock前缀的指令都可以用作一个StoreLoad屏障。（在Linux内核中使用的形式是无操作的lock指令，如addl $0,0(%%esp)。)。除非必须需要使用像CAS这样lock前缀的指令，否则使用支持SSE2扩展版本（如奔腾4及其后续版本）的mfence指令似乎是一个更好的方案。cpuid指令也是可以用的，但是比较慢。</p>
<p>在ia64平台上，LoadStore，LoadLoad和StoreStore屏障被合并成特殊形式的load和store指令–它们不再是一些单独的指令。ld.acq就是(load;LoadLoad+LoadStore)和st.rel就是(LoadStore+StoreStore;store)。这两个都不提供StoreLoad屏障–因此你需要一个单独的mf屏障指令。</p>
<p>在ARM和ppc平台中，就有可能通过non-fence-based指令序列取代load fences。这些序列和以及他们应用的案例在Cambridge Relaxed Memory Concurrency Group著作中都有描述。</p>
<p>sparc membar指令不但支持所有的4种屏障模式，而且还支持组合模式。但是StoreLoad模式需要在TSO中。在一些UltraSparcs中，不管任何模式下membar指令总是能让StoreLoad生效。</p>
<p>在与这些流指令有关的情况中，X86处理器支持”streaming SIMD” SSE2扩展只需要LoadLoad ‘lfence’</p>
<p>虽然PA-RISC规范并不强制规定，但所有HP PA-RISC的实现都是顺序一致，因此没有内存屏障指令。</p>
<p>唯一的在pa-risc上的原始原子操作(atomic primitive)是ldcw, 一种test-and-set的形式，通过它你可以使用一些技术建立原子条件更新(atomic conditional updates)，这些技术在 HP white paper on spinlocks中可以找到.</p>
<p>在不同的字段宽度(field width，包括4个字节和8个字节版本）里，CAS和LL/SC在不同的处理器上会使用多种形式。</p>
<p>在sparc和x86处理器中，CAS有隐式的前后全StoreLoad屏障。sparcv9架构手册描述了CAS不需要post-StoreLoad屏障特性，但是芯片手册表明它确实在ultrasparcs中存在这个特性。</p>
<p>只有在内存区域进行加载和存储(loaded/stored)时，ppc和alpha, LL/SC才会有隐式的屏障，但它不再有更通用的屏障特性。</p>
<p>在内存区域中进行加载或存储时, ia64 cmpxchg指令也会有隐式的屏障，但还会额外加上可选的.acq（post-LoadLoad+LoadStore）或者.rel（pre-StoreStore+LoadStore)修改指令。cmpxchg.acq形式可用于MonitorEnter，cmpxchg.rel可用于MonitorExit。在上述的情况中，exits和enters在没有被确定匹配的情况下，就需要ExitEnter(StoreLoad)屏障。</p>
<p>Sparc,x86和ia64平台支持unconditional-exchange (swap, xchg). Sparc ldstub是一个one-byte test-and-set。 ia64 fetchadd返回前一个值并把它加上去。在x86平台，一些指令（如add-to-memory）能够使用lock前缀的指令执行原子操作。</p>
<h2 id="4-指南"><a href="#4-指南" class="headerlink" title="4. 指南"></a><span id="4">4. 指南</span></h2><h3 id="单处理器-Uniprocessors"><a href="#单处理器-Uniprocessors" class="headerlink" title="单处理器(Uniprocessors)"></a>单处理器(Uniprocessors)</h3><p>如果能保证正在生成的代码只会运行在单个处理器上，那就可以跳过本节的其余部分。因为单处理器保持着明显的顺序一致性，除非对象内存以某种方式与可异步访问的IO内存共享，否则永远都不需要插入屏障指令。采用了特殊映射的java.nio buffers可能会出现这种情况，但也许只会影响内部的JVM支持代码，而不会影响Java代码。而且，可以想象，如果上下文切换时不要求充分的同步，那就需要使用一些特殊的屏障了。</p>
<h3 id="插入屏障-Inserting-Barriers"><a href="#插入屏障-Inserting-Barriers" class="headerlink" title="插入屏障(Inserting Barriers)"></a>插入屏障(Inserting Barriers)</h3><p>当程序执行时碰到了不同类型的存取，就需要屏障指令。几乎无法找到一个“最理想”位置，能将屏障执行总次数降到最小。编译器不知道指定的load或store指令是先于还是后于需要一个屏障操作的另一个load或store指令；如，当volatile store后面是一个return时。最简单保守的策略是为任一给定的load，store，lock或unlock生成代码时，都假设该类型的存取需要“最重量级”的屏障：</p>
<p>在每条volatile store指令之前插入一个StoreStore屏障。(在ia64平台上，必须将该屏障及大多数屏障合并成相应的load或store指令。)</p>
<p>如果一个类包含final字段，在该类每个构造器的全部store指令之后，return指令之前插入一个StoreStore屏障。</p>
<p>在每条volatile store指令之后插入一条StoreLoad屏障。注意，虽然也可以在每条volatile load指令之前插入一个StoreLoad屏障，但对于使用volatile的典型程序来说则会更慢，因为读操作会大大超过写操作。或者，如果可以的话，将volatile store实现成一条原子指令（例如x86平台上的XCHG），就可以省略这个屏障操作。如果原子指令比StoreLoad屏障成本低，这种方式就更高效。</p>
<p>在每条volatile load指令之后插入LoadLoad和LoadStore屏障。在持有数据依赖顺序的处理器上，如果下一条存取指令依赖于volatile load出来的值，就不需要插入屏障。特别是，在load一个volatile引用之后，如果后续指令是null检</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/07/20/same-threading/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ZP">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/20/same-threading/" class="post-title-link" itemprop="url">同一线程</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2020-07-20 18:02:48 / 修改时间：18:26:15" itemprop="dateCreated datePublished" datetime="2020-07-20T18:02:48+08:00">2020-07-20</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="同一线程"><a href="#同一线程" class="headerlink" title="同一线程"></a>同一线程</h1><ul>
<li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9%E5%8D%95%E7%BA%BF%E7%A8%8B%E7%B3%BB%E7%BB%9F">为什么选择单线程系统</a></li>
<li>同线程：单线程横向扩展<ul>
<li><a href="#%E6%AF%8F%E4%B8%AACPU%E4%B8%80%E4%B8%AA%E7%BA%BF%E7%A8%8B">每个CPU一个线程</a></li>
</ul>
</li>
<li><a href="#%E6%B2%A1%E6%9C%89%E5%85%B1%E4%BA%AB%E7%8A%B6%E6%80%81">没有共享状态</a></li>
<li>负载分配<ul>
<li><a href="#%E5%8D%95%E7%BA%BF%E7%A8%8B%E5%BE%AE%E6%9C%8D%E5%8A%A1">单线程微服务</a></li>
<li><a href="#%E5%85%B1%E4%BA%AB%E6%95%B0%E6%8D%AE%E6%9C%8D%E5%8A%A1">共享数据服务</a></li>
</ul>
</li>
<li><a href="#%E7%BA%BF%E7%A8%8B%E9%80%9A%E4%BF%A1">线程通信</a></li>
<li><a href="#%E6%9B%B4%E7%AE%80%E5%8D%95%E7%9A%84%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%9E%8B">更简单的并发模型</a></li>
<li><a href="#%E4%BE%8B%E8%AF%81">例证</a></li>
<li><a href="#Java%E7%BA%BF%E7%A8%8B%E6%93%8D%E4%BD%9C">Java线程操作</a></li>
</ul>
<p>同线程是一种并发模型，其中单线程系统可扩展到N个单线程系统。结果是N个单线程系统并行运行。</p>
<p>同一个线程的系统不是纯粹的单线程系统，因为它包含多个线程。但是-每个线程都像单线程系统一样运行。因此，术语“ <em>同线程”</em>而不是“单线程”。</p>
<h2 id="为什么选择单线程系统？"><a href="#为什么选择单线程系统？" class="headerlink" title="为什么选择单线程系统？"></a>为什么选择单线程系统？</h2><p>您可能想知道为什么今天有人会设计单线程系统。单线程系统之所以流行，是因为其并发模型比多线程系统简单得多。单线程系统不与其他线程共享任何状态（对象/数据）。这使单线程可以使用非并发数据结构，并更好地利用CPU和CPU缓存。</p>
<p>不幸的是，单线程系统不能完全利用现代CPU。现代CPU通常会多带2、4、6、8个内核。每个内核都充当一个单独的CPU。单线程系统只能使用其中一个内核，如下所示：</p>
<p><img src="http://tutorials.jenkov.com/images/java-concurrency/same-threading-0.png" alt="在4核CPU上运行的单线程系统。"></p>
<h2 id="同线程：单线程横向扩展"><a href="#同线程：单线程横向扩展" class="headerlink" title="同线程：单线程横向扩展"></a>同线程：单线程横向扩展</h2><p>为了利用CPU中的所有内核，可以扩展单线程系统以利用整个计算机。</p>
<h3 id="每个CPU一个线程"><a href="#每个CPU一个线程" class="headerlink" title="每个CPU一个线程"></a>每个CPU一个线程</h3><p>同线程系统通常在计算机中每个CPU运行1个线程。如果计算机包含4个CPU或具有4个内核的CPU，则通常会运行4个相同线程系统的实例（4个单线程系统）。下图显示了这一原理：</p>
<p><img src="http://tutorials.jenkov.com/images/java-concurrency/same-threading-0-1.png" alt="在4核CPU上运行的同线程系统。"></p>
<h2 id="没有共享状态"><a href="#没有共享状态" class="headerlink" title="没有共享状态"></a>没有共享状态</h2><p>同一个线程的系统看起来类似于传统的多线程系统，因为同一个线程的系统内部有多个线程在运行。但是有细微的差别。</p>
<p>同一线程系统与传统多线程系统之间的区别在于，同一线程系统中的线程不共享状态。没有线程并行访问的共享内存。没有线程共享数据的并发数据结构等。此处说明了这种差异：</p>
<p><img src="http://tutorials.jenkov.com/images/java-concurrency/same-threading-4.png" alt="多线程和同线程系统。"></p>
<p>缺少共享状态是导致每个线程在单线程系统下的行为。但是，由于同一个线程的系统可以包含多个线程-它实际上不是“单线程系统”。在没有更好的名字的情况下，我发现将这样的系统称为<em>同线程</em>系统而不是“具有单线程设计的多线程系统” 更为精确。同线程更容易说，也更容易理解。</p>
<p>从本质上讲，同一线程意味着数据处理停留在同一线程内，并且同一线程系统中没有线程可以同时共享数据。有时，这也被称为 <em>没有共享状态</em>并发或<em>单独的状态</em>并发。</p>
<h2 id="负载分配"><a href="#负载分配" class="headerlink" title="负载分配"></a>负载分配</h2><p>显然，同一个线程的系统需要在运行的单线程实例之间共享工作负载。如果只有一个线程可以完成任何工作，则该系统实际上将是单线程的。</p>
<p>究竟如何在不同线程上分配负载取决于系统的设计。我将在以下各节中介绍一些内容。</p>
<h3 id="单线程微服务"><a href="#单线程微服务" class="headerlink" title="单线程微服务"></a>单线程微服务</h3><p>如果您的系统包含多个微服务，则每个微服务都可以单线程模式运行。当您将多个单线程微服务部署到同一台计算机上时，每个微服务都可以在单个CPU上运行单个线程。</p>
<p>微服务本质上不共享任何数据，因此微服务是同线程系统的一个很好的用例。</p>
<h3 id="分片数据服务"><a href="#分片数据服务" class="headerlink" title="分片数据服务"></a>分片数据服务</h3><p>如果您的系统确实确实需要共享数据，或者至少需要共享一个数据库，则可以对数据库进行分片。分片意味着将数据分为多个数据库。通常对数据进行划分，以使彼此相关的所有数据一起位于同一数据库中。例如，属于某个“所有者”实体的所有数据都将插入同一数据库中。但是，分片不在本教程的讨论范围之内，因此您必须搜索有关该主题的教程。</p>
<h2 id="线程通讯"><a href="#线程通讯" class="headerlink" title="线程通讯"></a>线程通讯</h2><p>如果同一线程系统中的线程需要通信，则通过消息传递来实现。如果线程A要向线程B发送消息，则线程A可以通过生成消息（字节序列）来发送消息。然后，线程B可以复制该消息（字节序列）并读取它。通过复制消息，线程B确保线程A在读取消息时无法修改消息。复制后，线程A无法访问消息副本。</p>
<p>通过消息传递进行的线程通信如下所示：</p>
<p><img src="http://tutorials.jenkov.com/images/java-concurrency/same-threading-5.png" alt="在同一线程系统中通过消息传递进行线程通信。"></p>
<p>线程通信可以通过队列，管道，unix套接字，TCP套接字等进行。无论您的系统适合什么。</p>
<h2 id="更简单的并发模型"><a href="#更简单的并发模型" class="headerlink" title="更简单的并发模型"></a>更简单的并发模型</h2><p>在同一个线程系统中在其自己的线程中运行的每个系统都可以实现为单线程。这意味着内部并发模型变得比线程共享状态简单得多。您不必担心并发数据结构以及此类数据结构可能导致的所有并发问题。</p>
<h2 id="例证"><a href="#例证" class="headerlink" title="例证"></a>例证</h2><p>这是单线程，多线程和同线程系统的图示，因此您可以更轻松地了解它们之间的区别。</p>
<p>第一个插图显示了一个单线程系统。</p>
<p><img src="http://tutorials.jenkov.com/images/java-concurrency/same-threading-1.png" alt="单线程系统。"></p>
<p>第二个图显示了一个多线程系统，其中线程共享数据。</p>
<p><img src="http://tutorials.jenkov.com/images/java-concurrency/same-threading-2.png" alt="多线程系统。"></p>
<p>第三幅图显示了一个具有2个线程且具有单独数据的同线程系统，它们通过相互传递消息进行通信。</p>
<p><img src="http://tutorials.jenkov.com/images/java-concurrency/same-threading-3.png" alt="同线程系统。"></p>
<h2 id="Java线程操作"><a href="#Java线程操作" class="headerlink" title="Java线程操作"></a>Java线程操作</h2><p>Thread Ops for Java是一个开源工具包，旨在帮助您更轻松地实现单独的状态相同的线程系统。线程操作包含用于启动和停止单个线程以及通过单个线程实现某种程度的并发性的工具。如果您对使用相同线程的应用程序设计感兴趣，那么让Thread Ops看起来可能很有趣。您可以在我<a target="_blank" rel="noopener" href="http://tutorials.jenkov.com/thread-ops-java/index.html">的Java线程操作教程中</a>阅读有关线程操作的更多信息。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/07/20/concurrency-models/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ZP">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/20/concurrency-models/" class="post-title-link" itemprop="url">并发模型</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-07-20 17:28:49" itemprop="dateCreated datePublished" datetime="2020-07-20T17:28:49+08:00">2020-07-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-07-21 17:39:55" itemprop="dateModified" datetime="2020-07-21T17:39:55+08:00">2020-07-21</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="并发模型"><a href="#并发模型" class="headerlink" title="并发模型"></a>并发模型</h1><ul>
<li><a href="#%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%9E%8B%E5%92%8C%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E7%9A%84%E7%9B%B8%E4%BC%BC%E6%80%A7">并发模型和分布式系统的相似性</a></li>
<li><a href="#%E5%85%B1%E4%BA%AB%E7%8A%B6%E6%80%81%E4%B8%8E%E5%88%86%E7%A6%BB%E7%8A%B6%E6%80%81">共享状态与分离状态</a></li>
<li><a href="#Parallel-Wokers">Parallel-Wokers</a><ul>
<li><a href="#Parallel-Wokers%E4%BC%98%E5%8A%BF">Parallel-Wokers优势</a></li>
<li>parallel-workers劣势<ul>
<li><a href="#%E5%85%B1%E4%BA%AB%E7%8A%B6%E6%80%81%E4%BC%9A%E5%8F%98%E5%BE%97%E5%A4%8D%E6%9D%82">共享状态会变得复杂</a></li>
<li><a href="#%E6%97%A0%E7%8A%B6%E6%80%81%E7%9A%84workers">无状态的workers</a></li>
<li><a href="#%E4%BB%BB%E5%8A%A1%E9%A1%BA%E5%BA%8F%E6%98%AF%E4%B8%8D%E7%A1%AE%E5%AE%9A%E7%9A%84">任务顺序是不确定的</a></li>
</ul>
</li>
</ul>
</li>
<li>流水线<ul>
<li><a target="_blank" rel="noopener" href="http://tutorials.jenkov.com/java-concurrency/concurrency-models.html#reactive-event-driven-systems">反应性，事件驱动系统</a></li>
<li><a target="_blank" rel="noopener" href="http://tutorials.jenkov.com/java-concurrency/concurrency-models.html#actors-vs-channels">演员与频道</a></li>
</ul>
</li>
<li>流水线优势<ul>
<li><a href="#%E6%B2%A1%E6%9C%89%E5%85%B1%E4%BA%AB%E7%8A%B6%E6%80%81">没有共享状态</a></li>
<li><a href="#%E6%9C%89%E7%8A%B6%E6%80%81%E7%9A%84workers">有状态的workers</a></li>
<li><a href="#%E6%9B%B4%E5%A5%BD%E7%9A%84%E7%A1%AC%E4%BB%B6%E6%95%B4%E5%90%88">更好的硬件整合</a></li>
<li><a href="#%E4%BB%BB%E5%8A%A1%E5%8F%AF%E4%BB%A5%E6%8E%92%E5%BA%8F">任务可以排序</a></li>
</ul>
</li>
<li><a href="#%E7%BB%84%E8%A3%85%E7%BA%BF%E7%9A%84%E7%BC%BA%E7%82%B9">组装线的缺点</a></li>
<li><a href="#%E5%8A%9F%E8%83%BD%E5%B9%B6%E8%A1%8C">功能并行</a></li>
<li><a href="#%E5%93%AA%E7%A7%8D%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%9E%8B%E6%9C%80%E5%A5%BD">哪种并发模型最好</a></li>
</ul>
<p>并发系统可以通过使用不同的<em>并发模型</em>来实现。一个<em>并发模型</em>指定了系统中的线程如何通过协作来完成分配给它们的作业。不同的并发模型以不同的方式拆分任务，同时线程间的协作和通信方式也不相同。本并发模型教程将在撰写本文时（2015年至2019年）更深入地研究最流行的并发模型。</p>
<h2 id="并发模型和分布式系统的相似性"><a href="#并发模型和分布式系统的相似性" class="headerlink" title="并发模型和分布式系统的相似性"></a>并发模型和分布式系统的相似性</h2><p>本文中描述的并发模型类似于分布式系统中使用的不同体系结构。在并发系统中，不同的线程彼此通信。在分布式系统中，不同的进程相互通信（进程可存在于不同的计算机上）。本质上，线程和进程彼此非常相似。这就是为什么并发模型通常看起来与分布式系统体系结构相似的原因。</p>
<p>当然，分布式系统还面临着额外的挑战，即网络可能会失败，或者远程计算机或进程关闭等。但是大型服务器上运行的并发系统也可能会遇到类似的问题，如CPU发生故障，网卡发生故障，磁盘发生故障等。虽然失败的可能性很低，但理论上仍会发生。</p>
<p>由于并发模型与分布式系统体系结构相似，因此它们经常可以相互借鉴。例如，用于在workers（线程）之间分配工作的模型通常类似于<a target="_blank" rel="noopener" href="http://tutorials.jenkov.com/software-architecture/load-balancing.html">分布式系统中的负载平衡</a>模型。错误处理技术（例如日志记录，故障转移，任务的幂等）也是如此。</p>
<p>【注：幂等性，一个幂等操作的特点是其任意多次执行所产生的影响均与一次执行的影响相同】</p>
<h2 id="共享状态与分离状态"><a href="#共享状态与分离状态" class="headerlink" title="共享状态与分离状态"></a>共享状态与分离状态</h2><p>不管组件和线程是设计为在线程之间共享状态，还是保持分离状态永远不会在线程之间共享，这都是一个并发模型的关注点，</p>
<p><em>共享状态</em>意味着系统中的不同线程间将共享某些状态。<em>状态</em>是指一些数据，通常是一个或多个对象或类似的东西。当线程共享状态时，可能会出现<a href="#">Post not found: race-conditons</a>和<a href="#">Post not found: deadlock</a>等问题。当然，这取决于线程如何使用和访问共享对象。</p>
<p><img src="http://tutorials.jenkov.com/images/java-concurrency/concurrency-models-0-1.png" alt="具有共享状态的两个线程。"></p>
<p><em>分离状态</em>意味着系统中的不同线程间不共享任何状态。万一不同的线程需要通信，它们可以通过交换不可变对象或发送对象（或数据）的副本（拷贝）来进行通信。因此，当没有两个线程写入同一对象（数据/状态）时，可以避免大多数常见的并发问题。</p>
<p><img src="http://tutorials.jenkov.com/images/java-concurrency/concurrency-models-0-2.png" alt="具有独立状态的两个线程。"></p>
<p>使用分离状态的并发设计通常可以使代码的某些部分更易于实现和推理，因为您知道只有一个线程将写入给定对象。您不必担心并发访问该对象。但是，使用分离状态的并发性设计您可能需要更全面地考虑应用程序设计。我觉得这是值得的。我个人更喜欢单独的状态并发设计。</p>
<h2 id="Parallel-Wokers"><a href="#Parallel-Wokers" class="headerlink" title="Parallel-Wokers"></a>Parallel-Wokers</h2><p>第一个并发模型是我所说的<em>并行工作器</em>模型。传入的任务分配给不同的workers。这是说明<em>并行工作器</em>并发模型的图：</p>
<p><img src="http://tutorials.jenkov.com/images/java-concurrency/concurrency-models-1.png" alt="并行工作者并发模型-基本思想。"></p>
<p>在<em>并行工作器</em>并发模型中，委托人(Delegator) 将传入的作业分配给不同的Worker。每个Worker完成全部工作。这些Worker并行在不同的线程中运行或者不同的CPU上运行。</p>
<p>如果并行worker模型通过汽车工厂实现，则每辆汽车将由一名worker生产。worker将获得要制造的汽车的规格，并会从头到尾制造所有东西。</p>
<p><em>并行工作器</em>模型是Java应用程序中最常用的并发模型（尽管正在发生变化）。<a target="_blank" rel="noopener" href="http://tutorials.jenkov.com/java-util-concurrent/index.html">java.util.concurrent Java包</a> 中的许多并发实用<a target="_blank" rel="noopener" href="http://tutorials.jenkov.com/java-util-concurrent/index.html">程序</a>都是设计用于此模型的。您还可以在Java Enterprise Edition应用程序服务器的设计中看到此模型的痕迹。</p>
<h2 id="Parallel-Wokers优势"><a href="#Parallel-Wokers优势" class="headerlink" title="Parallel-Wokers优势"></a>Parallel-Wokers优势</h2><p>Parallel-Wokers并发模型的优点是易于理解。为了增加应用程序的并行化，您只需添加更多工作程序即可。</p>
<p>例如，如果你正在做一个网络爬虫，可以试试使用不同数量的wokers抓取到一定数量的页面，然后看看多少数量的wokers消耗的时间最短（意味着性能最高）。由于网络爬虫是一个 IO 密集型工作，最终结果很有可能是你电脑中的每个 CPU 或核心分配了几个线程。每个 CPU 若只分配一个线程可能有点少，因为在等待数据下载的过程中 CPU 将会空闲大量时间。</p>
<h2 id="Parallel-Wokers劣势"><a href="#Parallel-Wokers劣势" class="headerlink" title="Parallel-Wokers劣势"></a>Parallel-Wokers劣势</h2><p>但是，Parallel-Wokers并发模型具有一些隐藏在简单表面下的缺点。我将在以下各节中解释最明显的缺点。</p>
<h3 id="共享状态会变得复杂"><a href="#共享状态会变得复杂" class="headerlink" title="共享状态会变得复杂"></a>共享状态会变得复杂</h3><p>实际上，Parallel-Wokers并发模型比上面说明的要复杂一些。共享workers经常需要访问内存或共享数据库中的某种共享数据。下图显示了Parallel-Wokers并发模型的复杂：</p>
<p><img src="http://tutorials.jenkov.com/images/java-concurrency/concurrency-models-2.png" alt="说明共享状态的并行工作程序并发模型"></p>
<p>有些共享状态是在像作业队列这样的通信机制下。但也有一些共享状态是业务数据，数据缓存，数据库连接池等。</p>
<p>一旦共享状态潜入到Parallel-Wokers并发模型中，它就会开始变得复杂。线程需要以某种方式存取共享数据，以确保这个线程的修改能够对其他线程可见（将其推送到主内存中，而不仅仅是停留在执行该线程的CPU的CPU缓存中）。线程需要避免<a target="_blank" rel="noopener" href="http://tutorials.jenkov.com/java-concurrency/race-conditions-and-critical-sections.html">竞态条件</a>， <a target="_blank" rel="noopener" href="http://tutorials.jenkov.com/java-concurrency/deadlock.html">死锁</a>和许多其他共享状态并发问题。</p>
<p>此外，在等待访问共享数据结构时，线程之间的互相等待将会丢失并行性。许多并发数据结构是阻塞的，意味着在任何一个时间只有一个或者很少的线程能够访问。这样会导致在这些共享数据结构上出现竞争状态。在执行需要访问共享数据结构部分的代码时，高竞争基本上会导致执行时出现一定程度的串行化。</p>
<p>现代<a target="_blank" rel="noopener" href="http://tutorials.jenkov.com/java-concurrency/non-blocking-algorithms.html">的非阻塞并发算法</a>可以减少竞争并提高性能，但是非阻塞算法很难实现。</p>
<p>可持久化的数据结构是另一种选择。在修改的时候，可持久化的数据结构总是保护它的前一个版本不受影响。因此，如果多个线程指向同一个可持久化的数据结构，并且其中一个线程进行了修改，进行修改的线程会获得一个指向新结构的引用。所有其他线程保留对旧结构的引用，该旧结构仍保持不变，因此是一致的。Scala编程包含几个持久数据结构。</p>
<p>【注：这里的可持久化数据结构不是指持久化存储，而是一种数据结构，比如 Java 中的 String 类，以及 CopyOnWriteArrayList 类，具体可<a target="_blank" rel="noopener" href="http://www.cnblogs.com/tedzhao/archive/2008/11/12/1332112.html">参考</a>】</p>
<p>虽然可持久化的数据结构在解决共享数据结构的并发修改时显得很优雅，但是可持久化的数据结构的表现往往不尽人意。</p>
<p>例如，一个持久链表会将所有新元素添加到列表的开头，并返回对新添加元素的引用（该引用随后指向列表的其余部分）。所有其他线程仍保留对链表中先前第一个元素的引用，并且对这些线程而言，链表保持不变。他们看不到新添加的元素。</p>
<p>这种可持久化的链表采用链表来实现。不幸的是链表在现代硬件上表现的不太好。链表中得每个元素都是一个独立的对象，这些对象可以遍布在整个计算机内存中。现代 CPU 能够更快的进行顺序访问，所以你可以在现代的硬件上用数组实现的列表，以获得更高的性能。数组可以顺序的保存数据。CPU 缓存能够一次加载数组的一大块进行缓存，一旦加载完成 CPU 就可以直接访问缓存中的数据。这对于元素散落在 RAM 中的链表来说，不太可能做得到。</p>
<h3 id="无状态的Workers"><a href="#无状态的Workers" class="headerlink" title="无状态的Workers"></a>无状态的Workers</h3><p>共享状态可以由系统中的其他线程修改。因此，Workers必须在每次需要数据时重新读取数据，以确保它在最新副本上正常工作。不管共享状态是保存在内存中的还是在外部数据库中都是如此。不在内部保持状态（但每次需要时都会重新读取<em>状态</em>）的worker称为<em>无状态</em>worker。</p>
<p>每次需要时重新读取数据都会变慢，特别是如果状态存储在外部数据库中。</p>
<h3 id="作业排序是不确定的"><a href="#作业排序是不确定的" class="headerlink" title="作业排序是不确定的"></a>作业排序是不确定的</h3><p>并行工作程序模型的另一个缺点是作业执行顺序是不确定的。无法保证首先执行或最后执行哪些作业。作业A可以在作业B之前提供给工人，但作业B可以在作业A之前执行。</p>
<p>并行工作程序模型的不确定性使得在任何给定时间点都难以推理系统状态。这也使得很难（如果不是不可能的话）保证一项工作先于另一项工作发生。</p>
<h2 id="流水线"><a href="#流水线" class="headerlink" title="流水线"></a>流水线</h2><p>第二种并发模型是我所说的<em>组装线</em>并发模型。我选择该名称只是为了适应早先的“并行工作者”隐喻。其他开发人员根据平台/社区使用其他名称（例如，反应系统或事件驱动系统）。这是说明组装线并发模型的图：</p>
<p><img src="http://tutorials.jenkov.com/images/java-concurrency/concurrency-models-3.png" alt="流水线并发模型。"></p>
<p>工人的组织就像工厂中装配线的工人一样。每个工人只完成全部工作的一部分。完成该部分后，工人会将工作转发给下一个工人。</p>
<p>每个工作程序都在自己的线程中运行，并且不与其他工作程序共享任何状态。有时也称为无<em>共享</em>并发模型。</p>
<p>使用组装线并发模型的系统通常设计为使用非阻塞IO。非阻塞IO意味着当工作进程开始IO操作（例如，从网络连接读取文件或数据）时，工作进程不会等待IO调用完成。IO操作速度很慢，因此等待IO操作完成会浪费CPU时间。同时，CPU可能正在做其他事情。IO操作完成后，IO操作的结果（例如，读取的数据或写入的数据的状态）将传递给另一个工作程序。</p>
<p>使用非阻塞IO，IO操作将确定工作线程之间的边界。在必须启动IO操作之前，工作人员会尽力而为。然后，它放弃了对工作的控制。IO操作完成后，装配线中的下一个工作人员将继续进行该作业，直到必须开始IO操作等为止。</p>
<p><img src="http://tutorials.jenkov.com/images/java-concurrency/concurrency-models-4.png" alt="具有无阻塞IO操作的组装线并发模型标记了工作人员职责之间的界限。"></p>
<p>实际上，这些作业可能不会沿着一条装配线流动。由于大多数系统可以执行一项以上的工作，因此工作会根据需要完成的工作在不同的工作人员之间流动。实际上，可能同时存在多个不同的虚拟装配线。这实际上就是流水线系统中的工作流的样子：</p>
<p><img src="http://tutorials.jenkov.com/images/java-concurrency/concurrency-models-5.png" alt="具有多条装配线的装配线并发模型。"></p>
<p>甚至可以将作业转发给多个工人进行并行处理。例如，可以将作业转发给作业执行者和作业记录器。此图说明了三个装配线如何通过将其作业转发给同一工人（中间装配线中的最后一个工人）来完成：</p>
<p><img src="http://tutorials.jenkov.com/images/java-concurrency/concurrency-models-6.png" alt="流水线并发模型显示了转发给多名工人的工作。"></p>
<p>流水线甚至比这还要复杂。</p>
<h3 id="反应性，事件驱动系统"><a href="#反应性，事件驱动系统" class="headerlink" title="反应性，事件驱动系统"></a>反应性，事件驱动系统</h3><p>使用装配线并发模型的<em>系统</em>有时也称为<em>反应系统</em>或 <em>事件驱动系统</em>。系统的工作人员会对系统中发生的事件做出反应，这些事件是从外界接收到的，或者是其他工作人员发出的。事件的示例可能是传入的HTTP请求，或者某个文件已完成加载到内存等。</p>
<p>在撰写本文时，有许多有趣的反应式/事件驱动平台可用，将来还会有更多。一些更受欢迎的似乎是：</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://tutorials.jenkov.com/vert.x/index.html">Vert.x</a></li>
<li>阿卡</li>
<li>Node.JS（JavaScript）</li>
</ul>
<p>我个人认为Vert.x非常有趣（特别是对于像我这样的Java / JVM恐龙）。</p>
<h3 id="演员与频道"><a href="#演员与频道" class="headerlink" title="演员与频道"></a>演员与频道</h3><p>角色和通道是装配线（或反应/事件驱动）模型的两个类似示例。</p>
<p>在演员模型中，每个工人都称为<em>演员</em>。Actor可以直接彼此发送消息。消息是异步发送和处理的。如前所述，Actor可用于实现一个或多个作业处理装配线。这是说明参与者模型的图：</p>
<p><img src="http://tutorials.jenkov.com/images/java-concurrency/concurrency-models-7.png" alt="使用参与者实现的流水线并发模型。"></p>
<p>在渠道模型中，工作人员不会直接相互通信。相反，他们将消息（事件）发布在不同的渠道上。然后，其他工作人员可以在这些频道上收听消息，而发件人不知道谁在收听。这是说明通道模型的图：</p>
<p><img src="http://tutorials.jenkov.com/images/java-concurrency/concurrency-models-8.png" alt="使用渠道实现的流水线并发模型。"></p>
<p>在撰写本文时，渠道模型对我来说似乎更灵活。工人无需知道稍后在装配线中将处理什么工作的工人。它只需要知道将作业转发到哪个渠道（或将消息发送到等等）。频道上的侦听器可以订阅和取消订阅，而不会影响工作人员写入频道。这允许工人之间的联轴器稍松一些。</p>
<h2 id="流水线优势"><a href="#流水线优势" class="headerlink" title="流水线优势"></a>流水线优势</h2><p>与并行工作程序模型相比，组装线并发模型具有多个优点。我将在以下各节中介绍最大的优势。</p>
<h3 id="没有共享状态"><a href="#没有共享状态" class="headerlink" title="没有共享状态"></a>没有共享状态</h3><p>工作人员与其他工作人员不共享任何状态的事实意味着，无需考虑并发访问共享状态可能引起的所有并发问题，就可以实现他们。这使实施工人变得容易得多。您将工作程序实现为好像是执行该工作的唯一线程-本质上是单线程实现。</p>
<h3 id="有状态的工人"><a href="#有状态的工人" class="headerlink" title="有状态的工人"></a>有状态的工人</h3><p>由于工作人员知道没有其他线程修改其数据，因此工作人员可以是有状态的。有状态的意思是他们可以将需要操作的数据保留在内存中，仅将更改写回最终的外部存储系统。因此，有状态工人通常比无状态工人更快。</p>
<h3 id="更好的硬件整合"><a href="#更好的硬件整合" class="headerlink" title="更好的硬件整合"></a>更好的硬件整合</h3><p>单线程代码的优势在于，它通常与底层硬件的工作方式更好地相符。首先，当您可以假定代码以单线程模式执行时，通常可以创建更优化的数据结构和算法。</p>
<p>其次，单线程有状态工作者可以如上所述在内存中缓存数据。当将数据缓存在内存中时，也更有可能将该数据也缓存在执行线程的CPU的CPU缓存中。这样可以更快地访问缓存的数据。</p>
<p>当我以自然受益于底层硬件工作方式的方式编写代码时，我将其称为<em>硬件一致性</em>。一些开发商称这种<em>机械同情</em>。我更喜欢“硬件一致性”一词，因为计算机几乎没有机械部件，在这种情况下，“同情”一词被用作“更好地匹配”的隐喻，我相信“符合”一词可以很好地传达。无论如何，这是挑剔的。使用您喜欢的任何术语。</p>
<h3 id="可以订购工作"><a href="#可以订购工作" class="headerlink" title="可以订购工作"></a>可以订购工作</h3><p>可以根据组装线并发模型以确保作业排序的方式实现并发系统。作业排序使在任何给定时间点推断系统状态变得更加容易。此外，您可以将所有传入的作业写入日志。然后，在系统的任何部分发生故障的情况下，可以使用此日志从头开始重建系统状态。作业以特定顺序写入日志，并且该顺序成为保证的作业顺序。这是这样的设计的外观：</p>
<p><img src="http://tutorials.jenkov.com/images/java-concurrency/concurrency-models-8.png" alt="具有作业记录器的流水线并发模型。"></p>
<p>实施保证的工作订单不一定很容易，但是通常是可能的。如果可以的话，它可以极大地简化备份，还原数据，复制数据等任务，因为所有这些都可以通过日志文件来完成。</p>
<h2 id="组装线的缺点"><a href="#组装线的缺点" class="headerlink" title="组装线的缺点"></a>组装线的缺点</h2><p>组装流水线并发模型的主要缺点是，作业的执行通常分散在多个工作人员上，因此会分散在项目中的多个类上。因此，很难确切地知道给定作业正在执行什么代码。</p>
<p>编写代码也可能会更困难。辅助代码有时被编写为回调处理程序。具有许多嵌套回调处理程序的代码可能会导致某些开发人员称之为<em>回调地狱</em>。回调地狱只是意味着很难跟踪所有回调中代码的实际作用，以及确保每个回调都可以访问所需的数据。</p>
<p>使用并行工作程序并发模型，这往往会更容易。您可以打开工作程序代码，并从头到尾阅读几乎执行的代码。当然，并行工作程序代码也可以散布在许多不同的类上，但是执行顺序通常更容易从代码中读取。</p>
<h2 id="功能并行"><a href="#功能并行" class="headerlink" title="功能并行"></a>功能并行</h2><p>功能并行是第三种并发模型，最近（2015年）被广泛讨论。</p>
<p>函数并行性的基本思想是使用函数调用实现程序。功能可以看作是相互发送消息的“代理”或“角色”，就像在组装线并发模型（AKA反应或事件驱动系统）中一样。当一个函数调用另一个函数时，这类似于发送消息。</p>
<p>复制传递给该函数的所有参数，因此接收函数之外的任何实体都无法操纵该数据。该复制对于避免共享数据出现争用情况至关重要。这使得函数执行类似于原子操作。每个函数调用都可以独立于任何其他函数调用执行。</p>
<p>当每个函数调用可以独立执行时，每个函数调用可以在单独的CPU上执行。这就是说，功能上实现的算法可以在多个CPU上并行执行。</p>
<p>使用Java 7，我们获得了<code>java.util.concurrent</code>包含<a target="_blank" rel="noopener" href="http://tutorials.jenkov.com/java-util-concurrent/java-fork-and-join-forkjoinpool.html">ForkAndJoinPool</a>的软件包，该软件包 可以帮助您实现类似于功能并行的功能。使用Java 8，我们获得了并行<a target="_blank" rel="noopener" href="http://tutorials.jenkov.com/java-collections/streams.html">流</a> ，可以帮助您并行化大型集合的迭代。请记住，有些开发人员对此表示批评<code>ForkAndJoinPool</code>（您可以在本<code>ForkAndJoinPool</code>教程中找到批评的链接）。</p>
<p>关于函数并行性的难点是知道要并行调用哪些函数。跨CPU协调函数调用会带来开销。一个功能完成的工作单元必须具有一定的大小，才能负担此开销。如果函数调用很小，则尝试并行化它们实际上可能比单线程，单CPU执行慢。</p>
<p>根据我的理解（一点都不完美），您可以使用反应性，事件驱动的模型来实现算法，并实现类似于功能并行性的工作分解。使用均匀驱动的模型，您可以更好地控制要并行化的对象和数量（在我看来）。</p>
<p>此外，只有在该任务当前是程序唯一执行的任务时，才有意义地将任务分配给多个CPU，并产生开销。但是，如果系统正在同时执行多个其他任务（例如，Web服务器，数据库服务器和许多其他系统都在执行），则尝试并行化单个任务毫无意义。无论如何，计算机中的其他CPU都将忙于其他任务，因此没有理由尝试以较慢的，功能上并行的任务来打扰它们。组装流水线（反应式）并发模型可能会更好，因为它具有较少的开销（以单线程模式顺序执行），并且与底层硬件的工作方式更好地兼容。</p>
<h2 id="哪种并发模型最好"><a href="#哪种并发模型最好" class="headerlink" title="哪种并发模型最好"></a>哪种并发模型最好</h2><p>那么，哪种并发模型更好？</p>
<p>通常，答案是这取决于系统应该执行的操作。如果您的工作自然是并行的，独立的并且不需要共享状态，则可以使用并行工作器模型来实现系统。</p>
<p>但是，许多工作并非自然而然地平行和独立。对于这些类型的系统，我相信流水线并发模型的优点要大于缺点，并且要比并行工作器模型多。</p>
<p>您甚至不必自己编写所有组装线基础设施的代码。像<a target="_blank" rel="noopener" href="http://tutorials.jenkov.com/vert.x/index.html">Vert.x</a>这样的现代平台 已经为您实现了很多功能。我个人将为下一个项目探索在Vert.x等平台上运行的设计。我觉得Java EE不再具有优势。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/07/20/costs/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ZP">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/20/costs/" class="post-title-link" itemprop="url">多线程成本</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2020-07-20 17:22:50 / 修改时间：18:10:00" itemprop="dateCreated datePublished" datetime="2020-07-20T17:22:50+08:00">2020-07-20</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="多线程成本"><a href="#多线程成本" class="headerlink" title="多线程成本"></a>多线程成本</h1><ul>
<li><a href="#%E6%9B%B4%E5%A4%8D%E6%9D%82%E7%9A%84%E8%AE%BE%E8%AE%A1">更复杂的设计</a></li>
<li><a href="#%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2%E5%BC%80%E9%94%80">上下文切换开销</a></li>
<li><a href="#%E8%B5%84%E6%BA%90%E6%B6%88%E8%80%97%E5%A2%9E%E5%8A%A0">资源消耗增加</a></li>
</ul>
<p>从单线程应用程序到多线程应用程序不仅会带来好处。它还有一些成本。不要仅仅因为可以就启用多线程应用程序。您应该有一个好主意，即这样做所带来的收益大于成本。如有疑问，请尝试评估应用程序的性能或响应能力，而不仅仅是猜测。</p>
<h2 id="更复杂的设计"><a href="#更复杂的设计" class="headerlink" title="更复杂的设计"></a>更复杂的设计</h2><p>尽管多线程应用程序的某些部分比单线程应用程序简单，但其他部分则更复杂。由多个线程访问共享数据执行的代码需要特别注意。线程交互远非总是那么简单。错误线程同步引起的错误很难检测，重现和修复。</p>
<h2 id="上下文切换开销"><a href="#上下文切换开销" class="headerlink" title="上下文切换开销"></a>上下文切换开销</h2><p>当CPU从执行一个线程切换到执行另一个线程时，CPU需要保存当前线程的本地数据，程序指针等，并加载要执行的下一个线程的本地数据，程序指针等。该开关称为“上下文开关”。CPU从在一个线程的上下文中执行切换为在另一个线程的上下文中执行。</p>
<p>上下文切换并不便宜。您不想在线程之间进行不必要的切换。</p>
<p>您可以在Wikipedia上阅读有关上下文切换的更多信息：</p>
<p><a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/Context_switch">http://en.wikipedia.org/wiki/Context_switch</a></p>
<h2 id="资源消耗增加"><a href="#资源消耗增加" class="headerlink" title="资源消耗增加"></a>资源消耗增加</h2><p>线程需要计算机中的一些资源才能运行。除了CPU时间外，线程还需要一些内存来保留其本地堆栈。它还可能会占用操作系统中管理线程所需的一些资源。尝试创建一个程序，该程序创建的100个线程除了等待外什么都不做，并查看应用程序在运行时需要占用多少内存。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/07/20/benifits/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ZP">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/20/benifits/" class="post-title-link" itemprop="url">多线程的好处</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2020-07-20 16:55:13 / 修改时间：17:14:47" itemprop="dateCreated datePublished" datetime="2020-07-20T16:55:13+08:00">2020-07-20</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="多线程的好处"><a href="#多线程的好处" class="headerlink" title="多线程的好处"></a>多线程的好处</h1><ul>
<li><a href="#%E6%9B%B4%E5%A5%BD%E7%9A%84CPU%E4%BD%BF%E7%94%A8%E7%8E%87">更好的CPU使用率</a></li>
<li><a href="#%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E6%9B%B4%E7%AE%80%E5%8D%95">程序设计更简单</a></li>
<li><a href="#%E6%9B%B4%E5%A4%9A%E5%93%8D%E5%BA%94%E7%A8%8B%E5%BA%8F">更多响应程序</a></li>
<li><a href="#%E6%9B%B4%E5%85%AC%E5%B9%B3%E5%9C%B0%E5%88%86%E9%85%8DCPU%E8%B5%84%E6%BA%90">更公平地分配CPU资源</a></li>
</ul>
<p>多线程的最大好处是：</p>
<ul>
<li>更高的CPU利用率。</li>
<li>在某些情况下，程序设计更简单。</li>
<li>响应速度更快的程序。</li>
<li>在不同任务之间更公平地分配CPU资源。</li>
</ul>
<h2 id="更好的CPU使用率"><a href="#更好的CPU使用率" class="headerlink" title="更好的CPU使用率"></a>更好的CPU使用率</h2><p>想象一个应用程序从本地文件系统读取和处理文件。可以说，从磁盘读取af文件需要5秒钟，而处理则需要2秒钟。然后处理两个文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  5秒读取文件A</span><br><span class="line">  2秒处理文件A</span><br><span class="line">  5秒钟读取文件B</span><br><span class="line">  2秒处理文件B</span><br><span class="line">-----------------------</span><br><span class="line"> 总共14秒</span><br></pre></td></tr></table></figure>

<p>从磁盘读取文件时，大部分的CPU时间都花费在等待磁盘读取数据上。在这段时间内，CPU几乎处于空闲状态。它可能正在做其他事情。通过更改操作顺序，可以更好地利用CPU。查看以下顺序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  5秒读取文件A</span><br><span class="line">  5秒读取文件B + 2秒处理文件A</span><br><span class="line">  2秒处理文件B</span><br><span class="line">-----------------------</span><br><span class="line"> 总共12秒</span><br></pre></td></tr></table></figure>

<p>CPU等待读取第一个文件。然后，它开始读取第二个文件。当计算机的IO组件读取第二个文件时，CPU处理第一个文件。请记住，在等待从磁盘读取文件时，CPU大部分处于空闲状态。</p>
<p>通常，CPU在等待IO时可以做其他事情。不必是磁盘IO。它也可以是网络IO，也可以是来自计算机用户的输入。网络和磁盘IO通常比CPU和内存IO慢很多。</p>
<h2 id="程序设计更简单"><a href="#程序设计更简单" class="headerlink" title="程序设计更简单"></a>程序设计更简单</h2><p>如果要在单线程应用程序中手动编写上述读取和处理的顺序，则必须跟踪每个文件的读取和处理状态。相反，您可以启动两个线程，每个线程仅读取和处理一个文件。这些等待线程将在等待磁盘读取其文件时被阻止。在等待时，其他线程可以使用CPU处理已读取的文件部分。结果是磁盘始终保持忙碌状态，将各种文件读入内存。这样可以更好地利用磁盘和CPU。由于每个线程只需要跟踪一个文件，因此编程也更容易。</p>
<h2 id="更多响应程序"><a href="#更多响应程序" class="headerlink" title="更多响应程序"></a>更多响应程序</h2><p>将单线程应用程序转换为多线程应用程序的另一个共同目标是实现响应速度更快的应用程序。想象一下一个服务器应用程序在某个端口上侦听传入的请求。收到请求后，它将处理该请求，然后返回监听。服务器循环如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">while(server is active)&#123;</span><br><span class="line">  listen for request</span><br><span class="line">  process request</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果处理该请求需要很长时间，则在这段时间内没有新客户端可以向服务器发送新的请求。只有在服务器正在侦听时，才能接收请求。</p>
<p>另一种设计是侦听线程将请求传递给工作线程，然后立即返回侦听。工作线程将处理该请求，并将回复发送给客户端。该设计概述如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">while(server is active)&#123;</span><br><span class="line">  listen for request</span><br><span class="line">  hand request to worker thread</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样，服务器线程将尽快恢复监听。因此，更多的客户端可以将请求发送到服务器。服务器变得响应性更好。</p>
<p>桌面应用程序也是如此。如果单击启动长任务的按钮，并且执行任务的线程是更新窗口，按钮等的线程，则任务执行时应用程序将显示为无响应。好办法是：可以将任务移交给工作线程。当工作线程忙于任务时，窗口线程可以自由响应其他用户请求。当工作线程完成时，它向窗口线程发出信号。然后，窗口线程可以使用任务结果来更新应用程序窗口。具有工作线程设计的程序将对用户更加友好响应。</p>
<h2 id="更公平地分配CPU资源"><a href="#更公平地分配CPU资源" class="headerlink" title="更公平地分配CPU资源"></a>更公平地分配CPU资源</h2><p>假设有一个服务器正在接收来自客户端的请求。然后想象一下，其中一个客户端发送了一个处理时间很长的请求，例如10秒。如果服务器使用单个线程处理了所有任务，则处理缓慢的请求后的所有请求都将被迫等待，直到处理完完整的请求为止。</p>
<p>通过在多个线程之间分配CPU时间并在线程之间进行切换，CPU可以在多个请求之间更公平地共享其执行时间。这样，即使其中一个请求较慢，也可以与较慢的请求同时执行处理速度更快的其他请求。当然，这意味着执行慢速请求的速度甚至会更慢。但是，其他请求将等待更短的时间来处理，因为它们不必等待慢的任务完成才可以处理它们。如果只有慢速请求要处理，则仍可以将CPU单独分配给慢速任务。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/07/20/%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E7%9A%84%E4%BB%A3%E7%A0%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ZP">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/20/%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E7%9A%84%E4%BB%A3%E7%A0%81/" class="post-title-link" itemprop="url">线程安全的代码</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2020-07-20 15:30:26 / 修改时间：15:34:50" itemprop="dateCreated datePublished" datetime="2020-07-20T15:30:26+08:00">2020-07-20</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="线程安全与共享资源"><a href="#线程安全与共享资源" class="headerlink" title="线程安全与共享资源"></a>线程安全与共享资源</h1><p>允许被多个线程同时执行的代码称作线程安全的代码。线程安全的代码不包含竞态条件。当多个线程同时更新共享资源时会引发竞态条件。因此，了解 Java 线程执行时共享了什么资源很重要。</p>
<h2 id="局部变量"><a href="#局部变量" class="headerlink" title="局部变量"></a>局部变量</h2><p>局部变量存储在线程自己的栈中。也就是说，局部变量永远也不会被多个线程共享。所以，基础类型的局部变量是线程安全的。下面是基础类型的局部变量的一个例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">someMethod</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">long</span> threadSafeInt = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  threadSafeInt++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="局部的对象引用"><a href="#局部的对象引用" class="headerlink" title="局部的对象引用"></a>局部的对象引用</h2><p>对象的局部引用和基础类型的局部变量不太一样。尽管引用本身没有被共享，但引用所指的对象并没有存储在线程的栈内。所有的对象都存在共享堆中。如果在某个方法中创建的对象不会逃逸出（<em>译者注：即该对象不会被其它方法获得，也不会被非局部变量引用到</em>）该方法，那么它就是线程安全的。实际上，哪怕将这个对象作为参数传给其它方法，只要别的线程获取不到这个对象，那它仍是线程安全的。下面是一个线程安全的局部引用样例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">someMethod</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  LocalObject localObject = <span class="keyword">new</span> LocalObject();</span><br><span class="line"></span><br><span class="line">  localObject.callMethod();</span><br><span class="line">  method2(localObject);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method2</span><span class="params">(LocalObject localObject)</span></span>&#123;</span><br><span class="line">  localObject.setValue(<span class="string">&quot;value&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>样例中 LocalObject 对象没有被方法返回，也没有被传递给 someMethod()方法外的对象。每个执行 someMethod()的线程都会创建自己的 LocalObject 对象，并赋值给 localObject 引用。因此，这里的 LocalObject 是线程安全的。事实上，整个 someMethod()都是线程安全的。即使将 LocalObject 作为参数传给同一个类的其它方法或其它类的方法时，它仍然是线程安全的。当然，如果 LocalObject 通过某些方法被传给了别的线程，那它就不再是线程安全的了。</p>
<h2 id="对象成员"><a href="#对象成员" class="headerlink" title="对象成员"></a>对象成员</h2><p>对象成员存储在堆上。如果两个线程同时更新同一个对象的同一个成员，那这个代码就不是线程安全的。下面是一个样例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NotThreadSafe</span></span>&#123;</span><br><span class="line">    StringBuilder builder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">add</span><span class="params">(String text)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.builder.append(text);</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果两个线程同时调用同一个 NotThreadSafe 实例上的 add()方法，就会有竞态条件问题。例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">NotThreadSafe sharedInstance = <span class="keyword">new</span> NotThreadSafe();</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Thread(<span class="keyword">new</span> MyRunnable(sharedInstance)).start();</span><br><span class="line"><span class="keyword">new</span> Thread(<span class="keyword">new</span> MyRunnable(sharedInstance)).start();</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">  NotThreadSafe instance = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">MyRunnable</span><span class="params">(NotThreadSafe instance)</span></span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.instance = instance;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.instance.add(<span class="string">&quot;some text&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意两个 MyRunnable 共享了同一个 NotThreadSafe 对象。因此，当它们调用 add()方法时会造成竞态条件。</p>
<p>当然，如果这两个线程在不同的 NotThreadSafe 实例上调用 call()方法，就不会导致竞态条件。下面是稍微修改后的例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Thread(<span class="keyword">new</span> MyRunnable(<span class="keyword">new</span> NotThreadSafe())).start();</span><br><span class="line"><span class="keyword">new</span> Thread(<span class="keyword">new</span> MyRunnable(<span class="keyword">new</span> NotThreadSafe())).start();</span><br></pre></td></tr></table></figure>

<p>现在两个线程都有自己单独的 NotThreadSafe 对象，调用 add()方法时就会互不干扰，再也不会有竞态条件问题了。所以非线程安全的对象仍可以通过某种方式来消除竞态条件。</p>
<h2 id="线程控制逃逸规则"><a href="#线程控制逃逸规则" class="headerlink" title="线程控制逃逸规则"></a>线程控制逃逸规则</h2><p>线程控制逃逸规则可以帮助你判断代码中对某些资源的访问是否是线程安全的。</p>
<blockquote>
<p>如果一个资源的创建，使用，销毁都在同一个线程内完成，<br>且永远不会脱离该线程的控制，则该资源的使用就是线程安全的。</p>
</blockquote>
<p>资源可以是对象，数组，文件，数据库连接，套接字等等。Java 中你无需主动销毁对象，所以“销毁”指不再有引用指向对象。</p>
<p>即使对象本身线程安全，但如果该对象中包含其他资源（文件，数据库连接），整个应用也许就不再是线程安全的了。比如 2 个线程都创建了各自的数据库连接，每个连接自身是线程安全的，但它们所连接到的同一个数据库也许不是线程安全的。比如，2 个线程执行如下代码：</p>
<blockquote>
<p>检查记录 X 是否存在，如果不存在，插入 X</p>
</blockquote>
<p>如果两个线程同时执行，而且碰巧检查的是同一个记录，那么两个线程最终可能都插入了记录：</p>
<blockquote>
<p>线程 1 检查记录 X 是否存在。检查结果：不存在<br>线程 2 检查记录 X 是否存在。检查结果：不存在<br>线程 1 插入记录 X<br>线程 2 插入记录 X</p>
</blockquote>
<p>同样的问题也会发生在文件或其他共享资源上。因此，区分某个线程控制的对象是资源本身，还是仅仅到某个资源的引用很重要。</p>
<h1 id="竞态条件与临界区"><a href="#竞态条件与临界区" class="headerlink" title="竞态条件与临界区"></a>竞态条件与临界区</h1><p>在同一程序中运行多个线程本身不会导致问题，问题在于多个线程访问了相同的资源。如，同一内存区（变量，数组，或对象）、系统（数据库，web services 等）或文件。实际上，这些问题只有在一或多个线程向这些资源做了写操作时才有可能发生，只要资源没有发生变化,多个线程读取相同的资源就是安全的。</p>
<p>多线程同时执行下面的代码可能会出错：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Counter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">long</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">long</span> value)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.count = <span class="keyword">this</span>.count + value;   </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>想象下线程 A 和 B 同时执行同一个 Counter 对象的 add()方法，我们无法知道操作系统何时会在两个线程之间切换。JVM 并不是将这段代码视为单条指令来执行的，而是按照下面的顺序：</p>
<blockquote>
<p>从内存获取 this.count 的值放到寄存器<br>将寄存器中的值增加 value<br>将寄存器中的值写回内存</p>
</blockquote>
<p>观察线程 A 和 B 交错执行会发生什么：</p>
<blockquote>
<p>this.count = 0;<br>A: 读取 this.count 到一个寄存器 (0)<br>B: 读取 this.count 到一个寄存器 (0)<br>B: 将寄存器的值加 2<br>B: 回写寄存器值(2)到内存. this.count 现在等于 2<br>A: 将寄存器的值加 3<br>A: 回写寄存器值(3)到内存. this.count 现在等于 3</p>
</blockquote>
<p>两个线程分别加了 2 和 3 到 count 变量上，两个线程执行结束后 count 变量的值应该等于 5。然而由于两个线程是交叉执行的，两个线程从内存中读出的初始值都是 0。然后各自加了 2 和 3，并分别写回内存。最终的值并不是期望的 5，而是最后写回内存的那个线程的值，上面例子中最后写回内存的是线程 A，但实际中也可能是线程 B。如果没有采用合适的同步机制，线程间的交叉执行情况就无法预料。</p>
<h2 id="竞态条件-amp-临界区"><a href="#竞态条件-amp-临界区" class="headerlink" title="竞态条件 &amp; 临界区"></a>竞态条件 &amp; 临界区</h2><p>当两个线程竞争同一资源时，如果对资源的访问顺序敏感，就称存在竞态条件。导致竞态条件发生的代码区称作临界区。上例中 add()方法就是一个临界区,它会产生竞态条件。在临界区中使用适当的同步就可以避免竞态条件。</p>
<h1 id="线程安全及不可变性"><a href="#线程安全及不可变性" class="headerlink" title="线程安全及不可变性"></a>线程安全及不可变性</h1><p>当多个线程同时访问同一个资源，并且其中的一个或者多个线程对这个资源进行了写操作，才会产生竞态条件。多个线程同时读同一个资源不会产生竞态条件。</p>
<p>我们可以通过创建不可变的共享对象来保证对象在线程间共享时不会被修改，从而实现线程安全。如下示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImmutableValue</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> value = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ImmutableValue</span><span class="params">(<span class="keyword">int</span> value)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getValue</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>请注意 ImmutableValue 类的成员变量 value 是通过构造函数赋值的，并且在类中没有 set 方法。这意味着一旦 ImmutableValue 实例被创建，value 变量就不能再被修改，这就是不可变性。但你可以通过 getValue()方法读取这个变量的值。</p>
<p>（<em>译者注：注意，“不变”（Immutable）和“只读”（Read Only）是不同的。当一个变量是“只读”时，变量的值不能直接改变，但是可以在其它变量发生改变的时候发生改变。比如，一个人的出生年月日是“不变”属性，而一个人的年龄便是“只读”属性，但是不是“不变”属性。随着时间的变化，一个人的年龄会随之发生变化，而一个人的出生年月日则不会变化。这就是“不变”和“只读”的区别。（摘自《Java 与模式》第 34 章）</em>）</p>
<p>如果你需要对 ImmutableValue 类的实例进行操作，可以通过得到 value 变量后创建一个新的实例来实现，下面是一个对 value 变量进行加法操作的示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public class ImmutableValue&#123;</span><br><span class="line">    private int value &#x3D; 0;</span><br><span class="line"></span><br><span class="line">    public ImmutableValue(int value)&#123;</span><br><span class="line">        this.value &#x3D; value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getValue()&#123;</span><br><span class="line">        return this.value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public ImmutableValue add(int valueToAdd)&#123;</span><br><span class="line">        return new ImmutableValue(this.value + valueToAdd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>请注意 add()方法以加法操作的结果作为一个新的 ImmutableValue 类实例返回，而不是直接对它自己的 value 变量进行操作。</p>
<h2 id="引用不是线程安全的！"><a href="#引用不是线程安全的！" class="headerlink" title="引用不是线程安全的！"></a>引用不是线程安全的！</h2><p>重要的是要记住，即使一个对象是线程安全的不可变对象，指向这个对象的引用也可能不是线程安全的。看这个例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public void Calculator&#123;</span><br><span class="line">    private ImmutableValue currentValue &#x3D; null;</span><br><span class="line"></span><br><span class="line">    public ImmutableValue getValue()&#123;</span><br><span class="line">        return currentValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setValue(ImmutableValue newValue)&#123;</span><br><span class="line">        this.currentValue &#x3D; newValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void add(int newValue)&#123;</span><br><span class="line">        this.currentValue &#x3D; this.currentValue.add(newValue);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Calculator 类持有一个指向 ImmutableValue 实例的引用。注意，通过 setValue()方法和 add()方法可能会改变这个引用。因此，即使 Calculator 类内部使用了一个不可变对象，但 Calculator 类本身还是可变的，因此 Calculator 类不是线程安全的。换句话说：ImmutableValue 类是线程安全的，但使用它的类不是。当尝试通过不可变性去获得线程安全时，这点是需要牢记的。</p>
<p>要使 Calculator 类实现线程安全，将 getValue()、setValue()和 add()方法都声明为同步方法即可。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>





  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



      

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      

      

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ZP</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.0/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  


















  








  

  

</body>
</html>
