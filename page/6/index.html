<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.0/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"8.0.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="让我欢喜让我忧">
<meta property="og:url" content="http://example.com/page/6/index.html">
<meta property="og:site_name" content="让我欢喜让我忧">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="弱智骚年">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/6/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>让我欢喜让我忧</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">让我欢喜让我忧</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>日程表</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a>

  </li>
        <li class="menu-item menu-item-commonweal">

    <a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>公益 404</a>

  </li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">弱智骚年</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">14</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </section>
    </div>
   	<div>
   　	　
	<iframe id="iframeId" frameborder="no" border="0" marginwidth="0" marginheight="0" width="210" height="110" src="//music.163.com/outchain/player?type=2&id=1431448890&auto=1&height=66"></iframe>
	　
	</div> 　
  </aside>
	
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">
      

      
    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/07/20/same-threading/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="弱智骚年">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="让我欢喜让我忧">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/20/same-threading/" class="post-title-link" itemprop="url">同一线程</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2020-07-20 18:02:48 / 修改时间：18:26:15" itemprop="dateCreated datePublished" datetime="2020-07-20T18:02:48+08:00">2020-07-20</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="同一线程"><a href="#同一线程" class="headerlink" title="同一线程"></a>同一线程</h1><ul>
<li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9%E5%8D%95%E7%BA%BF%E7%A8%8B%E7%B3%BB%E7%BB%9F">为什么选择单线程系统</a></li>
<li>同线程：单线程横向扩展<ul>
<li><a href="#%E6%AF%8F%E4%B8%AACPU%E4%B8%80%E4%B8%AA%E7%BA%BF%E7%A8%8B">每个CPU一个线程</a></li>
</ul>
</li>
<li><a href="#%E6%B2%A1%E6%9C%89%E5%85%B1%E4%BA%AB%E7%8A%B6%E6%80%81">没有共享状态</a></li>
<li>负载分配<ul>
<li><a href="#%E5%8D%95%E7%BA%BF%E7%A8%8B%E5%BE%AE%E6%9C%8D%E5%8A%A1">单线程微服务</a></li>
<li><a href="#%E5%85%B1%E4%BA%AB%E6%95%B0%E6%8D%AE%E6%9C%8D%E5%8A%A1">共享数据服务</a></li>
</ul>
</li>
<li><a href="#%E7%BA%BF%E7%A8%8B%E9%80%9A%E4%BF%A1">线程通信</a></li>
<li><a href="#%E6%9B%B4%E7%AE%80%E5%8D%95%E7%9A%84%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%9E%8B">更简单的并发模型</a></li>
<li><a href="#%E4%BE%8B%E8%AF%81">例证</a></li>
<li><a href="#Java%E7%BA%BF%E7%A8%8B%E6%93%8D%E4%BD%9C">Java线程操作</a></li>
</ul>
<p>同线程是一种并发模型，其中单线程系统可扩展到N个单线程系统。结果是N个单线程系统并行运行。</p>
<p>同一个线程的系统不是纯粹的单线程系统，因为它包含多个线程。但是-每个线程都像单线程系统一样运行。因此，术语“ <em>同线程”</em>而不是“单线程”。</p>
<h2 id="为什么选择单线程系统？"><a href="#为什么选择单线程系统？" class="headerlink" title="为什么选择单线程系统？"></a>为什么选择单线程系统？</h2><p>您可能想知道为什么今天有人会设计单线程系统。单线程系统之所以流行，是因为其并发模型比多线程系统简单得多。单线程系统不与其他线程共享任何状态（对象/数据）。这使单线程可以使用非并发数据结构，并更好地利用CPU和CPU缓存。</p>
<p>不幸的是，单线程系统不能完全利用现代CPU。现代CPU通常会多带2、4、6、8个内核。每个内核都充当一个单独的CPU。单线程系统只能使用其中一个内核，如下所示：</p>
<p><img src="http://tutorials.jenkov.com/images/java-concurrency/same-threading-0.png" alt="在4核CPU上运行的单线程系统。"></p>
<h2 id="同线程：单线程横向扩展"><a href="#同线程：单线程横向扩展" class="headerlink" title="同线程：单线程横向扩展"></a>同线程：单线程横向扩展</h2><p>为了利用CPU中的所有内核，可以扩展单线程系统以利用整个计算机。</p>
<h3 id="每个CPU一个线程"><a href="#每个CPU一个线程" class="headerlink" title="每个CPU一个线程"></a>每个CPU一个线程</h3><p>同线程系统通常在计算机中每个CPU运行1个线程。如果计算机包含4个CPU或具有4个内核的CPU，则通常会运行4个相同线程系统的实例（4个单线程系统）。下图显示了这一原理：</p>
<p><img src="http://tutorials.jenkov.com/images/java-concurrency/same-threading-0-1.png" alt="在4核CPU上运行的同线程系统。"></p>
<h2 id="没有共享状态"><a href="#没有共享状态" class="headerlink" title="没有共享状态"></a>没有共享状态</h2><p>同一个线程的系统看起来类似于传统的多线程系统，因为同一个线程的系统内部有多个线程在运行。但是有细微的差别。</p>
<p>同一线程系统与传统多线程系统之间的区别在于，同一线程系统中的线程不共享状态。没有线程并行访问的共享内存。没有线程共享数据的并发数据结构等。此处说明了这种差异：</p>
<p><img src="http://tutorials.jenkov.com/images/java-concurrency/same-threading-4.png" alt="多线程和同线程系统。"></p>
<p>缺少共享状态是导致每个线程在单线程系统下的行为。但是，由于同一个线程的系统可以包含多个线程-它实际上不是“单线程系统”。在没有更好的名字的情况下，我发现将这样的系统称为<em>同线程</em>系统而不是“具有单线程设计的多线程系统” 更为精确。同线程更容易说，也更容易理解。</p>
<p>从本质上讲，同一线程意味着数据处理停留在同一线程内，并且同一线程系统中没有线程可以同时共享数据。有时，这也被称为 <em>没有共享状态</em>并发或<em>单独的状态</em>并发。</p>
<h2 id="负载分配"><a href="#负载分配" class="headerlink" title="负载分配"></a>负载分配</h2><p>显然，同一个线程的系统需要在运行的单线程实例之间共享工作负载。如果只有一个线程可以完成任何工作，则该系统实际上将是单线程的。</p>
<p>究竟如何在不同线程上分配负载取决于系统的设计。我将在以下各节中介绍一些内容。</p>
<h3 id="单线程微服务"><a href="#单线程微服务" class="headerlink" title="单线程微服务"></a>单线程微服务</h3><p>如果您的系统包含多个微服务，则每个微服务都可以单线程模式运行。当您将多个单线程微服务部署到同一台计算机上时，每个微服务都可以在单个CPU上运行单个线程。</p>
<p>微服务本质上不共享任何数据，因此微服务是同线程系统的一个很好的用例。</p>
<h3 id="分片数据服务"><a href="#分片数据服务" class="headerlink" title="分片数据服务"></a>分片数据服务</h3><p>如果您的系统确实确实需要共享数据，或者至少需要共享一个数据库，则可以对数据库进行分片。分片意味着将数据分为多个数据库。通常对数据进行划分，以使彼此相关的所有数据一起位于同一数据库中。例如，属于某个“所有者”实体的所有数据都将插入同一数据库中。但是，分片不在本教程的讨论范围之内，因此您必须搜索有关该主题的教程。</p>
<h2 id="线程通讯"><a href="#线程通讯" class="headerlink" title="线程通讯"></a>线程通讯</h2><p>如果同一线程系统中的线程需要通信，则通过消息传递来实现。如果线程A要向线程B发送消息，则线程A可以通过生成消息（字节序列）来发送消息。然后，线程B可以复制该消息（字节序列）并读取它。通过复制消息，线程B确保线程A在读取消息时无法修改消息。复制后，线程A无法访问消息副本。</p>
<p>通过消息传递进行的线程通信如下所示：</p>
<p><img src="http://tutorials.jenkov.com/images/java-concurrency/same-threading-5.png" alt="在同一线程系统中通过消息传递进行线程通信。"></p>
<p>线程通信可以通过队列，管道，unix套接字，TCP套接字等进行。无论您的系统适合什么。</p>
<h2 id="更简单的并发模型"><a href="#更简单的并发模型" class="headerlink" title="更简单的并发模型"></a>更简单的并发模型</h2><p>在同一个线程系统中在其自己的线程中运行的每个系统都可以实现为单线程。这意味着内部并发模型变得比线程共享状态简单得多。您不必担心并发数据结构以及此类数据结构可能导致的所有并发问题。</p>
<h2 id="例证"><a href="#例证" class="headerlink" title="例证"></a>例证</h2><p>这是单线程，多线程和同线程系统的图示，因此您可以更轻松地了解它们之间的区别。</p>
<p>第一个插图显示了一个单线程系统。</p>
<p><img src="http://tutorials.jenkov.com/images/java-concurrency/same-threading-1.png" alt="单线程系统。"></p>
<p>第二个图显示了一个多线程系统，其中线程共享数据。</p>
<p><img src="http://tutorials.jenkov.com/images/java-concurrency/same-threading-2.png" alt="多线程系统。"></p>
<p>第三幅图显示了一个具有2个线程且具有单独数据的同线程系统，它们通过相互传递消息进行通信。</p>
<p><img src="http://tutorials.jenkov.com/images/java-concurrency/same-threading-3.png" alt="同线程系统。"></p>
<h2 id="Java线程操作"><a href="#Java线程操作" class="headerlink" title="Java线程操作"></a>Java线程操作</h2><p>Thread Ops for Java是一个开源工具包，旨在帮助您更轻松地实现单独的状态相同的线程系统。线程操作包含用于启动和停止单个线程以及通过单个线程实现某种程度的并发性的工具。如果您对使用相同线程的应用程序设计感兴趣，那么让Thread Ops看起来可能很有趣。您可以在我<a target="_blank" rel="noopener" href="http://tutorials.jenkov.com/thread-ops-java/index.html">的Java线程操作教程中</a>阅读有关线程操作的更多信息。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>





  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/5/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><a class="extend next" rel="next" href="/page/7/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



      

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      

      

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">弱智骚年</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.0/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  


















  








  

  

</body>
</html>
